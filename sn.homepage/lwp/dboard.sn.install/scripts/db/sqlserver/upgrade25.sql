-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2001, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- 5724_S68                                              
USE HOMEPAGE; 
GO

BEGIN TRANSACTION
GO

-- START LNOO7WEME2: Patching the widget id in case they are too short. If a widget it is too short then the upgrade25.sql will fail
-- SPR ID#:  LNOO7WEME2 upgrade25.sql fails when the widgetId it is short in the WIDGET table.
-- Disalbe fk constraints:
ALTER TABLE HOMEPAGE.PREREQ DROP CONSTRAINT FK_PREREQ_WIDGET;
GO

ALTER TABLE HOMEPAGE.USER_WIDGET_PREF DROP CONSTRAINT FK_WIDGET_ID;
GO


-- Update the WIDGET_ID - WIDGET TABLE
update  HOMEPAGE.WIDGET  
set     WIDGET.WIDGET_ID = SUBSTRING('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', (LEN(WIDGET_ID)+1) , LEN(WIDGET_ID) ) + '' + WIDGET.WIDGET_ID
where   LEN(WIDGET.WIDGET_ID) < 30;

GO

-- Update the WIDGET_ID - USER_WIDGET_PREF
update  HOMEPAGE.USER_WIDGET_PREF 
set     USER_WIDGET_PREF.WIDGET_ID =  SUBSTRING('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', (LEN(WIDGET_ID)+1) , LEN(WIDGET_ID) ) + '' + USER_WIDGET_PREF.WIDGET_ID
where   LEN(USER_WIDGET_PREF.WIDGET_ID) < 30;

GO

-- Update the WIDGET_ID - PREREQ
update  HOMEPAGE.PREREQ 
set     PREREQ.WIDGET_ID = SUBSTRING('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', (LEN(WIDGET_ID)+1) , LEN(WIDGET_ID)) + '' +  PREREQ.WIDGET_ID
where   LEN(PREREQ.WIDGET_ID) < 30;

GO

-- put back the key
ALTER TABLE HOMEPAGE.USER_WIDGET_PREF
    ADD CONSTRAINT FK_WIDGET_ID FOREIGN KEY (WIDGET_ID)
        REFERENCES HOMEPAGE.WIDGET (WIDGET_ID);
GO

ALTER TABLE HOMEPAGE.PREREQ
        ADD CONSTRAINT FK_PREREQ_WIDGET FOREIGN KEY (WIDGET_ID)
        REFERENCES HOMEPAGE.WIDGET (WIDGET_ID)
        ON DELETE CASCADE;
GO
-- END LNOO7WEME2

------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
-- START THE DEFINITION FOR THE SEARCH DATABASE
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------
-- SEARCH -  CREATE THE TABLES
----------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.SR_TASKDEF (
	TASK_ID nvarchar(36) NOT NULL,
	TASK_NAME nvarchar(256) NOT NULL,
	STARTBY nvarchar(256),
	INTERVAL nvarchar(256),
	TASK_TYPE nvarchar(36) NOT NULL,
	ENABLED NUMERIC(5,0) DEFAULT 1 NOT NULL
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.SR_INDEXINGTASKDEF (
	INDEXING_TASK_ID nvarchar(36) NOT NULL,
	TASK_ID nvarchar(36) NOT NULL,
	INDEXING_TASK_SERVICES nvarchar(256) NOT NULL,
	INDEXING_TASK_OPTIMIZE NUMERIC(5,0) NOT NULL	
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.SR_FILESCONTENT (
	FILESCONTENT_ID nvarchar(36) NOT NULL,
	URL nvarchar(256) NOT NULL,
	COMPONENT_UUID nvarchar(36) NOT NULL,
	COMPONENT nvarchar(36) NOT NULL,
	CREATION_DATE DATETIME NOT NULL,
	LAST_MODIFIED_DATE DATETIME NOT NULL,
	LAST_ACCESSED_DATE DATETIME NOT NULL,
	IS_CURRENT NUMERIC(5,0) NOT NULL,
	CONTENT nvarchar(MAX) NOT NULL,
	FILE_SIZE NUMERIC(19,0) NOT NULL,
	CONTENT_SIZE NUMERIC(19,0) NOT NULL,
	INPUT_MIME_TYPE nvarchar(256) NOT NULL,
	CLAIMED NUMERIC(5,0) DEFAULT 0 NOT NULL,
	CLAIMED_TIME DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL
)  ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.SR_OPTIMIZETASKDEF (
	OPTIMIZE_TASK_ID nvarchar(36) NOT NULL,	
	TASK_ID nvarchar(36) NOT NULL	
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.SR_MIGTASKDEFINFO (
	MIGTASKDEFINFO_ID nvarchar(36) NOT NULL,
	NUM_TASKS_MIG NUMERIC(10,0) DEFAULT 1 NOT NULL  
)  ON [PRIMARY]
GO

CREATE VIEW HOMEPAGE.SR_ALLTASKSDEF AS
(
	SELECT 	T1.TASK_ID  		AS	PARENT_TASK_ID,
	T1.TASK_NAME 				AS	PARENT_TASK_NAME,
	T1.INTERVAL 				AS	PARENT_TASK_INTERVAL,
	T1.STARTBY	 				AS	PARENT_TASK_STARTBY,
	T1.TASK_TYPE 				AS	PARENT_TASK_TYPE, 
    T1.ENABLED 					AS  PARENT_TASK_ENABLED,
	T2.INDEXING_TASK_SERVICES	AS	INDEXING_TASK_SERVICES,
	T2.INDEXING_TASK_OPTIMIZE	AS	INDEXING_TASK_OPTIMIZE,
	T2.INDEXING_TASK_ID			AS	INDEXING_TASK_ID,
	''							AS	OPTIMIZE_TASK_ID,
	T2.INDEXING_TASK_ID			AS	CHILDTASK_PK
	FROM    HOMEPAGE.SR_TASKDEF T1,HOMEPAGE.SR_INDEXINGTASKDEF T2 
	WHERE T1.TASK_ID=T2.TASK_ID
) 
UNION 
(
	SELECT T3.TASK_ID			AS 	PARENT_TASK_ID,
	T3.TASK_NAME 				AS 	PARENT_TASK_NAME,
	T3.INTERVAL					AS 	PARENT_TASK_INTERVAL,
	T3.STARTBY 					AS	PARENT_TASK_STARTBY,
	T3.TASK_TYPE 				AS 	PARENT_TASK_TYPE, 
 	T3.ENABLED 			AS  PARENT_TASK_ENABLED,
	''							AS 	INDEXING_TASK_SERVICES,
	0							AS	INDEXING_TASK_OPTIMIZE,
	''							AS	INDEXING_TASK_ID,
	T4.OPTIMIZE_TASK_ID 		AS	OPTIMIZE_TASK_ID,
	T4.OPTIMIZE_TASK_ID			AS	CHILDTASK_PK
	FROM   HOMEPAGE.SR_TASKDEF T3,HOMEPAGE.SR_OPTIMIZETASKDEF T4
	WHERE  T3.TASK_ID=T4.TASK_ID
)
GO

----------------------------------------------------------------------------
-- SEARCH -  CREATE THE CONSTRAINTS
----------------------------------------------------------------------------
ALTER TABLE HOMEPAGE.SR_TASKDEF
	 ADD CONSTRAINT PK_TASK_ID PRIMARY KEY (TASK_ID)
GO	 

ALTER TABLE HOMEPAGE.SR_INDEXINGTASKDEF
	ADD CONSTRAINT PK_INDEX_TASK_ID PRIMARY KEY (INDEXING_TASK_ID)
GO	

ALTER TABLE HOMEPAGE.SR_OPTIMIZETASKDEF
	ADD CONSTRAINT PK_OPT_TASK_ID PRIMARY KEY (OPTIMIZE_TASK_ID)
GO

ALTER TABLE HOMEPAGE.SR_FILESCONTENT
	ADD CONSTRAINT PK_FILESCONTENT_ID PRIMARY KEY (FILESCONTENT_ID)
GO

ALTER TABLE HOMEPAGE.SR_MIGTASKDEFINFO
	ADD CONSTRAINT PK_MIGTASKDEF_ID PRIMARY KEY(MIGTASKDEFINFO_ID)
GO

ALTER TABLE HOMEPAGE.SR_INDEXINGTASKDEF
	ADD CONSTRAINT FK_INDEX_TASK_ID FOREIGN KEY (TASK_ID) 
	REFERENCES HOMEPAGE.SR_TASKDEF(TASK_ID) ON DELETE CASCADE
GO	

ALTER TABLE HOMEPAGE.SR_OPTIMIZETASKDEF
	ADD CONSTRAINT FK_OPT_TASK_ID FOREIGN KEY (TASK_ID) 
	REFERENCES  HOMEPAGE.SR_TASKDEF(TASK_ID) ON DELETE CASCADE
GO	

ALTER TABLE HOMEPAGE.SR_TASKDEF
    ADD CONSTRAINT UNIQUE_TASK_NAME UNIQUE (TASK_NAME)
GO    
    
ALTER TABLE HOMEPAGE.SR_INDEXINGTASKDEF
	ADD CONSTRAINT UNIQUE_TASK_ID_IND UNIQUE (TASK_ID)
GO	

ALTER TABLE HOMEPAGE.SR_OPTIMIZETASKDEF
	ADD CONSTRAINT UNIQUE_TASK_ID_OPT UNIQUE (TASK_ID)
GO

ALTER TABLE HOMEPAGE.SR_FILESCONTENT
	ADD CONSTRAINT UNIQUE_COMP_UUID UNIQUE (COMPONENT_UUID,COMPONENT)
GO

ALTER TABLE HOMEPAGE.SR_TASKDEF
    ADD CONSTRAINT CHECK_SR_TASKDEF
    CHECK ( (STARTBY IS NOT NULL AND INTERVAL IS NOT NULL) OR (STARTBY IS NULL AND INTERVAL IS NULL) );
GO

-------------------------------------------------------------------
-- START GRANT LCUSER FOR THE SEARCH TABLES
-------------------------------------------------------------------
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.SR_TASKDEF TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.SR_OPTIMIZETASKDEF TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.SR_INDEXINGTASKDEF TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.SR_FILESCONTENT TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.SR_ALLTASKSDEF TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.SR_MIGTASKDEFINFO TO HOMEPAGEUSER
GO

-------------------------------------------------------------------
-- START SEARCH SCHEDULER TABLES
-------------------------------------------------------------------

DROP TABLE HOMEPAGE.LOTUSCONNECTIONSTASK;
DROP TABLE HOMEPAGE.LOTUSCONNECTIONSTREG;
DROP TABLE HOMEPAGE.LOTUSCONNECTIONSLMGR;
DROP TABLE HOMEPAGE.LOTUSCONNECTIONSLMPR;

CREATE TABLE HOMEPAGE.LOTUSCONNECTIONSTASK ( [TASKID] BIGINT NOT NULL ,
               [VERSION] NVARCHAR(5) NOT NULL ,
               [ROW_VERSION] INT NOT NULL ,
               [TASKTYPE] INT NOT NULL ,
               [TASKSUSPENDED] TINYINT NOT NULL ,
               [CANCELLED] TINYINT NOT NULL ,
               [NEXTFIRETIME] BIGINT NOT NULL ,
               [STARTBYINTERVAL] NVARCHAR(254) NULL ,
               [STARTBYTIME] BIGINT NULL ,
               [VALIDFROMTIME] BIGINT NULL ,
               [VALIDTOTIME] BIGINT NULL ,
               [REPEATINTERVAL] NVARCHAR(254) NULL ,
               [MAXREPEATS] INT NOT NULL ,
               [REPEATSLEFT] INT NOT NULL ,
               [TASKINFO] IMAGE NULL ,
               [NAME] NVARCHAR(254) NOT NULL ,
               [AUTOPURGE] INT NOT NULL ,
               [FAILUREACTION] INT NULL ,
               [MAXATTEMPTS] INT NULL ,
               [QOS] INT NULL ,
               [PARTITIONID] INT NULL ,
               [OWNERTOKEN] NVARCHAR(200) NOT NULL ,
               [CREATETIME] BIGINT NOT NULL ) 
GO

ALTER TABLE HOMEPAGE.LOTUSCONNECTIONSTASK WITH NOCHECK ADD CONSTRAINT LOTUSCONNECTIONSTASK_PK PRIMARY KEY  NONCLUSTERED ( [TASKID] ) 
GO

CREATE INDEX LOTUSCONNECTIONSTASK_IDX1 ON HOMEPAGE.LOTUSCONNECTIONSTASK ( [TASKID],
               [OWNERTOKEN] ) 
GO

CREATE CLUSTERED INDEX LOTUSCONNECTIONSTASK_IDX2 ON HOMEPAGE.LOTUSCONNECTIONSTASK ( [NEXTFIRETIME] ASC,
               [REPEATSLEFT],
               [PARTITIONID] )
GO

CREATE TABLE HOMEPAGE.LOTUSCONNECTIONSTREG ( [REGKEY] NVARCHAR(254) NOT NULL ,
               [REGVALUE] NVARCHAR(254) NULL ,
               PRIMARY KEY ( [REGKEY] ) )
GO

CREATE TABLE HOMEPAGE.LOTUSCONNECTIONSLMGR ( [LEASENAME] NVARCHAR(254) NOT NULL,
               [LEASEOWNER] NVARCHAR(254) NOT NULL,
               [LEASE_EXPIRE_TIME] BIGINT,
               [DISABLED] NVARCHAR(5) )
GO

ALTER TABLE HOMEPAGE.LOTUSCONNECTIONSLMGR WITH NOCHECK ADD CONSTRAINT LOTUSCONNECTIONSLMGR_PK PRIMARY KEY  NONCLUSTERED ( [LEASENAME] ) 
GO

CREATE TABLE HOMEPAGE.LOTUSCONNECTIONSLMPR ( [LEASENAME] NVARCHAR(224) NOT NULL,
               [NAME] NVARCHAR(224) NOT NULL,
               [VALUE] NVARCHAR(254) NOT NULL )
GO

CREATE INDEX LOTUSCONNECTIONSLMPR_IDX1 ON HOMEPAGE.LOTUSCONNECTIONSLMPR ( [LEASENAME],
               [NAME] ) 
GO

-- SEARCH
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.LOTUSCONNECTIONSLMPR TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.LOTUSCONNECTIONSLMGR TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.LOTUSCONNECTIONSTREG TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.LOTUSCONNECTIONSTASK TO HOMEPAGEUSER
GO
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
-- END THE DEFINITION FOR THE SEARCH DATABASE
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------

 
CREATE TABLE HOMEPAGE.HP_UI  (
	UI_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	PERSON_LANG nvarchar(5) NOT NULL,
	LAST_VISIT DATETIME NOT NULL,
	WELCOME_MODE NUMERIC(5,0) NOT NULL DEFAULT 1,
	SHOW_DISABLED_WIDGETS NUMERIC(5,0) NOT NULL DEFAULT 0 
) ON [PRIMARY]
GO
 
CREATE TABLE HOMEPAGE.HP_TAB  (
	TAB_ID nvarchar(36) NOT NULL,
	DEFAULT_NAME nvarchar(36) NOT NULL,
	DEFAULT_N_COLUMNS NUMERIC(5, 0) NOT NULL DEFAULT 0,
	IS_NAME_CHANGEABLE NUMERIC(5,0) NOT NULL DEFAULT 0	
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.HP_TAB_INST  (
	TAB_INST_ID nvarchar(36) NOT NULL,
	TAB_ID nvarchar(36) NOT NULL,
	UI_ID nvarchar(36) NOT NULL,
	TAB_NAME nvarchar(36),
	N_COLUMNS NUMERIC(5, 0) NOT NULL DEFAULT 0,
	LAST_MODIFIED DATETIME NOT NULL
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.HP_WIDGET_INST  (
	WIDGET_INST_ID nvarchar(36) NOT NULL,
	WIDGET_ID nvarchar(36) NOT NULL,
	TAB_INST_ID nvarchar(36) NOT NULL,
	WIDGET_SETTING nvarchar(2048),
	CONTAINER nvarchar(36),
	ORDER_SEQUENCE NUMERIC(5, 0),
	IS_FIXED NUMERIC(5,0),
	IS_TOGGLED NUMERIC(5,0),
	LAST_MODIFIED DATETIME NOT NULL,
	LAST_UPDATED DATETIME
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.HP_WIDGET_TAB (
	WIDGET_TAB_ID nvarchar(36) NOT NULL,
	WIDGET_ID nvarchar(36) NOT NULL,
	TAB_ID nvarchar(36) NOT NULL,
	TYPE nvarchar(36) NOT NULL
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.NT_NOTIFICATION  (
	  NOTIFICATION_ID nvarchar(36) NOT NULL,
	  NOTIFICATION_SOURCE nvarchar(36) NOT NULL,
	  NOTIFICATION_TYPE nvarchar(256) NOT NULL,
	  DATETIME_STAMP DATETIME NOT NULL,
	  SENDER_EXID nvarchar(36) NOT NULL,
	  SUBJECT nvarchar(256),
	  MESSAGE nvarchar(2048),
	  CONTAINER_NAME nvarchar(256),
	  CONTAINER_URL nvarchar(2048),
	  ITEM_NAME nvarchar(256),
	  ITEM_URL nvarchar(2048)
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.NT_NOTIFICATION_RECIPIENT (
		  ID nvarchar(36) NOT NULL,
		  NOTIFICATION_ID nvarchar(36) NOT NULL,
		  RECIPIENT_EXID nvarchar(36) NOT NULL		  
) ON [PRIMARY]
GO

-- START Populate the HP_TAB table
-- Insert the panel tab page widget
INSERT INTO HOMEPAGE.HP_TAB 
			(TAB_ID, DEFAULT_NAME, DEFAULT_N_COLUMNS, IS_NAME_CHANGEABLE)
VALUES 		('_panel.widgetx4a43x82aaxb00187218631' , '%panel.widget' , 2 , 0);

-- Insert the panel tab page update
INSERT INTO HOMEPAGE.HP_TAB 
			(TAB_ID, DEFAULT_NAME, DEFAULT_N_COLUMNS, IS_NAME_CHANGEABLE)
VALUES 		('_panel.updatex4a43x82aaxb00187218631' , '%panel.update' , 1 , 0);

-- Insert the panel tab page widget
INSERT INTO HOMEPAGE.HP_TAB
			(TAB_ID, DEFAULT_NAME, DEFAULT_N_COLUMNS, IS_NAME_CHANGEABLE)
VALUES 		('_panel.customx4a43x82aaxb00187218631' , '%panel.custom' , 2 , 1); 


-- START Populate the HP_HP_UI and table HP_TAB_INST
-- move all the info stored into HOMEPAGE.PERSON into HOMEPAGE.UI 
-- moving: LAST_VISIT, WELCOME_MODE, SHOW_DISABLED_WIDGETS from PERSON to UI
-- copy USER_ID in PERSON_ID
INSERT INTO HOMEPAGE.HP_UI  (UI_ID, PERSON_ID, PERSON_LANG, LAST_VISIT, WELCOME_MODE, SHOW_DISABLED_WIDGETS) 
	SELECT 'UIxxxxxx' + '' + SUBSTRING(P.PERSON_ID, 9, LEN(P.PERSON_ID)), P.PERSON_ID, 'en-EN', P.LAST_VISIT, P.WELCOME_MODE, P.SHOW_DISABLED_WIDGETS
	FROM HOMEPAGE.PERSON P;
-- END  Populate the HP_HP_UI


-- START Populate HP_TAB_INST
-- For each UI record create the related tab_inst records. So for each UI we will have 3 records
-- insert values inside the HP_TAB_INST with the default name %widget_page and %panel.update.
-- I don't insert %panel.custom because the user cannot have any custom panel
INSERT INTO HOMEPAGE.HP_TAB_INST  (TAB_INST_ID, TAB_ID, UI_ID, TAB_NAME, N_COLUMNS, LAST_MODIFIED) 
	SELECT '_panel.widget_' + '' + SUBSTRING(UI.UI_ID, 15, LEN(UI.UI_ID)), '_panel.widgetx4a43x82aaxb00187218631',UI.UI_ID, '%panel.widget',2, (CURRENT_TIMESTAMP)
	FROM HOMEPAGE.HP_UI UI;

INSERT INTO HOMEPAGE.HP_TAB_INST  (TAB_INST_ID, TAB_ID, UI_ID, TAB_NAME, N_COLUMNS, LAST_MODIFIED) 
	SELECT '_panel.update_' + '' + SUBSTRING(UI.UI_ID, 15, LEN(UI.UI_ID)), '_panel.updatex4a43x82aaxb00187218631',UI.UI_ID, '%panel.update',2, (CURRENT_TIMESTAMP)                
	FROM HOMEPAGE.HP_UI UI;
-- END Populate HP_TAB_INST
	
-- START Populate HP_WIDGET_INST
-- insert values inside the HP_WIDGET_INST with the default name %widget_page
-- add a temp column: TEMP_CONTAINER

ALTER TABLE HOMEPAGE.HP_WIDGET_INST
	ADD TEMP_CONTAINER NUMERIC(5,0);
GO

-- Just the records with USER_WIDGET_PREF.ROW_NUM > 0 AND USER_WIDGET_PREF.COL_NUM > 0 are inserted because they are open widgets
INSERT INTO HOMEPAGE.HP_WIDGET_INST  (WIDGET_INST_ID, WIDGET_ID, TAB_INST_ID, WIDGET_SETTING, CONTAINER, ORDER_SEQUENCE, IS_FIXED, IS_TOGGLED, LAST_MODIFIED, LAST_UPDATED, TEMP_CONTAINER) 
SELECT TEMP.USER_WIDGET_PREF_ID, TEMP.WIDGET_ID, TAB_INST_ID,  TEMP.WIDGET_SETTING, '', TEMP.ROW_NUM, 0, MAX_MIN, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TEMP.COL_NUM
FROM (
        SELECT  USER_WIDGET_PREF.USER_WIDGET_PREF_ID, USER_WIDGET_PREF.WIDGET_ID, HP_TAB_INST.TAB_INST_ID ,USER_WIDGET_PREF.WIDGET_SETTING, USER_WIDGET_PREF.COL_NUM, USER_WIDGET_PREF.ROW_NUM, 0 as TMP_COL1, USER_WIDGET_PREF.MAX_MIN, CURRENT_TIMESTAMP as TMP_COL2, CURRENT_TIMESTAMP  as TMP_COL3
        FROM    HOMEPAGE.PERSON PERSON, HOMEPAGE.HP_TAB_INST HP_TAB_INST, HOMEPAGE.HP_UI HP_UI, HOMEPAGE.USER_WIDGET_PREF USER_WIDGET_PREF
        WHERE   PERSON.PERSON_ID = HP_UI.PERSON_ID AND HP_UI.UI_ID = HP_TAB_INST.UI_ID AND PERSON.PERSON_ID = USER_WIDGET_PREF.USER_ID AND
                HP_TAB_INST.TAB_NAME = '%panel.widget' AND USER_WIDGET_PREF.ROW_NUM > 0 AND USER_WIDGET_PREF.COL_NUM > 0
) AS TEMP;

-- The new orders sequence count start from 0 and not from 1. Decrease the old value stored in ROW_NUM (now ORDER_SEQUENCE) of one
UPDATE HOMEPAGE.HP_WIDGET_INST SET ORDER_SEQUENCE = (ORDER_SEQUENCE-1)
GO

-- By default IS_TOGGLED is setted to 0
UPDATE HOMEPAGE.HP_WIDGET_INST SET IS_TOGGLED = 0
GO

UPDATE HOMEPAGE.HP_WIDGET_INST SET 
	CONTAINER = '1'
WHERE HOMEPAGE.HP_WIDGET_INST.TEMP_CONTAINER = 1
GO

UPDATE HOMEPAGE.HP_WIDGET_INST SET 
	CONTAINER = '2'
WHERE HOMEPAGE.HP_WIDGET_INST.TEMP_CONTAINER = 2
GO

-- remove a temp column: TEMP_CONTAINER
ALTER TABLE HOMEPAGE.HP_WIDGET_INST DROP COLUMN TEMP_CONTAINER
GO
-- END Populate HP_WIDGET_INST

-- START Alter the Person table
ALTER TABLE HOMEPAGE.PERSON DROP COLUMN LAST_VISIT
GO

-- REMOVING WELCOME_MODE COLUMN. BEFORE WE NEED TO REMOVE THE CONSTRAINT
DECLARE @CONST_NAME as nvarchar(128), @DROP_STMT as nvarchar(2000)
SET @CONST_NAME = (select name from sys.default_constraints where parent_object_id=OBJECT_ID('HOMEPAGE.PERSON') and parent_column_id=6)
SET @DROP_STMT = N'ALTER TABLE HOMEPAGE.PERSON DROP CONSTRAINT ' + @CONST_NAME
EXEC (@DROP_STMT)
GO

ALTER TABLE HOMEPAGE.PERSON DROP COLUMN WELCOME_MODE
GO

-- REMOVING SHOW_DISABLED_WIDGETS COLUMN. BEFORE WE NEED TO REMOVE THE CONSTRAINT
DECLARE @CONST_NAME as nvarchar(128), @DROP_STMT as nvarchar(2000)
SET @CONST_NAME = (select name from sys.default_constraints where parent_object_id=OBJECT_ID('HOMEPAGE.PERSON') and parent_column_id=7)
SET @DROP_STMT = N'ALTER TABLE HOMEPAGE.PERSON DROP CONSTRAINT ' + @CONST_NAME
EXEC (@DROP_STMT)
GO

ALTER TABLE HOMEPAGE.PERSON DROP COLUMN SHOW_DISABLED_WIDGETS
GO
-- END Alter the Person table

-- drop the old table HOMEPAGE.USER_WIDGET_PREF
DROP TABLE HOMEPAGE.USER_WIDGET_PREF
GO

-- START to add the new columns into WIDGET tables and update it values
-- adding the new columns WIDGET_PREVIEW_IMAGE and WIDGET_CATEGORY to the WIDGET table
ALTER TABLE HOMEPAGE.WIDGET
ADD WIDGET_PREVIEW_IMAGE nvarchar(256)
GO

ALTER TABLE HOMEPAGE.WIDGET
ADD WIDGET_CATEGORY nvarchar(36) NOT NULL DEFAULT ' '
GO

ALTER TABLE HOMEPAGE.WIDGET
ADD WIDGET_IS_DEFAULT_OPENED NUMERIC(5,0) DEFAULT 0 NOT NULL
GO

ALTER TABLE HOMEPAGE.WIDGET
ADD WIDGET_MULTIPLE_INSTANCES NUMERIC(5,0) DEFAULT 0 NOT NULL
GO

ALTER TABLE HOMEPAGE.WIDGET
ADD WIDGET_MARKED_CACHABLE  NUMERIC(5,0) DEFAULT 0 NOT NULL
GO

ALTER TABLE HOMEPAGE.WIDGET
ADD WIDGET_SECURE_URL nvarchar(256) DEFAULT ''
GO

ALTER TABLE HOMEPAGE.WIDGET
ADD WIDGET_SECURE_ICON nvarchar(256) DEFAULT ''
GO

-- UPDATE THE OLD WIDGETS
UPDATE HOMEPAGE.WIDGET SET 
	WIDGET_CATEGORY = 'DOGEAR', 
	WIDGET_PREVIEW_IMAGE='${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg',
	WIDGET_MULTIPLE_INSTANCES=0,
	WIDGET_IS_DEFAULT_OPENED=1,
	WIDGET_MARKED_CACHABLE=0,
	WIDGET_ICON         = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png',
	WIDGET_SECURE_URL   = 'web/widgets/dogear/dogear.xml', 
	WIDGET_SECURE_ICON  = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png'
WHERE WIDGET_TITLE = '%widget.dogear.name'AND WIDGET_ID='dogear46x0a77x4a43x82aaxb00187218631';

UPDATE HOMEPAGE.WIDGET SET 
	WIDGET_CATEGORY = 'ACTIVITIES', 
	WIDGET_PREVIEW_IMAGE='${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg',
	WIDGET_MULTIPLE_INSTANCES=0,
	WIDGET_IS_DEFAULT_OPENED=1,
	WIDGET_MARKED_CACHABLE=0,
	WIDGET_ICON         = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconActivities16.png',
	WIDGET_SECURE_URL   = 'web/widgets/activities/activities.xml',
	WIDGET_SECURE_ICON  = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconActivities16.png'
WHERE WIDGET_TITLE = '%widget.activities.name' AND WIDGET_ID='activitixa187x491dxa4bfx2e1261d0b6ec';

UPDATE HOMEPAGE.WIDGET SET 
	WIDGET_CATEGORY = 'COMMUNITIES', 
	WIDGET_PREVIEW_IMAGE = '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg',
	WIDGET_MULTIPLE_INSTANCES=0,
	WIDGET_IS_DEFAULT_OPENED=1,
	WIDGET_MARKED_CACHABLE=0,
	WIDGET_ICON         = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconCommunities16.png',
	WIDGET_SECURE_URL   = 'web/widgets/communities/communities.xml', 
    WIDGET_SECURE_ICON  = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconCommunities16.png'
WHERE WIDGET_TITLE = '%widget.communities.name' AND WIDGET_ID='communitxe7c4x4e08xab54x80e7a4eb8933';

UPDATE HOMEPAGE.WIDGET SET 
	WIDGET_CATEGORY = 'BLOGS', 
	WIDGET_PREVIEW_IMAGE = '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg',
	WIDGET_MULTIPLE_INSTANCES=0,
	WIDGET_IS_DEFAULT_OPENED=1,
	WIDGET_MARKED_CACHABLE=0,
	WIDGET_ICON         = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBlogs16.png',
	WIDGET_SECURE_URL   = 'web/widgets/blogs/blogs.xml', 
	WIDGET_SECURE_ICON  = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBlogs16.png'
WHERE WIDGET_TITLE = '%widget.blogs.name' AND WIDGET_ID='blogs448xcd34x4565x9469x9c34fcefe48c';

UPDATE HOMEPAGE.WIDGET SET 
	WIDGET_CATEGORY = 'PROFILES', 
	WIDGET_PREVIEW_IMAGE='${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg',
	WIDGET_MULTIPLE_INSTANCES=0,
	WIDGET_IS_DEFAULT_OPENED=1,
	WIDGET_MARKED_CACHABLE=0,
	WIDGET_ICON         = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconProfiles16.png',
	WIDGET_SECURE_URL   = 'web/widgets/profiles/profiles.xml', 
	WIDGET_SECURE_ICON  = '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconProfiles16.png'
WHERE WIDGET_TITLE = '%widget.profiles.name' AND WIDGET_ID='profilesxaac7x4229x87bbx9a1c3551c591';

UPDATE HOMEPAGE.WIDGET SET 
	WIDGET_CATEGORY = 'OTHER',
	WIDGET_PREVIEW_IMAGE = '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg',
	WIDGET_MULTIPLE_INSTANCES=0,
	WIDGET_IS_DEFAULT_OPENED=0,
	WIDGET_MARKED_CACHABLE=0
WHERE   WIDGET_TITLE != '%widget.dogear.name' AND
        WIDGET_TITLE != '%widget.activities.name' AND
        WIDGET_TITLE != '%widget.communities.name' AND
        WIDGET_TITLE != '%widget.blogs.name' AND
        WIDGET_TITLE != '%widget.profiles.name';
        
-- END to add the new columns into WIDGET tables and update it values

------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------


--------------------------------------
-- REMOVE THE OLD CONSTRAINTS THAT NOW ARE BEEN RENAMED
--------------------------------------

ALTER TABLE HOMEPAGE.LOGINNAME 
	DROP CONSTRAINT FK_PERSON_ID;
GO

--------------------------------------
-- CREATE THE CONSTRAINTS
--------------------------------------

ALTER TABLE HOMEPAGE.HP_UI
    ADD CONSTRAINT PK_HP_UI PRIMARY KEY (UI_ID)  
GO    

ALTER TABLE HOMEPAGE.HP_TAB
    ADD CONSTRAINT PK_HP_TAB PRIMARY KEY (TAB_ID)
GO
    
ALTER TABLE HOMEPAGE.HP_TAB_INST
    ADD CONSTRAINT PK_HP_TAB_INST PRIMARY KEY (TAB_INST_ID)    
GO    
	
ALTER TABLE HOMEPAGE.HP_WIDGET_TAB 
	ADD CONSTRAINT PK_WIDGET_TAB PRIMARY KEY (WIDGET_TAB_ID)
GO

ALTER TABLE HOMEPAGE.HP_WIDGET_INST
	ADD CONSTRAINT PK_HP_WIDGET_INST PRIMARY KEY (WIDGET_INST_ID)
GO
	
ALTER TABLE HOMEPAGE.NT_NOTIFICATION
	ADD CONSTRAINT PK_NOTIFICATION PRIMARY KEY (NOTIFICATION_ID)
	
ALTER TABLE HOMEPAGE.NT_NOTIFICATION_RECIPIENT
	ADD CONSTRAINT PK_NOTIF_RECIP PRIMARY KEY (ID)
GO

ALTER TABLE HOMEPAGE.LOGINNAME
	ADD CONSTRAINT FK_LN_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)
GO
	
ALTER TABLE HOMEPAGE.HP_UI
    ADD CONSTRAINT FK_UI_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)	
GO	
	
ALTER TABLE HOMEPAGE.HP_TAB_INST
    ADD CONSTRAINT FK_UI_ID FOREIGN KEY (UI_ID)
	REFERENCES HOMEPAGE.HP_UI(UI_ID)
GO

ALTER TABLE HOMEPAGE.HP_TAB_INST
    ADD CONSTRAINT FK_TAB_INST_TAB_ID FOREIGN KEY (TAB_ID)
	REFERENCES HOMEPAGE.HP_TAB(TAB_ID)
GO

ALTER TABLE HOMEPAGE.HP_WIDGET_INST
    ADD CONSTRAINT FK_WIDGET_ID FOREIGN KEY (WIDGET_ID)
	REFERENCES HOMEPAGE.WIDGET (WIDGET_ID)
GO

ALTER TABLE HOMEPAGE.HP_WIDGET_INST
    ADD CONSTRAINT FK_TAB_INST_ID FOREIGN KEY (TAB_INST_ID)
	REFERENCES HOMEPAGE.HP_TAB_INST (TAB_INST_ID)
GO

ALTER TABLE HOMEPAGE.HP_WIDGET_TAB	
    ADD CONSTRAINT FK_WID_TAB_WID_ID FOREIGN KEY (WIDGET_ID)
	REFERENCES HOMEPAGE.WIDGET (WIDGET_ID)
GO

ALTER TABLE HOMEPAGE.HP_WIDGET_TAB	
    ADD CONSTRAINT FK_WID_TAB_TAB_ID FOREIGN KEY (TAB_ID)
	REFERENCES HOMEPAGE.HP_TAB (TAB_ID)
GO	
	
ALTER TABLE HOMEPAGE.NT_NOTIFICATION_RECIPIENT 
	ADD CONSTRAINT FK_RECIP_NOTIF FOREIGN KEY (NOTIFICATION_ID)
	REFERENCES HOMEPAGE.NT_NOTIFICATION (NOTIFICATION_ID)
	ON DELETE CASCADE
GO

--------------------------------------
-- CREATE THE INDEXES
--------------------------------------
CREATE INDEX WIDGET_INST
	ON HOMEPAGE.HP_WIDGET_INST (TAB_INST_ID ASC, WIDGET_ID ASC)
GO
	
CREATE INDEX HP_UI_PERSON_ID_INDEX
	ON HOMEPAGE.HP_UI (PERSON_ID)
GO

CREATE INDEX NT_NOTIFICATION_EXID_INDEX
	ON HOMEPAGE.NT_NOTIFICATION(SENDER_EXID)
GO
	
CREATE INDEX NT_NOTIF_RECT_EXID_INDEX
	ON HOMEPAGE.NT_NOTIFICATION_RECIPIENT(RECIPIENT_EXID)
GO	
	
CREATE INDEX NT_NOTIF_RECT_NID_INDEX
	ON HOMEPAGE.NT_NOTIFICATION_RECIPIENT(NOTIFICATION_ID)
GO

CREATE INDEX TAB_INST_UI_ID_IDX 
	ON HOMEPAGE.HP_TAB_INST(UI_ID)
GO

CREATE INDEX HP_WIDGET_INST_TAB_INST_ID_IDX
	ON HOMEPAGE.HP_WIDGET_INST(TAB_INST_ID)
GO
	
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------	

------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
-- STARTING OF THE DEFINITION FOR THE NEWS REPOSITORY DATABASE
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------
-- NEWS REPOSITORY - CREATE THE TABLES
----------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SOURCE (
	SOURCE_ID nvarchar(36) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(36) NOT NULL,
	CONTAINER_NAME nvarchar(256),
	CONTAINER_URL nvarchar(2048),
	ENTRY_ID  nvarchar(36),
	ENTRY_NAME nvarchar(256),
	ENTRY_URL nvarchar(2048),
	ENTRY_ATOM_URL nvarchar(2048),
	IS_ACL NUMERIC(5,0) NOT NULL,
	IS_PRIVATE NUMERIC(5,0),
	LAST_UPDATE DATETIME,
	IS_CNAME_RTL NUMERIC(5,0) DEFAULT 0 NOT NULL,
	IS_ENAME_RTL NUMERIC(5,0) DEFAULT 0 NOT NULL
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.NR_SUBSCRIPTION  (
	SUBSCRIPTION_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	SOURCE_ID nvarchar(36) NOT NULL,
	IS_EXPLICIT NUMERIC(5,0) NOT NULL,
	IS_ACTIVE NUMERIC(5,0) DEFAULT 1 NOT NULL
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.NR_NEWS_RECORDS (
	NEWS_RECORDS_ID nvarchar(36) NOT NULL,
	EVENT_NAME nvarchar(256) NOT NULL,
    READER_ID nvarchar(36),
    SOURCE nvarchar(36),
    CONTAINER_ID nvarchar(36),
    CONTAINER_NAME nvarchar(256),
    CONTAINER_URL nvarchar(2048),
    ENTRY_ID nvarchar(36),
    ENTRY_NAME nvarchar(256),
    ENTRY_URL nvarchar(2048),
    ENTRY_ATOM_URL nvarchar(2048),
    CREATION_DATE DATETIME NOT NULL,
    IS_INBOX NUMERIC(5,0) NOT NULL,
    IS_SAVED NUMERIC(5,0) NOT NULL,
    IS_TOP_STORY NUMERIC(5,0) NOT NULL,
    IS_PUBLIC NUMERIC(5,0) NOT NULL,
    IS_MAILED NUMERIC(5,0) NOT NULL,
    TIME_STAMP DATETIME NOT NULL,
    BRIEF_DESC nvarchar(512),
    IS_BRIEF_DESC_RTL NUMERIC(5,0) NOT NULL,
    ACTOR_UUID nvarchar(36),
    EVENT_RECORD_UUID nvarchar(36) NOT NULL,
    RELATED_COMM_UUID nvarchar(36),
    RELATED_COMM_NAME nvarchar(256),
    TAGS nvarchar(1024),
    META_TEMPLATE nvarchar(4000) NOT NULL DEFAULT '',
    TEXT_META_TEMPLATE nvarchar(1024),
    IS_CONTAINER NUMERIC(5,0) DEFAULT 0 NOT NULL
) ON [PRIMARY]
GO


CREATE TABLE HOMEPAGE.NR_TEMPLATE (
	TEMPLATE_ID nvarchar(36) NOT NULL,
 	NAME nvarchar(256) NOT NULL,
 	FORMAT nvarchar(256) NOT NULL,
 	DATA_SOURCE_STRING nvarchar(256) NOT NULL,
 	NO_VALUES NUMERIC(5,0) NOT NULL
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.NR_EVENT_RECORDS  (
	EVENT_RECORD_ID nvarchar(36) NOT NULL,
	EVENT_RECORD_CONTENT varbinary (MAX),
	IS_ACL NUMERIC(5,0) NOT NULL
) ON [PRIMARY]
GO

-- EMAIL DIGEST
CREATE TABLE HOMEPAGE.EMD_RECIPIENTS (
	RECIPIENT_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	FREQUENCY_UPDATE NUMERIC(5,0) NOT NULL,
	LAST_SENT_UPDATE DATETIME NOT NULL,
	MAIL_DOMAIN nvarchar(256) NOT NULL,
	MAIL_ADDRESS  nvarchar(256) NOT NULL,
	LOCALE nvarchar(5),
	DISPLAYNAME nvarchar(256)
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.EMD_JOBS  (
	JOB_ID nvarchar(36) NOT NULL,
	JOB_FREQUENCY NUMERIC(5,0) NOT NULL,
	NEXT_EXEC_TIME DATETIME,
	DUE_DATE_EXEC_TIME DATETIME,
	START_JOB DATETIME,
	END_JOB DATETIME,
	STATUS nvarchar(36),
	N_PERSONS_TO_UPDATE NUMERIC(10,0),
	AVG_EXEC_TIME_SECONDS NUMERIC(10,0),
	JOB_FREQUENCY_SCALE nvarchar(36) NOT NULL DEFAULT ''
) ON [PRIMARY]
GO

CREATE TABLE HOMEPAGE.EMD_JOBS_STATS (
	STAT_ID nvarchar(36) NOT NULL,
	JOB_ID nvarchar(36) NOT NULL,
	START_TIME DATETIME NOT NULL,
    END_TIME DATETIME NOT NULL,
    EXEC_TIME_SECONDS NUMERIC(10,0),
    N_PERSONS_UPDATED NUMERIC(10,0),
    STATUS nvarchar(36) DEFAULT 'COMPLETED' NOT NULL
) ON [PRIMARY]
GO
----------------------------------------------------------------------------
-- NEWS REPOSITORY -  CREATE THE CONSTRAINTS
----------------------------------------------------------------------------
ALTER TABLE HOMEPAGE.NR_SOURCE
    ADD CONSTRAINT PK_SOURCE_ID PRIMARY KEY(SOURCE_ID)    
GO

ALTER TABLE HOMEPAGE.NR_SUBSCRIPTION
    ADD CONSTRAINT PK_SUBSCRIPTION_ID PRIMARY KEY(SUBSCRIPTION_ID)
GO

ALTER TABLE HOMEPAGE.NR_NEWS_RECORDS
    ADD CONSTRAINT PK_NR_NEWS_RECORDS PRIMARY KEY(NEWS_RECORDS_ID)
GO

ALTER TABLE HOMEPAGE.NR_TEMPLATE 
    ADD CONSTRAINT PK_TEMPLATE_ID PRIMARY KEY(TEMPLATE_ID)
GO
    
ALTER TABLE HOMEPAGE.NR_SUBSCRIPTION
    ADD CONSTRAINT FK_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
GO

ALTER TABLE HOMEPAGE.NR_SUBSCRIPTION
    ADD CONSTRAINT FK_SOURCE_ID FOREIGN KEY (SOURCE_ID)
	REFERENCES HOMEPAGE.NR_SOURCE (SOURCE_ID)	
GO

ALTER TABLE HOMEPAGE.NR_EVENT_RECORDS
    ADD CONSTRAINT PK_EVENT_RECORD_ID PRIMARY KEY(EVENT_RECORD_ID)
GO 

-- EMAIL DIGEST CONSTRAINTS
ALTER TABLE HOMEPAGE.EMD_RECIPIENTS
    ADD CONSTRAINT PK_RECIPIENT_ID PRIMARY KEY(RECIPIENT_ID)
GO    

ALTER TABLE HOMEPAGE.EMD_JOBS
    ADD CONSTRAINT PK_JOB_ID PRIMARY KEY(JOB_ID)
GO

ALTER TABLE HOMEPAGE.EMD_JOBS_STATS
    ADD CONSTRAINT PK_STAT_ID PRIMARY KEY(STAT_ID)
GO

ALTER TABLE HOMEPAGE.EMD_RECIPIENTS
    ADD CONSTRAINT FK_REC_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)
GO
	
ALTER TABLE HOMEPAGE.EMD_JOBS_STATS
    ADD CONSTRAINT FK_JOB_ID FOREIGN KEY (JOB_ID)
	REFERENCES HOMEPAGE.EMD_JOBS (JOB_ID)
GO

ALTER TABLE HOMEPAGE.EMD_JOBS
	ADD CONSTRAINT UNIQUE_JOB_FREQ UNIQUE(JOB_FREQUENCY)
GO

----------------------------------------------------------------------------
-- NEWS REPOSITORY -  CREATE THE INDEXES
----------------------------------------------------------------------------
CREATE UNIQUE INDEX NR_SUBSCRIPTION_IX_UNIQUE
	ON HOMEPAGE.NR_SUBSCRIPTION(PERSON_ID ASC, SOURCE_ID ASC)
GO

CREATE INDEX NR_SUBSCRIPTION_SOURCE_IDX  
    ON HOMEPAGE.NR_SUBSCRIPTION(SOURCE_ID);
GO

CREATE UNIQUE INDEX NR_SOURCE_IX_UNIQUE
	ON HOMEPAGE.NR_SOURCE(SOURCE ASC, CONTAINER_ID ASC, ENTRY_ID ASC, IS_ACL ASC)
GO

CREATE INDEX NR_SOURCE_CONTAINER_NAME_IDX
    ON HOMEPAGE.NR_SOURCE(SOURCE ASC, CONTAINER_NAME ASC, ENTRY_ID ASC, IS_ACL ASC);
GO

CREATE INDEX NR_NEWS_RECORDS_READER_IDX
	ON HOMEPAGE.NR_NEWS_RECORDS(READER_ID)
GO	

CREATE INDEX NR_NEWS_RECORDS_ACTOR_IDX
	ON HOMEPAGE.NR_NEWS_RECORDS(ACTOR_UUID)
GO	

CREATE INDEX NR_NEWS_RECORDS_SOURCE_IDX 
	ON HOMEPAGE.NR_NEWS_RECORDS (CREATION_DATE DESC, NEWS_RECORDS_ID, READER_ID, IS_CONTAINER, IS_PUBLIC, SOURCE);
GO

CREATE INDEX NR_NEWS_RECORDS_CONTAINER_IDX
	ON HOMEPAGE.NR_NEWS_RECORDS(CONTAINER_ID)
GO
	
CREATE INDEX NR_NEWS_RECORDS_DATE_IDX
	ON HOMEPAGE.NR_NEWS_RECORDS(CREATION_DATE DESC)
GO

CREATE INDEX NR_NEWS_RECORDS_EVENT_IDX
	ON HOMEPAGE.NR_NEWS_RECORDS(EVENT_RECORD_UUID)
GO

CREATE INDEX NR_NEWS_RECORDS_IX1 
	ON HOMEPAGE.NR_NEWS_RECORDS (CREATION_DATE DESC, NEWS_RECORDS_ID, READER_ID, IS_CONTAINER, IS_PUBLIC)
GO

CREATE INDEX NR_READ_SOUR_ACTR_IS_PUB_IDX
	ON HOMEPAGE.NR_NEWS_RECORDS (READER_ID, SOURCE, ACTOR_UUID, IS_PUBLIC)
GO	

CREATE INDEX NR_READER_ER_UUID_IDX
	ON HOMEPAGE.NR_NEWS_RECORDS (READER_ID, EVENT_RECORD_UUID)
GO
	
CREATE INDEX NR_READER_IS_TOP_STORY_IDX 
	ON HOMEPAGE.NR_NEWS_RECORDS (CREATION_DATE DESC, NEWS_RECORDS_ID, READER_ID, IS_TOP_STORY)
GO

CREATE INDEX NR_READER_IS_SAVED_IDX 
	ON HOMEPAGE.NR_NEWS_RECORDS(CREATION_DATE DESC, READER_ID, IS_SAVED);
GO

CREATE INDEX NR_READER_TOPSTORY_SRC_IDX 
	ON HOMEPAGE.NR_NEWS_RECORDS (CREATION_DATE DESC, NEWS_RECORDS_ID, READER_ID, IS_TOP_STORY, SOURCE)
GO

CREATE UNIQUE INDEX NR_NEWS_RECORDS_COMM_UUID_IDX
     ON HOMEPAGE.NR_NEWS_RECORDS ( CREATION_DATE DESC, NEWS_RECORDS_ID, SOURCE, RELATED_COMM_UUID ) INCLUDE ( READER_ID, IS_CONTAINER, IS_PUBLIC );
GO

-- EMAIL DIGEST INDEXES
CREATE INDEX EMD_RECIPIENTS_SENT_UPDATE_IDX
	ON HOMEPAGE.EMD_RECIPIENTS(LAST_SENT_UPDATE DESC)
GO	

CREATE INDEX EMD_RECIPIENTS_MAIL_DOMAIN_IDX
	ON HOMEPAGE.EMD_RECIPIENTS(MAIL_DOMAIN DESC)
GO

-------------------------------------------------------------------
-- START ADDING SCHEDULER TABLES
-------------------------------------------------------------------

CREATE TABLE HOMEPAGE.NR_SCHEDULER_TASK (
	[TASKID] BIGINT NOT NULL ,
	[VERSION] NVARCHAR(5) NOT NULL ,
	[ROW_VERSION] INT NOT NULL ,
	[TASKTYPE] INT NOT NULL ,
	[TASKSUSPENDED] TINYINT NOT NULL ,
	[CANCELLED] TINYINT NOT NULL ,
	[NEXTFIRETIME] BIGINT NOT NULL ,
	[STARTBYINTERVAL] NVARCHAR(254) NULL ,
	[STARTBYTIME] BIGINT NULL ,
	[VALIDFROMTIME] BIGINT NULL ,
    [VALIDTOTIME] BIGINT NULL ,
    [REPEATINTERVAL] NVARCHAR(254) NULL ,
    [MAXREPEATS] INT NOT NULL ,
    [REPEATSLEFT] INT NOT NULL ,
    [TASKINFO] IMAGE NULL ,
    [NAME] NVARCHAR(254) NOT NULL ,
    [AUTOPURGE] INT NOT NULL ,
    [FAILUREACTION] INT NULL ,
    [MAXATTEMPTS] INT NULL ,
    [QOS] INT NULL ,
    [PARTITIONID] INT NULL ,
    [OWNERTOKEN] NVARCHAR(200) NOT NULL ,
    [CREATETIME] BIGINT NOT NULL
) 
GO

ALTER TABLE HOMEPAGE.NR_SCHEDULER_TASK WITH NOCHECK 
	ADD CONSTRAINT NR_SCHEDULER_TASK_PK PRIMARY KEY  NONCLUSTERED ( [TASKID] ) 
GO

CREATE INDEX NR_SCHEDULER_TASK_IDX1 
	ON HOMEPAGE.NR_SCHEDULER_TASK ( [TASKID], [OWNERTOKEN] ) 
GO

CREATE CLUSTERED INDEX NR_SCHEDULER_TASK_IDX2 
	ON HOMEPAGE.NR_SCHEDULER_TASK ( [NEXTFIRETIME] ASC, [REPEATSLEFT], [PARTITIONID] )
GO

CREATE TABLE HOMEPAGE.NR_SCHEDULER_TREG ( 
	[REGKEY] NVARCHAR(254) NOT NULL ,
	[REGVALUE] NVARCHAR(254) NULL ,
	PRIMARY KEY ( [REGKEY] ) )
GO

CREATE TABLE HOMEPAGE.NR_SCHEDULER_LMGR ( 
	[LEASENAME] NVARCHAR(254) NOT NULL,
	[LEASEOWNER] NVARCHAR(254) NOT NULL,
	[LEASE_EXPIRE_TIME] BIGINT,
	[DISABLED] NVARCHAR(5) )
GO

ALTER TABLE HOMEPAGE.NR_SCHEDULER_LMGR WITH NOCHECK 
	ADD CONSTRAINT NR_SCHEDULER_LMGR_PK PRIMARY KEY  NONCLUSTERED ( [LEASENAME] ) 
GO

CREATE TABLE HOMEPAGE.NR_SCHEDULER_LMPR ( 
	[LEASENAME] NVARCHAR(224) NOT NULL,
	[NAME] NVARCHAR(224) NOT NULL,
    [VALUE] NVARCHAR(254) NOT NULL )
GO

CREATE INDEX NR_SCHEDULER_LMPR_IDX1 
	ON HOMEPAGE.NR_SCHEDULER_LMPR ( [LEASENAME], [NAME] ) 
GO
	
-------------------------------------------------------------------
-- END ADDING SCHEDULER TABLES
-------------------------------------------------------------------

------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
-- END OF THE DEFINITION FOR THE NEWS REPOSITORY DATABASE
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------


------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------

---------------------------------
--- START INSERTING THE NEW WIDGET
---------------------------------
-- Beginning Dogear widgets 

-- Dogear MyBookmarks widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY,  WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('dembk46x0a77x4a43x82aaxb00187218631', '%widget.dogear.personal.name', '%widget.dogear.personal.desc', 'web/widgets/dogear/personal/mybookmarks.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'DOGEAR', 0,  0, 'web/widgets/dogear/personal/mybookmarks.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('7c1a34f1xc9cax4cc4x8b0bx51af2ddef2cd', 'dogear', 'dembk46x0a77x4a43x82aaxb00187218631');

-- Dogear PopularBookmarks widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('depbk46x0a77x4a43x82aaxb00187218631', '%widget.dogear.popular.name', '%widget.dogear.popular.desc', 'web/widgets/dogear/popular/popularbookmarks.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'DOGEAR', 0,  0, 'web/widgets/dogear/popular/popularbookmarks.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('7w1a60f1xc9cax4cc4x8b0bx51af2ddef2cd', 'dogear', 'depbk46x0a77x4a43x82aaxb00187218631');

-- Dogear RecentBookmarks widget - opened by default
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('derbk46x0a77x4a43x82aaxb00187218631',  '%widget.dogear.recent.name', '%widget.dogear.recent.desc', 'web/widgets/dogear/recent/recentbookmarks.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'DOGEAR', 0, 0, 'web/widgets/dogear/recent/recentbookmarks.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('7t1a60f1xc9cax4cc4x8b0bx51af2ddef2cd', 'dogear', 'derbk46x0a77x4a43x82aaxb00187218631');

-- Dogear WatchList widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('dewl46x0a77x4a43x82aaxb00187218631', '%widget.dogear.watchlist.name', '%widget.dogear.watchlist.desc', 'web/widgets/dogear/watching/watchlist.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'DOGEAR',  0, 0, 'web/widgets/dogear/watching/watchlist.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconBookmarks16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('7m1a60f1xc9cax4cc4x8b0bx51af2ddef2cd', 'dogear', 'dewl46x0a77x4a43x82aaxb00187218631');

-- End Dogear widgets

-- Beginning Activities widgets

-- Activities MyActivities widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('myactxa187x491dxa4bfx2e1261d0b6ec', '%widget.activities.personal.name', '%widget.activities.personal.desc', 'web/widgets/activities/personal/myactivities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconActivities16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'ACTIVITIES', 0, 0, 'web/widgets/activities/personal/myactivities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconActivities16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('fab0b9ccx9ffex4874xbf4ax10e389b5b4e3', 'activities', 'myactxa187x491dxa4bfx2e1261d0b6ec');

-- Activities PublicActivities widget - opened by default
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('pubactxa187x491dxa4bfx2e1261d0b6ec',  '%widget.activities.public.name', '%widget.activities.public.desc', 'web/widgets/activities/pub/publicactivities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconActivities16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'ACTIVITIES', 0,  0, 'web/widgets/activities/pub/publicactivities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconActivities16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('fab0v9ccx9ffex4523xbf4ax10e389b5b4e3', 'activities', 'pubactxa187x491dxa4bfx2e1261d0b6ec');

-- Sidebar Activities TODO widget - in update page
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('activities-sidebar7x4229x8',  '%widget.activities.sidebar.todo.name', '%widget.activities.sidebar.todo.desc', 'web/widgets/activitiesSideBar/activities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconActivities16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'ACTIVITIES', 1,  0, 'web/widgets/activitiesSideBar/activities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconActivities16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('fab0z9ccx9ffex4523xbf4ax10e389b5b4e3', 'activities', 'activities-sidebar7x4229x8');

-- End Activities widgets



-- Beginning Communities widgets

-- Communities MyCommunities widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('mycommunxe7c4x4e08xab54x80e7a4eb8933',  '%widget.communities.personal.name', '%widget.communities.personal.desc', 'web/widgets/communities/personal/mycommunities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconCommunities16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'COMMUNITIES', 0, 0, 'web/widgets/communities/personal/mycommunities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconCommunities16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('73de6624x9317x4195x90c0x696c1b6da4ff', 'communities', 'mycommunxe7c4x4e08xab54x80e7a4eb8933');

-- Communities PublicCommunities widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID,  WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('pubcommuxe7c4x4e08xab54x80e7a4eb8933',  '%widget.communities.public.name', '%widget.communities.public.desc', 'web/widgets/communities/pub/publiccommunities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconCommunities16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'COMMUNITIES', 0, 0, 'web/widgets/communities/pub/publiccommunities.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconCommunities16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('73de8824x9677y4195x90c0x696c1b6da4ff', 'communities', 'pubcommuxe7c4x4e08xab54x80e7a4eb8933');

-- End Communities widgets

-- Beginning Profiles widgets

-- Profiles MyProfile widget - opened by default
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID,  WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('myprofisxaac7x4229x87bbx9a1c3551c591', '%widget.profiles.personal.name', '%widget.profiles.personal.desc', 'web/widgets/profiles/personal/myprofile.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconProfiles16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'PROFILES', 0, 0, 'web/widgets/profiles/personal/myprofile.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconProfiles16.png' );

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('4a848b83x7451x4ad0x807ex2aa4373360bd', 'profiles', 'myprofisxaac7x4229x87bbx9a1c3551c591');

-- Profiles ColleagueProfile widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY, WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('colprofsxaac7x4229x87bbx9a1c3551c591', '%widget.profiles.colleagues.name', '%widget.profiles.colleagues.desc', 'web/widgets/profiles/colleagues/colleagueprofile.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconProfiles16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'PROFILES',  0,  0, 'web/widgets/profiles/colleagues/colleagueprofile.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconProfiles16.png' );

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('4a848b83x7891x4aw0x807ex2aa4373360bd', 'profiles', 'colprofsxaac7x4229x87bbx9a1c3551c591');

-- End Profiles widgets



-- Beginning Wiki Widget

-- My Wiky widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY,  WIDGET_IS_DEFAULT_OPENED,  WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('mywikiz1xaac7x4229x87BBx91ac3551c591', '%widget.mywiki.name', '%widget.mywiki.desc', 'web/widgets/wiki/mywiki.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconWikis16.png', 1, 1, 1, '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'WIKI',  0, 0, 'web/widgets/wiki/mywiki.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconWikis16.png' );

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('4a848b83x7621x4awk5020ex2aa4373360bd', 'wikis', 'mywikiz1xaac7x4229x87BBx91ac3551c591');

-- Popular Wiki
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY,  WIDGET_IS_DEFAULT_OPENED,  WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('pop-wiki1xaac7x4229x87BBx91ac3551c5', '%widget.popwiki.name', '%widget.popwiki.desc', 'web/widgets/wiki/popularwiki.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconWikis16.png', 1, 1, 1,  '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'WIKI',  0,  0, 'web/widgets/wiki/popularwiki.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconWikis16.png' );

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('4a848b8997620ojaw08d20ex2o4837336r8j', 'wikis', 'pop-wiki1xaac7x4229x87BBx91ac3551c5');

-- Latest wiki
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY,  WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('latest-wiki5jz1xaac7x4229x87BBx91ac', '%widget.latestwiki.name', '%widget.latestwiki.desc', 'web/widgets/wiki/latestwiki.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconWikis16.png', 1, 1, 1,  '${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'WIKI',  1, 0, 'web/widgets/wiki/latestwiki.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconWikis16.png' );

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('45thpb899762998dw08ee96x20of33o0Ur8j', 'wikis', 'latest-wiki5jz1xaac7x4229x87BBx91ac');

-- My Files widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY,  WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('myFilesPb86locI7vRV4yY1KKawZvE8Qul88', '%widget.files.name', '%widget.files.desc', 'web/widgets/files/files.xml','${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconFiles16.png', 1, 1, 1,'${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'FILES',  1, 0, 'web/widgets/files/files.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconFiles16.png' );

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('U9PdeKPWtviSGv2QP57ZRady4RHYBPyXCL9a','files','myFilesPb86locI7vRV4yY1KKawZvE8Qul88');

-- Files shared with me widget
INSERT INTO HOMEPAGE.WIDGET
            (WIDGET_ID, WIDGET_TITLE, WIDGET_TEXT, WIDGET_URL, WIDGET_ICON, WIDGET_ENABLED, WIDGET_SYSTEM, WIDGET_HOMEPAGE_SPECIFIC, WIDGET_PREVIEW_IMAGE, WIDGET_CATEGORY,  WIDGET_IS_DEFAULT_OPENED, WIDGET_MULTIPLE_INSTANCES, WIDGET_SECURE_URL, WIDGET_SECURE_ICON)
VALUES      ('sharedFilesV4fv72LD5NAcGv2nbrex0ExEq', '%widget.sharedfiles.name', '%widget.sharedfiles.desc', 'web/widgets/files/sharedFiles.xml','${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconFiles16.png', 1, 1, 1,'${HOMEPAGE_CONTEXT_ROOT}/web/jsp/palette/images/profiles_my_colleagues.jpg', 'FILES',  0, 0, 'web/widgets/files/sharedFiles.xml', '${HOMEPAGE_CONTEXT_ROOT}/images/default_buttons/png/iconFiles16.png');

INSERT INTO HOMEPAGE.PREREQ
            (PREREQ_ID, APP_ID, WIDGET_ID)
VALUES      ('JlNdbgUL4kAwMEFAEAwlYXQ3YBOWnBry4x6Y','files','sharedFilesV4fv72LD5NAcGv2nbrex0ExEq');



---------------------------------
--- END INSERTING THE NEW WIDGETS
---------------------------------

----------------
--- INSERT THE DATA INTO THE WIDGET_TAB TABLE
----------------
-- Dogear Original Widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_dogear7x4229x87BBx91ac3551c5', 'dogear46x0a77x4a43x82aaxb00187218631', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Dogear MyBookmarks widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_dembkx7x4229x87BBx91ac3551c5', 'dembk46x0a77x4a43x82aaxb00187218631', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Dogear PopularBookmarks widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_depbkx7x4229x87BBx91ac3551c5', 'depbk46x0a77x4a43x82aaxb00187218631', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Dogear RecentBookmarks widget - opened by default
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_derbkx7x4229x87BBx91ac3551c5', 'derbk46x0a77x4a43x82aaxb00187218631', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Dogear WatchList widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_dewlx7x4229x87BBx91ac3551c5', 'dewl46x0a77x4a43x82aaxb00187218631', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Activities Original Widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_activitixa187x491dxa4bfx2e1', 'activitixa187x491dxa4bfx2e1261d0b6ec', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Activities MyActivities widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_myactxa187x491dxa4bfx2e1261', 'myactxa187x491dxa4bfx2e1261d0b6ec', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Activities PublicActivities widget - opened by default
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_pubactxa187x491dxa4bfx2e126', 'pubactxa187x491dxa4bfx2e1261d0b6ec', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Communities Original Widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_communitxe7c4x4e08xab54x80e', 'communitxe7c4x4e08xab54x80e7a4eb8933', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Communities MyCommunities widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_mycommunxe7c4x4e08xab54x80e', 'mycommunxe7c4x4e08xab54x80e7a4eb8933', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Communities PublicCommunities widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_pubcommuxe7c4x4e08xab54x80e', 'pubcommuxe7c4x4e08xab54x80e7a4eb8933', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Blogs widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_blogs448xcd34x4565x9469x9c3', 'blogs448xcd34x4565x9469x9c34fcefe48c', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Profiles Original Widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_profilesxaac7x4229x87bbx9a1', 'profilesxaac7x4229x87bbx9a1c3551c591', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Profiles MyProfile widget - opened by default
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_myprofisxaac7x4229x87bbx9a1', 'myprofisxaac7x4229x87bbx9a1c3551c591', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Profiles ColleagueProfile widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_colprofsxaac7x4229x87bbx9al', 'colprofsxaac7x4229x87bbx9a1c3551c591', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- My Wiky widget                
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_mywikiz1xaac7x4229x87BBx91a', 'mywikiz1xaac7x4229x87BBx91ac3551c591', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Popular Wiki
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_pop-wiki1xaac7x4229x87BBx91', 'pop-wiki1xaac7x4229x87BBx91ac3551c5', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Latest wiki
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_latest-wiki5jz1xaac7x4229x8', 'latest-wiki5jz1xaac7x4229x87BBx91ac', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Files Widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_HXMb14Y53n2XAuLeHgrZI3f1CEGhN', 'myFilesPb86locI7vRV4yY1KKawZvE8Qul88', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Files sharded with me widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('WIDGET_FfQvWEJHX1TBvSCW0PS8ayfbPlZ1k', 'sharedFilesV4fv72LD5NAcGv2nbrex0ExEq', '_panel.widgetx4a43x82aaxb00187218631', 'primary');

-- Sidebar activities widget
INSERT INTO HOMEPAGE.HP_WIDGET_TAB
        (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE)
VALUES  ('UPDATES_activities-sidebar', 'activities-sidebar7x4229x8', '_panel.updatex4a43x82aaxb00187218631', 'primary');

-- Third party widgets
INSERT INTO HOMEPAGE.HP_WIDGET_TAB  (WIDGET_TAB_ID, WIDGET_ID, TAB_ID, TYPE) 
	SELECT 'WIDGET_OTHERS_' + '' + SUBSTRING(WIDGET.WIDGET_ID, 15, LEN(WIDGET.WIDGET_ID)), WIDGET.WIDGET_ID, '_panel.widgetx4a43x82aaxb00187218631','primary'
	FROM HOMEPAGE.WIDGET WIDGET
        WHERE WIDGET.WIDGET_CATEGORY = 'OTHER';

----------------
--- END THE DATA INTO THE WIDGET_TAB TABLE
----------------


------------ 
--- START INSERT TEMPLATES
------------

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('actor-Bei35oPldKwZTaR7aAiPFw4L08CyRW','actor', 'actorExtID', 'profilePhoto', 1); 

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('actorProfile-CAsyXgPhQd7N3wSMw7C0IUe','actorProfiles', 'actorExtID', 'profilePhoto', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('target-Ah3vEOPQZDEpgpwcQ2JNaHFfMnMcG','subject', 'targetSubjectExtIDs', 'profilePhoto', 3);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('actEnt-anXIr0xP82OSZnuoYbAZa2M5AsRFr', 'activityEntry', 'activity.entry.name;activity.entry.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('actEntComm-WEJHX1TBvSCW0PS8ayfbPlZ1k','activityEntryWithComment', 'activity.entry.name;activity.entry.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('actCont-WHHEhu6HTkRWtCQPylcUdSENF4mU', 'activityContainerName', 'activity.name;activity.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('actCont-Mg2xRFBLmRqg3Zj7Etrdttiyc6OH','activityContainerNameACL', 'activity.name;htmlURL', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('actToDo-psOHtvbY4lOJv8jOXJH5YgLoGYP7','toDoEntry', 'activity.todo.name;activity.todo.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('blog-Itf9INx14G6bbCWRYNRpLhSawJXF8Qs','blogContainerName', 'blog.name;blog.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('blogNew-qsgRrfp88AKWys4wcm4gIuZm3T2p','newBlogContainer', 'blog.name;htmlURL', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('blogEntry-ubpjmKeG6Vi8XpQXYKVx3mtCqm','blogEntry', 'blog.entry.name;htmlURL', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('blogComment-92JYbZEOrk0CBLEJHYwkrqPA','blogEntryWithComment', 'blog.entry.name;blog.comment.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('comm-Qf0I5rSEaImjaCcds3HYi4SeCGYCDCN','newCommunityContainer', 'community.name;community.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('comm-new-IduwKhHDNCLdmJFi0G7lwrE86IJ','communityContainerName', 'community.name;community.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('comm-topic6V808ijHf9TRgUSUqVVZoSOGg5','topicEntryName', 'community.topic.name;htmlURL', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('comm-book-VSWMFF7uZVaE11XRe4Q1ElJIc6','communityBookmarkEntryName', 'community.bookmark.name;community.bookmark.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('comm-feed-Ja6XFBT7kyfEJv07Unitc0MsJT','feedEntryName', 'community.feed.name;community.feed.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('dogear-book-DXAWZl1FIGMuMr4Ea4Lejbum','dogearBookmarkEntry', 'dogear.bookmark.title;htmlURL', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('tags-a7YmLTHTY2FdHKPsHU0wbAZCkgYrkk1','tag', 'tags', 'plain', 3);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('profileEntry-Vrh9M5YNmxNogF2oERZWyRE','profileLinkEntry', 'profiles.link.title;profiles.link.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('profile-status-HNX0o3AF32cFuPWhtYMjl','profileStatusEntry', 'status', 'plain', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('wiki-9qgQLuYLDdh66pf82um3c6q1lQ0gZl5','wikiContainerName','wiki.name;wiki.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('wiki-page-P75oD6oAdgoWCRNt4YYh7hZfuM','wikiEntryPage', 'wiki.page.name;wiki.page.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('wiki-comment-Ye2xdX8pbYM996pc7je30LI','wikiEntryPageCommented', 'wiki.page.name;wiki.page.url', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('file-bbqZpR6oxvE2sYAXxasKS0EtS1mDg4h','fileEntry', 'file.name;htmlURL', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('collection-7jEWoKkWx8ucNTo6Z7AndhRFh','collectionContainer', 'files.collection.name;htmlURL', 'link', 1);

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('wiki-9qgQLuYLDdh66pf82um3c6q1lQdfgt5','newWikiContainer','wiki.name;wiki.url', 'link', 1);


------------
--- END INSERT TEMPLATES
------------


-- ALTER THE HOMEPAGE_SCHEMA TABLE INSERTING THE NEW COLUMN RELEASEVER SET TO 2.5
DELETE FROM HOMEPAGE.HOMEPAGE_SCHEMA;

ALTER TABLE HOMEPAGE.HOMEPAGE_SCHEMA
ADD RELEASEVER nvarchar(32) NOT NULL DEFAULT ''
GO

ALTER TABLE HOMEPAGE.HOMEPAGE_SCHEMA
ALTER COLUMN  DBSCHEMAVER    NUMERIC(5,0) NOT NULL;
GO

INSERT INTO HOMEPAGE.HOMEPAGE_SCHEMA
	(COMPKEY, DBSCHEMAVER, RELEASEVER)
VALUES ('HOMEPAGE', 21 ,'2.5.0.0');


--------------------------------------
-- GRANT TO HOMEPAGE USER
--------------------------------------
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.HP_UI TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.HP_TAB TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.HP_TAB_INST TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.HP_WIDGET_INST TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.HP_WIDGET_TAB TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NT_NOTIFICATION TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NT_NOTIFICATION_RECIPIENT TO HOMEPAGEUSER
GO
-- NEWS REPOSITORY
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NR_SOURCE TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NR_SUBSCRIPTION TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NR_NEWS_RECORDS TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NR_TEMPLATE TO HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NR_EVENT_RECORDS TO  HOMEPAGEUSER
GO
-- Email digest
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.EMD_RECIPIENTS TO  HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.EMD_JOBS TO  HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.EMD_JOBS_STATS TO  HOMEPAGEUSER
GO
-- Scheduler
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NR_SCHEDULER_TASK TO  HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NR_SCHEDULER_TREG TO  HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NR_SCHEDULER_LMGR TO  HOMEPAGEUSER
GO
GRANT DELETE,INSERT,SELECT,UPDATE ON HOMEPAGE.NR_SCHEDULER_LMPR TO  HOMEPAGEUSER
GO

--------------------------------------
-- DISCONNECT
--------------------------------------

COMMIT
