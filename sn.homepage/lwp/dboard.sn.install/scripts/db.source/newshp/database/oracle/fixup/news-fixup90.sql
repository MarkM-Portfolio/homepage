-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

DROP TABLE HOMEPAGE.NR_COMM_SETTINGS;

-----------------------------------------------
-- HOMEPAGE.NR_COMM_SETTINGS
-----------------------------------------------

CREATE TABLE HOMEPAGE.NR_COMM_SETTINGS (
	COMM_ID VARCHAR2(36) NOT NULL,
	MICROBLOGGING_WRITE_ACL NUMBER(5 ,0),
	FLAGS VARCHAR2(36)
)
TABLESPACE "NEWSREGTABSPACE";

ALTER TABLE HOMEPAGE.NR_COMM_SETTINGS
    ADD (CONSTRAINT PK_COMM_ID PRIMARY KEY(COMM_ID) USING INDEX TABLESPACE "NEWSINDEXTABSPACE");

ALTER TABLE HOMEPAGE.NR_COMM_SETTINGS ENABLE ROW MOVEMENT;



COMMIT; 

-----------------------------------------------------
-- NR_PROFILES_VIEW
-----------------------------------------------------
CREATE TABLE HOMEPAGE.NR_PROFILES_VIEW (
	CATEGORY_READER_ID VARCHAR2(36)  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR2(36),
	CATEGORY_TYPE NUMBER(5,0) NOT NULL,
	SOURCE VARCHAR2(36) NOT NULL,
	CONTAINER_ID VARCHAR2(256),
	ITEM_ID VARCHAR2(36),
	ROLLUP_ENTRY_ID VARCHAR2(36),
	RESOURCE_TYPE NUMBER(5,0) NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR2(36) NOT NULL,
	SOURCE_TYPE NUMBER(5,0),
	USE_IN_ROLLUP NUMBER(5,0),
	IS_NETWORK	NUMBER(5,0),
	IS_FOLLOWER	NUMBER(5,0),
	EVENT_TIME TIMESTAMP,
	IS_STORY_COMM NUMBER(5 ,0),
	IS_BROADCAST NUMBER(5 ,0),
	ORGANIZATION_ID VARCHAR2(36),
	CONSTRAINT   	CK_CAT18_TYPE
    				CHECK
    				(CATEGORY_TYPE = 18)
)
TABLESPACE "NEWSREGTABSPACE";

ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW 
    ADD (CONSTRAINT PK_PROFILES_VIEW PRIMARY KEY(CATEGORY_READER_ID)  USING INDEX TABLESPACE "NEWSINDEXTABSPACE");

CREATE INDEX HOMEPAGE.PROFILES_VIEW_IDX
    ON HOMEPAGE.NR_PROFILES_VIEW (READER_ID, CREATION_DATE ASC) TABLESPACE NEWSINDEXTABSPACE;

CREATE INDEX HOMEPAGE.PROFILES_SIDX
    ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID) TABLESPACE NEWSINDEXTABSPACE;

CREATE INDEX HOMEPAGE.PROFILES_ITEM
    ON HOMEPAGE.NR_PROFILES_VIEW (ITEM_ID) TABLESPACE NEWSINDEXTABSPACE;

CREATE INDEX HOMEPAGE.PROFILES_STORIES_DATE
    ON HOMEPAGE.NR_PROFILES_VIEW (CREATION_DATE ASC) TABLESPACE NEWSINDEXTABSPACE;

CREATE UNIQUE INDEX HOMEPAGE.PROFILES_READER_STORY 		
	ON HOMEPAGE.NR_PROFILES_VIEW (READER_ID, STORY_ID) TABLESPACE NEWSINDEXTABSPACE;   

ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW ENABLE ROW MOVEMENT;



---------------------------------------------------------------------------------
-- Adding a new category for profiles view
---------------------------------------------------------------------------------
INSERT INTO HOMEPAGE.NR_CATEGORY_TYPE (CATEGORY_TYPE_ID, CATEGORY_TYPE, CATEGORY_TYPE_NAME, CATEGORY_TYPE_DESC)
VALUES ('profiles-view', 18, '%profiles', 'profiles');

---------------------------------------------------------------------------------
-- Adding IS_BROADCAST to ALL the readers table
---------------------------------------------------------------------------------
ALTER TABLE 	HOMEPAGE.NR_AGGREGATED_READERS		ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_AGGREGATED_READERS		ADD  ORGANIZATION_ID VARCHAR2(36);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_RESPONSES_READERS		ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_RESPONSES_READERS		ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_PROFILES_READERS		ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_PROFILES_READERS		ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_COMMUNITIES_READERS		ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_COMMUNITIES_READERS		ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ACTIVITIES_READERS		ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_ACTIVITIES_READERS		ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_BLOGS_READERS			ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_BLOGS_READERS			ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_BOOKMARKS_READERS		ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_BOOKMARKS_READERS		ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_FILES_READERS			ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_FILES_READERS			ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_FORUMS_READERS			ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_FORUMS_READERS			ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_WIKIS_READERS			ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_WIKIS_READERS			ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_TAGS_READERS			ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_TAGS_READERS			ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_STATUS_UPDATE_READERS	ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_STATUS_UPDATE_READERS	ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_EXTERNAL_READERS		ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_EXTERNAL_READERS		ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ACTIONABLE_READERS 		ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_ACTIONABLE_READERS 		ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;
ALTER TABLE 	HOMEPAGE.NR_DISCOVERY_VIEW			ADD  IS_BROADCAST NUMBER(5,0);
ALTER TABLE 	HOMEPAGE.NR_DISCOVERY_VIEW			ADD  ORGANIZATION_ID VARCHAR2(36);

COMMIT;

-------------------------------------------------------------------------------
-- ADDING ACTIVITY_META_DATA_1 and ACTIVITY_META_DATA_2
-------------------------------------------------------------------------------
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_ACT			ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_ACT			ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_ACT			ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_BLG			ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_BLG			ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_BLG			ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_COM			ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_COM			ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_COM			ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_WIK			ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_WIK			ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_WIK			ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_PRF			ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_PRF			ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_PRF			ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_HP			ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_HP			ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_HP			ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_DGR			ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_DGR			ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_DGR			ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_FILE		ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_FILE		ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_FILE		ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_FRM			ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_FRM			ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_FRM			ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_EXTERNAL	ADD  ACTIVITY_META_DATA_1 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_EXTERNAL	ADD  ACTIVITY_META_DATA_2 RAW(2000);
ALTER TABLE 	HOMEPAGE.NR_SRC_STORIES_EXTERNAL	ADD  IS_META_DATA_TRUNCATED  NUMBER(5,0);
COMMIT;


-------------------------------------------------------------------
-- REMOVING NR_ORGPERSON_FOLLOW AND NR_ORGPERSON_STORIES
-------------------------------------------------------------------
DROP TABLE HOMEPAGE.NR_ORGPERSON_STORIES;
DROP TABLE HOMEPAGE.NR_ORGPERSON_FOLLOW;
COMMIT;

-------------------------------------------------------------------
-- Add to: NR_ENTRIES_* the column SCOPE
-------------------------------------------------------------------
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_ACT			ADD  SCOPE NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_BLG			ADD  SCOPE NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_COM			ADD  SCOPE NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_WIK			ADD  SCOPE NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_PRF			ADD  SCOPE NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_HP			ADD  SCOPE NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_DGR			ADD  SCOPE NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_FILE		ADD  SCOPE NUMBER(5,0);	
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_FRM			ADD  SCOPE NUMBER(5,0);
COMMIT;
ALTER TABLE 	HOMEPAGE.NR_ENTRIES_EXTERNAL	ADD  SCOPE NUMBER(5,0);
COMMIT;

---------------------------------
-- CONVERT BLOB to CLOB
---------------------------------
-- TODO