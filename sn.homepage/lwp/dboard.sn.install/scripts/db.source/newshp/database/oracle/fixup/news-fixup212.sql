-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

-- 109943: Rename ENTRY_ID column in BOARD_OBJECT_REFERENCE
DROP INDEX HOMEPAGE.BRD_ENTRY_IDX;
COMMIT;

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE DROP CONSTRAINT FK_BRD_OBJ_ENTRY;
COMMIT;

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE RENAME COLUMN ENTRY_ID TO ITEM_ID;
COMMIT;

CREATE INDEX HOMEPAGE.BRD_ENTRY_IDX
    ON HOMEPAGE.BOARD_OBJECT_REFERENCE (ITEM_ID) TABLESPACE NEWSINDEXTABSPACE;
COMMIT;


---------------------------------------------------------------------
-- Adding Columns HOMEPAGE.NR_ENTRIES HOMEPAGE.NR_ENTRIES_ARCHIVE
---------------------------------------------------------------------

ALTER TABLE HOMEPAGE.NR_ENTRIES
       	ADD	JSON_META_DATA_TEMP CLOB 	LOB (JSON_META_DATA_TEMP) STORE AS (TABLESPACE NEWSLOBTABSPACE ENABLE STORAGE IN ROW CHUNK 480 CACHE );
COMMIT;


 DECLARE CURSOR cur IS SELECT ENTRY_ID, JSON_META_DATA FROM HOMEPAGE.NR_ENTRIES;
              BEGIN

                        FOR rec IN cur LOOP
                                UPDATE HOMEPAGE.NR_ENTRIES SET JSON_META_DATA_TEMP = rec.JSON_META_DATA WHERE ENTRY_ID = rec.ENTRY_ID;
                        END LOOP;
                        COMMIT;
                END;
 /
COMMIT;


ALTER TABLE HOMEPAGE.NR_ENTRIES
		DROP COLUMN JSON_META_DATA;
COMMIT:

ALTER TABLE HOMEPAGE.NR_ENTRIES
		RENAME COLUMN JSON_META_DATA_TEMP TO JSON_META_DATA;
COMMIT:

ALTER TABLE HOMEPAGE.NR_ENTRIES
	ADD	PREV_COMMENT_OBJECT_META_DATA CLOB 	LOB (PREV_COMMENT_OBJECT_META_DATA) STORE AS (TABLESPACE NEWSLOBTABSPACE ENABLE STORAGE IN ROW CHUNK 480 CACHE );
	
ALTER TABLE HOMEPAGE.NR_ENTRIES
	ADD	LAST_COMMENT_OBJECT_META_DATA CLOB 	LOB (LAST_COMMENT_OBJECT_META_DATA) STORE AS (TABLESPACE NEWSLOBTABSPACE ENABLE STORAGE IN ROW CHUNK 480 CACHE );	
	
ALTER TABLE HOMEPAGE.NR_ENTRIES
	ADD	LAST_COMMENT_TAGS VARCHAR2(1024);
	
ALTER TABLE HOMEPAGE.NR_ENTRIES
	ADD	PREV_COMMENT_TAGS VARCHAR2(1024);
	

COMMIT;

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
       	ADD	JSON_META_DATA_TEMP CLOB 	LOB (JSON_META_DATA_TEMP) STORE AS (TABLESPACE NEWSLOBTABSPACE ENABLE STORAGE IN ROW CHUNK 480 CACHE );
COMMIT;


 DECLARE CURSOR cur IS SELECT ENTRY_ID, JSON_META_DATA FROM HOMEPAGE.NR_ENTRIES_ARCHIVE; 
              BEGIN 
	                	
                        FOR rec IN cur LOOP 
                        	UPDATE HOMEPAGE.NR_ENTRIES_ARCHIVE SET JSON_META_DATA_TEMP = rec.JSON_META_DATA WHERE ENTRY_ID = rec.ENTRY_ID; 
                        END LOOP; 
                        COMMIT; 
                END; 
 / 
COMMIT;


ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
		DROP COLUMN JSON_META_DATA;
COMMIT:

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
		RENAME COLUMN JSON_META_DATA_TEMP TO JSON_META_DATA;
COMMIT:

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
	ADD	PREV_COMMENT_OBJECT_META_DATA CLOB 	LOB (PREV_COMMENT_OBJECT_META_DATA) STORE AS (TABLESPACE NEWSLOBTABSPACE ENABLE STORAGE IN ROW CHUNK 480 CACHE );
	
ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
	ADD	LAST_COMMENT_OBJECT_META_DATA CLOB 	LOB (LAST_COMMENT_OBJECT_META_DATA) STORE AS (TABLESPACE NEWSLOBTABSPACE ENABLE STORAGE IN ROW CHUNK 480 CACHE );		
	
ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
	ADD	LAST_COMMENT_TAGS VARCHAR2(1024);
	
ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
	ADD	PREV_COMMENT_TAGS VARCHAR2(1024);
	
COMMIT;
