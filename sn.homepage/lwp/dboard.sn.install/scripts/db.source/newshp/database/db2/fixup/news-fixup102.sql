-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

---------------------------------------------------------------------------------
------------------------ START NEWS FIXUP 102 -----------------------------------
---------------------------------------------------------------------------------



INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('profileContainervmladkL9DFYU5ADFla9a','profileContainer', 'profileContainer', 'profilePhoto', 1); 

COMMIT;


DROP TABLE HOMEPAGE.NR_COMM_STORIES;

COMMIT;


---------------------------------------------------------------------------------
-- Increase READER_ID column size 36 -> 39
---------------------------------------------------------------------------------

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;


ALTER TABLE HOMEPAGE.NR_RESPONSES_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_PROFILES_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_COMMUNITIES_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_ACTIVITIES_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_BLOGS_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_BOOKMARKS_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_FILES_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_FORUMS_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_WIKIS_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_TAGS_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_DISCOVERY_VIEW
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_SAVED_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_TOPICS_READERS
	ALTER COLUMN READER_ID SET DATA TYPE VARCHAR(39);

COMMIT;


---------------------------------------------------------------------------------
-- Increase COMMUNITY_ID column size 36 -> 39
---------------------------------------------------------------------------------

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
	ALTER COLUMN COMMUNITY_ID SET DATA TYPE VARCHAR(39);

COMMIT;

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
	ALTER COLUMN PERSON_COMMUNITY_ID SET DATA TYPE VARCHAR(39);

COMMIT;

reorg table HOMEPAGE.NR_COMM_FOLLOW allow no access ;
COMMIT;
reorg table HOMEPAGE.NR_COMM_PERSON_FOLLOW allow no access ;
COMMIT;



---------------------------------------------------------------------------------
-- MODIFY NR_STORIES AND NR_ENTRIES TABLE TO HAVE CONSISTENT DATA MODEL
---------------------------------------------------------------------------------

ALTER TABLE HOMEPAGE.NR_ENTRIES 
	DROP COLUMN ITEM_CORRELATION_AUTHOR_NAME
	DROP COLUMN ITEM_AUTHOR_DISPLAYNAME;

COMMIT;

reorg table HOMEPAGE.NR_ENTRIES ALLOW NO ACCESS;

COMMIT;


ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE 
	DROP COLUMN ITEM_CORRELATION_AUTHOR_NAME
	DROP COLUMN ITEM_AUTHOR_DISPLAYNAME;

COMMIT;

reorg table HOMEPAGE.NR_ENTRIES_ARCHIVE ALLOW NO ACCESS;

COMMIT;

ALTER TABLE HOMEPAGE.NR_STORIES
	ALTER COLUMN RELATED_COMMUNITY_ID SET DATA TYPE VARCHAR(39);

COMMIT;


ALTER TABLE HOMEPAGE.NR_STORIES 
	DROP COLUMN ITEM_CORRELATION_AUTHOR_NAME
	ADD COLUMN ENTRY_CORRELATION_ID VARCHAR(36)
	ADD COLUMN ITEM_CORRELATION_ATOM_URL VARCHAR(2048);

COMMIT;

reorg table HOMEPAGE.NR_STORIES ALLOW NO ACCESS;

COMMIT;


---------------------------------------------------------------------------------
-- READER TABLES: REVERT CLUSTERED INDEX BACK TO READER_ID
---------------------------------------------------------------------------------

DROP INDEX HOMEPAGE.AGGREGATED_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.AGGREGATED_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_RDR_STR
ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_CL_RDR_IX
ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.RESPONSES_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.RESPONSES_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.RESPONSES_READERS_RDR_STR
ON HOMEPAGE.NR_RESPONSES_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.RESPONSES_READERS_CL_RDR_IX
ON HOMEPAGE.NR_RESPONSES_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.PROFILES_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.PROFILES_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_READERS_RDR_STR
ON HOMEPAGE.NR_PROFILES_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_READERS_CL_RDR_IX
ON HOMEPAGE.NR_PROFILES_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.COMM_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.COMM_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.COMM_READERS_RDR_STR
ON HOMEPAGE.NR_COMMUNITIES_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.COMM_READERS_CL_RDR_IX
ON HOMEPAGE.NR_COMMUNITIES_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.ACTIVITIES_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.ACTIVITIES_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIVITIES_READERS_RDR_STR
ON HOMEPAGE.NR_ACTIVITIES_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIVITIES_READERS_CL_RDR_IX
ON HOMEPAGE.NR_ACTIVITIES_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.BLOGS_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.BLOGS_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.BLOGS_READERS_RDR_STR
ON HOMEPAGE.NR_BLOGS_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.BLOGS_READERS_CL_RDR_IX
ON HOMEPAGE.NR_BLOGS_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.BOOKMARKS_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.BOOKMARKS_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.BOOKMARKS_READERS_RDR_STR
ON HOMEPAGE.NR_BOOKMARKS_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.BOOKMARKS_READERS_CL_RDR_IX
ON HOMEPAGE.NR_BOOKMARKS_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.FILES_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.FILES_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.FILES_READERS_RDR_STR
ON HOMEPAGE.NR_FILES_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.FILES_READERS_CL_RDR_IX
ON HOMEPAGE.NR_FILES_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.FORUMS_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.FORUMS_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.FORUMS_READERS_RDR_STR
ON HOMEPAGE.NR_FORUMS_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.FORUMS_READERS_CL_RDR_IX
ON HOMEPAGE.NR_FORUMS_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.WIKIS_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.WIKIS_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.WIKIS_READERS_RDR_STR
ON HOMEPAGE.NR_WIKIS_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.WIKIS_READERS_CL_RDR_IX
ON HOMEPAGE.NR_WIKIS_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.TAGS_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.TAGS_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.TAGS_READERS_RDR_STR
ON HOMEPAGE.NR_TAGS_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.TAGS_READERS_CL_RDR_IX
ON HOMEPAGE.NR_TAGS_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.STATUS_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.STATUS_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.STATUS_READERS_RDR_STR
ON HOMEPAGE.NR_STATUS_UPDATE_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.STATUS_READERS_CL_RDR_IX
ON HOMEPAGE.NR_STATUS_UPDATE_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.EXTERNAL_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.EXTERNAL_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_RDR_STR
ON HOMEPAGE.NR_EXTERNAL_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_CL_RDR_IX
ON HOMEPAGE.NR_EXTERNAL_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.ACTIONABLE_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.ACTIONABLE_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_RDR_STR
ON HOMEPAGE.NR_ACTIONABLE_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_CL_RDR_IX
ON HOMEPAGE.NR_ACTIONABLE_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.DISCOVERY_VIEW_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.DISCOVERY_VIEW_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.DISCOVERY_VIEW_RDR_STR
ON HOMEPAGE.NR_DISCOVERY_VIEW (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.DISCOVERY_VIEW_CL_RDR_IX
ON HOMEPAGE.NR_DISCOVERY_VIEW (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.PROFILES_VIEW_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.PROFILES_VIEW_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_RDR_STR
ON HOMEPAGE.NR_PROFILES_VIEW (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_CL_RDR_IX
ON HOMEPAGE.NR_PROFILES_VIEW (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.NOTIFICA_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.NOTIFICA_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_RDR_STR
ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_CL_RDR_IX
ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.NOT_REC_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.NOT_REC_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_RDR_STR
ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_CL_RDR_IX
ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.SAVED_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.SAVED_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.SAVED_READERS_RDR_STR
ON HOMEPAGE.NR_SAVED_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.SAVED_READERS_CL_RDR_IX
ON HOMEPAGE.NR_SAVED_READERS (READER_ID) CLUSTER;
COMMIT;


DROP INDEX HOMEPAGE.TOPICS_READERS_RDR_STR;
COMMIT;

DROP INDEX HOMEPAGE.TOPICS_READERS_CL_RDR_IX;
COMMIT;

CREATE  INDEX HOMEPAGE.TOPICS_READERS_RDR_STR
ON HOMEPAGE.NR_TOPICS_READERS (READER_ID, STORY_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.TOPICS_READERS_CL_RDR_IX
ON HOMEPAGE.NR_TOPICS_READERS (READER_ID) CLUSTER;
COMMIT;



---------------------------------------------------------------------------------
-- ADD ADDITIONAL INDEXES BASED ON W3 RALLY AND MIGRATION TESTS
---------------------------------------------------------------------------------


-- NR_STORIES TABLE

CREATE INDEX HOMEPAGE.STORIES_ITEM_ID_IX 
	ON HOMEPAGE.NR_STORIES (ITEM_ID);

COMMIT;


-- NR_RESOURCE

CREATE INDEX HOMEPAGE.NR_RESOURCE_TYPE_CONT_IX
	ON HOMEPAGE.NR_RESOURCE (RESOURCE_TYPE, CONTAINER_NAME);

COMMIT;


-- NR_SAVED_READERS

CREATE INDEX HOMEPAGE.SAVED_READERS_SR_IX
	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID, READER_ID);

COMMIT;

---------------------------------------------------------------------------------
------------------------ END NEWS FIXUP 102 -------------------------------------
---------------------------------------------------------------------------------
 

  
  
  
