-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2017                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

------------------------------------------------
-- NR_SOURCE_TYPE_DEFAULT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SOURCE_TYPE_DEFAULT (
	SOURCE_TYPE_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT NOT NULL, -- numeric that is 1,2,3 etc.. 100, 101..
	SOURCE VARCHAR(36) NOT NULL,
	DISPLAY_NAME VARCHAR(4000),
	IMAGE_URL VARCHAR(2048),
	PUBLISHED TIMESTAMP,
	UPDATED TIMESTAMP,	
	IS_ENABLED SMALLINT,
	SUMMARY VARCHAR (4000),
	URL VARCHAR(2048),
	URL_SSL VARCHAR(2048),
	IMAGE_URL_SSL VARCHAR(2048),
	IS_DIGEST_ENABLED SMALLINT NOT NULL DEFAULT 0,
	DEFAULT_DIGEST_FREQUENCY SMALLINT NOT NULL DEFAULT 0,
	IS_DIGEST_LOCKED SMALLINT NOT NULL DEFAULT 0,
	ORGANIZATION_ID VARCHAR (36)
)	
IN NEWS32TABSPACE@

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE_DEFAULT 
  	ADD CONSTRAINT PK_SRC_TYPE_DEF_ID PRIMARY KEY(SOURCE_TYPE_ID)@

CREATE UNIQUE INDEX HOMEPAGE.NR_SRC_TYPE_DEF_UIDX 
	ON HOMEPAGE.NR_SOURCE_TYPE_DEFAULT (SOURCE_TYPE)@
	
CREATE UNIQUE INDEX HOMEPAGE.NR_SRC_DEF_UIDX
	ON HOMEPAGE.NR_SOURCE_TYPE_DEFAULT (SOURCE)@
	
COMMIT@

runstats on table HOMEPAGE.NR_SOURCE_TYPE_DEFAULT with distribution and detailed indexes all allow write access@

------------------------------------------------
-- NR_SOURCE_TYPE
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SOURCE_TYPE (
	SOURCE_TYPE_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT NOT NULL, -- numeric that is 1,2,3 etc.. 100, 101..
	SOURCE VARCHAR(36) NOT NULL,
	DISPLAY_NAME VARCHAR(4000),
	IMAGE_URL VARCHAR(2048),
	PUBLISHED TIMESTAMP,
	UPDATED TIMESTAMP,	
	IS_ENABLED SMALLINT,
	SUMMARY VARCHAR (4000),
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	URL VARCHAR(2048),
	URL_SSL VARCHAR(2048),
	IMAGE_URL_SSL VARCHAR(2048),
	IS_DIGEST_ENABLED SMALLINT NOT NULL DEFAULT 0,
	DEFAULT_DIGEST_FREQUENCY SMALLINT NOT NULL DEFAULT 0,
	IS_DIGEST_LOCKED SMALLINT NOT NULL DEFAULT 0
)	
IN NEWS32TABSPACE@

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE 
  	ADD CONSTRAINT PK_SRC_TYPE_ID PRIMARY KEY(SOURCE_TYPE_ID)@

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE ADD CONSTRAINT FK_SOURCE_TYPE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE UNIQUE INDEX HOMEPAGE.NR_SRC_TYPE_ORG_UIDX 
	ON HOMEPAGE.NR_SOURCE_TYPE (SOURCE_TYPE, ORGANIZATION_ID)@
COMMIT@

CREATE UNIQUE INDEX HOMEPAGE.UNQ_SOURCE_TYPE_SRC_ORG
 	ON HOMEPAGE.NR_SOURCE_TYPE (SOURCE, ORGANIZATION_ID)@
COMMIT@

CREATE INDEX HOMEPAGE.SRC_TYPE_ORG_ID
    ON HOMEPAGE.NR_SOURCE_TYPE (ORGANIZATION_ID, SOURCE_TYPE ASC)@

runstats on table HOMEPAGE.NR_SOURCE_TYPE with distribution and detailed indexes all allow write access@


------------------------------------------------
-- NR_TEMPLATE
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_TEMPLATE (
	TEMPLATE_ID VARCHAR(36) NOT NULL,
 	NAME VARCHAR(256) NOT NULL,
 	FORMAT VARCHAR(256) NOT NULL,
 	DATA_SOURCE_STRING VARCHAR(256) NOT NULL,
 	NO_VALUES SMALLINT NOT NULL
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_TEMPLATE 
  	ADD CONSTRAINT "PK_TEMPLATE_ID" PRIMARY KEY("TEMPLATE_ID")@    

RUNSTATS ON TABLE "HOMEPAGE"."NR_TEMPLATE" FOR INDEXES ALL@

------------------------------------------------
-- NR_SCHEDULER_TASK
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_TASK (
	TASKID BIGINT NOT NULL,
	VERSION VARCHAR(5) NOT NULL,
	ROW_VERSION INTEGER NOT NULL,
	TASKTYPE INTEGER NOT NULL,
	TASKSUSPENDED SMALLINT NOT NULL,
	CANCELLED SMALLINT NOT NULL,
	NEXTFIRETIME BIGINT NOT NULL,
	STARTBYINTERVAL VARCHAR(254),
	STARTBYTIME BIGINT,
	VALIDFROMTIME BIGINT,
	VALIDTOTIME BIGINT,
	REPEATINTERVAL VARCHAR(254),
	MAXREPEATS INTEGER NOT NULL,
	REPEATSLEFT INTEGER NOT NULL,
	TASKINFO BLOB(102400) LOGGED NOT COMPACT,
	NAME VARCHAR(254) NOT NULL,
	AUTOPURGE INTEGER NOT NULL,
	FAILUREACTION INTEGER,
	MAXATTEMPTS INTEGER,
	QOS INTEGER,
	PARTITIONID INTEGER,
	OWNERTOKEN VARCHAR(200) NOT NULL,
	CREATETIME BIGINT NOT NULL
) 
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_SCHEDULER_TASK 
	ADD PRIMARY KEY (TASKID)@

CREATE INDEX HOMEPAGE.NR_SCHEDULER_TASK_IDX1 
	ON HOMEPAGE.NR_SCHEDULER_TASK (TASKID, OWNERTOKEN)@

CREATE INDEX HOMEPAGE.NR_SCHEDULER_TASK_IDX2 
	ON HOMEPAGE.NR_SCHEDULER_TASK (NEXTFIRETIME ASC, REPEATSLEFT, PARTITIONID) CLUSTER@

------------------------------------------------
-- NR_SCHEDULER_TREG
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_TREG (
	REGKEY VARCHAR(254) NOT NULL,
	REGVALUE VARCHAR(254) 
) 
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_SCHEDULER_TREG 
	ADD PRIMARY KEY (REGKEY)@

------------------------------------------------
-- NR_SCHEDULER_LMGR
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_LMGR (
	LEASENAME VARCHAR(254) NOT NULL,
	LEASEOWNER VARCHAR(254) NOT NULL,
	LEASE_EXPIRE_TIME  BIGINT,
	DISABLED VARCHAR(5)
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_SCHEDULER_LMGR 
	ADD PRIMARY KEY (LEASENAME)@

------------------------------------------------
-- NR_SCHEDULER_LMPR
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_LMPR (
	LEASENAME VARCHAR(254) NOT NULL,
	NAME VARCHAR(254) NOT NULL,
	VALUE VARCHAR(254) NOT NULL
)
IN NEWSTABSPACE@

CREATE INDEX HOMEPAGE.NR_SCHEDULER_LMPR_IDX1 
	ON HOMEPAGE.NR_SCHEDULER_LMPR (LEASENAME, NAME)@


------------------------------------------------
-- NR_NEWS_STATUS_NETWORK
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK (
	NEWS_STATUS_NETWORK_ID VARCHAR(36) NOT NULL,
	READER_ID VARCHAR(39),
	ACTOR_UUID VARCHAR(36) NOT NULL,
	BRIEF_DESC VARCHAR(4000),
	ITEM_URL VARCHAR(2048),
	ITEM_ID  VARCHAR(36),
	EVENT_NAME VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	IS_WALL_POST  SMALLINT NOT NULL DEFAULT 0,
	CREATION_DATE TIMESTAMP,
	UPDATE_DATE TIMESTAMP,
	N_COMMENTS SMALLINT NOT NULL DEFAULT 0,
	IS_NETWORK_NEWS SMALLINT NOT NULL DEFAULT 0,
	IS_FOLLOW_NEWS SMALLINT NOT NULL DEFAULT 0,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK
  	ADD CONSTRAINT "PK_NEWS_STATUS_ID" PRIMARY KEY("NEWS_STATUS_NETWORK_ID")@
  	
ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK ADD CONSTRAINT FK_NEWS_STATUS_NETWORK_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.NR_NEWS_STATUS_NETWORK_ITEM_ID
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (ITEM_ID)@

CREATE INDEX HOMEPAGE.NR_NEWS_SN_READER_FOLL
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (UPDATE_DATE DESC, READER_ID, IS_FOLLOW_NEWS)@

CREATE INDEX HOMEPAGE.NR_NEWS_SN_READER_NETW
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (UPDATE_DATE DESC, READER_ID, IS_NETWORK_NEWS)@

CREATE INDEX HOMEPAGE.NEWS_STATUS_NET_R_U 
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (READER_ID, UPDATE_DATE DESC)@

CREATE INDEX HOMEPAGE.NR_STATUS_NETWORK_DATE
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (UPDATE_DATE ASC)@

CREATE INDEX HOMEPAGE.NR_NEWS_SN_READER_IDX
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (READER_ID)@
	
CREATE UNIQUE INDEX HOMEPAGE.NR_SN_ITEM_READ_UNQ
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (ITEM_ID, READER_ID)@
	
CREATE INDEX HOMEPAGE.NR_STATUS_UPDATE_IX
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (READER_ID, UPDATE_DATE ASC, CREATION_DATE ASC, ITEM_ID, ACTOR_UUID)@
COMMIT@	

------------------------------------------------
-- NR_NEWS_STATUS_COMMENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT (
	NEWS_STATUS_COMMENT_ID VARCHAR(36) NOT NULL,
	ACTOR_UUID VARCHAR(36) NOT NULL,
	CREATION_DATE TIMESTAMP,
	BRIEF_DESC VARCHAR(500),
	ITEM_ID  VARCHAR(36),
	ITEM_CORRELATION_ID VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT
  	ADD CONSTRAINT "PK_NEWS_COMMENT_ID" PRIMARY KEY("NEWS_STATUS_COMMENT_ID")@
  	
ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT ADD CONSTRAINT FK_STATUS_COMMENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
  	

CREATE INDEX HOMEPAGE.CL_STATUS_COMMENT_IDX
ON HOMEPAGE.NR_NEWS_STATUS_COMMENT (ITEM_CORRELATION_ID) CLUSTER@

CREATE INDEX HOMEPAGE.STATUS_COMMENT_ITEM_ID
    ON HOMEPAGE.NR_NEWS_STATUS_COMMENT (ITEM_ID)@

CREATE INDEX HOMEPAGE.NR_STATUS_COMMENT_DATE
    ON HOMEPAGE.NR_NEWS_STATUS_COMMENT (CREATION_DATE ASC)@     

------------------------------------------------
-- NR_NEWS_STATUS_CONTENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT (
	NEWS_STATUS_CONTENT_ID VARCHAR(36) NOT NULL,
	ITEM_ID  VARCHAR(36),
	ACTOR_UUID VARCHAR(36),
	CREATION_DATE TIMESTAMP,
	TARGET_SUBJECT_ID VARCHAR(36),
	ITEM_URL  VARCHAR(2048),
	UPDATE_DATE TIMESTAMP,
	RECOMMENDATIONS_COUNT INT, -- fixup57.sql during migraiton from 3.0 to 3.0.1
	CONTENT CLOB,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT
  	ADD CONSTRAINT "PK_S_CONTENT_ID" PRIMARY KEY("NEWS_STATUS_CONTENT_ID")@
  	
ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT ADD CONSTRAINT FK_STATUS_CONTENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.NR_NEWS_SC_ITEM_ID
    ON HOMEPAGE.NR_NEWS_STATUS_CONTENT (ITEM_ID)@

CREATE INDEX HOMEPAGE.NR_NEWS_SC_CD
    ON HOMEPAGE.NR_NEWS_STATUS_CONTENT (CREATION_DATE ASC)@

CREATE INDEX HOMEPAGE.NR_SC_UDATE
    ON HOMEPAGE.NR_NEWS_STATUS_CONTENT (UPDATE_DATE ASC)@   	    

------------------------------------------------
-- NR_NEWS_COMMENT_CONTENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT (
	NEWS_COMMENT_CONTENT_ID VARCHAR(36) NOT NULL,
	NEWS_STATUS_COMMENT_ID  VARCHAR(36),
	CONTENT CLOB,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT
  	ADD CONSTRAINT "PK_C_CONTENT_ID" PRIMARY KEY("NEWS_COMMENT_CONTENT_ID")@    

ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT
  	ADD CONSTRAINT "FK_C_COMMENT_ID" FOREIGN KEY ("NEWS_STATUS_COMMENT_ID")
	REFERENCES HOMEPAGE.NR_NEWS_STATUS_COMMENT("NEWS_STATUS_COMMENT_ID")@
	
ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT ADD CONSTRAINT FK_NEWS_COMMENT_CONTENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@	

CREATE INDEX HOMEPAGE.NR_NEWS_COMMENT_CONTENT_ID
    ON HOMEPAGE.NR_NEWS_COMMENT_CONTENT(NEWS_STATUS_COMMENT_ID)@	


----------------------------------------------------------------------
-- HOMEPAGE.NR_RESOURCE
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_RESOURCE (
	RESOURCE_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256) NOT NULL,
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	CATEGORY_TYPE SMALLINT,
	RESOURCE_TYPE SMALLINT NOT NULL,
	LAST_UPDATE TIMESTAMP,
	SOURCE_TYPE SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_RESOURCE 
    ADD CONSTRAINT "PK_RESOURCE_ID" PRIMARY KEY("RESOURCE_ID")@

ALTER TABLE HOMEPAGE.NR_RESOURCE ADD CONSTRAINT FK_RESOURCE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	
ALTER TABLE HOMEPAGE.NR_RESOURCE
	ADD CONSTRAINT UNIQUE_RES UNIQUE (CONTAINER_ID, RESOURCE_TYPE)@

CREATE INDEX HOMEPAGE.NR_RESOURCE_TYPE_CONT
    ON HOMEPAGE.NR_RESOURCE (RESOURCE_TYPE, CONTAINER_ID)@

CREATE INDEX HOMEPAGE.NR_RESOURCE_TYPE_CONT_IX
	ON HOMEPAGE.NR_RESOURCE (RESOURCE_TYPE, CONTAINER_NAME)@
	
CREATE UNIQUE INDEX HOMEPAGE.NR_RES_LU_UIDX
	ON HOMEPAGE.NR_RESOURCE (RESOURCE_ID, RESOURCE_TYPE, LAST_UPDATE DESC, CONTAINER_NAME DESC)@
	
CREATE INDEX HOMEPAGE.NR_RES_CONT_NAME_ORG_ID_IDX
	ON HOMEPAGE.NR_RESOURCE (CONTAINER_NAME, ORGANIZATION_ID)@	

----------------------------------------------------------------------
-- HOMEPAGE.NR_FOLLOWS 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_FOLLOWS (
	FOLLOW_ID VARCHAR(36) NOT NULL,
	PERSON_ID VARCHAR(36) NOT NULL,
	RESOURCE_ID VARCHAR(36) NOT NULL,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_FOLLOWS 
    ADD CONSTRAINT "PK_FOLLOWS_ID" PRIMARY KEY("FOLLOW_ID")@

ALTER TABLE HOMEPAGE.NR_FOLLOWS
    ADD CONSTRAINT "FK_FS_PERSON_ID" FOREIGN KEY ("PERSON_ID")
	REFERENCES HOMEPAGE.PERSON ("PERSON_ID")@

ALTER TABLE HOMEPAGE.NR_FOLLOWS
    ADD CONSTRAINT "FK_FS_RESOURCE_ID" FOREIGN KEY ("RESOURCE_ID")
	REFERENCES HOMEPAGE.NR_RESOURCE ("RESOURCE_ID")@
	
ALTER TABLE HOMEPAGE.NR_FOLLOWS ADD CONSTRAINT FK_FOLLOWS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE UNIQUE INDEX HOMEPAGE.NR_FOLLOWS_IDX
    ON HOMEPAGE.NR_FOLLOWS (RESOURCE_ID, PERSON_ID)@

CREATE INDEX HOMEPAGE.NR_FOLLOWS_PERS
    ON HOMEPAGE.NR_FOLLOWS (PERSON_ID)@

CREATE INDEX HOMEPAGE.NR_FOLLOWS_RES
    ON HOMEPAGE.NR_FOLLOWS (RESOURCE_ID)@
    
CREATE UNIQUE INDEX HOMEPAGE.NR_FOLLOWS_PER_RES_UIDX
	ON HOMEPAGE.NR_FOLLOWS (PERSON_ID, RESOURCE_ID)@    

----------------------------------------------------------------------
-- HOMEPAGE.NR_COMM_FOLLOW 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_COMM_FOLLOW (
	COMM_FOLLOW_ID VARCHAR(36) NOT NULL,
	PERSON_ID VARCHAR(36) NOT NULL,
	COMMUNITY_ID VARCHAR(39) NOT NULL,
	COMMUNITY_NAME VARCHAR(256),
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
    ADD CONSTRAINT "PK_COMM_FOLLOW_ID" PRIMARY KEY("COMM_FOLLOW_ID")@

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
    ADD CONSTRAINT "FK_COMM_PERSON_ID" FOREIGN KEY ("PERSON_ID")
	REFERENCES HOMEPAGE.PERSON ("PERSON_ID")@

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
    ADD CONSTRAINT UNIQUE_PERS_COMM UNIQUE (PERSON_ID, COMMUNITY_ID)@
    
ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW ADD CONSTRAINT FK_COMM_FOLLOW_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.NR_COMM_FOLLOW_PERSON_ID
    ON HOMEPAGE.NR_COMM_FOLLOW (PERSON_ID)@

CREATE INDEX HOMEPAGE.NR_COMM_FOLLOW_COM_ID
    ON HOMEPAGE.NR_COMM_FOLLOW (COMMUNITY_ID)@    	  

----------------------------------------------------------------------
-- HOMEPAGE.NR_STORIES
----------------------------------------------------------------------
--CREATE TABLE HOMEPAGE.NR_STORIES (
--	STORY_ID VARCHAR(36) NOT NULL,
--	EVENT_NAME VARCHAR(256) NOT NULL,
--	SOURCE VARCHAR(36),
--	CONTAINER_ID VARCHAR(256),	
--	CONTAINER_NAME VARCHAR(256),
--	CONTAINER_URL VARCHAR(2048),
--	ITEM_NAME VARCHAR(256),
--	ITEM_URL VARCHAR(2048),
--	ITEM_ATOM_URL VARCHAR(2048),
--	ITEM_ID VARCHAR(36), -- NEW
--	ITEM_CORRELATION_ID VARCHAR(36), -- NEW	
--	CREATION_DATE TIMESTAMP NOT NULL,
--	BRIEF_DESC VARCHAR(512),
--	ACTOR_UUID VARCHAR(36),
--	EVENT_RECORD_UUID VARCHAR(36) NOT NULL,
--	TAGS VARCHAR(1024),
--	META_TEMPLATE VARCHAR(4096) DEFAULT '' NOT NULL,
--	TEXT_META_TEMPLATE VARCHAR(1024),
--	R_META_TEMPLATE VARCHAR(4096),
--	R_TEXT_META_TEMPLATE VARCHAR(1024),
--	N_COMMENTS SMALLINT NOT NULL DEFAULT 0, -- NEW
--	N_RECOMMANDATIONS SMALLINT NOT NULL DEFAULT 0, -- NEW
--	IS_COMMUNITY_STORY SMALLINT DEFAULT 0,
--	ITEM_CORRELATION_NAME VARCHAR(256),
--	SOURCE_TYPE SMALLINT
--)
--IN NEWS32TABSPACE@

--ALTER TABLE HOMEPAGE.NR_STORIES
--   ADD CONSTRAINT "PK_STORY_ID" PRIMARY KEY("STORY_ID")@

--CREATE INDEX HOMEPAGE.NR_STORIES_DATE
--	ON HOMEPAGE.NR_STORIES(CREATION_DATE DESC)@

--CREATE INDEX HOMEPAGE.STORIES_CONTAINED_ID
--    ON HOMEPAGE.NR_STORIES (CONTAINER_ID)@

--CREATE INDEX HOMEPAGE.STORIES_ITEM_ID
--    ON HOMEPAGE.NR_STORIES (ITEM_ID)@

--CREATE INDEX HOMEPAGE.STORIES_ITEM_CORR_ID
--    ON HOMEPAGE.NR_STORIES (ITEM_CORRELATION_ID)@

--CREATE UNIQUE INDEX HOMEPAGE.NR_STORIES_ER_UUID
--	ON HOMEPAGE.NR_STORIES(EVENT_RECORD_UUID)@        

----------------------------------------------------------------------
-- HOMEPAGE.NR_FOLLOWED_STORIES (this table has been splitted)
----------------------------------------------------------------------
--CREATE TABLE HOMEPAGE.NR_FOLLOWED_STORIES (
--	CATEGORY_READER_ID VARCHAR(36) NOT NULL,
--	READER_ID VARCHAR(36) NOT NULL,
--	CATEGORY_TYPE SMALLINT NOT NULL,
--	SOURCE VARCHAR(36) NOT NULL,
--	CONTAINER_ID VARCHAR(256),
--	ITEM_ID VARCHAR(36), 
--	RESOURCE_TYPE SMALLINT NOT NULL,
--	CREATION_DATE TIMESTAMP NOT NULL,
--	STORY_ID VARCHAR(36) NOT NULL
--)
--IN NEWS4TABSPACE@

--ALTER TABLE HOMEPAGE.NR_FOLLOWED_STORIES
--   ADD CONSTRAINT "PK_F_STORY_ID" PRIMARY KEY("CATEGORY_READER_ID")@

--ALTER TABLE HOMEPAGE.NR_FOLLOWED_STORIES
--    ADD CONSTRAINT "FK_F_STORY_ID" FOREIGN KEY ("STORY_ID")
--	REFERENCES HOMEPAGE.NR_STORIES ("STORY_ID")@

--CREATE INDEX HOMEPAGE.NR_FOLLOWED_STORIES_READER_CAT
--    ON HOMEPAGE.NR_FOLLOWED_STORIES (CREATION_DATE ASC, READER_ID, CATEGORY_TYPE)@

----------------------------------------------------------------------
-- HOMEPAGE.NR_COMM_STORIES
----------------------------------------------------------------------
--CREATE TABLE HOMEPAGE.NR_COMM_STORIES (
--	COMM_STORY_ID VARCHAR(36) NOT NULL,
--	COMMUNITY_ID VARCHAR(36) NOT NULL,
--	CONTAINER_ID VARCHAR(256),
--	ITEM_ID VARCHAR(36),
--	RESOURCE_TYPE SMALLINT NOT NULL,
--	CREATION_DATE TIMESTAMP NOT NULL,
--	STORY_ID VARCHAR(36) NOT NULL,
--	SOURCE_TYPE SMALLINT
--)
--IN NEWS4TABSPACE@

--ALTER TABLE HOMEPAGE.NR_COMM_STORIES
--    ADD CONSTRAINT "PK_F_CSTORY_ID" PRIMARY KEY("COMM_STORY_ID")@

--ALTER TABLE HOMEPAGE.NR_COMM_STORIES
--    ADD CONSTRAINT "FK_COMM_STORY_ID" FOREIGN KEY ("STORY_ID")
--	REFERENCES HOMEPAGE.NR_STORIES ("STORY_ID")@

--CREATE INDEX HOMEPAGE.NR_COMM_STORIES_STORY_ID
--    ON HOMEPAGE.NR_COMM_STORIES (STORY_ID)@

--CREATE INDEX HOMEPAGE.NR_COMM_STORIES_COM_ID
--    ON HOMEPAGE.NR_COMM_STORIES (COMMUNITY_ID)@

--CREATE INDEX HOMEPAGE.COMM_STORIES_ITEM_ID
--    ON HOMEPAGE.NR_COMM_STORIES (ITEM_ID)@

--CREATE INDEX HOMEPAGE.NR_COMM_STORIES_DATE
--    ON HOMEPAGE.NR_COMM_STORIES (CREATION_DATE ASC)@

--CREATE INDEX HOMEPAGE.NR_COMM_STORIES_CDATE
--    ON HOMEPAGE.NR_COMM_STORIES (COMMUNITY_ID, CREATION_DATE ASC)@

--CREATE INDEX HOMEPAGE.NR_COM_STORY_ID			
--	ON HOMEPAGE.NR_COMM_STORIES (COMMUNITY_ID, STORY_ID)@    

------------------------------------------------
-- NR_STORIES_CONTENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_STORIES_CONTENT (
	STORY_CONTENT_ID VARCHAR(36) NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36),
	SOURCE_TYPE SMALLINT,
	ACTIVITY_META_DATA CLOB INLINE LENGTH 200,
	ITEM_CONTENT CLOB INLINE LENGTH 512,
	ITEM_CORRELATION_CONTENT CLOB INLINE LENGTH 512,
	CONTENT_FORMAT SMALLINT,
	ITEM_CONTENT_FORMAT SMALLINT,
	ITEM_CORRELATION_FORMAT SMALLINT,
	ACTIVITY_META_DATA_1 VARCHAR(4000) for bit data,
	ACTIVITY_META_DATA_2 VARCHAR(4000) for bit data,
	IS_META_DATA_TRUNCATED SMALLINT,
	ITEM_BRIEF_DESC VARCHAR(4000),
	ITEM_CORRELATION_BRIEF_DESC VARCHAR(4000),
	ITEM_TAGS VARCHAR(1024),
	ITEM_CORRELATION_TAGS VARCHAR(1024),
	CONTENT CLOB INLINE LENGTH 512,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS32TABSPACE@

ALTER TABLE HOMEPAGE.NR_STORIES_CONTENT
  	ADD CONSTRAINT "PK_STORY_CONT_ID" PRIMARY KEY("STORY_CONTENT_ID")@
  	
ALTER TABLE HOMEPAGE.NR_STORIES_CONTENT ADD CONSTRAINT FK_STORIES_CONTENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
  	

CREATE INDEX HOMEPAGE.STORIES_CONTENT_STORY
    ON HOMEPAGE.NR_STORIES_CONTENT (STORY_ID)@

CREATE INDEX HOMEPAGE.NR_STORIES_CONTENT_DATE
    ON HOMEPAGE.NR_STORIES_CONTENT (CREATION_DATE ASC)@    	

----------------------------------------------------------------------
-- HOMEPAGE.NR_NETWORK
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NETWORK (
	NETWORK_ID VARCHAR(36) NOT NULL,
	PERSON_ID VARCHAR(36) NOT NULL,
	COLLEAGUE_ID VARCHAR(36) NOT NULL,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_NETWORK
    ADD CONSTRAINT "PK_NETWORK_ID" PRIMARY KEY("NETWORK_ID")@

ALTER TABLE HOMEPAGE.NR_NETWORK
    ADD CONSTRAINT "FK_NTW_PERS_ID" FOREIGN KEY ("PERSON_ID")
	REFERENCES HOMEPAGE.PERSON ("PERSON_ID")@

ALTER TABLE HOMEPAGE.NR_NETWORK
    ADD CONSTRAINT "FK_NTW_COLL_ID" FOREIGN KEY ("COLLEAGUE_ID")
	REFERENCES HOMEPAGE.PERSON ("PERSON_ID")@
	
ALTER TABLE HOMEPAGE.NR_NETWORK ADD CONSTRAINT FK_NETWORK_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@	

CREATE INDEX HOMEPAGE.NR_NETWORK_PERS
    ON HOMEPAGE.NR_NETWORK (PERSON_ID)@

CREATE UNIQUE INDEX HOMEPAGE.COLL_PERSON_IDX 
	ON HOMEPAGE.NR_NETWORK (COLLEAGUE_ID, PERSON_ID)@  

CREATE UNIQUE INDEX HOMEPAGE.NR_NETWORK_PER_COL_IDX
	ON HOMEPAGE.NR_NETWORK (PERSON_ID, COLLEAGUE_ID)@	

-----------------------------------------
-- HOMEPAGE.EMD_RESOURCE_PREF
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_RESOURCE_PREF (
	RESOURCE_PREF_ID VARCHAR(36) NOT NULL,
	PERSON_ID VARCHAR(36) NOT NULL,
	RESOURCE_TYPE SMALLINT NOT NULL,
	FREQUENCY_TYPE SMALLINT NOT NULL,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF 
  	ADD CONSTRAINT "PK_RES_PREF_ID" PRIMARY KEY("RESOURCE_PREF_ID")@

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF
    ADD CONSTRAINT "FK_RES_PERSON_ID" FOREIGN KEY ("PERSON_ID")
	REFERENCES HOMEPAGE.PERSON ("PERSON_ID")@

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF ADD CONSTRAINT FK_EMD_RES_PREF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.EMD_RES_PREF_PER_ID
    ON HOMEPAGE.EMD_RESOURCE_PREF (PERSON_ID)@

CREATE UNIQUE INDEX HOMEPAGE.EMD_RESOURCE_PREF_UNQ
	ON HOMEPAGE.EMD_RESOURCE_PREF (PERSON_ID, RESOURCE_TYPE)@
	
CREATE INDEX HOMEPAGE.NR_EMD_RES_PRF_PER_FRQ_RES_IDX 
	ON HOMEPAGE.EMD_RESOURCE_PREF (PERSON_ID, FREQUENCY_TYPE, RESOURCE_TYPE)@	

-----------------------------------------
-- HOMEPAGE.EMD_TRANCHE
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_TRANCHE (
	TRANCHE_ID VARCHAR(36) NOT NULL,
	SEQ_NUMBER SMALLINT NOT NULL,
	LAST_PROCESSED_DAILY TIMESTAMP,
	LAST_PROCESSED_WEEKLY TIMESTAMP,
	IS_LOCKED SMALLINT NOT NULL,
	IS_LOCKED_DAILY SMALLINT NOT NULL DEFAULT 0,
	IS_LOCKED_WEEKLY SMALLINT NOT NULL DEFAULT 0,
	LAST_STARTED_DAILY TIMESTAMP,
	LAST_STARTED_WEEKLY TIMESTAMP,
	LAST_EXEC_TIME_DAILY_MIN INTEGER,
	LAST_EXEC_TIME_WEEKLY_MIN INTEGER,
	LAST_RUNNER_DAILY VARCHAR(256),
	LAST_RUNNER_WEEKLY VARCHAR(256),
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.EMD_TRANCHE 
  	ADD CONSTRAINT "PK_TRANCHE_ID" PRIMARY KEY("TRANCHE_ID")@

CREATE UNIQUE INDEX HOMEPAGE.SEQ_NUMBER_UNIQUE
    ON HOMEPAGE.EMD_TRANCHE (SEQ_NUMBER, ORGANIZATION_ID)@ 
	
ALTER TABLE HOMEPAGE.EMD_TRANCHE ADD CONSTRAINT FK_EMD_TRANCHE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	

-----------------------------------------
-- HOMEPAGE.EMD_TRANCHE_INFO
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_TRANCHE_INFO (
	TRANCHE_INFO_ID VARCHAR(36) NOT NULL,
	TRANCHE_ID VARCHAR(36) NOT NULL,
	COUNT_PROCESSED_DAILY SMALLINT,
	COUNT_PROCESSED_WEEKLY SMALLINT,
	AVG_EXEC_TIME_DAILY_MIN SMALLINT,
	AVG_EXEC_TIME_WEEKLY_MIN SMALLINT,
	DOMAIN_AFFINITY CLOB,
	N_USERS INTEGER,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO
  	ADD CONSTRAINT "PK_TRC_INFO_ID" PRIMARY KEY("TRANCHE_INFO_ID")@

ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO
    ADD CONSTRAINT "FK_TRANCHE_ID" FOREIGN KEY ("TRANCHE_ID")
	REFERENCES HOMEPAGE.EMD_TRANCHE ("TRANCHE_ID")@
	
ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO ADD CONSTRAINT FK_EMD_TRANCHE_INFO_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

-----------------------------------------
-- HOMEPAGE.EMD_EMAIL_PREFS
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_EMAIL_PREFS (
	EMAIL_PREFS_ID VARCHAR(36) NOT NULL,
	PERSON_ID VARCHAR(36) NOT NULL,
	SEND_DIRECTED SMALLINT,
	TRANCHE_ID VARCHAR(36) NOT NULL,
	EMAIL_ADDRESS VARCHAR(256),
	LANG VARCHAR(36),
	USE_TEXT_EMAIL SMALLINT,
	REPLYTO_ENABLED SMALLINT NOT NULL DEFAULT 1,
	TIMEZONE VARCHAR(255) DEFAULT NULL,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS 
  	ADD CONSTRAINT "PK_EMAIL_PREFS_ID" PRIMARY KEY("EMAIL_PREFS_ID")@

ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS
    ADD CONSTRAINT "FK_EMD_PERSON_ID" FOREIGN KEY ("PERSON_ID")
	REFERENCES HOMEPAGE.PERSON ("PERSON_ID")@
	
ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS ADD CONSTRAINT FK_EMD_EMAIL_PREFS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE UNIQUE INDEX HOMEPAGE.EMD_EMAIL_PREFS_PER
    ON HOMEPAGE.EMD_EMAIL_PREFS (PERSON_ID)@
    
CREATE INDEX HOMEPAGE.EMD_EMAIL_PREFS_TR
    ON HOMEPAGE.EMD_EMAIL_PREFS (TRANCHE_ID)@    

------------------------------
-- NR_COMM_PERSON_FOLLOW
------------------------------
CREATE TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW (
	COMM_PERSON_FOLLOW_ID VARCHAR(36) NOT NULL,
	PERSON_ID VARCHAR(36) NOT NULL,
	PERSON_COMMUNITY_ID VARCHAR(39) NOT NULL,
	IS_READER_COMM SMALLINT DEFAULT 0 NOT NULL,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
    ADD CONSTRAINT "PK_COMM_PER_ID" PRIMARY KEY("COMM_PERSON_FOLLOW_ID")@

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
    ADD CONSTRAINT "FK_COMM_PER_PER_ID" FOREIGN KEY ("PERSON_ID")
	REFERENCES HOMEPAGE.PERSON ("PERSON_ID")@
	
ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW ADD CONSTRAINT FK_COMM_PERSON_FOLLOW_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
    ADD CONSTRAINT UNIQUE_PERS_P_COMM UNIQUE (PERSON_ID, PERSON_COMMUNITY_ID)@	

CREATE INDEX HOMEPAGE.NR_COMM_PER_FOLLOW_PER_ID
    ON HOMEPAGE.NR_COMM_PERSON_FOLLOW (PERSON_ID)@

CREATE INDEX HOMEPAGE.NR_COMM_FOLLOW_COM_PER_ID
    ON HOMEPAGE.NR_COMM_PERSON_FOLLOW (PERSON_COMMUNITY_ID)@
    
-- 108309: CR3 - Improve per. for the 5th most expensive query
CREATE INDEX HOMEPAGE.NR_COMM_PERSON_F 
	ON HOMEPAGE.NR_COMM_PERSON_FOLLOW (PERSON_ID, IS_READER_COMM, PERSON_COMMUNITY_ID, ORGANIZATION_ID)@    

    
----------------------------------------------------------------
-- HOMEPAGE.NR_ENTRIES
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(256),
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	ITEM_CREATION_DATE TIMESTAMP,
	ITEM_UPDATE_DATE TIMESTAMP,
	ITEM_TAGS VARCHAR(1024),
	N_COMMENTS INTEGER DEFAULT NULL,
	N_RECOMMANDATIONS INTEGER DEFAULT NULL,
	LAST_COMMENT_ID VARCHAR(256),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(256),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_AUTHOR_COMMENT VARCHAR(36),
	ITEM_ATOM_URL VARCHAR(2048),
	PREVIEW_IMAGE_URL VARCHAR(2048),
	JSON_META_DATA CLOB INLINE LENGTH 800,
	ITEM_SCOPE SMALLINT,
	IS_LAST_COMMENT_PUBLIC SMALLINT,
	IS_PREV_COMMENT_PUBLIC SMALLINT,
	ITEM_CORRELATION_ID VARCHAR(256),
	ITEM_CORRELATION_NAME VARCHAR(256),
	LAST_DESC_COMMENT VARCHAR(4000),
	PREV_DESC_COMMENT VARCHAR(4000),
	LAST_UPDATE_DATE_COMMENT TIMESTAMP,
	PREV_UPDATE_DATE_COMMENT TIMESTAMP,
	ITEM_AUTHOR_UUID VARCHAR (256),
	ITEM_CORRELATION_AUTHOR_UUID VARCHAR (256),
	BRIEF_DESC VARCHAR (4000),
	ITEM_CORRELATION_BRIEF_DESC VARCHAR(4000),
	IS_LAST_COMMENT_VISIBLE SMALLINT DEFAULT 1,
	IS_PREV_COMMENT_VISIBLE SMALLINT DEFAULT 1,
	LAST_UPDATE_RECORD TIMESTAMP,
	PREV_COMMENT_NUM_REC INTEGER DEFAULT NULL,
	LAST_COMMENT_NUM_REC INTEGER DEFAULT NULL,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	PREV_COMMENT_OBJECT_META_DATA CLOB INLINE LENGTH 800,
	LAST_COMMENT_OBJECT_META_DATA CLOB INLINE LENGTH 800,
	LAST_COMMENT_TAGS VARCHAR(1024),
	PREV_COMMENT_TAGS VARCHAR(1024),
	IS_EXTERNAL SMALLINT DEFAULT 0 NOT NULL,
	ITEM_CORRELATION_CREATION_DATE TIMESTAMP
)
IN NEWS32TABSPACE@

ALTER TABLE HOMEPAGE.NR_ENTRIES
    ADD CONSTRAINT PK_ENTRY_ID PRIMARY KEY(ENTRY_ID)@
    
ALTER TABLE HOMEPAGE.NR_ENTRIES ADD CONSTRAINT FK_ENTRIES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.NR_ENTRIES_CONT
    ON HOMEPAGE.NR_ENTRIES (CONTAINER_ID)@

CREATE UNIQUE INDEX HOMEPAGE.NR_ENTRIES_ITEMORG
    ON HOMEPAGE.NR_ENTRIES (ITEM_ID, ORGANIZATION_ID)@

COMMIT@

----------------------------------------------------------------
-- HOMEPAGE.NR_STORIES
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_STORIES (
	STORY_ID VARCHAR(36) NOT NULL,
	EVENT_NAME VARCHAR(256) NOT NULL,
	SOURCE VARCHAR(36),
	CONTAINER_ID VARCHAR(256),	
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	CONTAINER_ATOM_URL VARCHAR(2048),
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	ITEM_ATOM_URL VARCHAR(2048),
	ITEM_ID VARCHAR(256),
	ITEM_CORRELATION_ID VARCHAR(256),
	ITEM_CORRELATION_SCOPE SMALLINT,
	ITEM_CORRELATION_UPDATE_DATE TIMESTAMP,
	ITEM_CORRELATION_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	BRIEF_DESC VARCHAR(4000),
	ACTOR_UUID VARCHAR(256),
	EVENT_RECORD_UUID VARCHAR(36) NOT NULL,
	TAGS VARCHAR(1024),
	META_TEMPLATE VARCHAR(3328) DEFAULT '' NOT NULL,
	TEXT_META_TEMPLATE VARCHAR(1024),
	R_META_TEMPLATE VARCHAR(3328),
	R_TEXT_META_TEMPLATE VARCHAR(1024),
	IS_COMMUNITY_STORY SMALLINT DEFAULT 0,
	ITEM_CORRELATION_NAME VARCHAR(256),
	HAS_ATTACHMENT SMALLINT DEFAULT 0,
	SOURCE_TYPE SMALLINT,
	ENTRY_ID VARCHAR(36),
	EVENT_TIME TIMESTAMP,
	VERB VARCHAR (128),
	ITEM_SCOPE SMALLINT,
	ITEM_UPDATE_DATE TIMESTAMP,
	FIRST_RECIPIENT_ID VARCHAR(36),
	NUM_RECIPIENTS SMALLINT, 
	PRIMARY_ACTION_URL VARCHAR(768), 
	SECONDARY_ACTION_URL VARCHAR(768),
	ITEM_AUTHOR_UUID VARCHAR (256),
	ITEM_CORRELATION_AUTHOR_UUID VARCHAR (256),
	EVENT_SCOPE SMALLINT,
	RELATED_COMMUNITY_ID VARCHAR(39),
	ENTRY_CORRELATION_ID VARCHAR(256),
	ITEM_CORRELATION_ATOM_URL VARCHAR(2048),
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ITEM_CREATION_DATE TIMESTAMP,
	ITEM_CORRELATION_CREATION_DATE TIMESTAMP
)
IN NEWS32TABSPACE@

ALTER TABLE HOMEPAGE.NR_STORIES
    ADD CONSTRAINT "PK_STORY_ID" PRIMARY KEY("STORY_ID")@

ALTER TABLE HOMEPAGE.NR_STORIES
  	ADD CONSTRAINT FK_ENTRY_ID FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.NR_ENTRIES (ENTRY_ID)@
	
ALTER TABLE HOMEPAGE.NR_STORIES ADD CONSTRAINT FK_STORIES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.NR_STORIES_DATE
	ON HOMEPAGE.NR_STORIES (CREATION_DATE DESC)@

CREATE INDEX HOMEPAGE.STORY_CONTAINED_ID
    ON HOMEPAGE.NR_STORIES (CONTAINER_ID)@

CREATE INDEX HOMEPAGE.STORIES_ITEM_CORR_ID
    ON HOMEPAGE.NR_STORIES (ITEM_CORRELATION_ID, ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.NR_STORIES_EIDX
    ON HOMEPAGE.NR_STORIES (ENTRY_ID)@

CREATE INDEX  HOMEPAGE.NR_STORIES_ER_UUID 
	ON HOMEPAGE.NR_STORIES (EVENT_RECORD_UUID, STORY_ID)@
    
CREATE INDEX HOMEPAGE.NR_STORY_CD_IDX 
	ON HOMEPAGE.NR_STORIES (CREATION_DATE ASC, STORY_ID)@        

CREATE INDEX HOMEPAGE.STORIES_EVENT_ITEM_ACTOR_IDX ON
	HOMEPAGE.NR_STORIES (EVENT_NAME, ITEM_ID, ACTOR_UUID)@

CREATE INDEX HOMEPAGE.STORIES_ITEM_ID_IX 
	ON HOMEPAGE.NR_STORIES (ITEM_ID)@
	
CREATE INDEX HOMEPAGE.NR_STORIES_REL_COMM
	ON HOMEPAGE.NR_STORIES (RELATED_COMMUNITY_ID)@
	
CREATE INDEX HOMEPAGE.STORIES_ITEM_ENTRY_CORR_ID
    ON HOMEPAGE.NR_STORIES (ENTRY_CORRELATION_ID, ORGANIZATION_ID)@	

COMMIT@

----------------------------------------------------------------
-- HOMEPAGE.NR_ENTRIES_ARCHIVE
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(256),
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	ITEM_CREATION_DATE TIMESTAMP,
	ITEM_UPDATE_DATE TIMESTAMP,
	ITEM_TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT NULL,
	N_RECOMMANDATIONS SMALLINT DEFAULT NULL,
	LAST_COMMENT_ID VARCHAR(256),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(256),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_AUTHOR_COMMENT VARCHAR(36),
	ITEM_ATOM_URL VARCHAR(2048),
	PREVIEW_IMAGE_URL VARCHAR(2048),
	JSON_META_DATA CLOB INLINE LENGTH 800,
	ITEM_SCOPE SMALLINT,
	IS_LAST_COMMENT_PUBLIC SMALLINT,
	IS_PREV_COMMENT_PUBLIC SMALLINT,
	ITEM_CORRELATION_ID VARCHAR(256),
	ITEM_CORRELATION_NAME VARCHAR(256),
	LAST_DESC_COMMENT VARCHAR(4000),
	PREV_DESC_COMMENT VARCHAR(4000),
	LAST_UPDATE_DATE_COMMENT TIMESTAMP,
	PREV_UPDATE_DATE_COMMENT TIMESTAMP,
	ITEM_AUTHOR_UUID VARCHAR (256),
	ITEM_CORRELATION_AUTHOR_UUID VARCHAR (256),
	BRIEF_DESC VARCHAR (4000),
	ITEM_CORRELATION_BRIEF_DESC VARCHAR(4000),
	IS_LAST_COMMENT_VISIBLE SMALLINT DEFAULT 1,
	IS_PREV_COMMENT_VISIBLE SMALLINT DEFAULT 1,
	LAST_UPDATE_RECORD TIMESTAMP,
	PREV_COMMENT_NUM_REC INTEGER DEFAULT NULL,
	LAST_COMMENT_NUM_REC INTEGER DEFAULT NULL,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	PREV_COMMENT_OBJECT_META_DATA CLOB INLINE LENGTH 800,
	LAST_COMMENT_OBJECT_META_DATA CLOB INLINE LENGTH 800,
	LAST_COMMENT_TAGS VARCHAR(1024),
	PREV_COMMENT_TAGS VARCHAR(1024),
	IS_EXTERNAL SMALLINT DEFAULT 0 NOT NULL,
	ITEM_CORRELATION_CREATION_DATE TIMESTAMP
)
IN NEWS32TABSPACE@

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
    ADD CONSTRAINT PK_ENTRY_AR_ID PRIMARY KEY(ENTRY_ID)@
    
ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE ADD CONSTRAINT FK_ENTRIES_ARCHIVE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
    

CREATE INDEX HOMEPAGE.NR_ENTRIES_AR_CONT
    ON HOMEPAGE.NR_ENTRIES_ARCHIVE (CONTAINER_ID)@

CREATE UNIQUE INDEX HOMEPAGE.NR_ENTRIES_AR_ITEMORG
 	ON HOMEPAGE.NR_ENTRIES_ARCHIVE(ITEM_ID, ORGANIZATION_ID)@
 	
COMMIT@

----------------------------------------------------------------------
-- HOMEPAGE.NR_AGGREGATED_READERS 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AGGREGATED_READERS (
	CATEGORY_READER_ID VARCHAR(36) DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	COMMUNITY_ID VARCHAR(36),
	ROLLUP_ACTION_TYPE VARCHAR(36)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS
    ADD CONSTRAINT PK_AGG_READERS PRIMARY KEY(CATEGORY_READER_ID)@

ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS 
	ADD CONSTRAINT FK_AGG_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@ 
	
ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS ADD CONSTRAINT FK_AGG_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

--  [start indexes] NR_AGGREGATED_READERS
CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_STR_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_ITM_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_CD_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE INDEX HOMEPAGE.AGGREGATED_READERS_STR_RDR 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (STORY_ID, READER_ID, CONTAINER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (CREATION_DATE DESC, IS_BROADCAST)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_RLL_BRD_VVI 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (COMMUNITY_ID)@ 
COMMIT@

CREATE INDEX HOMEPAGE.MPM_AGG_READERS_1B 
	ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, USE_IN_ROLLUP, ORGANIZATION_ID, CREATION_DATE, SOURCE_TYPE) 
	ALLOW REVERSE SCANS PAGE SPLIT SYMMETRIC COLLECT SAMPLED DETAILED STATISTICS COMPRESS YES INCLUDE NULL KEYS@
COMMIT@

--  [end indexes] NR_AGGREGATED_READERS


--------------------------------------------------------------------------
-- 11) HOMEPAGE.NR_STATUS_UPDATE_READERS
--------------------------------------------------------------------------	
CREATE TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS (
	CATEGORY_READER_ID VARCHAR(36)  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	COMMUNITY_ID VARCHAR(36),
	ROLLUP_ACTION_TYPE VARCHAR(36),
   	CONSTRAINT  CK_CAT11_TYPE
    			CHECK
    			(CATEGORY_TYPE = 11)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS 
    ADD CONSTRAINT PK_SU_READERS PRIMARY KEY(CATEGORY_READER_ID)@

ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS
	ADD CONSTRAINT FK_STA_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@
	
ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS ADD CONSTRAINT FK_SU_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	
	
--  [start indexes] NR_STATUS_UPDATE_READERS
CREATE  INDEX HOMEPAGE.STATUS_READERS_STR_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.STATUS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.STATUS_READERS_CD_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.STATUS_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE  INDEX HOMEPAGE.STATUS_READERS_STR_RDR 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.STATUS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (CREATION_DATE DESC, IS_STORY_COMM)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.STATUS_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.STATUS_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@


CREATE  INDEX HOMEPAGE.STATUS_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_STATUS_UPDATE_READERS

---------------------------------------------------------
-- 12) ADDING A NR_EXTERNAL_READERS READER TABLE
---------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_EXTERNAL_READERS (
	CATEGORY_READER_ID VARCHAR(36)  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	COMMUNITY_ID VARCHAR(36),
	ROLLUP_ACTION_TYPE VARCHAR(36),
   	CONSTRAINT  CK_CAT12_TYPE
    			CHECK
    			(CATEGORY_TYPE = 12)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS 
    ADD CONSTRAINT PK_EXT_READERS PRIMARY KEY(CATEGORY_READER_ID)@

ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS
	ADD CONSTRAINT FK_EXT_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@
	
ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS ADD CONSTRAINT FK_EXT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	
	
--  [start indexes] NR_EXTERNAL_READERS
CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_STR_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_ITM_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_CD_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE INDEX HOMEPAGE.EXTERNAL_READERS_STR_RDR 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@


CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_EXTERNAL_READERS


---------------------------------------------------------
-- 13-16) ADDING NR_ACTIONABLE_READERS READER TABLE
---------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ACTIONABLE_READERS (
	CATEGORY_READER_ID VARCHAR(36)  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	OPERATION_ID VARCHAR(512),
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	COMMUNITY_ID VARCHAR(36),
	ROLLUP_ACTION_TYPE VARCHAR(36),
	CONSTRAINT   	CK_CAT_ACTION_TYPE
    				CHECK
    				(CATEGORY_TYPE >= 14 AND CATEGORY_TYPE <= 16)	
)
IN NEWS32TABSPACE@

ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS 
    ADD CONSTRAINT PK_ACTION_READERS PRIMARY KEY (CATEGORY_READER_ID)@
    
ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS
	ADD CONSTRAINT FK_ACT_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@    

ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS ADD CONSTRAINT FK_ACT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	
--  [start indexes] NR_ACTIONABLE_READERS
CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_STR_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_ITM_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_CD_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE INDEX HOMEPAGE.ACTIONABLE_READERS_STR_RDR 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_RLL_BRD_VVI
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@


CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_ACTIONABLE_READERS


--ALTER VIEW HOMEPAGE.NR_FOLLOWED_STORIES ENABLE QUERY OPTIMIZATION@

-------------------------------------------------------
-- 1) HOMEPAGE.BOARD
-------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD  (
	BOARD_ID VARCHAR(256) NOT NULL,
	BOARD_CONTAINER_ID VARCHAR(256) NOT NULL,
	BOARD_TYPE VARCHAR(64) NOT NULL,
	BOARD_OWNER_ASSOC_ID VARCHAR(36) NOT NULL,
	BOARD_OWNER_ASSOC_TYPE VARCHAR(64) NOT NULL,
	CREATED TIMESTAMP NOT NULL,
	CREATED_BY VARCHAR(36) NOT NULL,
	LASTUPDATE TIMESTAMP NOT NULL,
	LASTUPDATE_BY VARCHAR(36) NOT NULL,
	IS_ENABLED SMALLINT DEFAULT 1 NOT NULL,
	VISIBILITY VARCHAR(36),
	EDITABILITY VARCHAR(36),
	ORGANIZATION_ID VARCHAR(36)
)
IN BOARD16TABSPACE@

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT BOARD_PK PRIMARY KEY (BOARD_ID)@ 

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT FK_BRD_OWNER FOREIGN KEY (BOARD_OWNER_ASSOC_ID) 
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)@

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT FK_BRD_CREATED FOREIGN KEY (CREATED_BY) 
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)@	

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT FK_BRD_LASTUPDATE FOREIGN KEY (LASTUPDATE_BY) 
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)@
	
ALTER TABLE HOMEPAGE.BOARD ADD CONSTRAINT FK_BOARD_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@	

CREATE UNIQUE INDEX HOMEPAGE.BOARD_OWNER_ASSOC_UIDX 
	ON HOMEPAGE.BOARD (BOARD_OWNER_ASSOC_ID ASC, BOARD_TYPE ASC)@

ALTER TABLE HOMEPAGE.BOARD
	ADD CONSTRAINT CONTAINER_ID_UNQ UNIQUE (BOARD_CONTAINER_ID)@
	
CREATE UNIQUE INDEX HOMEPAGE.BRD_CONTAINER_ID_UIDX 
	ON HOMEPAGE.BOARD (BOARD_CONTAINER_ID)@
	
--------------------------------------
-- HOMEPAGE.BOARD_ENTRIES to store the relationship between a reader and a status update
--------------------------------------
CREATE TABLE HOMEPAGE.BOARD_ENTRIES  (
	ENTRY_ID VARCHAR(47) NOT NULL, -- the format will include in the pk also the creation time
	ENTRY_TYPE SMALLINT,
	CATEGORY_TYPE SMALLINT,
	SOURCE VARCHAR(36),
	SOURCE_TYPE SMALLINT,
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_URL VARCHAR(2048) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	CREATION_DATE TIMESTAMP NOT NULL, -- used also by the seedlist, when something is created the update is equal to is created
	UPDATE_DATE TIMESTAMP NOT NULL, -- this field is used and queried from the the seedlist for initial and incremental index
	ACTOR_UUID VARCHAR(36),
	IS_COMMUNITY_STORY SMALLINT DEFAULT 0,
	TARGET_SUBJECT_ID VARCHAR(256),
	TAGS VARCHAR(1024),
	SL_IS_UPDATED SMALLINT NOT NULL DEFAULT 0, -- this field is used by the seedlist
	SL_IS_DELETED SMALLINT NOT NULL DEFAULT 0, -- this field is used by the seedlist
	SL_UPDATE_DATE TIMESTAMP NOT NULL, -- this field is used by the seedlist
	LAST_CONTRIBUTOR_ID VARCHAR(36),
	CONTENT_LOCALE  VARCHAR(5),
	HTML_CONTENT CLOB,
	CONTENT CLOB,
	ORGANIZATION_ID VARCHAR(36),
	CREATION_DATE_DISPLAY TIMESTAMP,
	UPDATE_DATE_DISPLAY TIMESTAMP,
	ACTOR_UUID_DISPLAY VARCHAR(36),
	LAST_CONTRIBUTOR_ID_DISPLAY VARCHAR(36)
)
IN BOARD16TABSPACE@

ALTER TABLE HOMEPAGE.BOARD_ENTRIES 
    ADD CONSTRAINT PK_BRD_ENTRIES PRIMARY KEY(ENTRY_ID)@

ALTER TABLE HOMEPAGE.BOARD_ENTRIES
	ADD CONSTRAINT FK_CONTAINER_ID FOREIGN KEY (CONTAINER_ID) 
	REFERENCES HOMEPAGE.BOARD (BOARD_CONTAINER_ID)@ 
	
ALTER TABLE HOMEPAGE.BOARD_ENTRIES ADD CONSTRAINT FK_BOARD_ENTRIES_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.NEWS_BRD_SL_UPDATE
    ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC)@

CREATE UNIQUE INDEX HOMEPAGE.ITEM_ID_IDX
   ON HOMEPAGE.BOARD_ENTRIES (ITEM_ID ASC) INCLUDE (CONTAINER_ID)@

CREATE INDEX HOMEPAGE.CREATION_ITEM_IDX 
	ON HOMEPAGE.BOARD_ENTRIES (CREATION_DATE_DISPLAY DESC, ITEM_ID DESC)@

CREATE INDEX HOMEPAGE.BRD_E_CONTAINER_ID_UIDX 
	ON HOMEPAGE.BOARD_ENTRIES (CONTAINER_ID)@

CREATE INDEX HOMEPAGE.BRD_SL_UPDATED_DEL 
	ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC, SL_IS_DELETED)@
	
CREATE INDEX HOMEPAGE.BRD_ENTRIES_ITEM
	ON HOMEPAGE.BOARD_ENTRIES (ITEM_ID, SL_IS_DELETED)@	
	
CREATE INDEX HOMEPAGE.SEEDLIST_BRD_IDX 
	ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC, ENTRY_ID)@
	
CREATE INDEX HOMEPAGE.BRD_IS_DEL_CDATE_ACT_ENT
	ON HOMEPAGE.BOARD_ENTRIES (SL_IS_DELETED, CREATION_DATE DESC, ACTOR_UUID, ENTRY_TYPE)@	

COMMIT@

--------------------------------------
-- HOMEPAGE.BOARD_COMMENTS to store the comments
--------------------------------------
CREATE TABLE HOMEPAGE.BOARD_COMMENTS  (
	COMMENT_ID VARCHAR(47) NOT NULL, -- the format will include in the pk also the creation time
	ACTOR_UUID VARCHAR(36),
	CREATION_DATE TIMESTAMP NOT NULL,
	ITEM_ID VARCHAR(47),
	ENTRY_ID VARCHAR(47),
	ITEM_URL VARCHAR(2048),	
	UPDATE_DATE TIMESTAMP,
	LAST_CONTRIBUTOR_ID VARCHAR(36),
	CONTENT_LOCALE VARCHAR(5),
	PUBLISHED_ORDER INTEGER,
	TAGS VARCHAR(1024),
	HTML_CONTENT CLOB,
	CONTENT CLOB,
	ORGANIZATION_ID VARCHAR(36),
	AUTHOR_UUID_DISPLAY VARCHAR(36),
	LAST_CONTRIBUTOR_ID_DISPLAY VARCHAR(36),
	CREATION_DATE_DISPLAY TIMESTAMP,
	UPDATE_DATE_DISPLAY TIMESTAMP
)
IN BOARD16TABSPACE@

ALTER TABLE HOMEPAGE.BOARD_COMMENTS 
    ADD CONSTRAINT PK_BRD_COMMENT_ID PRIMARY KEY(COMMENT_ID)@

ALTER TABLE HOMEPAGE.BOARD_COMMENTS
	ADD CONSTRAINT FK_BRD_COM_ENTRY FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.BOARD_ENTRIES (ENTRY_ID)@

ALTER TABLE HOMEPAGE.BOARD_COMMENTS  ADD CONSTRAINT FK_BOARD_COMMENTS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.NEWS_BRD_ITEM_ID
    ON HOMEPAGE.BOARD_COMMENTS  (ITEM_ID)@

CREATE INDEX HOMEPAGE.NEWS_BRD_ITEM_CORR_ID
    ON HOMEPAGE.BOARD_COMMENTS  (ENTRY_ID)@

CREATE INDEX HOMEPAGE.CREATION_DATE_IDX 
	ON HOMEPAGE.BOARD_COMMENTS (CREATION_DATE ASC)@
	
CREATE INDEX HOMEPAGE.ITEM_CORR_CREATION_IDX 
	ON HOMEPAGE.BOARD_COMMENTS (ENTRY_ID, CREATION_DATE ASC)@
	
CREATE INDEX HOMEPAGE.ITEM_ITEM_CORR_IDX
	ON HOMEPAGE.BOARD_COMMENTS (ITEM_ID ASC, ENTRY_ID ASC)@	

CREATE UNIQUE INDEX HOMEPAGE.BRD_COMM_ITEM_COR_PUB
    ON HOMEPAGE.BOARD_COMMENTS (ENTRY_ID, PUBLISHED_ORDER ASC)@
    
CREATE INDEX HOMEPAGE.CREATION_DATE_ITEM_IDX
	ON HOMEPAGE.BOARD_COMMENTS (CREATION_DATE ASC, ITEM_ID)@
    
	
COMMIT@

----------------------------------------------------------------
-- ADDING BOARD_OBJECT_REFERENCE
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE (
	OBJECT_ID VARCHAR(47) NOT NULL,
	ITEM_ID VARCHAR(47) NOT NULL,
	DISPLAY_NAME VARCHAR(2048),
	IMAGE_NAME   VARCHAR(2048),
	NAME VARCHAR(512), 
	URL VARCHAR(1024), 
	CONTENT VARCHAR(4000),
	IMAGE_URL VARCHAR(1024),
	SOURCE  VARCHAR(36),
	SOURCE_TYPE  SMALLINT,
	CREATION_DATE TIMESTAMP,
	TYPE VARCHAR(36),
	AUTHOR_ID VARCHAR(36),
	AUTHOR_DISPLAY_NAME VARCHAR(256),
	OBJECT_META_DATA VARCHAR(4000),
	OBJECT_META_DATA_2 VARCHAR(4000),
	FULL_OBJECT_META_DATA CLOB,
	OBJECT_EXTERNAL_ID VARCHAR(256),
	ORGANIZATION_ID VARCHAR(36)
)
IN BRD32TABSPACE@

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE 
    ADD CONSTRAINT PK_BRD_OBJ_ID PRIMARY KEY(OBJECT_ID)@

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE
	ADD CONSTRAINT FK_BRD_AUTHOR_ID FOREIGN KEY (AUTHOR_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)@
	
ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE ADD CONSTRAINT FK_BRD_OBJ_REFERENCE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	

CREATE INDEX HOMEPAGE.BRD_ENTRY_IDX
    ON HOMEPAGE.BOARD_OBJECT_REFERENCE (ITEM_ID)@

CREATE INDEX HOMEPAGE.BRD_AUTHOR_IDX
    ON HOMEPAGE.BOARD_OBJECT_REFERENCE (AUTHOR_ID)@     
	
COMMIT@

--------------------------------------
-- HOMEPAGE.BOARD_RECOMMANDATIONS to store the relationship between a board entries and something which has been recommended
---------------------------------------
CREATE TABLE HOMEPAGE.BOARD_RECOMMENDATIONS  (
	RECOMMENDATION_ID VARCHAR(47) NOT NULL, --primary key
	RECOMMENDER_ID VARCHAR(36) NOT NULL, -- PERSON_ID of the recommender, FK to PERSON table
	ITEM_ID VARCHAR(47) NOT NULL,
	SOURCE_TYPE SMALLINT NOT NULL, 
	CREATION_DATE TIMESTAMP,
	ORGANIZATION_ID VARCHAR(36),
	RECOMMENDER_ID_DISPLAY VARCHAR(36),
	CREATION_DATE_DISPLAY TIMESTAMP
)
IN BOARD16TABSPACE@

ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS 
    ADD CONSTRAINT PK_BRD_RECOMM_ID PRIMARY KEY(RECOMMENDATION_ID)@
    
ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS
	ADD CONSTRAINT FK_BRD_RECOMMENDER FOREIGN KEY (RECOMMENDER_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)@
	
ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS ADD CONSTRAINT FK_BRD_RECOMM_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS
	ADD CONSTRAINT FK_BRD_RECOMMENDER_D FOREIGN KEY (RECOMMENDER_ID_DISPLAY) REFERENCES HOMEPAGE.PERSON (PERSON_ID)@	

--ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS
--	ADD CONSTRAINT FK_BRD_ENTRY_ID FOREIGN KEY (ENTRY_ID)
--	REFERENCES HOMEPAGE.BOARD_ENTRIES (ENTRY_ID)@    

CREATE INDEX HOMEPAGE.BRD_REC_ITEM_ID
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (ITEM_ID)@
    
CREATE UNIQUE INDEX HOMEPAGE.BRD_REC_RECOM_D_ITEM_ID
	ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID_DISPLAY, ITEM_ID)@

CREATE INDEX HOMEPAGE.BRD_RECOMMENDER_ID
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID)@
    
CREATE INDEX HOMEPAGE.BRD_RECOMMENDER_ID_D
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID_DISPLAY)@    

COMMIT@

-------------------------------------------------------
-- HOMEPAGE.BOARD_CURRENT_STATUS 
-- table to store the history of current status updates
-------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_CURRENT_STATUS  (
	CURRENT_STATUS_ID VARCHAR(47) NOT NULL, -- the format will include in the pk also the creation time
	ACTOR_UUID VARCHAR(36) NOT NULL,
	ENTRY_ID VARCHAR(47) NOT NULL,
	CURRENT_STATUS_SET TIMESTAMP NOT NULL,
	ORGANIZATION_ID VARCHAR(36)
)
IN BOARD16TABSPACE@

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS 
    ADD CONSTRAINT PK_CUR_ST_ID PRIMARY KEY (CURRENT_STATUS_ID)@

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS
	ADD CONSTRAINT FK_CUR_ST_ACTOR_ID FOREIGN KEY (ACTOR_UUID)
	REFERENCES HOMEPAGE.PERSON(PERSON_ID)@

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS
	ADD CONSTRAINT FK_CUR_ST_ENTRY_ID FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.BOARD_ENTRIES(ENTRY_ID)@
	
ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS ADD CONSTRAINT FK_BOARD_CURRENT_STATUS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.CURRENT_STATUS_INDEX 
	ON HOMEPAGE.BOARD_CURRENT_STATUS	(ACTOR_UUID ASC, CURRENT_STATUS_SET ASC, CURRENT_STATUS_ID ASC, ENTRY_ID ASC)@

CREATE UNIQUE INDEX HOMEPAGE.ACTOR_ENTRY 
	ON HOMEPAGE.BOARD_CURRENT_STATUS (ACTOR_UUID)@

CREATE INDEX HOMEPAGE.BRD_CURRENT_STATUS 
	ON HOMEPAGE.BOARD_CURRENT_STATUS (ENTRY_ID)@	

COMMIT@	

------------------------------------------------
-- HOMEPAGE.BOARD_MENTIONS
------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_MENTIONS  (
	BOARD_MENTIONS_ID VARCHAR(36) NOT NULL, --primary key
	ITEM_ID VARCHAR(256) NOT NULL, 
	PERSON_ID VARCHAR(36) NOT NULL, -- PERSON_ID of the recommender, FK to PERSON table
	LABEL VARCHAR(4000),
	WAS_ITEM_VISIBLE SMALLINT DEFAULT 0 NOT NULL,
	ORGANIZATION_ID VARCHAR(36)
)
IN BOARD16TABSPACE@

ALTER TABLE HOMEPAGE.BOARD_MENTIONS 
    ADD CONSTRAINT PK_BRD_MEN_ID PRIMARY KEY(BOARD_MENTIONS_ID)@

ALTER TABLE HOMEPAGE.BOARD_MENTIONS
	ADD CONSTRAINT FK_BRD_MEN_PER_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)@
	
ALTER TABLE HOMEPAGE.BOARD_MENTIONS ADD CONSTRAINT FK_BOARD_MENTIONS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.BRD_MEN_PER_IDX
	ON HOMEPAGE.BOARD_MENTIONS (PERSON_ID)@
	
CREATE INDEX HOMEPAGE.BRD_MEN_ITEM_IDX
	ON HOMEPAGE.BOARD_MENTIONS (ITEM_ID)@	
	
COMMIT@	

---------------------------------------------------------------------------------
-- ADDING QUARANTINE TABLE
---------------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.DELETED_STORIES_QUEUE (
	QUEUE_ID VARCHAR(36) NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE 	VARCHAR(36) NOT NULL, -- this is externalized
	SOURCE_TYPE SMALLINT NOT NULL,
	STATUS SMALLINT NOT NULL DEFAULT 0,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.DELETED_STORIES_QUEUE 
  	ADD CONSTRAINT PK_QUARANTINE PRIMARY KEY(QUEUE_ID)@
  	
ALTER TABLE HOMEPAGE.DELETED_STORIES_QUEUE ADD CONSTRAINT FK_DEL_STORIES_QUEUE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
  	
CREATE INDEX HOMEPAGE.DELETED_STORY_ID 
  	ON HOMEPAGE.DELETED_STORIES_QUEUE (STORY_ID)@  	

COMMIT@
  	
-----------------------------------------------
-- HOMEPAGE.NR_COMM_SETTINGS
-----------------------------------------------

CREATE TABLE HOMEPAGE.NR_COMM_SETTINGS (
	COMM_ID VARCHAR(36) NOT NULL,
	MICROBLOGGING_WRITE_ACL SMALLINT,
	FLAGS VARCHAR(36),
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_COMM_SETTINGS
    ADD CONSTRAINT PK_COMM_ID PRIMARY KEY(COMM_ID)@
    
ALTER TABLE HOMEPAGE.NR_COMM_SETTINGS ADD CONSTRAINT FK_COMM_SETTINGS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

COMMIT@



-----------------------------------------------------
-- 18 NR_PROFILES_VIEW
-----------------------------------------------------
CREATE TABLE HOMEPAGE.NR_PROFILES_VIEW (
	CATEGORY_READER_ID VARCHAR(36)  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39),
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	COMMUNITY_ID VARCHAR(36),
	ROLLUP_ACTION_TYPE VARCHAR(36),
	CONSTRAINT   	CK_CAT18_TYPE
    				CHECK
    				(CATEGORY_TYPE = 18)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW 
    ADD CONSTRAINT PK_PROFILES_VIEW PRIMARY KEY(CATEGORY_READER_ID)@
    
ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW
	ADD CONSTRAINT FK_PRO_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@ 
	
ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW ADD CONSTRAINT FK_PRF_VIEW_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	
--  [start indexes] NR_PROFILES_VIEW
CREATE  INDEX HOMEPAGE.PROFILES_VIEW_STR_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_ITM_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_CD_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_RLL_IIX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE  INDEX HOMEPAGE.PROFILES_VIEW_STR_RDR 
 	ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_DEL_SERV_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (CREATION_DATE DESC, IS_BROADCAST)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@

--NEW ORG_ID NR_PROFILES_VIEW 
CREATE  INDEX HOMEPAGE.PROFILES_VIEW_ORG_IIDX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ORGANIZATION_ID, IS_VISIBLE, IS_BROADCAST, ROLLUP_ENTRY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_COMM_IDX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_PROFILES_VIEW

--------------------------------------------------------------------------
-- 19 HOMEPAGE.NR_NOTIFICATION_SENT_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS (
	CATEGORY_READER_ID VARCHAR(36)  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	ROLLUP_ACTION_TYPE VARCHAR(36),
	COMMUNITY_ID VARCHAR(36),
        CONSTRAINT   	CK_CAT19_TYPE
    			CHECK
    			(CATEGORY_TYPE = 19)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS 
    ADD CONSTRAINT PK_SENT_NOT_READ PRIMARY KEY(CATEGORY_READER_ID)@
    
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS
	ADD CONSTRAINT FK_NOT_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS ADD CONSTRAINT FK_NOT_SENT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

--  [start indexes] NR_NOTIFICATION_SENT_READERS
CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_STR_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_ITM_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_CD_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE INDEX HOMEPAGE.NOTIFICA_READERS_STR_RDR 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@


CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_NOTIFICATION_SENT_READERS

--------------------------------------------------------------------------
-- 20 HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (
	CATEGORY_READER_ID VARCHAR(36)  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	ROLLUP_ACTION_TYPE VARCHAR(36),
	COMMUNITY_ID VARCHAR(36),
        CONSTRAINT   	CK_CAT20_TYPE
    			CHECK
    			(CATEGORY_TYPE = 20)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS 
    ADD CONSTRAINT PK_REC_NOT_READ PRIMARY KEY(CATEGORY_READER_ID)@
    
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS
	ADD CONSTRAINT FK_REC_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@ 

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS ADD CONSTRAINT FK_NOT_REC_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

--  [start indexes] NR_NOTIFICATION_RECEIV_READERS
CREATE  INDEX HOMEPAGE.NOT_REC_READERS_STR_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_ITM_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_CD_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (READER_ID, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_STR_RDR 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (ROLLUP_ENTRY_ID, READER_ID, IS_VISIBLE, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@


CREATE  INDEX HOMEPAGE.NOT_REC_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_NOTIFICATION_RECEIV_READERS

--------------------------------------------------------------------------
-- 13 HOMEPAGE.NR_SAVED_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SAVED_READERS (
	CATEGORY_READER_ID VARCHAR(36)  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	OPERATION_ID VARCHAR(512),
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	COMMUNITY_ID VARCHAR(36),
	ROLLUP_ACTION_TYPE VARCHAR(36),
	CONSTRAINT   	CK_CAT_SAVED_TYPE
    				CHECK
    				(CATEGORY_TYPE = 13)	
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_SAVED_READERS 
    ADD CONSTRAINT PK_SAVED_READERS PRIMARY KEY (CATEGORY_READER_ID)@
    
ALTER TABLE HOMEPAGE.NR_SAVED_READERS
	ADD CONSTRAINT FK_SAV_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@  
	
ALTER TABLE HOMEPAGE.NR_SAVED_READERS ADD CONSTRAINT FK_SAVED_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
    
--  [start indexes] NR_SAVED_READERS
CREATE  INDEX HOMEPAGE.SAVED_READERS_STR_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.SAVED_READERS_ITM_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.SAVED_READERS_CD_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.SAVED_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_SAVED_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE  INDEX HOMEPAGE.SAVED_READERS_STR_RDR 
 	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.SAVED_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.SAVED_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_SAVED_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.SAVED_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_SAVED_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@


CREATE  INDEX HOMEPAGE.SAVED_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_SAVED_READERS (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_SAVED_READERS

--------------------------------------------------------------------------
-- 21 HOMEPAGE.NR_TOPICS_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_TOPICS_READERS (
	CATEGORY_READER_ID VARCHAR(36)  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	ROLLUP_AUTHOR_ID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	COMMUNITY_ID VARCHAR(36),
	ROLLUP_ACTION_TYPE VARCHAR(36),
	CONSTRAINT   	CK_CAT_TOPICS_TYPE
    				CHECK
    				(CATEGORY_TYPE = 21)	
)
IN NEWS32TABSPACE@

ALTER TABLE HOMEPAGE.NR_TOPICS_READERS 
    ADD CONSTRAINT PK_TOPICS_READERS PRIMARY KEY (CATEGORY_READER_ID)@
    
ALTER TABLE HOMEPAGE.NR_TOPICS_READERS
	ADD CONSTRAINT FK_TOP_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@ 
	
ALTER TABLE HOMEPAGE.NR_TOPICS_READERS ADD CONSTRAINT FK_TOPICS_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

--  [start indexes] NR_TOPICS_READERS
CREATE  INDEX HOMEPAGE.TOPICS_READERS_STR_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.TOPICS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.TOPICS_READERS_CD_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.TOPICS_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_TOPICS_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE INDEX HOMEPAGE.TOPICS_READERS_STR_RDR 
 	ON HOMEPAGE.NR_TOPICS_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.TOPICS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.TOPICS_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_TOPICS_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.TOPICS_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_TOPICS_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@


CREATE  INDEX HOMEPAGE.TOPICS_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_TOPICS_READERS (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_TOPICS_READERS

----------------------------------------------------
-- 22 HOMEPAGE.NR_MENTIONS_READERS
----------------------------------------------------
CREATE TABLE HOMEPAGE.NR_MENTIONS_READERS (
	CATEGORY_READER_ID VARCHAR(36) DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	ROLLUP_ACTION_TYPE VARCHAR(36),
	COMMUNITY_ID VARCHAR(36),
		CONSTRAINT   	CK_CAT22_TYPE
    			CHECK
    			(CATEGORY_TYPE = 22)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS
    ADD CONSTRAINT PK_MEN_READERS PRIMARY KEY(CATEGORY_READER_ID)@

ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS 
	ADD CONSTRAINT FK_MEN_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@ 
	
ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS ADD CONSTRAINT FK_MENT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	
--  [start indexes] NR_MENTIONS_READERS
CREATE  INDEX HOMEPAGE.MENTIONS_READERS_STR_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_CD_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE  INDEX HOMEPAGE.MENTIONS_READERS_STR_RDR 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@


CREATE  INDEX HOMEPAGE.MENTIONS_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_MENTIONS_READERS

----------------------------------------------------
-- 23 HOMEPAGE.NR_COMMUNITIES_VIEW
----------------------------------------------------
CREATE TABLE HOMEPAGE.NR_COMMUNITIES_VIEW (
	CATEGORY_READER_ID VARCHAR(36) DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256),
	COMMUNITY_ID VARCHAR(36),
	ROLLUP_ACTION_TYPE VARCHAR(36),
		CONSTRAINT   	CK_CAT23_TYPE
    			CHECK
    			(CATEGORY_TYPE = 23)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_COMMUNITIES_VIEW
    ADD CONSTRAINT PK_CV_READERS PRIMARY KEY(CATEGORY_READER_ID)@

ALTER TABLE HOMEPAGE.NR_COMMUNITIES_VIEW 
	ADD CONSTRAINT FK_CV_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@ 
	
ALTER TABLE HOMEPAGE.NR_COMMUNITIES_VIEW ADD CONSTRAINT FK_CV_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

---  [start indexes] NR_COMMUNITIES_VIEW
CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_STR_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (STORY_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_ITM_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (ITEM_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_CD_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (STORY_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_RLL_IIX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC)@ 
COMMIT@

CREATE UNIQUE  INDEX HOMEPAGE.COMMUNITIES_VIEW_STR_RDR 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_DEL_SERV_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (CREATION_DATE DESC)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE)@ 
COMMIT@

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE)@ 
COMMIT@


CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_COMM_IDX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (COMMUNITY_ID)@ 
COMMIT@

--  [end indexes] NR_COMMUNITIES_VIEW



-----------------------------------------------------------------------
-- [START] SEEDLIST
-----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AS_SEEDLIST (
	SEEDLIST_ID VARCHAR(36) NOT NULL, -- pk which is not linked to any value
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL, -- when an item id is moderated
	IS_DELETED SMALLINT DEFAULT 0 NOT NULL, -- when a story is moderated
	DATA VARCHAR(4000),
	FULL_DATA CLOB, -- in case data is not enough big
	FOLLOWERS VARCHAR(4000),
	FULL_FOLLOWERS CLOB, -- in case followers is not enough big
	STORY_ID VARCHAR(36) NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
	ITEM_ID VARCHAR(256),
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	COMMUNITY_ID VARCHAR(36)
)
IN NEWS32TABSPACE@

ALTER TABLE HOMEPAGE.NR_AS_SEEDLIST
	ADD CONSTRAINT NR_SEEDLIST_PK PRIMARY KEY (SEEDLIST_ID)@

ALTER TABLE HOMEPAGE.NR_AS_SEEDLIST ADD CONSTRAINT FK_AS_SEEDLIST_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@

CREATE UNIQUE INDEX HOMEPAGE.NR_SL_STR_UNIQUE
	ON HOMEPAGE.NR_AS_SEEDLIST(STORY_ID)@	

CREATE INDEX HOMEPAGE.NR_SL_ITEM_ID_IX
	ON HOMEPAGE.NR_AS_SEEDLIST (ITEM_ID)@

CREATE INDEX HOMEPAGE.NR_SL_UD_DELETED_VIS
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE DESC, IS_DELETED, IS_VISIBLE)@
	
CREATE INDEX HOMEPAGE.NR_SL_UD_DELETED
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE DESC)@
	
CREATE INDEX HOMEPAGE.NR_SL_CD_DELETED
	ON HOMEPAGE.NR_AS_SEEDLIST (CREATION_DATE DESC)@	
	
CREATE INDEX HOMEPAGE.NR_SL_UD_STR
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE ASC, STORY_ID)@
	
CREATE INDEX HOMEPAGE.NR_SL_VIS_DELETED_US_STR
	ON HOMEPAGE.NR_AS_SEEDLIST (IS_VISIBLE, IS_DELETED, UPDATE_DATE DESC, STORY_ID)@
COMMIT@

CREATE INDEX HOMEPAGE.NR_AS_SEEDLIST_COMM_IDX
	ON HOMEPAGE.NR_AS_SEEDLIST (COMMUNITY_ID)@
COMMIT@	
	
	
	
	
COMMIT@	


-----------------------------------------------------------------------
-- [END] SEEDLIST
-----------------------------------------------------------------------

------------------------------------------------
-- HOMEPAGE.NR_AS_COLLECTION_CONFIG
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AS_COLLECTION_CONFIG (
	COLLECTION_ID VARCHAR (50) NOT NULL,
	XML_DATA CLOB (51200) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_AS_COLLECTION_CONFIG
	ADD CONSTRAINT NR_AS_CONFIG_PK PRIMARY KEY (COLLECTION_ID)@
	
COMMIT@

------------------------------------------------
-- HOMEPAGE.NR_AS_CRAWLER_STATUS
------------------------------------------------	
CREATE TABLE HOMEPAGE.NR_AS_CRAWLER_STATUS (
	COLLECTION_ID VARCHAR (50) NOT NULL,
	XML_DATA CLOB (51200) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_AS_CRAWLER_STATUS
	ADD CONSTRAINT NR_AS_STATUS_PK PRIMARY KEY (COLLECTION_ID)@
	
	
COMMIT@

------------------------------------------------------------------------------
-- ADD NR_AS_CONTENT_INDEX_STATS TABLE
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS (
	STAT_ID VARCHAR(36) NOT NULL,
	STAT_NAME VARCHAR(2048),
	STAT_VALUE BLOB(3670016),
	STAT_UPDATE_DATE TIMESTAMP,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS
  	ADD CONSTRAINT NR_CONTENTSTATS_PK PRIMARY KEY(STAT_ID)@
  	
ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS ADD CONSTRAINT FK_AS_CNT_INDEX_STATS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
  	

COMMIT@

--------------------------------------------------
-- HOMEPAGE.IMG_CACHE
--------------------------------------------------
CREATE TABLE HOMEPAGE.IMG_CACHE (
	IMG_CACHE_ID VARCHAR(36) NOT NULL,
	ORIGINAL_URL VARCHAR (1024) NOT NULL,
	FILE_PATH VARCHAR (256) NOT NULL,
	NUM_REQUEST INTEGER,
	CREATION_DATE TIMESTAMP,
	LAST_REQUEST_DATE TIMESTAMP,
	MAX_HEIGHT SMALLINT,
	MAX_WIDTH SMALLINT,	
	TRANSFORMATION SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ORIGINAL_URL_MD5 char(32) NOT NULL
)	
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.IMG_CACHE
  	ADD CONSTRAINT PK_IMG_CACHE_ID PRIMARY KEY(IMG_CACHE_ID)@  


ALTER TABLE HOMEPAGE.IMG_CACHE ADD CONSTRAINT FK_IMG_CACHE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@	

CREATE UNIQUE INDEX HOMEPAGE.IMG_CACHE_FILE_UNQ
	ON HOMEPAGE.IMG_CACHE (FILE_PATH)@
	
CREATE INDEX HOMEPAGE.IMG_CACHE_URL_IDX
	ON HOMEPAGE.IMG_CACHE (ORIGINAL_URL_MD5, ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.IMG_CACHE_DEL_BATCH_IDX 
   	ON HOMEPAGE.IMG_CACHE (LAST_REQUEST_DATE ASC, NUM_REQUEST ASC, FILE_PATH, IMG_CACHE_ID)@	
	
COMMIT@	

-----------------------------------------------------------
-- HOMEPAGE.NR_AS_COUNTS
-----------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AS_COUNTS (
	AS_COUNT_ID VARCHAR(36) NOT NULL,
	PERSON_ID VARCHAR(36) NOT NULL,	
	UI_VIEW SMALLINT,
	COUNT INTEGER,
	ORGANIZATION_ID VARCHAR (36) NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL
)	
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_AS_COUNTS 
  	ADD CONSTRAINT PK_AS_COUNT_ID PRIMARY KEY (AS_COUNT_ID)@
  	
ALTER TABLE HOMEPAGE.NR_AS_COUNTS
    ADD CONSTRAINT FK_AS_COUNT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
    
ALTER TABLE HOMEPAGE.NR_AS_COUNTS
    ADD CONSTRAINT FK_AS_COUNT_PER_ID FOREIGN KEY (PERSON_ID) REFERENCES HOMEPAGE.PERSON (PERSON_ID)@    

CREATE UNIQUE INDEX HOMEPAGE.NR_COUNT_PER_VIEW_UNQ 
	ON HOMEPAGE.NR_AS_COUNTS (PERSON_ID, UI_VIEW, ORGANIZATION_ID)@
	
CREATE INDEX HOMEPAGE.NR_AS_COUNT_PER_IDX
	ON HOMEPAGE.NR_AS_COUNTS (PERSON_ID)@
	
CREATE INDEX HOMEPAGE.NR_AS_COUNT_ORG_IDX
	ON HOMEPAGE.NR_AS_COUNTS (ORGANIZATION_ID)@	
	
COMMIT@

runstats on table HOMEPAGE.NR_AS_COUNTS with distribution and detailed indexes all allow write access@

------------------------------------------------
-- OEMBED_SCHEDULER_TASK
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_TASK (
	TASKID BIGINT NOT NULL,
	VERSION VARCHAR(5) NOT NULL,
	ROW_VERSION INTEGER NOT NULL,
	TASKTYPE INTEGER NOT NULL,
	TASKSUSPENDED SMALLINT NOT NULL,
	CANCELLED SMALLINT NOT NULL,
	NEXTFIRETIME BIGINT NOT NULL,
	STARTBYINTERVAL VARCHAR(254),
	STARTBYTIME BIGINT,
	VALIDFROMTIME BIGINT,
	VALIDTOTIME BIGINT,
	REPEATINTERVAL VARCHAR(254),
	MAXREPEATS INTEGER NOT NULL,
	REPEATSLEFT INTEGER NOT NULL,
	TASKINFO BLOB(102400) LOGGED NOT COMPACT,
	NAME VARCHAR(254) NOT NULL,
	AUTOPURGE INTEGER NOT NULL,
	FAILUREACTION INTEGER,
	MAXATTEMPTS INTEGER,
	QOS INTEGER,
	PARTITIONID INTEGER,
	OWNERTOKEN VARCHAR(200) NOT NULL,
	CREATETIME BIGINT NOT NULL
) 
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.OEMBED_SCHEDULER_TASK 
	ADD PRIMARY KEY (TASKID)@

CREATE INDEX HOMEPAGE.OEMBED_SCHEDULER_TASK_IDX1 
	ON HOMEPAGE.OEMBED_SCHEDULER_TASK (TASKID, OWNERTOKEN)@

CREATE INDEX HOMEPAGE.OEMBED_SCHEDULER_TASK_IDX2 
	ON HOMEPAGE.OEMBED_SCHEDULER_TASK (NEXTFIRETIME ASC, REPEATSLEFT, PARTITIONID) CLUSTER@

------------------------------------------------
-- OEMBED_SCHEDULER_TREG
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_TREG (
	REGKEY VARCHAR(254) NOT NULL,
	REGVALUE VARCHAR(254) 
) 
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.OEMBED_SCHEDULER_TREG 
	ADD PRIMARY KEY (REGKEY)@

------------------------------------------------
-- OEMBED_SCHEDULER_LMGR
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_LMGR (
	LEASENAME VARCHAR(254) NOT NULL,
	LEASEOWNER VARCHAR(254) NOT NULL,
	LEASE_EXPIRE_TIME  BIGINT,
	DISABLED VARCHAR(5)
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.OEMBED_SCHEDULER_LMGR 
	ADD PRIMARY KEY (LEASENAME)@

------------------------------------------------
-- OEMBED_SCHEDULER_LMPR
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_LMPR (
	LEASENAME VARCHAR(254) NOT NULL,
	NAME VARCHAR(254) NOT NULL,
	VALUE VARCHAR(254) NOT NULL
)
IN NEWSTABSPACE@

CREATE INDEX HOMEPAGE.OEMBED_SCHEDULER_LMPR_IDX1 
	ON HOMEPAGE.OEMBED_SCHEDULER_LMPR (LEASENAME, NAME)@
	
	
---------------------------------------------------------------
-- HOMEPAGE.NR_CUSTOM_LIST
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_CUSTOM_LIST (
	CUSTOM_LIST_ID VARCHAR(36) NOT NULL,
	CUSTOM_LIST_NAME VARCHAR(1024) NOT NULL,
	CREATION_TIME TIMESTAMP NOT NULL,
	UPDATE_TIME TIMESTAMP NOT NULL,
	CUSTOM_LIST_SUMMARY VARCHAR(2048),
	ORGANIZATION_ID VARCHAR(36) NOT NULL,
	PERSON_ID VARCHAR(36) NOT NULL,
	STATE SMALLINT NOT NULL,
	PERSON_DISPLAY VARCHAR(36)
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST 
  	ADD CONSTRAINT PK_CUSTOM_LIST_ID PRIMARY KEY(CUSTOM_LIST_ID)@  

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST
  	ADD CONSTRAINT FK_CUST_L_PER_ID FOREIGN KEY(PERSON_ID) REFERENCES HOMEPAGE.PERSON (PERSON_ID)@

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST
  	ADD CONSTRAINT FK_CUST_L_PER_D_ID FOREIGN KEY(PERSON_DISPLAY) REFERENCES HOMEPAGE.PERSON (PERSON_ID)@  	
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST
  	ADD CONSTRAINT FK_CUST_L_ORG_ID FOREIGN KEY(ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
  	
CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_PER_ORG_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST (PERSON_ID, ORGANIZATION_ID)@ 

CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_PER_D_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST (PERSON_DISPLAY)@ 	

---------------------------------------------------------------
-- HOMEPAGE.NR_CUSTOM_LIST_ITEM
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM (
	CUSTOM_LIST_ITEM_ID VARCHAR(36) NOT NULL,
	CUSTOM_LIST_ID VARCHAR(36) NOT NULL,
	ITEM_ID VARCHAR(256) NOT NULL,
	CUSTOM_LIST_ITEM_NAME VARCHAR(1024) NOT NULL,
	CREATION_TIME TIMESTAMP NOT NULL,
	UPDATE_TIME TIMESTAMP NOT NULL,
	TYPE VARCHAR(256) NOT NULL,
	CUSTOM_LIST_ITEM_SUMMARY VARCHAR(2048),
	ORGANIZATION_ID VARCHAR(36) NOT NULL,
	STATE SMALLINT NOT NULL,
	PERSON_DISPLAY VARCHAR(36)
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM 
  	ADD CONSTRAINT PK_CUSTOM_LIST_ITEM_ID PRIMARY KEY(CUSTOM_LIST_ITEM_ID)@
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM 
  	ADD CONSTRAINT FK_CUSTOM_LIST_ID FOREIGN KEY(CUSTOM_LIST_ID) REFERENCES HOMEPAGE.NR_CUSTOM_LIST (CUSTOM_LIST_ID)@
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM 
  	ADD CONSTRAINT FK_CUST_L_I_ORG_ID FOREIGN KEY(ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM
  	ADD CONSTRAINT FK_CUST_L_I_PER_D_ID FOREIGN KEY(PERSON_DISPLAY) REFERENCES HOMEPAGE.PERSON (PERSON_ID)@   	
  	
CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_ID_ORG_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (CUSTOM_LIST_ID, ORGANIZATION_ID)@
	
CREATE UNIQUE INDEX HOMEPAGE.NR_CUSTOM_LIST_ITEM_IDX_UNQ
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (ITEM_ID, CUSTOM_LIST_ID)@	
	
CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_ITEM_PER_D_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (PERSON_DISPLAY)@	
	
CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_ITEM_CRTIME_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (CREATION_TIME)@	

COMMIT@	

---------------------------------------------------------------
-- HOMEPAGE.NR_READ_STATUS
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_READ_STATUS (
	READ_STATUS_ID VARCHAR(36) NOT NULL,
	PERSON_ID VARCHAR(36) NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT PK_READ_STATUS_ID PRIMARY KEY(READ_STATUS_ID)@
  	
ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT FK_READ_STATUS_PER FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID)@  
	
ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT FK_READ_STATUS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID)@
	
ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT FK_READ_STATUS_ORG FOREIGN KEY (ORGANIZATION_ID)
	REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	
CREATE UNIQUE INDEX HOMEPAGE.READ_STATUS_PER_STR_UNQ_IDX
	ON HOMEPAGE.NR_READ_STATUS (PERSON_ID, STORY_ID)@
	
CREATE INDEX HOMEPAGE.READ_STATUS_ORG_IDX
	ON HOMEPAGE.NR_READ_STATUS (ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.READ_STATUS_STORY_ID_IDX 
	ON HOMEPAGE.NR_READ_STATUS (STORY_ID) COMPRESS NO ALLOW REVERSE SCANS@

COMMIT@


-------------------------------------------------------
-- NR_ENTRIES_ROLLUP_ACTION
-------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION  (
        ENTRY_ROLLUP_ACTION_ID VARCHAR(36) NOT NULL,
        ROLLUP_ENTRY_ID VARCHAR(256) NOT NULL,
        ROLLUP_AUTHOR_ID VARCHAR(36),
        TEMPLATE_NAME VARCHAR(256) NOT NULL,
        ACTION VARCHAR(50) NOT NULL,   			
        ACTION_COUNT INTEGER DEFAULT 0, 
		META_TEMPLATE VARCHAR(3328) NOT NULL,
		TEXT_META_TEMPLATE VARCHAR(1024) NOT NULL,
		CREATION_DATE TIMESTAMP NOT NULL,
        UPDATE_DATE TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000' NOT NULL 		  
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION
	ADD CONSTRAINT PK_ENTRIES_ROLLUP_ACTION_ID PRIMARY KEY (ENTRY_ROLLUP_ACTION_ID)@

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION
	ADD CONSTRAINT FK_ROLLUP_AUTHOR_ID FOREIGN KEY (ROLLUP_AUTHOR_ID) REFERENCES HOMEPAGE.PERSON(PERSON_ID)@

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION 
	ADD CONSTRAINT FK_ORGANIZATION_ID FOREIGN KEY (ORGANIZATION_ID)  REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID)@
	
CREATE INDEX HOMEPAGE.ENTR_ROLLUP_ACT_CDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (CREATION_DATE DESC)@
	
CREATE INDEX HOMEPAGE.ENTR_ROLLUP_ACT_UDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (UPDATE_DATE DESC)@

CREATE UNIQUE INDEX HOMEPAGE.ENTR_ROLLUP_ACT_UNQ_IDX
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ROLLUP_ENTRY_ID, ACTION, ROLLUP_AUTHOR_ID, ORGANIZATION_ID)@
	
CREATE INDEX HOMEPAGE.ENTR_ROLLUP_ACT_AUT_ID_IDX
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ROLLUP_AUTHOR_ID, ORGANIZATION_ID)@	

CREATE INDEX HOMEPAGE.ENTR_ROLLUP_ENTRYACT_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ROLLUP_ENTRY_ID, ACTION)@
	
---------------------------------------------------------------
-- NR_ENTRIES_ROLLUP_PERSON
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON  (
        ENTRY_ROLLUP_PERSON_ID VARCHAR(36) NOT NULL,
        ENTRY_ROLLUP_ACTION_ID VARCHAR(36) NOT NULL,			
        PERSON_ID VARCHAR(36) NOT NULL,			
        ACTION_COUNT INTEGER DEFAULT 0,
		CREATION_DATE TIMESTAMP NOT NULL,
        UPDATE_DATE TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000' NOT NULL 	  		  
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON
	ADD CONSTRAINT PK_ENTRY_ROLLUP_PERSON_ID PRIMARY KEY (ENTRY_ROLLUP_PERSON_ID)@

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON
	ADD CONSTRAINT FK_ENTRY_ROLLUP_ACTION_ID FOREIGN KEY (ENTRY_ROLLUP_ACTION_ID) REFERENCES HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ENTRY_ROLLUP_ACTION_ID)@

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON 
	ADD CONSTRAINT FK_PERSON_ID FOREIGN KEY (PERSON_ID) REFERENCES HOMEPAGE.PERSON(PERSON_ID)@

CREATE INDEX HOMEPAGE.ENTR_ROLLUP_PER_CDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (CREATION_DATE DESC)@

CREATE INDEX HOMEPAGE.ENTR_ROLLUP_PER_UDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (UPDATE_DATE DESC)@

CREATE INDEX HOMEPAGE.ENTR_ROLLUP_PER_PER_ID_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (PERSON_ID, ORGANIZATION_ID)@

CREATE UNIQUE INDEX HOMEPAGE.ENTR_ROLLUP_PER_ROL_ACTI_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (ENTRY_ROLLUP_ACTION_ID, PERSON_ID, ORGANIZATION_ID)@

CREATE INDEX HOMEPAGE.ENTR_ROLLUP_PER_ENTRUDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (ENTRY_ROLLUP_ACTION_ID, UPDATE_DATE DESC)@
	
-----------------------------------------------------------------------
-- HOMEPAGE.L3T_ORGANIZATION table
-----------------------------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_ORGANIZATION (
	ORGANIZATION_ID VARCHAR(36) NOT NULL,
	ORGANIZATION_EXID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_ORGANIZATION ADD CONSTRAINT PK_L3T_ORGANIZATION_ID PRIMARY KEY(ORGANIZATION_ID)@
CREATE UNIQUE INDEX HOMEPAGE.UNQ_L3T_ORG_EXID ON HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_EXID)@


-------------------------------------------------
-- HOMEPAGE.L3T_COMPANIES
-------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_COMPANIES (
		COMPANY_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(128) NOT NULL,
		OPENID_ORG VARCHAR(128) NOT NULL,
		LOTUSLIVE_INSTANCE VARCHAR(5) NOT NULL,
		PACKAGEPREF_DEFAULT VARCHAR(11) NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_COMPANIES ADD CONSTRAINT PK_COMPANY_ID PRIMARY KEY (COMPANY_ID)@
ALTER TABLE HOMEPAGE.L3T_COMPANIES ADD CONSTRAINT FK_COM_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID)@
CREATE UNIQUE INDEX HOMEPAGE.UNQ_OPENID_ORG_IDX  ON HOMEPAGE.L3T_COMPANIES (OPENID_ORG)@
	

-------------------------------------------------
-- HOMEPAGE.L3T_USERS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USERS (
		USER_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(256) NOT NULL,
		OPENID_IDENTITY VARCHAR(256) NOT NULL,
		EMAIL VARCHAR(256) NOT NULL,
		COMPANY_ID VARCHAR(36) NOT NULL,
		LOGGED_IN SMALLINT NOT NULL,
		LOGGED_IN_TIME TIMESTAMP NOT NULL,
		LANG VARCHAR(6) NOT NULL,
		PACKAGEPREF_DEFAULT VARCHAR(6) NOT NULL,
		LAST_AGREEMENT INTEGER NOT NULL DEFAULT 0,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT PK_USERS_ID PRIMARY KEY (USER_ID)@
CREATE UNIQUE INDEX HOMEPAGE.UNQ_OPENID_IDENTITY_IDX ON HOMEPAGE.L3T_USERS (OPENID_IDENTITY)@
ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT FK_USERS_COMPANY_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID)@
ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT FK_USERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.USERS_COMP_IDX ON HOMEPAGE.L3T_USERS (COMPANY_ID)@
CREATE INDEX HOMEPAGE.USERS_ORG_IDX ON HOMEPAGE.L3T_USERS (ORGANIZATION_ID)@



-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGES
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGES (
		PACKAGE_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(40) NOT NULL,
		ENTITLE_EVERYONE SMALLINT NOT NULL,
		OWNER_ID VARCHAR(36) NOT NULL,
		TOKEN VARCHAR(12),
		MAINT_MODE SMALLINT NOT NULL DEFAULT 1,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL,
		DELETEABLE SMALLINT NOT NULL DEFAULT 1
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT PK_PACKAGES_ID PRIMARY KEY (PACKAGE_ID)@
ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT FK_PACKAGES_OWNER_ID FOREIGN KEY (OWNER_ID) REFERENCES HOMEPAGE.L3T_USERS 	(USER_ID)@
ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT FK_PACKAGES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.PKG_OWNER_IDX ON HOMEPAGE.L3T_PACKAGES (OWNER_ID)@
CREATE INDEX HOMEPAGE.PKG_ORG_IDX ON HOMEPAGE.L3T_PACKAGES (ORGANIZATION_ID)@

-------------------------------------------------
-- HOMEPAGE.L3T_COMPANY_ENTITLEMENTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (
		COMPANY_ENTITLEMENTS_ID VARCHAR(36) NOT NULL,
		COMPANY_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT PK_COMPANY_ENT_ID PRIMARY KEY (COMPANY_ENTITLEMENTS_ID)@
CREATE UNIQUE INDEX HOMEPAGE.UNQ_COM_ENT_COM_PKG_IDX ON  HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (COMPANY_ID, PACKAGE_ID)@
ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT FK_COM_ENT_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID)@
ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT FK_COM_ENT_COM_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID)@
ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT FK_COM_ENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.COM_ENT_PKG_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (PACKAGE_ID)@
CREATE INDEX HOMEPAGE.COM_ENT_COMP_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (COMPANY_ID)@
CREATE INDEX HOMEPAGE.COM_ENT_ORG_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (ORGANIZATION_ID)@




-------------------------------------------------
-- HOMEPAGE.L3T_COMPANY_PKG_PREFS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS (
		COMPANY_PKG_PREFS_ID VARCHAR(36) NOT NULL,
		COMPANY_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		PREFERENCE VARCHAR(11) NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT PK_COMPANY_PKG_PREFS_ID PRIMARY KEY (COMPANY_PKG_PREFS_ID)@
CREATE UNIQUE INDEX HOMEPAGE.UNQ_COM_PKG_PREF_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS  (COMPANY_ID, PACKAGE_ID)@
ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT FK_COM_PKG_PREF_COM_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID)@
ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT FK_COM_PKG_PREF_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID)@
ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT FK_COM_PKG_PREF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.COMP_PRF_PKG_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (PACKAGE_ID)@
CREATE INDEX HOMEPAGE.COMP_PRF_COMP_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (COMPANY_ID)@
CREATE INDEX HOMEPAGE.COMP_PRF_ORG_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (ORGANIZATION_ID)@

-------------------------------------------------
-- HOMEPAGE.L3T_EXT_META2
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_EXT_META2 (
		EXT_META2_ID VARCHAR(36) NOT NULL,
		UNID VARCHAR(512) NOT NULL,
		OPENID_ORG VARCHAR(512) NOT NULL,
		TYPE VARCHAR(512) NOT NULL,
		PARENT VARCHAR(36) NOT NULL,
		NODE_KEY VARCHAR(256),
		NODE_VALUE VARCHAR(512),
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_EXT_META2 ADD CONSTRAINT PK_EXT_META2_ID PRIMARY KEY (EXT_META2_ID)@
ALTER TABLE HOMEPAGE.L3T_EXT_META2 ADD CONSTRAINT FK_EXT_META2_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.EXT_META2_ORG_IDX ON HOMEPAGE.L3T_EXT_META2 (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.EXT_META2_UNIDNKEY_IDX ON HOMEPAGE.L3T_EXT_META2 (UNID, NODE_KEY)@
CREATE INDEX HOMEPAGE.EXT_META2_PARENT_IDX ON HOMEPAGE.L3T_EXT_META2 (PARENT)@

-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGE_DETAILS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGE_DETAILS (
		PACKAGE_DETAILS_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		POSITION_ID VARCHAR(512) NOT NULL,
		WIDGET VARCHAR(512) NOT NULL,
		LABS_ID VARCHAR(512) NOT NULL,
		POSITION_TYPE VARCHAR(36) NOT NULL,
		POSITION_INDEX INTEGER NOT NULL WITH DEFAULT 0,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT PK_PACKAGE_DETAILS_ID PRIMARY KEY (PACKAGE_DETAILS_ID)@
ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT FK_PKG_DET_PKG_IDFOREIGN FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID)@
ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT FK_PKG_DET_PKG_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.PKG_DET_PKG_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (PACKAGE_ID)@
CREATE INDEX HOMEPAGE.PKG_DET_ORG_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.L3T_PACKAGE_DETAILS_LABSID_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (LABS_ID)@

-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGE_LOCATION
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGE_LOCATION (
		PACKAGE_LOCATION_ID VARCHAR(36) NOT NULL,
		POSITION_URL VARCHAR(512) NOT NULL,
		LABS_ID VARCHAR(512) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_PACKAGE_LOCATION ADD CONSTRAINT PK_PACKAGE_LOCATION_ID PRIMARY KEY (PACKAGE_LOCATION_ID)@
ALTER TABLE HOMEPAGE.L3T_PACKAGE_LOCATION ADD CONSTRAINT FK_PACKAGE_LOCATION_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.PKG_LOC_ORG_IDX ON HOMEPAGE.L3T_PACKAGE_LOCATION (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.L3T_PACKAGE_LOCATN_LABSID_IDX ON HOMEPAGE.L3T_PACKAGE_LOCATION (LABS_ID)@

-------------------------------------------------
-- HOMEPAGE.L3T_USER_ENTITLEMENTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS (
		USER_ENTITLEMENTS_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		USER_ID VARCHAR(36) NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL		
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS ADD CONSTRAINT PK_USER_ENTITLEMENTS_ID PRIMARY KEY (USER_ENTITLEMENTS_ID)@
CREATE UNIQUE INDEX HOMEPAGE.UNQ_USR_ENT_PKG_USR_IDX ON HOMEPAGE.L3T_USER_ENTITLEMENTS  (PACKAGE_ID,  USER_ID)@
ALTER TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS ADD CONSTRAINT FK_USR_ENT_PGK_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES 	(PACKAGE_ID)@


-------------------------------------------------
-- HOMEPAGE.L3T_USER_PKG_PREFS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USER_PKG_PREFS (
		USER_PKG_PREFS_ID VARCHAR(36) NOT NULL, 
		PACKAGE_ID VARCHAR(36) NOT NULL,
		USER_ID VARCHAR(36) NOT NULL,
		PREFERENCE VARCHAR(9) NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT PK_USER_PKG_PREFS_ID PRIMARY KEY (USER_PKG_PREFS_ID)@
CREATE UNIQUE INDEX  HOMEPAGE.USER_PKG_PREF_PKG_USR_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS  (PACKAGE_ID, USER_ID)@
ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT FK_USR_PKG_PRF_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID)@
ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT FK_USR_PKG_PRF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.USR_PGK_PFR_PKG_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS (PACKAGE_ID)@
CREATE INDEX HOMEPAGE.USR_PKG_PRF_ORG_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS (ORGANIZATION_ID)@


-------------------------------------------------
-- HOMEPAGE.L3T_EXT_POINTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_EXT_POINTS (
		EXT_POINT_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(256) NOT NULL,
		SERVICE VARCHAR(128) NOT NULL,
		EXT_TYPE VARCHAR(128) NOT NULL,
		DESCRIPTION VARCHAR(512)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_EXT_POINTS ADD CONSTRAINT PK_EXT_POINT_ID PRIMARY KEY (EXT_POINT_ID)@

-------------------------------------------------
-- HOMEPAGE.L3T_EXT_BINDS
-------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_EXT_BINDS (
		EXT_BIND_ID VARCHAR(36) NOT NULL,
		EXT_ID VARCHAR(36) NOT NULL,
		EXT_POINT_ID VARCHAR(36) NOT NULL,
		ENABLED SMALLINT NOT NULL DEFAULT 0,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.L3T_EXT_BINDS ADD CONSTRAINT PK_EXT_BIND_ID PRIMARY KEY (EXT_BIND_ID)@
CREATE UNIQUE INDEX HOMEPAGE.UNQ_EXT_BIND_IDX ON HOMEPAGE.L3T_EXT_BINDS (EXT_ID, EXT_POINT_ID, ORGANIZATION_ID)@



------------------------------------- V2 AppRegistry -------------------------------------

------------ SERVICES ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICES(
	ID VARCHAR(36) NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	TITLE VARCHAR(100),
	ENABLE SMALLINT DEFAULT 0,
	DESCRIPTION VARCHAR(500),
	TRANSLATIONS VARCHAR(1000),
	SCOPE VARCHAR(12),
	LAST_MODIFIED TIMESTAMP NOT NULL,
	PAYLOAD CLOB(1M)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_SERVICES ADD CONSTRAINT PK_SERVICES_ID PRIMARY KEY (ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICES ADD CONSTRAINT UK_SERVICE_NAME UNIQUE(NAME)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_SERVICES@

------------ PATHS ------------
CREATE TABLE HOMEPAGE.APPREG_PATHS(
	ID VARCHAR(36) NOT NULL,
	NAME VARCHAR(100) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_PATHS ADD CONSTRAINT PK_PATHS PRIMARY KEY (ID)@
ALTER TABLE HOMEPAGE.APPREG_PATHS ADD CONSTRAINT UK_PATHS UNIQUE(NAME)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_PATHS@

------------ OBJECTS ------------
CREATE TABLE HOMEPAGE.APPREG_OBJECTS(
	ID VARCHAR(36) NOT NULL,
	NAME VARCHAR(100) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_OBJECTS ADD CONSTRAINT PK_OBJECTS PRIMARY KEY (ID)@
ALTER TABLE HOMEPAGE.APPREG_OBJECTS ADD CONSTRAINT UK_OBJECTS UNIQUE(NAME)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_OBJECTS@

------------ EVENTS ------------
CREATE TABLE HOMEPAGE.APPREG_EVENTS(
	ID VARCHAR(36) NOT NULL,
	NAME VARCHAR(100) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_EVENTS ADD CONSTRAINT PK_EVENTS PRIMARY KEY (ID)@
ALTER TABLE HOMEPAGE.APPREG_EVENTS ADD CONSTRAINT UK_EVENTS UNIQUE(NAME)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_EVENTS@

------------ RESOURCES ------------
CREATE TABLE HOMEPAGE.APPREG_RESOURCES(
	ID VARCHAR(36) NOT NULL,
	NAME VARCHAR(100) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_RESOURCES ADD CONSTRAINT PK_RESOURCES PRIMARY KEY (ID)@
ALTER TABLE HOMEPAGE.APPREG_RESOURCES ADD CONSTRAINT UK_RESOURCES UNIQUE(NAME)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_RESOURCES@

------------ THEMES ------------
CREATE TABLE HOMEPAGE.APPREG_THEMES(
	ID VARCHAR(36) NOT NULL,
	NAME VARCHAR(100) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_THEMES ADD CONSTRAINT PK_THEMES PRIMARY KEY (ID)@
ALTER TABLE HOMEPAGE.APPREG_THEMES ADD CONSTRAINT UK_THEMES UNIQUE(NAME)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_THEMES@

------------ SERVICE_PATH ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_PATH(
	SERVICE_ID VARCHAR(36) NOT NULL,
	PATH_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_SERVICE_PATH ADD CONSTRAINT PK_SRVPTH_SERVICE_PATH PRIMARY KEY (SERVICE_ID, PATH_ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_PATH ADD CONSTRAINT FK_SRVPTH_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_PATH ADD CONSTRAINT FK_SRVPTH_PATH_ID FOREIGN KEY (PATH_ID) REFERENCES HOMEPAGE.APPREG_PATHS (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_PTH_SRV_ID ON HOMEPAGE.APPREG_SERVICE_PATH (SERVICE_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_PTH_PTH_ID ON HOMEPAGE.APPREG_SERVICE_PATH (PATH_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_SERVICE_PATH@

------------ SERVICE_OBJECT ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_OBJECT(
	SERVICE_ID VARCHAR(36) NOT NULL,
	OBJECT_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_SERVICE_OBJECT ADD CONSTRAINT PK_SRVOBJ_SERVICE_OBJECT PRIMARY KEY (SERVICE_ID, OBJECT_ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_OBJECT ADD CONSTRAINT FK_SRVOBJ_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_OBJECT ADD CONSTRAINT FK_SRVOBJ_OBJECT_ID FOREIGN KEY (OBJECT_ID) REFERENCES HOMEPAGE.APPREG_OBJECTS (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_OBJ_SRV_ID ON HOMEPAGE.APPREG_SERVICE_OBJECT (SERVICE_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_OBJ_OBJ_ID ON HOMEPAGE.APPREG_SERVICE_OBJECT (OBJECT_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_SERVICE_OBJECT@

------------ SERVICE_EVENT ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_EVENT(
	SERVICE_ID VARCHAR(36) NOT NULL,
	EVENT_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_SERVICE_EVENT ADD CONSTRAINT PK_SRVEVN_SERVICE_EVENT PRIMARY KEY (SERVICE_ID, EVENT_ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_EVENT ADD CONSTRAINT FK_SRVEVN_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_EVENT ADD CONSTRAINT FK_SRVEVN_EVENT_ID FOREIGN KEY (EVENT_ID) REFERENCES HOMEPAGE.APPREG_EVENTS (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_EVN_SRV_ID ON HOMEPAGE.APPREG_SERVICE_EVENT (SERVICE_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_EVN_EVN_ID ON HOMEPAGE.APPREG_SERVICE_EVENT (EVENT_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_SERVICE_EVENT@

------------ SERVICE_RESOURCE ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_RESOURCE(
	SERVICE_ID VARCHAR(36) NOT NULL,
	RESOURCE_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_SERVICE_RESOURCE ADD CONSTRAINT PK_SRVRES_SERVICE_RESOURCE PRIMARY KEY (SERVICE_ID, RESOURCE_ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_RESOURCE ADD CONSTRAINT FK_SRVRES_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_RESOURCE ADD CONSTRAINT FK_SRVRES_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES HOMEPAGE.APPREG_RESOURCES (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_RES_SRV_ID ON HOMEPAGE.APPREG_SERVICE_RESOURCE (SERVICE_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_RES_RES_ID ON HOMEPAGE.APPREG_SERVICE_RESOURCE (RESOURCE_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_SERVICE_RESOURCE@

------------ SERVICE_THEME ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_THEME(
	SERVICE_ID VARCHAR(36) NOT NULL,
	THEME_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_SERVICE_THEME ADD CONSTRAINT PK_SRVTHM_SERVICE_THEME PRIMARY KEY (SERVICE_ID, THEME_ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_THEME ADD CONSTRAINT FK_SRVTHM_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_THEME ADD CONSTRAINT FK_SRVTHM_THEME_ID FOREIGN KEY (THEME_ID) REFERENCES HOMEPAGE.APPREG_THEMES (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_THM_SRV_ID ON HOMEPAGE.APPREG_SERVICE_THEME (SERVICE_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_THM_THM_ID ON HOMEPAGE.APPREG_SERVICE_THEME (THEME_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_SERVICE_THEME@

------------ APPLICATIONS ------------
CREATE TABLE HOMEPAGE.APPREG_APPLICATIONS(
	ID VARCHAR(36) NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	TITLE VARCHAR(100),
	APP_ID VARCHAR(100) NOT NULL,
	DESCRIPTION VARCHAR(500),
	TRANSLATIONS VARCHAR(1000),
	URL VARCHAR(512),
	ICON VARCHAR(500),
	SCOPE VARCHAR(12),
	ORGANIZATION_ID VARCHAR(36) NOT NULL,
	LAST_MODIFIED TIMESTAMP NOT NULL,
	PAYLOAD CLOB(1M),
	ENTITLEMENT VARCHAR(100)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_APPLICATIONS ADD CONSTRAINT PK_APPLICATIONS PRIMARY KEY (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_APP_ORG_ID ON HOMEPAGE.APPREG_APPLICATIONS (ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_APP_ID_ORG_ID ON HOMEPAGE.APPREG_APPLICATIONS (ID, ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_APP_APP_NAME_ORG_ID ON HOMEPAGE.APPREG_APPLICATIONS (NAME, ORGANIZATION_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_APP_APP_ID_ORG_ID ON HOMEPAGE.APPREG_APPLICATIONS (APP_ID, ORGANIZATION_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_APPLICATIONS@

------------ SERVICE_APPLICATION ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_APPLICATION(
	SERVICE_ID VARCHAR(36) NOT NULL,
	APPLICATION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_SERVICE_APPLICATION ADD CONSTRAINT PK_SRVAPP_SERVICE_APPLICATION PRIMARY KEY (SERVICE_ID, APPLICATION_ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_APPLICATION ADD CONSTRAINT FK_SRVAPP_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID)@
ALTER TABLE HOMEPAGE.APPREG_SERVICE_APPLICATION ADD CONSTRAINT FK_SRVAPP_APPLICATION_ID FOREIGN KEY (APPLICATION_ID) REFERENCES HOMEPAGE.APPREG_APPLICATIONS (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_APP_SRV_ID ON HOMEPAGE.APPREG_SERVICE_APPLICATION (SERVICE_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_SRV_APP_APP_ID ON HOMEPAGE.APPREG_SERVICE_APPLICATION (APPLICATION_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_SERVICE_APPLICATION@

------------ EXTENSIONS ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSIONS(
	ID VARCHAR(36) NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	TITLE VARCHAR(100),
	EXT_ID VARCHAR(100) NOT NULL,
	TYPE VARCHAR(100),
	DESCRIPTION VARCHAR(500),
	TRANSLATIONS VARCHAR(1000),
	SCOPE VARCHAR(12),
	LAST_MODIFIED TIMESTAMP NOT NULL,
	PAYLOAD CLOB(1M)
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_EXTENSIONS ADD CONSTRAINT PK_EXTENSIONS PRIMARY KEY (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_EXT_EXT_NAME ON HOMEPAGE.APPREG_EXTENSIONS (NAME)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_EXT_EXT_ID ON HOMEPAGE.APPREG_EXTENSIONS (EXT_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_EXT_EXT_TYPE ON HOMEPAGE.APPREG_EXTENSIONS (TYPE)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_EXTENSIONS@

------------ APPLICATION_EXTENSIONS ------------
CREATE TABLE HOMEPAGE.APPREG_APPLICATION_EXTENSION(
	APPLICATION_ID VARCHAR(36) NOT NULL,
	EXTENSION_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_APPLICATION_EXTENSION ADD CONSTRAINT PK_APPEXT_APPLICATION_EXTENSION PRIMARY KEY (APPLICATION_ID, EXTENSION_ID)@
ALTER TABLE HOMEPAGE.APPREG_APPLICATION_EXTENSION ADD CONSTRAINT FK_APPEXT_APPLICATION_ID FOREIGN KEY (APPLICATION_ID) REFERENCES HOMEPAGE.APPREG_APPLICATIONS (ID)@
ALTER TABLE HOMEPAGE.APPREG_APPLICATION_EXTENSION ADD CONSTRAINT FK_APPEXT_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_APP_EXT_APP_ID ON HOMEPAGE.APPREG_APPLICATION_EXTENSION (APPLICATION_ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_APP_EXT_EXT_ID ON HOMEPAGE.APPREG_APPLICATION_EXTENSION (EXTENSION_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_APPLICATION_EXTENSION@

------------ EXTENSION_PATH ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_PATH(
	EXTENSION_ID VARCHAR(36) NOT NULL,
	PATH_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_PATH ADD CONSTRAINT PK_EXTPTH_EXTENSION_PATH PRIMARY KEY (EXTENSION_ID, PATH_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_PATH ADD CONSTRAINT UK_EXTPTH_EXTENSION_ID UNIQUE(EXTENSION_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_PATH ADD CONSTRAINT FK_EXTPTH_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_PATH ADD CONSTRAINT FK_EXTPTH_PATH_ID FOREIGN KEY (PATH_ID) REFERENCES HOMEPAGE.APPREG_PATHS (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_EXT_PTH_PTH_ID ON HOMEPAGE.APPREG_EXTENSION_PATH (PATH_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_EXTENSION_PATH@

------------ EXTENSION_OBJECT ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT(
	EXTENSION_ID VARCHAR(36) NOT NULL,
	OBJECT_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT ADD CONSTRAINT PK_EXTOBJ_EXTENSION_OBJECT PRIMARY KEY (EXTENSION_ID, OBJECT_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT ADD CONSTRAINT UK_EXTOBJ_EXTENSION_ID UNIQUE(EXTENSION_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT ADD CONSTRAINT FK_EXTOBJ_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT ADD CONSTRAINT FK_EXTOBJ_OBJECT_ID FOREIGN KEY (OBJECT_ID) REFERENCES HOMEPAGE.APPREG_OBJECTS (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_EXT_OBJ_OBJ_ID ON HOMEPAGE.APPREG_EXTENSION_OBJECT (OBJECT_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT@

------------ EXTENSION_EVENT ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_EVENT(
	EXTENSION_ID VARCHAR(36) NOT NULL,
	EVENT_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_EVENT ADD CONSTRAINT PK_EXTEVN_EXTENSION_EVENT PRIMARY KEY (EXTENSION_ID, EVENT_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_EVENT ADD CONSTRAINT UK_EXTEVN_EXTENSION_ID UNIQUE(EXTENSION_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_EVENT ADD CONSTRAINT FK_EXTEVN_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_EVENT ADD CONSTRAINT FK_EXTEVN_EVENT_ID FOREIGN KEY (EVENT_ID) REFERENCES HOMEPAGE.APPREG_EVENTS (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_EXT_EVN_EVN_ID ON HOMEPAGE.APPREG_EXTENSION_EVENT (EVENT_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_EXTENSION_EVENT@

------------ EXTENSION_RESOURCE ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE(
	EXTENSION_ID VARCHAR(36) NOT NULL,
	RESOURCE_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE ADD CONSTRAINT PK_EXTRES_EXTENSION_RESOURCE PRIMARY KEY (EXTENSION_ID, RESOURCE_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE ADD CONSTRAINT UK_EXTRES_EXTENSION_ID UNIQUE(EXTENSION_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE ADD CONSTRAINT FK_EXTRES_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE ADD CONSTRAINT FK_EXTRES_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES HOMEPAGE.APPREG_RESOURCES (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_EXT_RES_RES_ID ON HOMEPAGE.APPREG_EXTENSION_RESOURCE (RESOURCE_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE@

------------ EXTENSION_THEME ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_THEME(
	EXTENSION_ID VARCHAR(36) NOT NULL,
	THEME_ID VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_THEME ADD CONSTRAINT PK_EXTTHM_EXTENSION_THEME PRIMARY KEY (EXTENSION_ID, THEME_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_THEME ADD CONSTRAINT UK_EXTTHM_EXTENSION_ID UNIQUE(EXTENSION_ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_THEME ADD CONSTRAINT FK_EXTTHM_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID)@
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_THEME ADD CONSTRAINT FK_EXTTHM_THEME_ID FOREIGN KEY (THEME_ID) REFERENCES HOMEPAGE.APPREG_THEMES (ID)@
CREATE INDEX HOMEPAGE.UNQ_APPREG_EXT_THM_THM_ID ON HOMEPAGE.APPREG_EXTENSION_THEME (THEME_ID)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_EXTENSION_THEME@

------------ APPREG_SETTINGS ------------
CREATE TABLE HOMEPAGE.APPREG_SETTINGS(
	SETTING_KEY VARCHAR(100) NOT NULL,
	SETTING_VALUE VARCHAR(100) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.APPREG_SETTINGS ADD CONSTRAINT PK_APPREG_SETTINGS PRIMARY KEY (SETTING_KEY)@

RUNSTATS ON TABLE HOMEPAGE.APPREG_SETTINGS@

-- -----------------------------------------------------------------
-- Visitor model event tracking table
-- -----------------------------------------------------------------

CREATE TABLE HOMEPAGE.VM_EVENT_TRACKER(
	SUBSCRIBER_ID VARCHAR(36) NOT NULL,
	VISITING_ORG_ID VARCHAR(36),
	HOME_ORG_ID VARCHAR(36),
	LAST_MODIFIED TIMESTAMP NOT NULL,
	MIGRATED SMALLINT DEFAULT 0,
	EVENT_NAME VARCHAR(36) NOT NULL
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.VM_EVENT_TRACKER ADD CONSTRAINT PK_VM_SUBSCRIBER_ID PRIMARY KEY (SUBSCRIBER_ID)@
CREATE INDEX HOMEPAGE.VM_VISITING_ORG_IDX ON HOMEPAGE.VM_EVENT_TRACKER (VISITING_ORG_ID)@
CREATE INDEX HOMEPAGE.VM_HOME_ORG_IDX ON HOMEPAGE.VM_EVENT_TRACKER (HOME_ORG_ID)@

RUNSTATS ON TABLE HOMEPAGE.VM_EVENT_TRACKER@

------------------------------------------------------------------------------
-- Migration News : Event Synchronization
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.MIGN_EVENT_SYNC (
	EVENT_ID VARCHAR(36) NOT NULL,
	EVENT BLOB(3670016),
	CREATION_DATE TIMESTAMP NOT NULL,
    SOURCE VARCHAR(36) NOT NULL,
    TAGS VARCHAR(2048),
    URL VARCHAR(2048),
    ATTEMPTS SMALLINT DEFAULT 0 NOT NULL
)
IN NEWSTABSPACE@

ALTER TABLE HOMEPAGE.MIGN_EVENT_SYNC
  	ADD CONSTRAINT PK_MIGN_EVENT_SYNC PRIMARY KEY (EVENT_ID)@

CREATE INDEX HOMEPAGE.MIGN_EVENT_SYNC_DATE_IDX
	ON HOMEPAGE.MIGN_EVENT_SYNC (CREATION_DATE ASC)@

RUNSTATS ON TABLE HOMEPAGE.MIGN_EVENT_SYNC@

------------------------------------------------------------------------------
-- Migration Profiles Tool : Migration People
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.MIGP_MIGRATIONPEOPLE (
    ID        		VARCHAR(36) NOT NULL,
    USERID    		VARCHAR(36),
    EMAIL     		VARCHAR(256),
    ORGID	    	VARCHAR(36),
    PRIORITY  		INTEGER  DEFAULT '0',
    STATE	    	BIGINT  DEFAULT '0',
    CREATETIME      TIMESTAMP DEFAULT CURRENT TIMESTAMP,
    STATEUPDATETIME TIMESTAMP DEFAULT CURRENT TIMESTAMP,
    MIGRATIONTYPE   VARCHAR(36) DEFAULT 'migrate'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.MIGP_MIGRATIONPEOPLE 
	ADD CONSTRAINT MIGP_MIGRATIONPEOPLE_PK PRIMARY KEY (ID)@

CREATE INDEX HOMEPAGE.MIGP_MP_NEXT_PEOPLE_IDX
    ON HOMEPAGE.MIGP_MIGRATIONPEOPLE (PRIORITY DESC, STATE, STATEUPDATETIME)@

CREATE INDEX HOMEPAGE.MIGP_MP_FIND_IDX
    ON HOMEPAGE.MIGP_MIGRATIONPEOPLE (USERID, EMAIL)@

RUNSTATS ON TABLE HOMEPAGE.MIGP_MIGRATIONPEOPLE@

------------------------------------------------------------------------------
-- Migration Profiles Tool : Populate Status
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.MIGP_POPULATESTATUS (
    ID              VARCHAR(36) NOT NULL,
    CURRENTURL      VARCHAR(256),
    TIME            TIMESTAMP,
    MIGRATIONTYPE   VARCHAR(36) DEFAULT 'migrate'
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.MIGP_POPULATESTATUS 
	ADD CONSTRAINT MIGP_POPULATESTATUS_PK PRIMARY KEY (ID)@

RUNSTATS ON TABLE HOMEPAGE.MIGP_POPULATESTATUS@

------------------------------------------------------------------------------
-- Migration Profiles Tool : Profile Key Map
------------------------------------------------------------------------------
	
CREATE TABLE HOMEPAGE.MIGP_PROFILEKEYMAP (
    ID              VARCHAR(36) NOT NULL,
    PROFILEKEY      VARCHAR(36) NOT NULL,
    EXTERNALID      VARCHAR(36) NOT NULL,
    ORGID           VARCHAR(36) NOT NULL,
    CREATED         TIMESTAMP
)
IN NEWS4TABSPACE@

ALTER TABLE HOMEPAGE.MIGP_PROFILEKEYMAP 
	ADD CONSTRAINT MIGP_PROFILEKEYMAP_PK PRIMARY KEY (ID)@

CREATE UNIQUE INDEX HOMEPAGE.MIGP_PKM_PROFILEKEY_UIDX
    ON HOMEPAGE.MIGP_PROFILEKEYMAP (PROFILEKEY)@

CREATE UNIQUE INDEX HOMEPAGE.MIGP_PKM_EXTERNALID_UIDX
    ON HOMEPAGE.MIGP_PROFILEKEYMAP (EXTERNALID)@

RUNSTATS ON TABLE HOMEPAGE.MIGP_PROFILEKEYMAP@
