-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}


DROP TABLE HOMEPAGE.OAUTH2_TOKEN;
DROP TABLE HOMEPAGE.OAUTH2_GADGET_BINDING;
DROP TABLE HOMEPAGE.OAUTH1_CONTEXT;
DROP TABLE HOMEPAGE.OAUTH1_CLIENT;
DROP TABLE HOMEPAGE.OAUTH1_PROVIDER;
DROP TABLE HOMEPAGE.OAUTH1_TOKEN;


-------------------------------------------
-- HOMEPAGE.OAUTH1_TOKEN
-------------------------------------------	 
CREATE TABLE HOMEPAGE.OAUTH1_TOKEN (
	ID VARCHAR(256) NOT NULL PRIMARY KEY,
	TOKEN VARCHAR(1024) NOT NULL,
	SECRET VARCHAR(1024) NOT NULL,
	EXPIRATION TIMESTAMP,
	CREATED TIMESTAMP NOT NULL,
	MODIFIED TIMESTAMP NOT NULL
)
IN HPNT16TABSPACE;

COMMIT;

-------------------------------------------
-- HOMEPAGE.OAUTH2_TOKEN
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH2_TOKEN (
  ID VARCHAR(254) NOT NULL PRIMARY KEY,
  URI VARCHAR(1024) NOT NULL,
  SERVICE_NAME VARCHAR(254) NOT NULL,
  PERSON_ID VARCHAR(36) NOT NULL,
  SCOPE VARCHAR(1024) NOT NULL,
  TTYPE SMALLINT NOT NULL,
  SECRET VARCHAR(1024),
  EXPIRES TIMESTAMP,
  ISSUED TIMESTAMP NOT NULL,
  TOKEN_TYPE VARCHAR(254),
  MAC_SECRET VARCHAR(1024),
  MAC_ALG VARCHAR(254),
  MAC_EXT VARCHAR(254),
  PROPS VARCHAR(1024)
)
IN HPNT16TABSPACE;

ALTER TABLE HOMEPAGE.OAUTH2_TOKEN
	ADD CONSTRAINT FK_OA2T_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON(PERSON_ID);	

CREATE INDEX HOMEPAGE.OA2T_PERSON_SERVICE
	ON HOMEPAGE.OAUTH2_TOKEN (PERSON_ID, SERVICE_NAME);
	
COMMIT;

-------------------------------------------
-- HOMEPAGE.OAUTH2_GADGET_BINDING
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH2_GADGET_BINDING (
  ID VARCHAR(36) NOT NULL PRIMARY KEY,
  URI_SHA1 CHAR(40) NOT NULL, 
  SERVICE_NAME VARCHAR(254)  NOT NULL,
  URI VARCHAR(1024) NOT NULL,
  CLIENT_NAME VARCHAR(254) NOT NULL,
  OVERRIDES SMALLINT NOT NULL,
  CONSTRAINT PK_GADGET_PK UNIQUE (URI_SHA1, SERVICE_NAME)
)
IN HPNT16TABSPACE;

ALTER TABLE HOMEPAGE.OAUTH2_GADGET_BINDING
  ADD CONSTRAINT FK_BINDING_CLIENT FOREIGN KEY(CLIENT_NAME)
  REFERENCES HOMEPAGE.OAUTH2_CLIENT(NAME) ON DELETE CASCADE ON UPDATE NO ACTION ENFORCED ENABLE QUERY OPTIMIZATION;
  
COMMIT; 

-------------------------------------------
-- HOMEPAGE.OAUTH1_PROVIDER
-------------------------------------------	 
CREATE TABLE HOMEPAGE.OAUTH1_PROVIDER (
	ID VARCHAR(256) NOT NULL PRIMARY KEY,
	NAME VARCHAR(254) NOT NULL,
	DESCRIPTION VARCHAR(1024),
	REQUESTTOKENURL VARCHAR(512) NOT NULL,
	AUTHORIZEURL VARCHAR(512) NOT NULL,
	ACCESSTOKENURL VARCHAR(512) NOT NULL,
	BASEURL VARCHAR(512),
	MANAGEURL VARCHAR(512),
	REGISTERURL VARCHAR(512),
	SIGNMETHOD VARCHAR(32),
	VERSION VARCHAR(8),
	CREATED TIMESTAMP NOT NULL,
	MODIFIED TIMESTAMP NOT NULL,
	CONSTRAINT PRVD_NAME_UK UNIQUE (NAME)
)
IN HPNT16TABSPACE;

-------------------------------------------
-- HOMEPAGE.OAUTH1_CLIENT
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH1_CLIENT (
	ID VARCHAR(256) NOT NULL PRIMARY KEY,
	PERSON_ID VARCHAR(36) NOT NULL,
	NAME VARCHAR(254) NOT NULL,
	TOKENID VARCHAR(256) NOT NULL,
	PROVIDERID VARCHAR(256) NOT NULL,
	DESCRIPTION VARCHAR(1024),
	CALLBACKURL VARCHAR(512),	
	CREATED TIMESTAMP NOT NULL,
	MODIFIED TIMESTAMP NOT NULL,
	CONSTRAINT CLNT_NAME_UK UNIQUE (NAME)
)
IN HPNT16TABSPACE;

ALTER TABLE HOMEPAGE.OAUTH1_CLIENT 
	ADD CONSTRAINT CLNT_FK FOREIGN KEY (PROVIDERID) 
	REFERENCES HOMEPAGE.OAUTH1_PROVIDER(ID) ON DELETE CASCADE ON UPDATE NO ACTION ENFORCED ENABLE QUERY OPTIMIZATION;

ALTER TABLE HOMEPAGE.OAUTH1_CLIENT 
	ADD CONSTRAINT CLNT_TOKEN_FK FOREIGN KEY (TOKENID) 
	REFERENCES HOMEPAGE.OAUTH1_TOKEN(ID) ON DELETE CASCADE ON UPDATE NO ACTION ENFORCED ENABLE QUERY OPTIMIZATION;
	
ALTER TABLE HOMEPAGE.OAUTH1_CLIENT
	ADD CONSTRAINT FK_OA1CL_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON(PERSON_ID);		
	
COMMIT;

-------------------------------------------
-- HOMEPAGE.OAUTH1_CONTEXT
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH1_CONTEXT (
	ID VARCHAR(256) NOT NULL PRIMARY KEY,
	CLIENTID VARCHAR(256) NOT NULL,
	PERSON_ID VARCHAR(36),
	TOKENID VARCHAR(256) NOT NULL,
	CREATED TIMESTAMP NOT NULL,
	MODIFIED TIMESTAMP NOT NULL,
	NONCE VARCHAR(256),
	EXPIRATION TIMESTAMP,
	AUTHORIZED SMALLINT DEFAULT 0 NOT NULL
)
IN HPNT16TABSPACE;

ALTER TABLE HOMEPAGE.OAUTH1_CONTEXT
	ADD CONSTRAINT CONTEXT_CLNT_FK FOREIGN KEY (CLIENTID) 
	REFERENCES HOMEPAGE.OAUTH1_CLIENT(ID) ON DELETE CASCADE ON UPDATE NO ACTION ENFORCED ENABLE QUERY OPTIMIZATION;

ALTER TABLE HOMEPAGE.OAUTH1_CONTEXT
	ADD CONSTRAINT AUTH_TOKEN_FK FOREIGN KEY (TOKENID) 
	REFERENCES HOMEPAGE.OAUTH1_TOKEN(ID);
	
ALTER TABLE HOMEPAGE.OAUTH1_CONTEXT
	ADD CONSTRAINT FK_OA1C_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON(PERSON_ID);		

COMMIT;

 

  
  
  