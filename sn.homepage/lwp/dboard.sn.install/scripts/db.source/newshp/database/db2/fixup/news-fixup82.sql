-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

----------------------------------------------------------------------
-- 1) HOMEPAGE.NR_ENTRIES_ACT
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ACT (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL,
	TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT 0 NOT NULL,
	N_RECCOMANDATIONS SMALLINT DEFAULT 0 NOT NULL,
	N_ATTACHMENTS SMALLINT DEFAULT 0 NOT NULL,
	BRIEF_DESC VARCHAR(512),
	LAST_RECOMMENDER_ID VARCHAR(36),
	LAST_DATE_RECOMMENDER_ID TIMESTAMP,
	PREV_RECOMMENDER_ID VARCHAR(36),
	PREV_DATE_RECOMMENDER_ID TIMESTAMP,
	LAST_COMMENT_ID VARCHAR(36),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_DESC_COMMENT VARCHAR(256),
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(36),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_DESC_COMMENT VARCHAR(256),
	PREV_AUTHOR_COMMENT VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONSTRAINT   	CK_ENT_SRC1_TYPE
    				CHECK
    				(SOURCE_TYPE = 1)
)
IN NEWSTABSPACE;

ALTER TABLE HOMEPAGE.NR_ENTRIES_ACT
    ADD CONSTRAINT PK_ACT_ENTRY_ID PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_ACT_CONT
    ON HOMEPAGE.NR_ENTRIES_ACT (CONTAINER_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_ACT_SRC
    ON HOMEPAGE.NR_ENTRIES_ACT (SOURCE_TYPE);



COMMIT;

----------------------------------------------------------------------
-- 2) HOMEPAGE.NR_ENTRIES_BLG
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_BLG (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL,
	TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT 0 NOT NULL,
	N_RECCOMANDATIONS SMALLINT DEFAULT 0 NOT NULL,
	N_ATTACHMENTS SMALLINT DEFAULT 0 NOT NULL,
	BRIEF_DESC VARCHAR(512),
	LAST_RECOMMENDER_ID VARCHAR(36),
	LAST_DATE_RECOMMENDER_ID TIMESTAMP,
	PREV_RECOMMENDER_ID VARCHAR(36),
	PREV_DATE_RECOMMENDER_ID TIMESTAMP,
	LAST_COMMENT_ID VARCHAR(36),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_DESC_COMMENT VARCHAR(256),
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(36),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_DESC_COMMENT VARCHAR(256),
	PREV_AUTHOR_COMMENT VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONSTRAINT   	CK_ENT_SRC2_TYPE
    				CHECK
    				(SOURCE_TYPE = 2)
)
IN NEWSTABSPACE;

ALTER TABLE HOMEPAGE.NR_ENTRIES_BLG
    ADD CONSTRAINT PK_BLG_ENTRY_ID PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_BLG_CONT
    ON HOMEPAGE.NR_ENTRIES_BLG (CONTAINER_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_BLG_SRC
    ON HOMEPAGE.NR_ENTRIES_BLG (SOURCE_TYPE);
    


COMMIT;

----------------------------------------------------------------------
-- 3) HOMEPAGE.NR_ENTRIES_COM
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_COM (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL,
	TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT 0 NOT NULL,
	N_RECCOMANDATIONS SMALLINT DEFAULT 0 NOT NULL,
	N_ATTACHMENTS SMALLINT DEFAULT 0 NOT NULL,
	BRIEF_DESC VARCHAR(512),
	LAST_RECOMMENDER_ID VARCHAR(36),
	LAST_DATE_RECOMMENDER_ID TIMESTAMP,
	PREV_RECOMMENDER_ID VARCHAR(36),
	PREV_DATE_RECOMMENDER_ID TIMESTAMP,
	LAST_COMMENT_ID VARCHAR(36),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_DESC_COMMENT VARCHAR(256),
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(36),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_DESC_COMMENT VARCHAR(256),
	PREV_AUTHOR_COMMENT VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONSTRAINT   	CK_ENT_SRC3_TYPE
    				CHECK
    				(SOURCE_TYPE = 3)
)
IN NEWSTABSPACE;

ALTER TABLE HOMEPAGE.NR_ENTRIES_COM
    ADD CONSTRAINT PK_COM_ENTRY_ID PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_COM_CONT
    ON HOMEPAGE.NR_ENTRIES_COM (CONTAINER_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_COM_SRC
    ON HOMEPAGE.NR_ENTRIES_COM (SOURCE_TYPE);



COMMIT;

----------------------------------------------------------------------
-- 4) HOMEPAGE.NR_ENTRIES_WIK
----------------------------------------------------------------------    
CREATE TABLE HOMEPAGE.NR_ENTRIES_WIK (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL,
	TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT 0 NOT NULL,
	N_RECCOMANDATIONS SMALLINT DEFAULT 0 NOT NULL,
	N_ATTACHMENTS SMALLINT DEFAULT 0 NOT NULL,
	BRIEF_DESC VARCHAR(512),
	LAST_RECOMMENDER_ID VARCHAR(36),
	LAST_DATE_RECOMMENDER_ID TIMESTAMP,
	PREV_RECOMMENDER_ID VARCHAR(36),
	PREV_DATE_RECOMMENDER_ID TIMESTAMP,
	LAST_COMMENT_ID VARCHAR(36),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_DESC_COMMENT VARCHAR(256),
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(36),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_DESC_COMMENT VARCHAR(256),
	PREV_AUTHOR_COMMENT VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONSTRAINT   	CK_ENT_SRC4_TYPE
    				CHECK
    				(SOURCE_TYPE = 4)
)
IN NEWSTABSPACE;

ALTER TABLE HOMEPAGE.NR_ENTRIES_WIK
    ADD CONSTRAINT PK_WIK_ENTRY_ID PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_WIK_CONT
    ON HOMEPAGE.NR_ENTRIES_WIK (CONTAINER_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_WIK_SRC
    ON HOMEPAGE.NR_ENTRIES_WIK (SOURCE_TYPE);



COMMIT;

----------------------------------------------------------------------
-- 5) HOMEPAGE.NR_ENTRIES_PRF
----------------------------------------------------------------------    
CREATE TABLE HOMEPAGE.NR_ENTRIES_PRF (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL,
	TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT 0 NOT NULL,
	N_RECCOMANDATIONS SMALLINT DEFAULT 0 NOT NULL,
	N_ATTACHMENTS SMALLINT DEFAULT 0 NOT NULL,
	BRIEF_DESC VARCHAR(512),
	LAST_RECOMMENDER_ID VARCHAR(36),
	LAST_DATE_RECOMMENDER_ID TIMESTAMP,
	PREV_RECOMMENDER_ID VARCHAR(36),
	PREV_DATE_RECOMMENDER_ID TIMESTAMP,
	LAST_COMMENT_ID VARCHAR(36),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_DESC_COMMENT VARCHAR(256),
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(36),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_DESC_COMMENT VARCHAR(256),
	PREV_AUTHOR_COMMENT VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONSTRAINT   	CK_ENT_SRC5_TYPE
    				CHECK
    				(SOURCE_TYPE = 5)
)
IN NEWSTABSPACE;

ALTER TABLE HOMEPAGE.NR_ENTRIES_PRF
    ADD CONSTRAINT PK_PRF_ENTRY_ID PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_PRF_CONT
    ON HOMEPAGE.NR_ENTRIES_PRF (CONTAINER_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_PRF_SRC
    ON HOMEPAGE.NR_ENTRIES_PRF (SOURCE_TYPE);



COMMIT;

----------------------------------------------------------------------
-- 6) HOMEPAGE.NR_ENTRIES_HP
----------------------------------------------------------------------    
CREATE TABLE HOMEPAGE.NR_ENTRIES_HP (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL,
	TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT 0 NOT NULL,
	N_RECCOMANDATIONS SMALLINT DEFAULT 0 NOT NULL,
	N_ATTACHMENTS SMALLINT DEFAULT 0 NOT NULL,
	BRIEF_DESC VARCHAR(512),
	LAST_RECOMMENDER_ID VARCHAR(36),
	LAST_DATE_RECOMMENDER_ID TIMESTAMP,
	PREV_RECOMMENDER_ID VARCHAR(36),
	PREV_DATE_RECOMMENDER_ID TIMESTAMP,
	LAST_COMMENT_ID VARCHAR(36),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_DESC_COMMENT VARCHAR(256),
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(36),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_DESC_COMMENT VARCHAR(256),
	PREV_AUTHOR_COMMENT VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONSTRAINT   	CK_ENT_SRC6_TYPE
    				CHECK
    				(SOURCE_TYPE = 6)
)
IN NEWSTABSPACE;

ALTER TABLE HOMEPAGE.NR_ENTRIES_HP
    ADD CONSTRAINT PK_HP_ENTRY_ID PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_HP_CONT
    ON HOMEPAGE.NR_ENTRIES_HP (CONTAINER_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_HP_SRC
    ON HOMEPAGE.NR_ENTRIES_HP (SOURCE_TYPE);



COMMIT;

----------------------------------------------------------------------
-- 7) HOMEPAGE.NR_ENTRIES_DGR
----------------------------------------------------------------------      
CREATE TABLE HOMEPAGE.NR_ENTRIES_DGR (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL,
	TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT 0 NOT NULL,
	N_RECCOMANDATIONS SMALLINT DEFAULT 0 NOT NULL,
	N_ATTACHMENTS SMALLINT DEFAULT 0 NOT NULL,
	BRIEF_DESC VARCHAR(512),
	LAST_RECOMMENDER_ID VARCHAR(36),
	LAST_DATE_RECOMMENDER_ID TIMESTAMP,
	PREV_RECOMMENDER_ID VARCHAR(36),
	PREV_DATE_RECOMMENDER_ID TIMESTAMP,
	LAST_COMMENT_ID VARCHAR(36),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_DESC_COMMENT VARCHAR(256),
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(36),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_DESC_COMMENT VARCHAR(256),
	PREV_AUTHOR_COMMENT VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONSTRAINT   	CK_ENT_SRC7_TYPE
    				CHECK
    				(SOURCE_TYPE = 7)
)
IN NEWSTABSPACE;


ALTER TABLE HOMEPAGE.NR_ENTRIES_DGR
    ADD CONSTRAINT PK_DGR_ENTRY_ID PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_DGR_CONT
    ON HOMEPAGE.NR_ENTRIES_DGR (CONTAINER_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_DGR_SRC
    ON HOMEPAGE.NR_ENTRIES_DGR (SOURCE_TYPE);



COMMIT;

----------------------------------------------------------------------
-- 8) HOMEPAGE.NR_ENTRIES_FILE
----------------------------------------------------------------------      
CREATE TABLE HOMEPAGE.NR_ENTRIES_FILE (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL,
	TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT 0 NOT NULL,
	N_RECCOMANDATIONS SMALLINT DEFAULT 0 NOT NULL,
	N_ATTACHMENTS SMALLINT DEFAULT 0 NOT NULL,
	BRIEF_DESC VARCHAR(512),
	LAST_RECOMMENDER_ID VARCHAR(36),
	LAST_DATE_RECOMMENDER_ID TIMESTAMP,
	PREV_RECOMMENDER_ID VARCHAR(36),
	PREV_DATE_RECOMMENDER_ID TIMESTAMP,
	LAST_COMMENT_ID VARCHAR(36),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_DESC_COMMENT VARCHAR(256),
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(36),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_DESC_COMMENT VARCHAR(256),
	PREV_AUTHOR_COMMENT VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONSTRAINT   	CK_ENT_SRC8_TYPE
    				CHECK
    				(SOURCE_TYPE = 8)
)
IN NEWSTABSPACE;


ALTER TABLE HOMEPAGE.NR_ENTRIES_FILE
    ADD CONSTRAINT PK_FILE_ENTRY_ID PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_FILE_CONT
    ON HOMEPAGE.NR_ENTRIES_FILE (CONTAINER_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_FILE_SRC
    ON HOMEPAGE.NR_ENTRIES_FILE (SOURCE_TYPE);



COMMIT;

----------------------------------------------------------------------
-- 9) HOMEPAGE.NR_ENTRIES_FRM
----------------------------------------------------------------------      
CREATE TABLE HOMEPAGE.NR_ENTRIES_FRM (
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	ITEM_ID VARCHAR(36) NOT NULL,
	ITEM_NAME VARCHAR(256),
	ITEM_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL,
	TAGS VARCHAR(1024),
	N_COMMENTS SMALLINT DEFAULT 0 NOT NULL,
	N_RECCOMANDATIONS SMALLINT DEFAULT 0 NOT NULL,
	N_ATTACHMENTS SMALLINT DEFAULT 0 NOT NULL,
	BRIEF_DESC VARCHAR(512),
	LAST_RECOMMENDER_ID VARCHAR(36),
	LAST_DATE_RECOMMENDER_ID TIMESTAMP,
	PREV_RECOMMENDER_ID VARCHAR(36),
	PREV_DATE_RECOMMENDER_ID TIMESTAMP,
	LAST_COMMENT_ID VARCHAR(36),
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_DESC_COMMENT VARCHAR(256),
	LAST_AUTHOR_COMMENT VARCHAR(36),
	PREV_COMMENT_ID VARCHAR(36),
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_DESC_COMMENT VARCHAR(256),
	PREV_AUTHOR_COMMENT VARCHAR(36),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONSTRAINT   	CK_ENT_SRC9_TYPE
    				CHECK
    				(SOURCE_TYPE = 9)
)
IN NEWSTABSPACE;


ALTER TABLE HOMEPAGE.NR_ENTRIES_FRM
    ADD CONSTRAINT PK_FRM_ENTRY_ID PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_FRM_CONT
    ON HOMEPAGE.NR_ENTRIES_FRM (CONTAINER_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_FRM_SRC
    ON HOMEPAGE.NR_ENTRIES_FRM (SOURCE_TYPE);

   

COMMIT;

----------------------------------------------------------------
-- DROPPING AND RECREATING RE-CREATE ADDING TABLE FOR PROFILES STORIES COMMENTS 
----------------------------------------------------------------
DROP TABLE HOMEPAGE.NR_NEWS_PRF_COMMENT;

CREATE TABLE HOMEPAGE.NR_NEWS_PRF_COMMENT (
	NEWS_COMMENT_ID VARCHAR(36) NOT NULL,
	ACTOR_UUID VARCHAR(36) NOT NULL,
	CREATION_DATE TIMESTAMP,
	UPDATE_DATE TIMESTAMP,
	BRIEF_DESC VARCHAR(500),
	ENTRY_ID  VARCHAR(36),
	SOURCE_TYPE SMALLINT NOT NULL,
	ITEM_ID  VARCHAR(36),
	ITEM_CORRELATION_ID VARCHAR(36),
	ITEM_URL VARCHAR(2048),
	TARGET_SUBJECT_ID VARCHAR(36),
	CONTENT BLOB(1M)
)
IN NEWSTABSPACE;

ALTER TABLE HOMEPAGE.NR_NEWS_PRF_COMMENT
  	ADD CONSTRAINT PK_PRF_COMMENT_ID PRIMARY KEY(NEWS_COMMENT_ID);

ALTER TABLE HOMEPAGE.NR_NEWS_PRF_COMMENT
  	ADD CONSTRAINT FK_ENTRY_ID FOREIGN KEY (ITEM_CORRELATION_ID)
	REFERENCES HOMEPAGE.NR_ENTRIES_PRF (ENTRY_ID);
  	
CREATE INDEX HOMEPAGE.PRF_COMMENT_ENTRY_ID
    ON HOMEPAGE.NR_NEWS_PRF_COMMENT (ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_NEWS_PRF_COMMENT_DATE
    ON HOMEPAGE.NR_NEWS_PRF_COMMENT (UPDATE_DATE ASC);     

COMMIT;



----------------------------------------------------------------
-- DROPPING AND RECREATE NR_RECOMMENDATION - CAN RELATE TO ANY ENTRY TABLE
----------------------------------------------------------------
DROP TABLE HOMEPAGE.NR_RECOMMENDATION;

CREATE TABLE HOMEPAGE.NR_RECOMMENDATION  (
	RECOMMENDATION_ID VARCHAR(36) NOT NULL, --primary key
	RECOMMENDER_ID VARCHAR(36) NOT NULL, -- PERSON_ID of the recommender, FK to PERSON table
	ENTRY_ID VARCHAR(36) NOT NULL, 
	SOURCE_TYPE SMALLINT NOT NULL, 
	CREATION_DATE TIMESTAMP
)
IN NEWS4TABSPACE;

ALTER TABLE HOMEPAGE.NR_RECOMMENDATION 
    ADD CONSTRAINT PK_RECOMMENDATION PRIMARY KEY(RECOMMENDATION_ID);

ALTER TABLE HOMEPAGE.NR_RECOMMENDATION
  	ADD CONSTRAINT FK_RECOMMENDER_ID FOREIGN KEY (RECOMMENDER_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
    
CREATE INDEX HOMEPAGE.NR_REC_ENTRY_ID
    ON HOMEPAGE.NR_RECOMMENDATION (ENTRY_ID);

CREATE INDEX HOMEPAGE.NR_RECCOMANDER_ID
    ON HOMEPAGE.NR_RECOMMENDATION (RECOMMENDER_ID);
    
CREATE UNIQUE INDEX HOMEPAGE.NR_RECOMMENDER_ENTRY_ID
    ON HOMEPAGE.NR_RECOMMENDATION (RECOMMENDER_ID, ENTRY_ID);



COMMIT;

---------------------------------------------------------------
-- DROPPING AND RECREATING RE-CREATE HOMEPAGE.NR_ATTACHMENT
---------------------------------------------------------------
DROP TABLE HOMEPAGE.NR_ATTACHMENT;

CREATE TABLE HOMEPAGE.NR_ATTACHMENT (
	ATTACHMENT_ID VARCHAR(36) NOT NULL,
	ENTRY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT NOT NULL,
	ATTACHMENT_TYPE SMALLINT,
	CREATION_DATE TIMESTAMP,
	NAME VARCHAR(2048),
	DESCRIPTION VARCHAR(4000),	
	TARGET_ID  VARCHAR(256),
	TARGET_URL VARCHAR(2048),
	META_DATA VARCHAR(4000)
)
IN NEWSTABSPACE;

ALTER TABLE HOMEPAGE.NR_ATTACHMENT 
    ADD CONSTRAINT PK_ATTACHMENT PRIMARY KEY(ATTACHMENT_ID);

CREATE INDEX HOMEPAGE.NR_ATT_ENTRY_ID
    ON HOMEPAGE.NR_ATTACHMENT (ENTRY_ID);    



COMMIT;


---------------------------------------------------------------
-- Adding flag for debug purpose on PERSON_COMM table
---------------------------------------------------------------
ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
	ADD COLUMN IS_READER_COMM SMALLINT NOT NULL DEFAULT 0;
	
reorg table HOMEPAGE.NR_COMM_PERSON_FOLLOW use NEWS4TMPTABSPACE;

COMMIT;

UPDATE HOMEPAGE.NR_COMM_PERSON_FOLLOW  SET IS_READER_COMM = 0;

COMMIT;

UPDATE HOMEPAGE.NR_COMM_PERSON_FOLLOW  SET IS_READER_COMM = 1 WHERE NOT EXISTS (
	SELECT 	1
 	FROM  	HOMEPAGE.PERSON PERSON
 	WHERE 	HOMEPAGE.NR_COMM_PERSON_FOLLOW.PERSON_COMMUNITY_ID = PERSON.PERSON_ID 
);

COMMIT;

---------------------------------------------------------------
-- Adding flag for debug purpose on NR_COMM_PERSON_STORIES table
---------------------------------------------------------------
ALTER TABLE HOMEPAGE.NR_COMM_PERSON_STORIES
	ADD COLUMN IS_STORY_COMM SMALLINT;

reorg table HOMEPAGE.NR_COMM_PERSON_STORIES use NEWS4TMPTABSPACE;

UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID < '0..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '0..f' AND COMM_PER_STORY_ID < '1..f' ;
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '1..f' AND COMM_PER_STORY_ID < '2..f' ;
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '2..f' AND COMM_PER_STORY_ID < '3..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '3..f' AND COMM_PER_STORY_ID < '4..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '4..f' AND COMM_PER_STORY_ID < '5..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '5..f' AND COMM_PER_STORY_ID < '6..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '6..f' AND COMM_PER_STORY_ID < '7..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '7..f' AND COMM_PER_STORY_ID < '8..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '8..f' AND COMM_PER_STORY_ID < '9..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= '9..f' AND COMM_PER_STORY_ID < 'a..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= 'a..f' AND COMM_PER_STORY_ID < 'b..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= 'b..f' AND COMM_PER_STORY_ID < 'c..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= 'c..f' AND COMM_PER_STORY_ID < 'd..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= 'd..f' AND COMM_PER_STORY_ID < 'e..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= 'e..f' AND COMM_PER_STORY_ID < 'f..f';
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES SET IS_STORY_COMM = 1 WHERE    COMM_PER_STORY_ID >= 'f..f' ;
COMMIT;

COMMIT;

UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		 	COMM_PER_STORY_ID < '0..f' 
              );
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= '0..f' AND COMM_PER_STORY_ID < '1..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= '1..f' AND COMM_PER_STORY_ID < '2..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= '2..f' AND COMM_PER_STORY_ID < '3..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= '3..f' AND COMM_PER_STORY_ID < '4..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= '4..f' AND COMM_PER_STORY_ID < '5..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              			COMM_PER_STORY_ID >= '5..f' AND COMM_PER_STORY_ID < '6..f'  
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= '6..f' AND COMM_PER_STORY_ID < '7..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= '7..f' AND COMM_PER_STORY_ID < '8..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= '8..f' AND COMM_PER_STORY_ID < '9..f'
              );
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= '9..f' AND COMM_PER_STORY_ID < 'a..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= 'a..f' AND COMM_PER_STORY_ID < 'b..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= 'b..f' AND COMM_PER_STORY_ID < 'c..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= 'c..f' AND COMM_PER_STORY_ID < 'd..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= 'd..f' AND COMM_PER_STORY_ID < 'e..f'
              );
COMMIT; 
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= 'e..f' AND COMM_PER_STORY_ID < 'f..f'
              );
COMMIT;
UPDATE HOMEPAGE.NR_COMM_PERSON_STORIES 
SET    IS_STORY_COMM = 0
WHERE  EXISTS ( SELECT 1
                FROM   HOMEPAGE.PERSON
                WHERE  PERSON_ID = COMM_PER_READER_ID AND 
              		  	COMM_PER_STORY_ID >= 'f..f'
              );
COMMIT; 
	

---------------------------------------------------------------
---------------------------------------------------------------	
-- SEEDLIST AND BOARD TABLES	
---------------------------------------------------------------
---------------------------------------------------------------

---------------------------------------------------------------	
-- All tose tables are going to be stored into a dedicated table space
---------------------------------------------------------------
CREATE BUFFERPOOL BOARD16KBP IMMEDIATE SIZE 500 AUTOMATIC PAGESIZE 16K;

CREATE SYSTEM TEMPORARY TABLESPACE BOARDTMPTABSPACE
	PAGESIZE 16K MANAGED BY SYSTEM 
	USING ( 'BOARDTMPTABSPACE' ) 
	EXTENTSIZE 16 PREFETCHSIZE AUTOMATIC
	BUFFERPOOL BOARD16KBP
	FILE SYSTEM CACHING;
	      
CREATE LARGE TABLESPACE BOARD16TABSPACE 
	PAGESIZE 16K MANAGED BY DATABASE
	USING (FILE 'BOARD16TABSPACE' 12800)
	EXTENTSIZE 16
	PREFETCHSIZE AUTOMATIC
	BUFFERPOOL BOARD16KBP
	AUTORESIZE YES
	INCREASESIZE 40 M
	MAXSIZE NONE;  
	
--------------------------------------
-- HOMEPAGE.BOARD_READERS to store the relationship between a reader and a status update
--------------------------------------
CREATE TABLE HOMEPAGE.BOARD_ENTRIES  (
	ENTRY_ID VARCHAR(47) NOT NULL, -- the format will include in the pk also the creation time
	ENTRY_TYPE SMALLINT,
	CATEGORY_TYPE SMALLINT,
	SOURCE VARCHAR(36),
	SOURCE_TYPE SMALLINT,
	STORY_ID VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	CONTAINER_NAME VARCHAR(256),
	CONTAINER_URL VARCHAR(2048),
	CREATION_DATE TIMESTAMP NOT NULL, -- used also by the seedlist, when something is created the update is equal to is created
	UPDATE_DATE TIMESTAMP NOT NULL, -- this field is used and queried from the the seedlist for initial and incremental index
	ACTOR_UUID VARCHAR(36),
	N_COMMENTS SMALLINT NOT NULL DEFAULT 0,
	N_RECOMMANDATIONS SMALLINT NOT NULL DEFAULT 0,
	IS_COMMUNITY_STORY SMALLINT DEFAULT 0,
	HAS_ATTACHMENT SMALLINT DEFAULT 0,
	TARGET_SUBJECT_ID VARCHAR(256),
	IS_NETWORK_NEWS SMALLINT NOT NULL DEFAULT 0,
	IS_FOLLOW_NEWS SMALLINT NOT NULL DEFAULT 0,
	TAGS VARCHAR(1024),
	SL_IS_UPDATED SMALLINT NOT NULL DEFAULT 0, -- this field is used by the seedlist
	SL_IS_DELETED SMALLINT NOT NULL DEFAULT 0, -- this field is used by the seedlist
	SL_UPDATE_DATE TIMESTAMP NOT NULL, -- this field is used by the seedlist
	CONTENT BLOB NOT NULL
)
IN BOARD16TABSPACE;

ALTER TABLE HOMEPAGE.BOARD_ENTRIES 
    ADD CONSTRAINT PK_BRD_ENTRIES PRIMARY KEY(ENTRY_ID);

CREATE INDEX HOMEPAGE.NEWS_BRD_UPDATE
    ON HOMEPAGE.BOARD_ENTRIES (UPDATE_DATE ASC);
  
CREATE INDEX HOMEPAGE.NEWS_BRD_SL_UPDATE
    ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC);

COMMIT;

--------------------------------------
-- HOMEPAGE.BOARD_READERS to store the relationship between a reader and a status update
--------------------------------------
CREATE TABLE HOMEPAGE.BOARD_READERS  (
	READER_ENTRY_ID VARCHAR(47) NOT NULL, -- the format will include in the pk also the creation time
	READER_ID VARCHAR(36) NOT NULL,
	IS_READER_COMM SMALLINT NOT NULL DEFAULT 0,
	ENTRY_ID VARCHAR(47) NOT NULL
)
IN BOARD16TABSPACE;

ALTER TABLE HOMEPAGE.BOARD_READERS 
    ADD CONSTRAINT PK_BRD_READERS PRIMARY KEY(READER_ENTRY_ID);

ALTER TABLE HOMEPAGE.BOARD_READERS
	ADD CONSTRAINT FK_BRD_PERSON_ID FOREIGN KEY (READER_ID)
	REFERENCES HOMEPAGE.PERSON(PERSON_ID);

ALTER TABLE HOMEPAGE.BOARD_READERS
	ADD CONSTRAINT FK_BRD_ENTRY_ID FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.BOARD_ENTRIES (ENTRY_ID);	    

CREATE INDEX HOMEPAGE.NEWS_BRD_READER_ID
    ON HOMEPAGE.BOARD_READERS  (READER_ID);

CREATE INDEX HOMEPAGE.NEWS_BRD_ENTRY_ID
    ON HOMEPAGE.BOARD_READERS  (ENTRY_ID);

ALTER TABLE HOMEPAGE.BOARD_READERS
	ADD CONSTRAINT NEWS_BRD_UNIQUE UNIQUE(READER_ID, ENTRY_ID);

COMMIT;

--------------------------------------
-- HOMEPAGE.BOARD_ATTACHMENTS to store the comments
--------------------------------------
CREATE TABLE HOMEPAGE.BOARD_COMMENTS  (
	COMMENT_ID VARCHAR(47) NOT NULL, -- the format will include in the pk also the creation time
	ACTOR_UUID VARCHAR(36),
	CREATION_DATE TIMESTAMP NOT NULL,
	ITEM_ID VARCHAR(47),
	ITEM_CORRELATION_ID VARCHAR(47),
	ITEM_URL VARCHAR(2048),	
	CONTENT BLOB(1M)
)
IN BOARD16TABSPACE;

ALTER TABLE HOMEPAGE.BOARD_COMMENTS 
    ADD CONSTRAINT PK_BRD_COMMENT_ID PRIMARY KEY(COMMENT_ID);

ALTER TABLE HOMEPAGE.BOARD_COMMENTS
	ADD CONSTRAINT FK_BRD_ITEM_COR_ID FOREIGN KEY (ITEM_CORRELATION_ID)
	REFERENCES HOMEPAGE.BOARD_ENTRIES (ENTRY_ID);

CREATE INDEX HOMEPAGE.NEWS_BRD_ITEM_ID
    ON HOMEPAGE.BOARD_COMMENTS  (ITEM_ID);

CREATE INDEX HOMEPAGE.NEWS_BRD_ITEM_CORR_ID
    ON HOMEPAGE.BOARD_COMMENTS  (ITEM_CORRELATION_ID);   

COMMIT;

----------------------------------------------------------------
-- ADDING NR_STATUS_ATTACHMENT
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_ATTACHMENTS (
	ATTACHMENT_ID VARCHAR(47) NOT NULL,
	ENTRY_ID VARCHAR(47) NOT NULL, -- 47
	SOURCE_TYPE SMALLINT NOT NULL,
	ATTACHMENT_TYPE SMALLINT,
	CREATION_DATE TIMESTAMP,
	NAME VARCHAR(2048),
	DESCRIPTION VARCHAR(4000),	
	TARGET_ID  VARCHAR(256),
	TARGET_URL VARCHAR(2048),
	META_DATA VARCHAR(4000)
)
IN BOARD16TABSPACE;

ALTER TABLE HOMEPAGE.BOARD_ATTACHMENTS 
    ADD CONSTRAINT PK_BRD_ATTACH_ID PRIMARY KEY(ATTACHMENT_ID);

ALTER TABLE HOMEPAGE.BOARD_ATTACHMENTS
	ADD CONSTRAINT FK_BRD_AT_ENTRY_ID FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.BOARD_ENTRIES (ENTRY_ID);

CREATE INDEX HOMEPAGE.NEWS_BRD_ENTRY_IDX
    ON HOMEPAGE.BOARD_ATTACHMENTS (ENTRY_ID);     
	
COMMIT;

--------------------------------------
-- HOMEPAGE.BOARD_RECOMMANDATIONS to store the relationship between a board entries and something which has been recommended
---------------------------------------
CREATE TABLE HOMEPAGE.BOARD_RECOMMENDATIONS  (
	RECOMMENDATION_ID VARCHAR(47) NOT NULL, --primary key
	RECOMMENDER_ID VARCHAR(36) NOT NULL, -- PERSON_ID of the recommender, FK to PERSON table
	ENTRY_ID VARCHAR(47) NOT NULL,
	SOURCE_TYPE SMALLINT NOT NULL, 
	CREATION_DATE TIMESTAMP
)
IN BOARD16TABSPACE;

ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS 
    ADD CONSTRAINT PK_BRD_RECOMM_ID PRIMARY KEY(RECOMMENDATION_ID);

CREATE INDEX HOMEPAGE.BRD_REC_STORY_ID
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (ENTRY_ID);
    
CREATE UNIQUE INDEX HOMEPAGE.BRD_RECOM_ENTRY_ID
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID, ENTRY_ID);

COMMIT;


