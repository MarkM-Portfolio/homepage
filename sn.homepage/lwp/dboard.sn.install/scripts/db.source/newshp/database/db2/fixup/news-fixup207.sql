-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

---------------------------------------------------------------------------------
------------------------ START NEWS FIXUP 207 -----------------------------------
---------------------------------------------------------------------------------

-- For perf. reason I avoid to run REORG. It shouldn't be needed. 

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_RESPONSES_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_RESPONSES_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_PROFILES_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_PROFILES_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);

COMMIT;

ALTER TABLE HOMEPAGE.NR_COMMUNITIES_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_COMMUNITIES_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);

COMMIT;

ALTER TABLE HOMEPAGE.NR_ACTIVITIES_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_ACTIVITIES_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);

COMMIT;

ALTER TABLE HOMEPAGE.NR_BLOGS_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_BLOGS_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_BOOKMARKS_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_BOOKMARKS_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_FILES_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_FILES_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_FORUMS_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_FORUMS_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_WIKIS_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_WIKIS_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_TAGS_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_TAGS_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_DISCOVERY_VIEW ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_DISCOVERY_VIEW ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;


ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_SAVED_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_SAVED_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_TOPICS_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_TOPICS_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS ALTER COLUMN ORGANIZATION_ID SET DEFAULT '00000000-0000-0000-0000-000000000000';
ALTER TABLE HOMEPAGE.NR_TOPICS_READERS ALTER COLUMN ORGANIZATION_ID SET DATA TYPE VARCHAR(36);
COMMIT;

----------------------------------------------------------------------------------------
-- [START] Adding ORGANIZATION_ID to all the tables
----------------------------------------------------------------------------------------

ALTER TABLE HOMEPAGE.NR_SOURCE ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_RESOURCE ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_FOLLOWS ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_STORIES_CONTENT ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_NETWORK ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000';
COMMIT;

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.EMD_TRANCHE ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS ADD TIMEZONE VARCHAR(255) DEFAULT NULL;
ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000';
COMMIT;

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_ENTRIES ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_STORIES ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.BOARD ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.BOARD_ENTRIES ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.BOARD_COMMENTS  ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.BOARD_MENTIONS  ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.DELETED_STORIES_QUEUE ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_COMM_SETTINGS ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_AS_SEEDLIST ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
ALTER TABLE HOMEPAGE.NR_AS_SEEDLIST ALTER COLUMN ITEM_ID SET DATA TYPE VARCHAR(256);
COMMIT;

COMMIT;

ALTER TABLE HOMEPAGE.NR_AS_COLLECTION_CONFIG ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_AS_CRAWLER_STATUS ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS ADD ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000'; 
COMMIT;

----------------------------------------------------------------------------------------
-- [END] Adding ORGANIZATION_ID to all the tables
----------------------------------------------------------------------------------------

UPDATE HOMEPAGE.NR_SOURCE_TYPE SET ORGANIZATION_ID = '00000000-0000-0000-0000-000000000000';
COMMIT;

-- DROP UNIQUE AND CREATE CONSTRAINT AND INDEXES

DROP INDEX HOMEPAGE.PERSON_EXID;
COMMIT;

ALTER TABLE HOMEPAGE.LOGINNAME DROP UNIQUE LOGINNAME_UNIQUE;
COMMIT;

ALTER TABLE HOMEPAGE.EMD_TRANCHE DROP UNIQUE SEQ_NUMBER_UNIQUE;
COMMIT;

CREATE UNIQUE INDEX HOMEPAGE.PERSON_EXID
    ON HOMEPAGE.PERSON (EXID, ORGANIZATION_ID);    
COMMIT;
    
CREATE UNIQUE INDEX HOMEPAGE.LOGINNAME_UNIQUE
    ON HOMEPAGE.LOGINNAME (LOGINNAME, ORGANIZATION_ID);    
COMMIT;    
    
CREATE UNIQUE INDEX HOMEPAGE.SEQ_NUMBER_UNIQUE
    ON HOMEPAGE.EMD_TRANCHE (SEQ_NUMBER, ORGANIZATION_ID);      
COMMIT;

-- ALTER STAT_VALUE COLUMN ON NR_AS_CONTENT_INDEX_STATS
ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS RENAME COLUMN STAT_VALUE TO OLD_STAT_VALUE;
COMMIT;

ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS ADD COLUMN STAT_VALUE BLOB(3670016);
COMMIT;

UPDATE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS SET STAT_VALUE = OLD_STAT_VALUE;
COMMIT;

ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS DROP COLUMN OLD_STAT_VALUE;
COMMIT;

REORG TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS;

-- MIGRATE THE NR_AS_COLLECTIONS_CONFIG TABLE --
UPDATE HOMEPAGE.NR_AS_COLLECTION_CONFIG 
SET XML_DATA = REPLACE(XML_DATA,
					   '<indexServicesFactoryName>com.ibm.lotus.search.engine.services.ActivityStreamSearchServicesFactory</indexServicesFactoryName>',
					   '<indexServicesFactoryName>com.ibm.lotus.search.engine.services.DefaultSearchServicesFactory</indexServicesFactoryName>');
COMMIT;

-- FORM THE NR_MENTIONS_READERS TABLE DATA --
-- Create an index for the data extract --
CREATE INDEX STORIES_STORY_EVENT_IX ON HOMEPAGE.NR_STORIES(EVENT_NAME, STORY_ID);
COMMIT;

CREATE VIEW HOMEPAGE.MENTIONS_READERS AS (
SELECT r.CATEGORY_READER_ID, r.READER_ID, r.CATEGORY_TYPE, r.SOURCE,
r.CONTAINER_ID, r.ITEM_ID, r.ROLLUP_ENTRY_ID, r.RESOURCE_TYPE, r.CREATION_DATE,
r.STORY_ID, r.SOURCE_TYPE, r.USE_IN_ROLLUP, r.IS_NETWORK, r.IS_FOLLOWER, 
r.EVENT_TIME, r.IS_STORY_COMM, r.IS_BROADCAST, r.ORGANIZATION_ID, r.ACTOR_UUID, r.ROLLUP_AUTHOR_ID, r.IS_VISIBLE, r.MAX_UPDATE_FOR_READER
FROM HOMEPAGE.NR_RESPONSES_READERS r, HOMEPAGE.NR_STORIES s
WHERE r.STORY_ID = s.STORY_ID
AND s.EVENT_NAME IN ('community.wall.notification.mention',
                     'community.wall.comment.notification.mention',
                     'profiles.status.notification.mention',
                     'profiles.wallpost.notification.mention',
                     'profiles.status.comment.notification.mention',
                     'profiles.wallpost.comment.notification.mention')
);
COMMIT;

EXPORT TO data.tmp.ixf OF IXF 
METHOD N ( 
CATEGORY_READER_ID, READER_ID, CATEGORY_TYPE, SOURCE,
CONTAINER_ID, ITEM_ID, ROLLUP_ENTRY_ID, RESOURCE_TYPE, CREATION_DATE,
STORY_ID, SOURCE_TYPE, USE_IN_ROLLUP, IS_NETWORK, IS_FOLLOWER, EVENT_TIME,
IS_STORY_COMM, IS_BROADCAST, ORGANIZATION_ID, ACTOR_UUID, 
ROLLUP_AUTHOR_ID, IS_VISIBLE, MAX_UPDATE_FOR_READER)
SELECT r.CATEGORY_READER_ID, r.READER_ID, 22, r.SOURCE,
r.CONTAINER_ID, r.ITEM_ID, r.ROLLUP_ENTRY_ID, r.RESOURCE_TYPE, r.CREATION_DATE,
r.STORY_ID, r.SOURCE_TYPE, r.USE_IN_ROLLUP, r.IS_NETWORK, r.IS_FOLLOWER, 
r.EVENT_TIME, r.IS_STORY_COMM, r.IS_BROADCAST, r.ORGANIZATION_ID, r.ACTOR_UUID, r.ROLLUP_AUTHOR_ID, r.IS_VISIBLE, r.MAX_UPDATE_FOR_READER
FROM HOMEPAGE.MENTIONS_READERS r;

DROP TABLE HOMEPAGE.NR_MENTIONS_READERS;
COMMIT;

CREATE TABLE HOMEPAGE.NR_MENTIONS_READERS (
	CATEGORY_READER_ID VARCHAR(36) DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) NOT NULL,
	CONTAINER_ID VARCHAR(256),
	ITEM_ID VARCHAR(256),
	ROLLUP_ENTRY_ID VARCHAR(256),
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256),
	ROLLUP_AUTHOR_ID VARCHAR (256),
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	MAX_UPDATE_FOR_READER TIMESTAMP
)
IN NEWS4TABSPACE;

GRANT DELETE, INSERT, SELECT, UPDATE ON HOMEPAGE.NR_MENTIONS_READERS TO USER LCUSER; 

IMPORT FROM data.tmp.ixf OF IXF METHOD N(
CATEGORY_READER_ID, READER_ID, CATEGORY_TYPE, SOURCE,
CONTAINER_ID, ITEM_ID, ROLLUP_ENTRY_ID, RESOURCE_TYPE, CREATION_DATE,
STORY_ID, SOURCE_TYPE, USE_IN_ROLLUP, IS_NETWORK, IS_FOLLOWER, EVENT_TIME,
IS_STORY_COMM, IS_BROADCAST, ORGANIZATION_ID, ACTOR_UUID, IS_VISIBLE,
ROLLUP_AUTHOR_ID, MAX_UPDATE_FOR_READER)
ALLOW NO ACCESS COMMITCOUNT 2000
INSERT INTO HOMEPAGE.NR_MENTIONS_READERS (
CATEGORY_READER_ID, READER_ID, CATEGORY_TYPE, SOURCE,
CONTAINER_ID, ITEM_ID, ROLLUP_ENTRY_ID, RESOURCE_TYPE, CREATION_DATE,
STORY_ID, SOURCE_TYPE, USE_IN_ROLLUP, IS_NETWORK, IS_FOLLOWER, EVENT_TIME,
IS_STORY_COMM, IS_BROADCAST, ORGANIZATION_ID, ACTOR_UUID, IS_VISIBLE,
ROLLUP_AUTHOR_ID, MAX_UPDATE_FOR_READER);
COMMIT;

DROP INDEX STORIES_STORY_EVENT_IX;
COMMIT;

DROP VIEW HOMEPAGE.MENTIONS_READERS;
COMMIT;

ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS
    ADD CONSTRAINT CK_CAT22_TYPE CHECK(CATEGORY_TYPE = 22);

ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS
    ADD CONSTRAINT PK_MEN_READERS PRIMARY KEY(CATEGORY_READER_ID);

ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS 
	ADD CONSTRAINT FK_MEN_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID); 
	
--  [start indexes] NR_MENTIONS_READERS
CREATE  INDEX HOMEPAGE.MENTIONS_READERS_STR_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_CD_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_SRC_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (READER_ID, CREATION_DATE DESC, STORY_ID, IS_BROADCAST, ROLLUP_ENTRY_ID, SOURCE_TYPE, IS_VISIBLE); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_RLL_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (READER_ID, IS_VISIBLE, USE_IN_ROLLUP); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_RDR_STR 
 	ON HOMEPAGE.NR_MENTIONS_READERS (READER_ID, STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_ROLLUP_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ROLLUP_ENTRY_ID, READER_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_RIR_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (READER_ID, IS_VISIBLE, ROLLUP_ENTRY_ID DESC, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_RLL_BRD_VIS 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, USE_IN_ROLLUP, IS_VISIBLE); 
COMMIT;

--  [end indexes] NR_MENTIONS_READERS

REORG TABLE HOMEPAGE.NR_MENTIONS_READERS ALLOW NO ACCESS;
REORG INDEXES ALL FOR TABLE HOMEPAGE.NR_MENTIONS_READERS;
runstats on table HOMEPAGE.NR_MENTIONS_READERS AND INDEXES ALL;
COMMIT;


---------------------------------------------------------------------------------
------------------------ END NEWS FIXUP 207 -------------------------------------
---------------------------------------------------------------------------------

 

  
  
  
