-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

------------------------------------------------
-- NR_SOURCE_TYPE_DEFAULT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SOURCE_TYPE_DEFAULT (
	SOURCE_TYPE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT NOT NULL, -- numeric that is 1,2,3 etc.. 100, 101..
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	DISPLAY_NAME VARCHAR(4000) CCSID 1208,
	IMAGE_URL VARCHAR(2048) CCSID 1208,
	PUBLISHED TIMESTAMP,
	UPDATED TIMESTAMP,	
	IS_ENABLED SMALLINT,
	SUMMARY VARCHAR (4000) CCSID 1208,
	URL VARCHAR(2048) CCSID 1208,
	URL_SSL VARCHAR(2048) CCSID 1208,
	IMAGE_URL_SSL VARCHAR(2048) CCSID 1208,
	IS_DIGEST_ENABLED SMALLINT NOT NULL DEFAULT 0,
	DEFAULT_DIGEST_FREQUENCY SMALLINT NOT NULL DEFAULT 0,
	IS_DIGEST_LOCKED SMALLINT NOT NULL DEFAULT 0,
	ORGANIZATION_ID VARCHAR (36) CCSID 1208
)	
;

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE_DEFAULT 
  	ADD CONSTRAINT HOMEPAGE.PK_SRC_TYPE_DEF_ID PRIMARY KEY(SOURCE_TYPE_ID);

CREATE UNIQUE INDEX HOMEPAGE.NR_SRC_TYPE_DEF_UIDX 
	ON HOMEPAGE.NR_SOURCE_TYPE_DEFAULT (SOURCE_TYPE);
	
CREATE UNIQUE INDEX HOMEPAGE.NR_SRC_DEF_UIDX
	ON HOMEPAGE.NR_SOURCE_TYPE_DEFAULT (SOURCE);

--runstats on table HOMEPAGE.NR_SOURCE_TYPE_DEFAULT with distribution and detailed indexes all allow write access;	
	
COMMIT;
------------------------------------------------
-- NR_SOURCE_TYPE
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SOURCE_TYPE (
	SOURCE_TYPE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT NOT NULL, -- numeric that is 1,2,3 etc.. 100, 101..
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	DISPLAY_NAME VARCHAR(4000) CCSID 1208,
	IMAGE_URL VARCHAR(2048) CCSID 1208,
	PUBLISHED TIMESTAMP,
	UPDATED TIMESTAMP,	
	IS_ENABLED SMALLINT,
	SUMMARY VARCHAR(4000) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	URL VARCHAR(2048) CCSID 1208,
	URL_SSL VARCHAR(2048) CCSID 1208,
	IMAGE_URL_SSL VARCHAR(2048) CCSID 1208,
	IS_DIGEST_ENABLED SMALLINT NOT NULL DEFAULT 0,
	DEFAULT_DIGEST_FREQUENCY SMALLINT NOT NULL DEFAULT 0,
	IS_DIGEST_LOCKED SMALLINT NOT NULL DEFAULT 0
)	
;

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE 
  	ADD CONSTRAINT HOMEPAGE.PK_SRC_TYPE_ID PRIMARY KEY(SOURCE_TYPE_ID);

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE ADD CONSTRAINT HOMEPAGE.FK_SOURCE_TYPE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE UNIQUE INDEX HOMEPAGE.NR_SRC_TYPE_ORG_UIDX 
	ON HOMEPAGE.NR_SOURCE_TYPE (SOURCE_TYPE, ORGANIZATION_ID);


CREATE UNIQUE INDEX HOMEPAGE.UNQ_SOURCE_TYPE_SRC_ORG
 	ON HOMEPAGE.NR_SOURCE_TYPE (SOURCE, ORGANIZATION_ID);


CREATE INDEX HOMEPAGE.SRC_TYPE_ORG_ID
    ON HOMEPAGE.NR_SOURCE_TYPE (ORGANIZATION_ID, SOURCE_TYPE ASC);

--RUNSTATS on table HOMEPAGE.NR_SOURCE_TYPE with distribution and detailed indexes all allow write access;

------------------------------------------------
-- NR_TEMPLATE
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_TEMPLATE (
	TEMPLATE_ID VARCHAR(36) CCSID 1208 NOT NULL,
 	NAME VARCHAR(256) CCSID 1208 NOT NULL,
 	FORMAT VARCHAR(256) CCSID 1208 NOT NULL,
 	DATA_SOURCE_STRING VARCHAR(256) CCSID 1208 NOT NULL,
 	NO_VALUES SMALLINT NOT NULL
)
;

ALTER TABLE HOMEPAGE.NR_TEMPLATE 
  	ADD CONSTRAINT HOMEPAGE.PK_TEMPLATE_ID PRIMARY KEY(TEMPLATE_ID);    

--RUNSTATS ON TABLE HOMEPAGE.NR_TEMPLATE FOR INDEXES ALL;

------------------------------------------------
-- NR_SCHEDULER_TASK
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_TASK (
	TASKID BIGINT NOT NULL,
	VERSION VARCHAR(5) CCSID 1208 NOT NULL,
	ROW_VERSION INTEGER NOT NULL,
	TASKTYPE INTEGER NOT NULL,
	TASKSUSPENDED SMALLINT NOT NULL,
	CANCELLED SMALLINT NOT NULL,
	NEXTFIRETIME BIGINT NOT NULL,
	STARTBYINTERVAL VARCHAR(254) CCSID 1208,
	STARTBYTIME BIGINT,
	VALIDFROMTIME BIGINT,
	VALIDTOTIME BIGINT,
	REPEATINTERVAL VARCHAR(254) CCSID 1208,
	MAXREPEATS INTEGER NOT NULL,
	REPEATSLEFT INTEGER NOT NULL,
	TASKINFO BLOB(102400),
	NAME VARCHAR(254) CCSID 1208 NOT NULL,
	AUTOPURGE INTEGER NOT NULL,
	FAILUREACTION INTEGER,
	MAXATTEMPTS INTEGER,
	QOS INTEGER,
	PARTITIONID INTEGER,
	OWNERTOKEN VARCHAR(200) CCSID 1208 NOT NULL,
	CREATETIME BIGINT NOT NULL
) 
;

ALTER TABLE HOMEPAGE.NR_SCHEDULER_TASK 
	ADD PRIMARY KEY (TASKID);

CREATE INDEX HOMEPAGE.NR_SCHEDULER_TASK_IDX1 
	ON HOMEPAGE.NR_SCHEDULER_TASK (TASKID, OWNERTOKEN);

CREATE INDEX HOMEPAGE.NR_SCHEDULER_TASK_IDX2 
	ON HOMEPAGE.NR_SCHEDULER_TASK (NEXTFIRETIME ASC, REPEATSLEFT, PARTITIONID);

------------------------------------------------
-- NR_SCHEDULER_TREG
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_TREG (
	REGKEY VARCHAR(254) CCSID 1208 NOT NULL,
	REGVALUE VARCHAR(254) CCSID 1208 
) 
;

ALTER TABLE HOMEPAGE.NR_SCHEDULER_TREG 
	ADD PRIMARY KEY (REGKEY);

------------------------------------------------
-- NR_SCHEDULER_LMGR
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_LMGR (
	LEASENAME VARCHAR(254) CCSID 1208 NOT NULL,
	LEASEOWNER VARCHAR(254) CCSID 1208 NOT NULL,
	LEASE_EXPIRE_TIME  BIGINT,
	DISABLED VARCHAR(5) CCSID 1208
)
;

ALTER TABLE HOMEPAGE.NR_SCHEDULER_LMGR 
	ADD PRIMARY KEY (LEASENAME);

------------------------------------------------
-- NR_SCHEDULER_LMPR
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_LMPR (
	LEASENAME VARCHAR(254) CCSID 1208 NOT NULL,
	NAME VARCHAR(254) CCSID 1208 NOT NULL,
	VALUE VARCHAR(254) CCSID 1208 NOT NULL
)
;

CREATE INDEX HOMEPAGE.NR_SCHEDULER_LMPR_IDX1 
	ON HOMEPAGE.NR_SCHEDULER_LMPR (LEASENAME, NAME);


------------------------------------------------
-- NR_NEWS_STATUS_NETWORK
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK (
	NEWS_STATUS_NETWORK_ID VARCHAR(36) CCSID 1208 NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208,
	ACTOR_UUID VARCHAR(36) CCSID 1208 NOT NULL,
	BRIEF_DESC VARCHAR(4000) CCSID 1208,
	ITEM_URL VARCHAR(2048) CCSID 1208,
	ITEM_ID  VARCHAR(36) CCSID 1208,
	EVENT_NAME VARCHAR(36) CCSID 1208,
	TARGET_SUBJECT_ID VARCHAR(36) CCSID 1208,
	IS_WALL_POST  SMALLINT NOT NULL DEFAULT 0,
	CREATION_DATE TIMESTAMP,
	UPDATE_DATE TIMESTAMP,
	N_COMMENTS SMALLINT NOT NULL DEFAULT 0,
	IS_NETWORK_NEWS SMALLINT NOT NULL DEFAULT 0,
	IS_FOLLOW_NEWS SMALLINT NOT NULL DEFAULT 0,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK
  	ADD CONSTRAINT HOMEPAGE.PK_NEWS_STATUS_ID PRIMARY KEY(NEWS_STATUS_NETWORK_ID);

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK ADD CONSTRAINT HOMEPAGE.FK_NEWS_STATUS_NETWORK_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.NR_NEWS_STATUS_NETWORK_ITEM_ID
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (ITEM_ID);

CREATE INDEX HOMEPAGE.NR_NEWS_SN_READER_FOLL
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (UPDATE_DATE DESC, READER_ID, IS_FOLLOW_NEWS);

CREATE INDEX HOMEPAGE.NR_NEWS_SN_READER_NETW
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (UPDATE_DATE DESC, READER_ID, IS_NETWORK_NEWS);

CREATE INDEX HOMEPAGE.NEWS_STATUS_NET_R_U 
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (READER_ID, UPDATE_DATE DESC);

CREATE INDEX HOMEPAGE.NR_STATUS_NETWORK_DATE
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (UPDATE_DATE ASC);

CREATE INDEX HOMEPAGE.NR_NEWS_SN_READER_IDX
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (READER_ID);
	
CREATE UNIQUE INDEX HOMEPAGE.NR_SN_ITEM_READ_UNQ
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (ITEM_ID, READER_ID);

CREATE INDEX HOMEPAGE.NR_STATUS_UPDATE_IX
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (READER_ID, UPDATE_DATE ASC, CREATION_DATE ASC, ITEM_ID, ACTOR_UUID);
	

------------------------------------------------
-- NR_NEWS_STATUS_COMMENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT (
	NEWS_STATUS_COMMENT_ID VARCHAR(36) CCSID 1208 NOT NULL,
	ACTOR_UUID VARCHAR(36) CCSID 1208 NOT NULL,
	CREATION_DATE TIMESTAMP,
	BRIEF_DESC VARCHAR(500) CCSID 1208,
	ITEM_ID  VARCHAR(36) CCSID 1208,
	ITEM_CORRELATION_ID VARCHAR(256) CCSID 1208,
	ITEM_URL VARCHAR(2048) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT
  	ADD CONSTRAINT HOMEPAGE.PK_NEWS_COMMENT_ID PRIMARY KEY(NEWS_STATUS_COMMENT_ID);

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT ADD CONSTRAINT HOMEPAGE.FK_STATUS_COMMENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.CL_STATUS_COMMENT_IDX
ON HOMEPAGE.NR_NEWS_STATUS_COMMENT (ITEM_CORRELATION_ID);

CREATE INDEX HOMEPAGE.STATUS_COMMENT_ITEM_ID
    ON HOMEPAGE.NR_NEWS_STATUS_COMMENT (ITEM_ID);

CREATE INDEX HOMEPAGE.NR_STATUS_COMMENT_DATE
    ON HOMEPAGE.NR_NEWS_STATUS_COMMENT (CREATION_DATE ASC);     

------------------------------------------------
-- NR_NEWS_STATUS_CONTENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT (
	NEWS_STATUS_CONTENT_ID VARCHAR(36) CCSID 1208 NOT NULL,
	ITEM_ID  VARCHAR(36) CCSID 1208,
	ACTOR_UUID VARCHAR(36) CCSID 1208,
	CREATION_DATE TIMESTAMP,
	TARGET_SUBJECT_ID VARCHAR(36) CCSID 1208,
	ITEM_URL  VARCHAR(2048) CCSID 1208,
	UPDATE_DATE TIMESTAMP,
	RECOMMENDATIONS_COUNT INT, -- fixup57.sql during migraiton from 3.0 to 3.0.1
	CONTENT CLOB CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT
  	ADD CONSTRAINT HOMEPAGE.PK_S_CONTENT_ID PRIMARY KEY(NEWS_STATUS_CONTENT_ID);

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT ADD CONSTRAINT HOMEPAGE.FK_STATUS_CONTENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.NR_NEWS_SC_ITEM_ID
    ON HOMEPAGE.NR_NEWS_STATUS_CONTENT (ITEM_ID);

CREATE INDEX HOMEPAGE.NR_NEWS_SC_CD
    ON HOMEPAGE.NR_NEWS_STATUS_CONTENT (CREATION_DATE ASC);

CREATE INDEX HOMEPAGE.NR_SC_UDATE
    ON HOMEPAGE.NR_NEWS_STATUS_CONTENT (UPDATE_DATE ASC);   	    

------------------------------------------------
-- NR_NEWS_COMMENT_CONTENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT (
	NEWS_COMMENT_CONTENT_ID VARCHAR(36) CCSID 1208 NOT NULL,
	NEWS_STATUS_COMMENT_ID  VARCHAR(36) CCSID 1208,
	CONTENT CLOB CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT
  	ADD CONSTRAINT HOMEPAGE.PK_C_CONTENT_ID PRIMARY KEY(NEWS_COMMENT_CONTENT_ID);    

ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT
  	ADD CONSTRAINT HOMEPAGE.FK_C_COMMENT_ID FOREIGN KEY (NEWS_STATUS_COMMENT_ID)
	REFERENCES HOMEPAGE.NR_NEWS_STATUS_COMMENT(NEWS_STATUS_COMMENT_ID);

ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT ADD CONSTRAINT HOMEPAGE.FK_NEWS_COMMENT_CONTENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);	

CREATE INDEX HOMEPAGE.NR_NEWS_COMMENT_CONTENT_ID
    ON HOMEPAGE.NR_NEWS_COMMENT_CONTENT(NEWS_STATUS_COMMENT_ID);	


----------------------------------------------------------------------
-- HOMEPAGE.NR_RESOURCE
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_RESOURCE (
	RESOURCE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208 NOT NULL,
	CONTAINER_NAME VARCHAR(256) CCSID 1208,
	CONTAINER_URL VARCHAR(2048) CCSID 1208,
	CATEGORY_TYPE SMALLINT,
	RESOURCE_TYPE SMALLINT NOT NULL,
	LAST_UPDATE TIMESTAMP,
	SOURCE_TYPE SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_RESOURCE 
    ADD CONSTRAINT HOMEPAGE.PK_RESOURCE_ID PRIMARY KEY(RESOURCE_ID);

ALTER TABLE HOMEPAGE.NR_RESOURCE ADD CONSTRAINT HOMEPAGE.FK_RESOURCE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
ALTER TABLE HOMEPAGE.NR_RESOURCE
	ADD CONSTRAINT HOMEPAGE.UNIQUE_RES UNIQUE (CONTAINER_ID, RESOURCE_TYPE);

CREATE INDEX HOMEPAGE.NR_RESOURCE_TYPE_CONT
    ON HOMEPAGE.NR_RESOURCE (RESOURCE_TYPE, CONTAINER_ID);	

CREATE INDEX HOMEPAGE.NR_RESOURCE_TYPE_CONT_IX
	ON HOMEPAGE.NR_RESOURCE (RESOURCE_TYPE, CONTAINER_NAME);

CREATE UNIQUE INDEX HOMEPAGE.NR_RES_LU_UIDX
	ON HOMEPAGE.NR_RESOURCE (RESOURCE_ID, RESOURCE_TYPE, LAST_UPDATE DESC, CONTAINER_NAME DESC);
	
CREATE INDEX HOMEPAGE.NR_RES_CONT_NAME_ORG_ID_IDX
	ON HOMEPAGE.NR_RESOURCE (CONTAINER_NAME, ORGANIZATION_ID);
	
----------------------------------------------------------------------
-- HOMEPAGE.NR_FOLLOWS 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_FOLLOWS (
	FOLLOW_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,
	RESOURCE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_FOLLOWS 
    ADD CONSTRAINT HOMEPAGE.PK_FOLLOWS_ID PRIMARY KEY(FOLLOW_ID);

ALTER TABLE HOMEPAGE.NR_FOLLOWS
    ADD CONSTRAINT HOMEPAGE.FK_FS_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.NR_FOLLOWS
    ADD CONSTRAINT HOMEPAGE.FK_FS_RESOURCE_ID FOREIGN KEY (RESOURCE_ID)
	REFERENCES HOMEPAGE.NR_RESOURCE (RESOURCE_ID);

ALTER TABLE HOMEPAGE.NR_FOLLOWS ADD CONSTRAINT HOMEPAGE.FK_FOLLOWS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE UNIQUE INDEX HOMEPAGE.NR_FOLLOWS_IDX
    ON HOMEPAGE.NR_FOLLOWS (RESOURCE_ID, PERSON_ID);

CREATE INDEX HOMEPAGE.NR_FOLLOWS_PERS
    ON HOMEPAGE.NR_FOLLOWS (PERSON_ID);

CREATE INDEX HOMEPAGE.NR_FOLLOWS_RES
    ON HOMEPAGE.NR_FOLLOWS (RESOURCE_ID);    

CREATE UNIQUE INDEX HOMEPAGE.NR_FOLLOWS_PER_RES_UIDX
	ON HOMEPAGE.NR_FOLLOWS (PERSON_ID, RESOURCE_ID);
	
----------------------------------------------------------------------
-- HOMEPAGE.NR_COMM_FOLLOW 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_COMM_FOLLOW (
	COMM_FOLLOW_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,
	COMMUNITY_ID VARCHAR(39) CCSID 1208 NOT NULL,
	COMMUNITY_NAME VARCHAR(256) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
    ADD CONSTRAINT HOMEPAGE.PK_COMM_FOLLOW_ID PRIMARY KEY(COMM_FOLLOW_ID);

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
    ADD CONSTRAINT HOMEPAGE.FK_COMM_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
    ADD CONSTRAINT HOMEPAGE.UNIQUE_PERS_COMM UNIQUE (PERSON_ID, COMMUNITY_ID);	

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW ADD CONSTRAINT HOMEPAGE.FK_COMM_FOLLOW_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.NR_COMM_FOLLOW_PERSON_ID
    ON HOMEPAGE.NR_COMM_FOLLOW (PERSON_ID);

CREATE INDEX HOMEPAGE.NR_COMM_FOLLOW_COM_ID
    ON HOMEPAGE.NR_COMM_FOLLOW (COMMUNITY_ID);    	  

----------------------------------------------------------------------
-- HOMEPAGE.NR_STORIES
----------------------------------------------------------------------
--CREATE TABLE HOMEPAGE.NR_STORIES (
--	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
--	EVENT_NAME VARCHAR(256) CCSID 1208 NOT NULL,
--	SOURCE VARCHAR(36) CCSID 1208,
--	CONTAINER_ID VARCHAR(256) CCSID 1208,	
--	CONTAINER_NAME VARCHAR(256) CCSID 1208,
--	CONTAINER_URL VARCHAR(2048) CCSID 1208,
--	ITEM_NAME VARCHAR(256) CCSID 1208,
--	ITEM_URL VARCHAR(2048) CCSID 1208,
--	ITEM_ATOM_URL VARCHAR(2048) CCSID 1208,
--	ITEM_ID VARCHAR(36) CCSID 1208, -- NEW
--	ITEM_CORRELATION_ID VARCHAR(36) CCSID 1208, -- NEW	
--	CREATION_DATE TIMESTAMP NOT NULL,
--	BRIEF_DESC VARCHAR(512) CCSID 1208,
--	ACTOR_UUID VARCHAR(36) CCSID 1208,
--	EVENT_RECORD_UUID VARCHAR(36) CCSID 1208 NOT NULL,
--	TAGS VARCHAR(1024) CCSID 1208,
--	META_TEMPLATE VARCHAR(4096) CCSID 1208 DEFAULT '' NOT NULL,
--	TEXT_META_TEMPLATE VARCHAR(1024) CCSID 1208,
--	R_META_TEMPLATE VARCHAR(4096) CCSID 1208,
--	R_TEXT_META_TEMPLATE VARCHAR(1024) CCSID 1208,
--	N_COMMENTS SMALLINT NOT NULL DEFAULT 0, -- NEW
--	N_RECOMMANDATIONS SMALLINT NOT NULL DEFAULT 0, -- NEW
--	IS_COMMUNITY_STORY SMALLINT DEFAULT 0,
--	ITEM_CORRELATION_NAME VARCHAR(256) CCSID 1208,
--	SOURCE_TYPE SMALLINT
--)
--;

--ALTER TABLE HOMEPAGE.NR_STORIES
--   ADD CONSTRAINT HOMEPAGE.PK_STORY_ID PRIMARY KEY(STORY_ID);

--CREATE INDEX HOMEPAGE.NR_STORIES_DATE
--	ON HOMEPAGE.NR_STORIES(CREATION_DATE DESC);

--CREATE INDEX HOMEPAGE.STORIES_CONTAINED_ID
--    ON HOMEPAGE.NR_STORIES (CONTAINER_ID);

--CREATE INDEX HOMEPAGE.STORIES_ITEM_ID
--    ON HOMEPAGE.NR_STORIES (ITEM_ID);

--CREATE INDEX HOMEPAGE.STORIES_ITEM_CORR_ID
--    ON HOMEPAGE.NR_STORIES (ITEM_CORRELATION_ID);

--CREATE UNIQUE INDEX HOMEPAGE.NR_STORIES_ER_UUID
--	ON HOMEPAGE.NR_STORIES(EVENT_RECORD_UUID);        

----------------------------------------------------------------------
-- HOMEPAGE.NR_FOLLOWED_STORIES (this table has been splitted)
----------------------------------------------------------------------
--CREATE TABLE HOMEPAGE.NR_FOLLOWED_STORIES (
--	CATEGORY_READER_ID VARCHAR(36) CCSID 1208 NOT NULL,
--	READER_ID VARCHAR(36) CCSID 1208 NOT NULL,
--	CATEGORY_TYPE SMALLINT NOT NULL,
--	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
--	CONTAINER_ID VARCHAR(256) CCSID 1208,
--	ITEM_ID VARCHAR(36) CCSID 1208, 
--	RESOURCE_TYPE SMALLINT NOT NULL,
--	CREATION_DATE TIMESTAMP NOT NULL,
--	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL
--)
--;

--ALTER TABLE HOMEPAGE.NR_FOLLOWED_STORIES
--   ADD CONSTRAINT HOMEPAGE.PK_F_STORY_ID PRIMARY KEY(CATEGORY_READER_ID);

--ALTER TABLE HOMEPAGE.NR_FOLLOWED_STORIES
--    ADD CONSTRAINT HOMEPAGE.FK_F_STORY_ID FOREIGN KEY (STORY_ID)
--	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);

--CREATE INDEX HOMEPAGE.NR_FOLLOWED_STORIES_READER_CAT
--    ON HOMEPAGE.NR_FOLLOWED_STORIES (CREATION_DATE ASC, READER_ID, CATEGORY_TYPE);

----------------------------------------------------------------------
-- HOMEPAGE.NR_COMM_STORIES
----------------------------------------------------------------------
--CREATE TABLE HOMEPAGE.NR_COMM_STORIES (
--	COMM_STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
--	COMMUNITY_ID VARCHAR(36) CCSID 1208 NOT NULL,
--	CONTAINER_ID VARCHAR(256) CCSID 1208,
--	ITEM_ID VARCHAR(36) CCSID 1208,
--	RESOURCE_TYPE SMALLINT NOT NULL,
--	CREATION_DATE TIMESTAMP NOT NULL,
--	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
--	SOURCE_TYPE SMALLINT
--)
--;

--ALTER TABLE HOMEPAGE.NR_COMM_STORIES
--    ADD CONSTRAINT HOMEPAGE.PK_F_CSTORY_ID PRIMARY KEY(COMM_STORY_ID);

--ALTER TABLE HOMEPAGE.NR_COMM_STORIES
--    ADD CONSTRAINT HOMEPAGE.FK_COMM_STORY_ID FOREIGN KEY (STORY_ID)
--	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);

--CREATE INDEX HOMEPAGE.NR_COMM_STORIES_STORY_ID
--    ON HOMEPAGE.NR_COMM_STORIES (STORY_ID);

--CREATE INDEX HOMEPAGE.NR_COMM_STORIES_COM_ID
--    ON HOMEPAGE.NR_COMM_STORIES (COMMUNITY_ID);

--CREATE INDEX HOMEPAGE.COMM_STORIES_ITEM_ID
--    ON HOMEPAGE.NR_COMM_STORIES (ITEM_ID);

--CREATE INDEX HOMEPAGE.NR_COMM_STORIES_DATE
--    ON HOMEPAGE.NR_COMM_STORIES (CREATION_DATE ASC);

--CREATE INDEX HOMEPAGE.NR_COMM_STORIES_CDATE
--    ON HOMEPAGE.NR_COMM_STORIES (COMMUNITY_ID, CREATION_DATE ASC);

--CREATE INDEX HOMEPAGE.NR_COM_STORY_ID			
--	ON HOMEPAGE.NR_COMM_STORIES (COMMUNITY_ID, STORY_ID);    

------------------------------------------------
-- NR_STORIES_CONTENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_STORIES_CONTENT (
	STORY_CONTENT_ID VARCHAR(36) CCSID 1208 NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208,
	SOURCE_TYPE SMALLINT,
	ACTIVITY_META_DATA CLOB CCSID 1208,
	ITEM_CONTENT CLOB CCSID 1208,
	ITEM_CORRELATION_CONTENT CLOB CCSID 1208,
	CONTENT_FORMAT SMALLINT,
	ITEM_CONTENT_FORMAT SMALLINT,
	ITEM_CORRELATION_FORMAT SMALLINT,
	ACTIVITY_META_DATA_1 VARCHAR(4000) FOR BIT data,
	ACTIVITY_META_DATA_2 VARCHAR(4000) FOR BIT data,
	IS_META_DATA_TRUNCATED SMALLINT,
	ITEM_BRIEF_DESC VARCHAR(4000) CCSID 1208,
	ITEM_CORRELATION_BRIEF_DESC VARCHAR(4000) CCSID 1208,
	ITEM_TAGS VARCHAR(1024) CCSID 1208,
	ITEM_CORRELATION_TAGS VARCHAR(1024) CCSID 1208,
	CONTENT CLOB CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_STORIES_CONTENT
  	ADD CONSTRAINT HOMEPAGE.PK_STORY_CONT_ID PRIMARY KEY(STORY_CONTENT_ID);

ALTER TABLE HOMEPAGE.NR_STORIES_CONTENT ADD CONSTRAINT HOMEPAGE.FK_STORIES_CONTENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.STORIES_CONTENT_STORY
    ON HOMEPAGE.NR_STORIES_CONTENT (STORY_ID);

CREATE INDEX HOMEPAGE.NR_STORIES_CONTENT_DATE
    ON HOMEPAGE.NR_STORIES_CONTENT (CREATION_DATE ASC);    	

----------------------------------------------------------------------
-- HOMEPAGE.NR_NETWORK
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NETWORK (
	NETWORK_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,
	COLLEAGUE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_NETWORK
    ADD CONSTRAINT HOMEPAGE.PK_NETWORK_ID PRIMARY KEY(NETWORK_ID);

ALTER TABLE HOMEPAGE.NR_NETWORK
    ADD CONSTRAINT HOMEPAGE.FK_NTW_PERS_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.NR_NETWORK
    ADD CONSTRAINT HOMEPAGE.FK_NTW_COLL_ID FOREIGN KEY (COLLEAGUE_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.NR_NETWORK ADD CONSTRAINT HOMEPAGE.FK_NETWORK_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);	

CREATE INDEX HOMEPAGE.NR_NETWORK_PERS
    ON HOMEPAGE.NR_NETWORK (PERSON_ID);

CREATE UNIQUE INDEX HOMEPAGE.COLL_PERSON_IDX 
	ON HOMEPAGE.NR_NETWORK (COLLEAGUE_ID, PERSON_ID);

CREATE UNIQUE INDEX HOMEPAGE.NR_NETWORK_PER_COL_IDX
	ON HOMEPAGE.NR_NETWORK (PERSON_ID, COLLEAGUE_ID);	

-----------------------------------------
-- HOMEPAGE.EMD_RESOURCE_PREF
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_RESOURCE_PREF (
	RESOURCE_PREF_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,
	RESOURCE_TYPE SMALLINT NOT NULL,
	FREQUENCY_TYPE SMALLINT NOT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF 
  	ADD CONSTRAINT HOMEPAGE.PK_RES_PREF_ID PRIMARY KEY(RESOURCE_PREF_ID);

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF
    ADD CONSTRAINT HOMEPAGE.FK_RES_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF ADD CONSTRAINT HOMEPAGE.FK_EMD_RES_PREF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.EMD_RES_PREF_PER_ID
    ON HOMEPAGE.EMD_RESOURCE_PREF (PERSON_ID);

CREATE UNIQUE INDEX HOMEPAGE.EMD_RESOURCE_PREF_UNQ
	ON HOMEPAGE.EMD_RESOURCE_PREF (PERSON_ID, RESOURCE_TYPE);    

CREATE INDEX HOMEPAGE.NR_EMD_RES_PRF_PER_FRQ_RES_IDX 
	ON HOMEPAGE.EMD_RESOURCE_PREF (PERSON_ID, FREQUENCY_TYPE, RESOURCE_TYPE);

-----------------------------------------
-- HOMEPAGE.EMD_TRANCHE
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_TRANCHE (
	TRANCHE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SEQ_NUMBER SMALLINT NOT NULL,
	LAST_PROCESSED_DAILY TIMESTAMP,
	LAST_PROCESSED_WEEKLY TIMESTAMP,
	IS_LOCKED SMALLINT NOT NULL,
	IS_LOCKED_DAILY SMALLINT NOT NULL DEFAULT 0,
	IS_LOCKED_WEEKLY SMALLINT NOT NULL DEFAULT 0,
	LAST_STARTED_DAILY TIMESTAMP,
	LAST_STARTED_WEEKLY TIMESTAMP,
	LAST_EXEC_TIME_DAILY_MIN INTEGER,
	LAST_EXEC_TIME_WEEKLY_MIN INTEGER,
	LAST_RUNNER_DAILY VARCHAR(256) CCSID 1208,
	LAST_RUNNER_WEEKLY VARCHAR(256) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.EMD_TRANCHE 
  	ADD CONSTRAINT HOMEPAGE.PK_TRANCHE_ID PRIMARY KEY(TRANCHE_ID);

CREATE UNIQUE INDEX HOMEPAGE.SEQ_NUMBER_UNIQUE
    ON HOMEPAGE.EMD_TRANCHE (SEQ_NUMBER, ORGANIZATION_ID); 
	
ALTER TABLE HOMEPAGE.EMD_TRANCHE ADD CONSTRAINT HOMEPAGE.FK_EMD_TRANCHE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);


-----------------------------------------
-- HOMEPAGE.EMD_TRANCHE_INFO
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_TRANCHE_INFO (
	TRANCHE_INFO_ID VARCHAR(36) CCSID 1208 NOT NULL,
	TRANCHE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	COUNT_PROCESSED_DAILY SMALLINT,
	COUNT_PROCESSED_WEEKLY SMALLINT,
	AVG_EXEC_TIME_DAILY_MIN SMALLINT,
	AVG_EXEC_TIME_WEEKLY_MIN SMALLINT,
	DOMAIN_AFFINITY CLOB CCSID 1208,
	N_USERS INTEGER,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO
  	ADD CONSTRAINT HOMEPAGE.PK_TRC_INFO_ID PRIMARY KEY(TRANCHE_INFO_ID);

ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO
    ADD CONSTRAINT HOMEPAGE.FK_TRANCHE_ID FOREIGN KEY (TRANCHE_ID)
	REFERENCES HOMEPAGE.EMD_TRANCHE (TRANCHE_ID);	 	

ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO ADD CONSTRAINT HOMEPAGE.FK_EMD_TRANCHE_INFO_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

-----------------------------------------
-- HOMEPAGE.EMD_EMAIL_PREFS
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_EMAIL_PREFS (
	EMAIL_PREFS_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SEND_DIRECTED SMALLINT,
	TRANCHE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	EMAIL_ADDRESS VARCHAR(256) CCSID 1208,
	LANG VARCHAR(36) CCSID 1208,
	USE_TEXT_EMAIL SMALLINT,
	REPLYTO_ENABLED SMALLINT NOT NULL DEFAULT 1,
	TIMEZONE VARCHAR(255) CCSID 1208 DEFAULT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS 
  	ADD CONSTRAINT HOMEPAGE.PK_EMAIL_PREFS_ID PRIMARY KEY(EMAIL_PREFS_ID);

ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS
    ADD CONSTRAINT HOMEPAGE.FK_EMD_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS ADD CONSTRAINT HOMEPAGE.FK_EMD_EMAIL_PREFS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE UNIQUE INDEX HOMEPAGE.EMD_EMAIL_PREFS_PER
    ON HOMEPAGE.EMD_EMAIL_PREFS (PERSON_ID);
    
CREATE INDEX HOMEPAGE.EMD_EMAIL_PREFS_TR
    ON HOMEPAGE.EMD_EMAIL_PREFS (TRANCHE_ID);    

------------------------------
-- NR_COMM_PERSON_FOLLOW
------------------------------
CREATE TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW (
	COMM_PERSON_FOLLOW_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_COMMUNITY_ID VARCHAR(39) CCSID 1208 NOT NULL,
	IS_READER_COMM SMALLINT DEFAULT 0 NOT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
)
;

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
    ADD CONSTRAINT HOMEPAGE.PK_COMM_PER_ID PRIMARY KEY(COMM_PERSON_FOLLOW_ID);

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
    ADD CONSTRAINT HOMEPAGE.FK_COMM_PER_PER_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW ADD CONSTRAINT HOMEPAGE.FK_COMM_PERSON_FOLLOW_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
    ADD CONSTRAINT HOMEPAGE.UNIQUE_PERS_P_COMM UNIQUE (PERSON_ID, PERSON_COMMUNITY_ID);	

CREATE INDEX HOMEPAGE.NR_COMM_PER_FOLLOW_PER_ID
    ON HOMEPAGE.NR_COMM_PERSON_FOLLOW (PERSON_ID);

CREATE INDEX HOMEPAGE.NR_COMM_FOLLOW_COM_PER_ID
    ON HOMEPAGE.NR_COMM_PERSON_FOLLOW (PERSON_COMMUNITY_ID);
    
-- 108309: CR3 - Improve per. for the 5th most expensive query
CREATE INDEX HOMEPAGE.NR_COMM_PERSON_F 
	ON HOMEPAGE.NR_COMM_PERSON_FOLLOW (PERSON_ID, IS_READER_COMM, PERSON_COMMUNITY_ID);    

    
----------------------------------------------------------------
-- HOMEPAGE.NR_ENTRIES
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES (
	ENTRY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	CONTAINER_NAME VARCHAR(256) CCSID 1208,
	CONTAINER_URL VARCHAR(2048) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ITEM_NAME VARCHAR(256) CCSID 1208,
	ITEM_URL VARCHAR(2048) CCSID 1208,
	ITEM_CREATION_DATE TIMESTAMP,
	ITEM_UPDATE_DATE TIMESTAMP,
	ITEM_TAGS VARCHAR(1024) CCSID 1208,
	N_COMMENTS INTEGER DEFAULT NULL,
	N_RECOMMANDATIONS INTEGER DEFAULT NULL,
	LAST_COMMENT_ID VARCHAR(256) CCSID 1208,
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_AUTHOR_COMMENT VARCHAR(36) CCSID 1208,
	PREV_COMMENT_ID VARCHAR(256) CCSID 1208,
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_AUTHOR_COMMENT VARCHAR(36) CCSID 1208,
	ITEM_ATOM_URL VARCHAR(2048) CCSID 1208,
	PREVIEW_IMAGE_URL VARCHAR(2048) CCSID 1208,
	JSON_META_DATA CLOB CCSID 1208,
	ITEM_SCOPE SMALLINT,
	IS_LAST_COMMENT_PUBLIC SMALLINT,
	IS_PREV_COMMENT_PUBLIC SMALLINT,
	ITEM_CORRELATION_ID VARCHAR(256) CCSID 1208,
	ITEM_CORRELATION_NAME VARCHAR(256) CCSID 1208,
	LAST_DESC_COMMENT VARCHAR(4000) CCSID 1208,
	PREV_DESC_COMMENT VARCHAR(4000) CCSID 1208,
	LAST_UPDATE_DATE_COMMENT TIMESTAMP,
	PREV_UPDATE_DATE_COMMENT TIMESTAMP,
	ITEM_AUTHOR_UUID VARCHAR(256) CCSID 1208,
	ITEM_CORRELATION_AUTHOR_UUID VARCHAR(256) CCSID 1208,
	BRIEF_DESC VARCHAR(4000) CCSID 1208,
	ITEM_CORRELATION_BRIEF_DESC VARCHAR(4000) CCSID 1208,
	IS_LAST_COMMENT_VISIBLE SMALLINT DEFAULT 1,
	IS_PREV_COMMENT_VISIBLE SMALLINT DEFAULT 1,
	LAST_UPDATE_RECORD TIMESTAMP,
	PREV_COMMENT_NUM_REC INTEGER DEFAULT NULL,
	LAST_COMMENT_NUM_REC INTEGER DEFAULT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	PREV_COMMENT_OBJECT_META_DATA CLOB CCSID 1208,
	LAST_COMMENT_OBJECT_META_DATA CLOB CCSID 1208,
	LAST_COMMENT_TAGS VARCHAR(1024) CCSID 1208,
	PREV_COMMENT_TAGS VARCHAR(1024) CCSID 1208,
	IS_EXTERNAL SMALLINT DEFAULT 0 NOT NULL,
	ITEM_CORRELATION_CREATION_DATE TIMESTAMP
)
;

ALTER TABLE HOMEPAGE.NR_ENTRIES
    ADD CONSTRAINT HOMEPAGE.PK_ENTRY_ID PRIMARY KEY(ENTRY_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES ADD CONSTRAINT HOMEPAGE.FK_ENTRIES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_CONT
    ON HOMEPAGE.NR_ENTRIES (CONTAINER_ID);

CREATE UNIQUE INDEX HOMEPAGE.NR_ENTRIES_ITEMORG
    ON HOMEPAGE.NR_ENTRIES (ITEM_ID, ORGANIZATION_ID);


COMMIT;

----------------------------------------------------------------
-- HOMEPAGE.NR_STORIES
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_STORIES (
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	EVENT_NAME VARCHAR(256) CCSID 1208 NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208,
	CONTAINER_ID VARCHAR(256) CCSID 1208,	
	CONTAINER_NAME VARCHAR(256) CCSID 1208,
	CONTAINER_URL VARCHAR(2048) CCSID 1208,
	CONTAINER_ATOM_URL VARCHAR(2048) CCSID 1208,
	ITEM_NAME VARCHAR(256) CCSID 1208,
	ITEM_URL VARCHAR(2048) CCSID 1208,
	ITEM_ATOM_URL VARCHAR(2048) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ITEM_CORRELATION_ID VARCHAR(256) CCSID 1208,
	ITEM_CORRELATION_SCOPE SMALLINT,
	ITEM_CORRELATION_UPDATE_DATE TIMESTAMP,
	ITEM_CORRELATION_URL VARCHAR(2048) CCSID 1208,
	CREATION_DATE TIMESTAMP NOT NULL,
	BRIEF_DESC VARCHAR(4000) CCSID 1208,
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	EVENT_RECORD_UUID VARCHAR(36) CCSID 1208 NOT NULL,
	TAGS VARCHAR(1024) CCSID 1208,
	META_TEMPLATE VARCHAR(3328) CCSID 1208 DEFAULT '' NOT NULL,
	TEXT_META_TEMPLATE VARCHAR(1024) CCSID 1208,
	R_META_TEMPLATE VARCHAR(3328) CCSID 1208,
	R_TEXT_META_TEMPLATE VARCHAR(1024) CCSID 1208,
	IS_COMMUNITY_STORY SMALLINT DEFAULT 0,
	ITEM_CORRELATION_NAME VARCHAR(256) CCSID 1208,
	HAS_ATTACHMENT SMALLINT DEFAULT 0,
	SOURCE_TYPE SMALLINT,
	ENTRY_ID VARCHAR(36) CCSID 1208,
	EVENT_TIME TIMESTAMP,
	VERB VARCHAR(128) CCSID 1208,
	ITEM_SCOPE SMALLINT,
	ITEM_UPDATE_DATE TIMESTAMP,
	FIRST_RECIPIENT_ID VARCHAR(36) CCSID 1208,
	NUM_RECIPIENTS SMALLINT, 
	PRIMARY_ACTION_URL VARCHAR(768) CCSID 1208, 
	SECONDARY_ACTION_URL VARCHAR(768) CCSID 1208,
	ITEM_AUTHOR_UUID VARCHAR(256) CCSID 1208,
	ITEM_CORRELATION_AUTHOR_UUID VARCHAR(256) CCSID 1208,
	EVENT_SCOPE SMALLINT,
	RELATED_COMMUNITY_ID VARCHAR(39) CCSID 1208,
	ENTRY_CORRELATION_ID VARCHAR(256) CCSID 1208,
	ITEM_CORRELATION_ATOM_URL VARCHAR(2048) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ITEM_CREATION_DATE TIMESTAMP,
	ITEM_CORRELATION_CREATION_DATE TIMESTAMP
)
;

ALTER TABLE HOMEPAGE.NR_STORIES
    ADD CONSTRAINT HOMEPAGE.PK_STORY_ID PRIMARY KEY(STORY_ID);

ALTER TABLE HOMEPAGE.NR_STORIES
  	ADD CONSTRAINT HOMEPAGE.FK_ENTRY_ID FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.NR_ENTRIES (ENTRY_ID);    

ALTER TABLE HOMEPAGE.NR_STORIES ADD CONSTRAINT HOMEPAGE.FK_STORIES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.NR_STORIES_DATE
	ON HOMEPAGE.NR_STORIES (CREATION_DATE DESC);

CREATE INDEX HOMEPAGE.STORY_CONTAINED_ID
    ON HOMEPAGE.NR_STORIES (CONTAINER_ID);

CREATE INDEX HOMEPAGE.STORIES_ITEM_CORR_ID
    ON HOMEPAGE.NR_STORIES (ITEM_CORRELATION_ID, ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.NR_STORIES_EIDX
    ON HOMEPAGE.NR_STORIES (ENTRY_ID);

CREATE INDEX  HOMEPAGE.NR_STORIES_ER_UUID 
	ON HOMEPAGE.NR_STORIES (EVENT_RECORD_UUID, STORY_ID);
    
CREATE INDEX HOMEPAGE.NR_STORY_CD_IDX 
	ON HOMEPAGE.NR_STORIES (CREATION_DATE ASC, STORY_ID);        

CREATE INDEX HOMEPAGE.STORIES_EVENT_ITEM_ACTOR_IDX ON
	HOMEPAGE.NR_STORIES (EVENT_NAME, ITEM_ID, ACTOR_UUID);

CREATE INDEX HOMEPAGE.STORIES_ITEM_ID_IX 
	ON HOMEPAGE.NR_STORIES (ITEM_ID);
	
CREATE INDEX HOMEPAGE.NR_STORIES_REL_COMM
	ON HOMEPAGE.NR_STORIES (RELATED_COMMUNITY_ID);	

CREATE INDEX HOMEPAGE.STORIES_ITEM_ENTRY_CORR_ID
    ON HOMEPAGE.NR_STORIES (ENTRY_CORRELATION_ID, ORGANIZATION_ID);	

COMMIT;

----------------------------------------------------------------
-- HOMEPAGE.NR_ENTRIES_ARCHIVE
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE (
	ENTRY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	CONTAINER_NAME VARCHAR(256) CCSID 1208,
	CONTAINER_URL VARCHAR(2048) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ITEM_NAME VARCHAR(256) CCSID 1208,
	ITEM_URL VARCHAR(2048) CCSID 1208,
	ITEM_CREATION_DATE TIMESTAMP,
	ITEM_UPDATE_DATE TIMESTAMP,
	ITEM_TAGS VARCHAR(1024) CCSID 1208,
	N_COMMENTS SMALLINT DEFAULT NULL,
	N_RECOMMANDATIONS SMALLINT DEFAULT NULL,
	LAST_COMMENT_ID VARCHAR(256) CCSID 1208,
	LAST_DATE_COMMENT TIMESTAMP,
	LAST_AUTHOR_COMMENT VARCHAR(36) CCSID 1208,
	PREV_COMMENT_ID VARCHAR(256) CCSID 1208,
	PREV_DATE_COMMENT TIMESTAMP,
	PREV_AUTHOR_COMMENT VARCHAR(36) CCSID 1208,
	ITEM_ATOM_URL VARCHAR(2048) CCSID 1208,
	PREVIEW_IMAGE_URL VARCHAR(2048) CCSID 1208,
	JSON_META_DATA CLOB CCSID 1208,
	ITEM_SCOPE SMALLINT,
	IS_LAST_COMMENT_PUBLIC SMALLINT,
	IS_PREV_COMMENT_PUBLIC SMALLINT,
	ITEM_CORRELATION_ID VARCHAR(256) CCSID 1208,
	ITEM_CORRELATION_NAME VARCHAR(256) CCSID 1208,
	LAST_DESC_COMMENT VARCHAR(4000) CCSID 1208,
	PREV_DESC_COMMENT VARCHAR(4000) CCSID 1208,
	LAST_UPDATE_DATE_COMMENT TIMESTAMP,
	PREV_UPDATE_DATE_COMMENT TIMESTAMP,
	ITEM_AUTHOR_UUID VARCHAR(256) CCSID 1208,
	ITEM_CORRELATION_AUTHOR_UUID VARCHAR(256) CCSID 1208,
	BRIEF_DESC VARCHAR(4000) CCSID 1208,
	ITEM_CORRELATION_BRIEF_DESC VARCHAR(4000) CCSID 1208,
	IS_LAST_COMMENT_VISIBLE SMALLINT DEFAULT 1,
	IS_PREV_COMMENT_VISIBLE SMALLINT DEFAULT 1,
	LAST_UPDATE_RECORD TIMESTAMP,
	PREV_COMMENT_NUM_REC INTEGER DEFAULT NULL,
	LAST_COMMENT_NUM_REC INTEGER DEFAULT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	PREV_COMMENT_OBJECT_META_DATA CLOB CCSID 1208,
	LAST_COMMENT_OBJECT_META_DATA CLOB CCSID 1208,
	LAST_COMMENT_TAGS VARCHAR(1024) CCSID 1208,
	PREV_COMMENT_TAGS VARCHAR(1024) CCSID 1208,
	IS_EXTERNAL SMALLINT DEFAULT 0 NOT NULL,
	ITEM_CORRELATION_CREATION_DATE TIMESTAMP
)
;

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
    ADD CONSTRAINT HOMEPAGE.PK_ENTRY_AR_ID PRIMARY KEY(ENTRY_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE ADD CONSTRAINT HOMEPAGE.FK_ENTRIES_ARCHIVE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.NR_ENTRIES_AR_CONT
    ON HOMEPAGE.NR_ENTRIES_ARCHIVE (CONTAINER_ID);

CREATE UNIQUE INDEX HOMEPAGE.NR_ENTRIES_AR_ITEM
    ON HOMEPAGE.NR_ENTRIES_ARCHIVE (ITEM_ID);

COMMIT;

----------------------------------------------------------------------
-- HOMEPAGE.NR_AGGREGATED_READERS 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AGGREGATED_READERS (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208 DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR(256) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208
)
;

ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS
    ADD CONSTRAINT HOMEPAGE.PK_AGG_READERS PRIMARY KEY(CATEGORY_READER_ID);

ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS 
	ADD CONSTRAINT HOMEPAGE.FK_AGG_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);    

ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS ADD CONSTRAINT HOMEPAGE.FK_AGG_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

--  [start indexes] NR_AGGREGATED_READERS
CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_STR_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (STORY_ID); 


CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_ITM_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (ITEM_ID); 


CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_CD_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (STORY_ID, CREATION_DATE DESC); 


CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE INDEX HOMEPAGE.AGGREGATED_READERS_STR_RDR 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (STORY_ID, READER_ID, CONTAINER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (CREATION_DATE DESC, IS_BROADCAST);
COMMIT;

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC);
COMMIT;

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_RLL_BRD_VVI 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE);
COMMIT;

CREATE  INDEX HOMEPAGE.AGGREGATED_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (COMMUNITY_ID);
COMMIT;

CREATE INDEX HOMEPAGE.MPM_AGG_READERS_1B 
	ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, USE_IN_ROLLUP, ORGANIZATION_ID, CREATION_DATE, SOURCE_TYPE);
COMMIT;

--  [end indexes] NR_AGGREGATED_READERS

--------------------------------------------------------------------------
-- 11) HOMEPAGE.NR_STATUS_UPDATE_READERS
--------------------------------------------------------------------------	
CREATE TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
   	CONSTRAINT  HOMEPAGE.CK_CAT11_TYPE
    			CHECK
    			(CATEGORY_TYPE = 11)
);

ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS 
    ADD CONSTRAINT HOMEPAGE.PK_SU_READERS PRIMARY KEY(CATEGORY_READER_ID);

ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS
	ADD CONSTRAINT HOMEPAGE.FK_STA_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);
	
ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS ADD CONSTRAINT HOMEPAGE.FK_SU_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
	
--  [start indexes] NR_STATUS_UPDATE_READERS
CREATE  INDEX HOMEPAGE.STATUS_READERS_STR_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.STATUS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.STATUS_READERS_CD_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.STATUS_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE  INDEX HOMEPAGE.STATUS_READERS_STR_RDR 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.STATUS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (CREATION_DATE DESC, IS_STORY_COMM); 
COMMIT;

CREATE  INDEX HOMEPAGE.STATUS_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.STATUS_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;


CREATE  INDEX HOMEPAGE.STATUS_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_STATUS_UPDATE_READERS

---------------------------------------------------------
-- 12) ADDING A NR_EXTERNAL_READERS READER TABLE
---------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_EXTERNAL_READERS (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208 DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
   	CONSTRAINT  HOMEPAGE.CK_CAT12_TYPE
    			CHECK
    			(CATEGORY_TYPE = 12)
);

ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS 
    ADD CONSTRAINT HOMEPAGE.PK_EXT_READERS PRIMARY KEY(CATEGORY_READER_ID);

ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS
	ADD CONSTRAINT HOMEPAGE.FK_EXT_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);
	
ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS ADD CONSTRAINT HOMEPAGE.FK_EXT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
	
--  [start indexes] NR_EXTERNAL_READERS
CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_STR_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_ITM_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_CD_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE INDEX HOMEPAGE.EXTERNAL_READERS_STR_RDR 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;


CREATE  INDEX HOMEPAGE.EXTERNAL_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_EXTERNAL_READERS


---------------------------------------------------------
-- 13-16) ADDING NR_ACTIONABLE_READERS READER TABLE
---------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ACTIONABLE_READERS (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208 DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	OPERATION_ID VARCHAR(512) CCSID 1208,
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
	CONSTRAINT   	HOMEPAGE.CK_CAT_ACTION_TYPE
    				CHECK
    				(CATEGORY_TYPE >= 14 AND CATEGORY_TYPE <= 16)	
);

ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS 
    ADD CONSTRAINT HOMEPAGE.PK_ACTION_READERS PRIMARY KEY (CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS
	ADD CONSTRAINT HOMEPAGE.FK_ACT_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);    

ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS ADD CONSTRAINT HOMEPAGE.FK_ACT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
--  [start indexes] NR_ACTIONABLE_READERS
CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_STR_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_ITM_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_CD_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE INDEX HOMEPAGE.ACTIONABLE_READERS_STR_RDR 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_RLL_BRD_VVI
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;


CREATE  INDEX HOMEPAGE.ACTIONABLE_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_ACTIONABLE_READERS


--ALTER VIEW HOMEPAGE.NR_FOLLOWED_STORIES ENABLE QUERY OPTIMIZATION;

-------------------------------------------------------
-- 1) HOMEPAGE.BOARD
-------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD  (
	BOARD_ID VARCHAR(256) CCSID 1208 NOT NULL,
	BOARD_CONTAINER_ID VARCHAR(256) CCSID 1208 NOT NULL,
	BOARD_TYPE VARCHAR(64) CCSID 1208 NOT NULL,
	BOARD_OWNER_ASSOC_ID VARCHAR(36) CCSID 1208 NOT NULL,
	BOARD_OWNER_ASSOC_TYPE VARCHAR(64) CCSID 1208 NOT NULL,
	CREATED TIMESTAMP NOT NULL,
	CREATED_BY VARCHAR(36) CCSID 1208 NOT NULL,
	LASTUPDATE TIMESTAMP NOT NULL,
	LASTUPDATE_BY VARCHAR(36) CCSID 1208 NOT NULL,
	IS_ENABLED SMALLINT DEFAULT 1 NOT NULL,
	VISIBILITY VARCHAR(36) CCSID 1208,
	EDITABILITY VARCHAR(36) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208
);

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT HOMEPAGE.BOARD_PK PRIMARY KEY (BOARD_ID); 

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT HOMEPAGE.FK_BRD_OWNER FOREIGN KEY (BOARD_OWNER_ASSOC_ID) 
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT HOMEPAGE.FK_BRD_CREATED FOREIGN KEY (CREATED_BY) 
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);	

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT HOMEPAGE.FK_BRD_LASTUPDATE FOREIGN KEY (LASTUPDATE_BY) 
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
	
ALTER TABLE HOMEPAGE.BOARD ADD CONSTRAINT HOMEPAGE.FK_BOARD_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);	

CREATE UNIQUE INDEX HOMEPAGE.BOARD_OWNER_ASSOC_UIDX 
	ON HOMEPAGE.BOARD (BOARD_OWNER_ASSOC_ID ASC, BOARD_TYPE ASC);

ALTER TABLE HOMEPAGE.BOARD
	ADD CONSTRAINT HOMEPAGE.CONTAINER_ID_UNQ UNIQUE (BOARD_CONTAINER_ID);
	
CREATE UNIQUE INDEX HOMEPAGE.BRD_CONTAINER_ID_UIDX 
	ON HOMEPAGE.BOARD (BOARD_CONTAINER_ID);
	
--------------------------------------
-- HOMEPAGE.BOARD_ENTRIES to store the relationship between a reader and a status update
--------------------------------------
CREATE TABLE HOMEPAGE.BOARD_ENTRIES  (
	ENTRY_ID VARCHAR(47) CCSID 1208 NOT NULL, -- the format will include in the pk also the creation time
	ENTRY_TYPE SMALLINT,
	CATEGORY_TYPE SMALLINT,
	SOURCE VARCHAR(36) CCSID 1208,
	SOURCE_TYPE SMALLINT,
	ITEM_ID VARCHAR(36) CCSID 1208 NOT NULL,
	ITEM_URL VARCHAR(2048) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	CREATION_DATE TIMESTAMP NOT NULL, -- used also by the seedlist, when something is created the update is equal to is created
	UPDATE_DATE TIMESTAMP NOT NULL, -- this field is used and queried from the the seedlist for initial and incremental index
	ACTOR_UUID VARCHAR(36) CCSID 1208,
	IS_COMMUNITY_STORY SMALLINT DEFAULT 0,
	TARGET_SUBJECT_ID VARCHAR(256) CCSID 1208,
	TAGS VARCHAR(1024) CCSID 1208,
	SL_IS_UPDATED SMALLINT NOT NULL DEFAULT 0, -- this field is used by the seedlist
	SL_IS_DELETED SMALLINT NOT NULL DEFAULT 0, -- this field is used by the seedlist
	SL_UPDATE_DATE TIMESTAMP NOT NULL, -- this field is used by the seedlist
	LAST_CONTRIBUTOR_ID VARCHAR(36) CCSID 1208,
	CONTENT_LOCALE  VARCHAR(5) CCSID 1208,
	HTML_CONTENT CLOB CCSID 1208,
	CONTENT CLOB CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208,
	CREATION_DATE_DISPLAY TIMESTAMP,
	UPDATE_DATE_DISPLAY TIMESTAMP,
	ACTOR_UUID_DISPLAY VARCHAR(36) CCSID 1208,
	LAST_CONTRIBUTOR_ID_DISPLAY VARCHAR(36) CCSID 1208
);

ALTER TABLE HOMEPAGE.BOARD_ENTRIES 
    ADD CONSTRAINT HOMEPAGE.PK_BRD_ENTRIES PRIMARY KEY(ENTRY_ID);

ALTER TABLE HOMEPAGE.BOARD_ENTRIES
	ADD CONSTRAINT HOMEPAGE.FK_CONTAINER_ID FOREIGN KEY (CONTAINER_ID) 
	REFERENCES HOMEPAGE.BOARD (BOARD_CONTAINER_ID); 
	
ALTER TABLE HOMEPAGE.BOARD_ENTRIES ADD CONSTRAINT HOMEPAGE.FK_BOARD_ENTRIES_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.NEWS_BRD_SL_UPDATE
    ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC);

CREATE UNIQUE INDEX HOMEPAGE.ITEM_ID_IDX
   ON HOMEPAGE.BOARD_ENTRIES (ITEM_ID ASC,CONTAINER_ID);

CREATE INDEX HOMEPAGE.CREATION_ITEM_IDX 
	ON HOMEPAGE.BOARD_ENTRIES (CREATION_DATE_DISPLAY DESC, ITEM_ID DESC);

CREATE INDEX HOMEPAGE.BRD_E_CONTAINER_ID_UIDX 
	ON HOMEPAGE.BOARD_ENTRIES (CONTAINER_ID);

CREATE INDEX HOMEPAGE.BRD_SL_UPDATED_DEL 
	ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC, SL_IS_DELETED);
	
CREATE INDEX HOMEPAGE.BRD_ENTRIES_ITEM
	ON HOMEPAGE.BOARD_ENTRIES (ITEM_ID, SL_IS_DELETED);	
	
CREATE INDEX HOMEPAGE.SEEDLIST_BRD_IDX 
	ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC, ENTRY_ID);
	
CREATE INDEX HOMEPAGE.BRD_IS_DEL_CDATE_ACT_ENT
	ON HOMEPAGE.BOARD_ENTRIES (SL_IS_DELETED, CREATION_DATE DESC, ACTOR_UUID, ENTRY_TYPE);	

COMMIT;

--------------------------------------
-- HOMEPAGE.BOARD_COMMENTS to store the comments
--------------------------------------
CREATE TABLE HOMEPAGE.BOARD_COMMENTS  (
	COMMENT_ID VARCHAR(47) CCSID 1208 NOT NULL, -- the format will include in the pk also the creation time
	ACTOR_UUID VARCHAR(36) CCSID 1208,
	CREATION_DATE TIMESTAMP NOT NULL,
	ITEM_ID VARCHAR(47) CCSID 1208,
	ENTRY_ID VARCHAR(47) CCSID 1208,
	ITEM_URL VARCHAR(2048) CCSID 1208,	
	UPDATE_DATE TIMESTAMP,
	LAST_CONTRIBUTOR_ID VARCHAR(36) CCSID 1208,
	CONTENT_LOCALE VARCHAR(5) CCSID 1208,
	PUBLISHED_ORDER INTEGER,
	TAGS VARCHAR(1024) CCSID 1208,
	HTML_CONTENT CLOB CCSID 1208,
	CONTENT CLOB CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208,
	AUTHOR_UUID_DISPLAY VARCHAR(36) CCSID 1208,
	LAST_CONTRIBUTOR_ID_DISPLAY VARCHAR(36) CCSID 1208,
	CREATION_DATE_DISPLAY TIMESTAMP,
	UPDATE_DATE_DISPLAY TIMESTAMP
);

ALTER TABLE HOMEPAGE.BOARD_COMMENTS 
    ADD CONSTRAINT HOMEPAGE.PK_BRD_COMMENT_ID PRIMARY KEY(COMMENT_ID);

ALTER TABLE HOMEPAGE.BOARD_COMMENTS
	ADD CONSTRAINT HOMEPAGE.FK_BRD_COM_ENTRY FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.BOARD_ENTRIES (ENTRY_ID);

ALTER TABLE HOMEPAGE.BOARD_COMMENTS  ADD CONSTRAINT HOMEPAGE.FK_BOARD_COMMENTS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.NEWS_BRD_ITEM_ID
    ON HOMEPAGE.BOARD_COMMENTS  (ITEM_ID);

CREATE INDEX HOMEPAGE.NEWS_BRD_ITEM_CORR_ID
    ON HOMEPAGE.BOARD_COMMENTS  (ENTRY_ID);

CREATE INDEX HOMEPAGE.CREATION_DATE_IDX 
	ON HOMEPAGE.BOARD_COMMENTS (CREATION_DATE ASC);
	
CREATE INDEX HOMEPAGE.ITEM_CORR_CREATION_IDX 
	ON HOMEPAGE.BOARD_COMMENTS (ENTRY_ID, CREATION_DATE ASC);
	
CREATE INDEX HOMEPAGE.ITEM_ITEM_CORR_IDX
	ON HOMEPAGE.BOARD_COMMENTS (ITEM_ID ASC, ENTRY_ID ASC);	

CREATE UNIQUE INDEX HOMEPAGE.BRD_COMM_ITEM_COR_PUB
    ON HOMEPAGE.BOARD_COMMENTS (ENTRY_ID, PUBLISHED_ORDER ASC);
    
CREATE INDEX HOMEPAGE.CREATION_DATE_ITEM_IDX
	ON HOMEPAGE.BOARD_COMMENTS (CREATION_DATE ASC, ITEM_ID);
    
	
COMMIT;

----------------------------------------------------------------
-- ADDING BOARD_OBJECT_REFERENCE
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE (
	OBJECT_ID VARCHAR(47) CCSID 1208 NOT NULL,
	ITEM_ID VARCHAR(47) CCSID 1208 NOT NULL,
	DISPLAY_NAME VARCHAR(2048) CCSID 1208,
	IMAGE_NAME   VARCHAR(2048) CCSID 1208,
	NAME VARCHAR(512) CCSID 1208, 
	URL VARCHAR(1024) CCSID 1208, 
	CONTENT VARCHAR(4000) CCSID 1208,
	IMAGE_URL VARCHAR(1024) CCSID 1208,
	SOURCE  VARCHAR(36) CCSID 1208,
	SOURCE_TYPE  SMALLINT,
	CREATION_DATE TIMESTAMP,
	TYPE VARCHAR(36) CCSID 1208,
	AUTHOR_ID VARCHAR(36) CCSID 1208,
	AUTHOR_DISPLAY_NAME VARCHAR(256) CCSID 1208,
	OBJECT_META_DATA VARCHAR(4000) CCSID 1208,
	OBJECT_META_DATA_2 VARCHAR(4000) CCSID 1208,
	FULL_OBJECT_META_DATA CLOB CCSID 1208,
	OBJECT_EXTERNAL_ID VARCHAR(256) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208
);

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE 
    ADD CONSTRAINT HOMEPAGE.PK_BRD_OBJ_ID PRIMARY KEY(OBJECT_ID);

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE
	ADD CONSTRAINT HOMEPAGE.FK_BRD_AUTHOR_ID FOREIGN KEY (AUTHOR_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
	
ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE ADD CONSTRAINT HOMEPAGE.FK_BRD_OBJ_REFERENCE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	

CREATE INDEX HOMEPAGE.BRD_ENTRY_IDX
    ON HOMEPAGE.BOARD_OBJECT_REFERENCE (ITEM_ID);

CREATE INDEX HOMEPAGE.BRD_AUTHOR_IDX
    ON HOMEPAGE.BOARD_OBJECT_REFERENCE (AUTHOR_ID);     
	
COMMIT;

--------------------------------------
-- HOMEPAGE.BOARD_RECOMMANDATIONS to store the relationship between a board entries and something which has been recommended
---------------------------------------
CREATE TABLE HOMEPAGE.BOARD_RECOMMENDATIONS  (
	RECOMMENDATION_ID VARCHAR(47) CCSID 1208 NOT NULL, --primary key
	RECOMMENDER_ID VARCHAR(36) CCSID 1208 NOT NULL, -- PERSON_ID of the recommender, FK to PERSON table
	ITEM_ID VARCHAR(47) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT NOT NULL, 
	CREATION_DATE TIMESTAMP,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208,
	RECOMMENDER_ID_DISPLAY VARCHAR(36) CCSID 1208,
	CREATION_DATE_DISPLAY TIMESTAMP
);

ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS 
    ADD CONSTRAINT HOMEPAGE.PK_BRD_RECOMM_ID PRIMARY KEY(RECOMMENDATION_ID);
    
ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS
	ADD CONSTRAINT HOMEPAGE.FK_BRD_RECOMMENDER FOREIGN KEY (RECOMMENDER_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
	
ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS ADD CONSTRAINT HOMEPAGE.FK_BRD_RECOMM_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS
	ADD CONSTRAINT HOMEPAGE.FK_BRD_RECOMMENDER_D FOREIGN KEY (RECOMMENDER_ID_DISPLAY) REFERENCES HOMEPAGE.PERSON (PERSON_ID);	

--ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS
--	ADD CONSTRAINT FK_BRD_ENTRY_ID FOREIGN KEY (ENTRY_ID)
--	REFERENCES HOMEPAGE.BOARD_ENTRIES (ENTRY_ID);    

CREATE INDEX HOMEPAGE.BRD_REC_ITEM_ID
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (ITEM_ID);
    
CREATE UNIQUE INDEX HOMEPAGE.BRD_REC_RECOM_D_ITEM_ID
	ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID_DISPLAY, ITEM_ID);

CREATE INDEX HOMEPAGE.BRD_RECOMMENDER_ID
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID);
    
CREATE INDEX HOMEPAGE.BRD_RECOMMENDER_ID_D
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID_DISPLAY);    

COMMIT;

-------------------------------------------------------
-- HOMEPAGE.BOARD_CURRENT_STATUS 
-- table to store the history of current status updates
-------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_CURRENT_STATUS  (
	CURRENT_STATUS_ID VARCHAR(47) CCSID 1208 NOT NULL, -- the format will include in the pk also the creation time
	ACTOR_UUID VARCHAR(36) CCSID 1208 NOT NULL,
	ENTRY_ID VARCHAR(47) CCSID 1208 NOT NULL,
	CURRENT_STATUS_SET TIMESTAMP NOT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208
);

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS 
    ADD CONSTRAINT HOMEPAGE.PK_CUR_ST_ID PRIMARY KEY (CURRENT_STATUS_ID);

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS
	ADD CONSTRAINT HOMEPAGE.FK_CUR_ST_ACTOR_ID FOREIGN KEY (ACTOR_UUID)
	REFERENCES HOMEPAGE.PERSON(PERSON_ID);

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS
	ADD CONSTRAINT HOMEPAGE.FK_CUR_ST_ENTRY_ID FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.BOARD_ENTRIES(ENTRY_ID);
	
ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS ADD CONSTRAINT HOMEPAGE.FK_BOARD_CURRENT_STATUS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.CURRENT_STATUS_INDEX 
	ON HOMEPAGE.BOARD_CURRENT_STATUS	(ACTOR_UUID ASC, CURRENT_STATUS_SET ASC, CURRENT_STATUS_ID ASC, ENTRY_ID ASC);

CREATE UNIQUE INDEX HOMEPAGE.ACTOR_ENTRY 
	ON HOMEPAGE.BOARD_CURRENT_STATUS (ACTOR_UUID);

CREATE INDEX HOMEPAGE.BRD_CURRENT_STATUS 
	ON HOMEPAGE.BOARD_CURRENT_STATUS (ENTRY_ID);	

COMMIT;	

------------------------------------------------
-- HOMEPAGE.BOARD_MENTIONS
------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_MENTIONS  (
	BOARD_MENTIONS_ID VARCHAR(36) CCSID 1208 NOT NULL, --primary key
	ITEM_ID VARCHAR(256) CCSID 1208 NOT NULL, 
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL, -- PERSON_ID of the recommender, FK to PERSON table
	LABEL VARCHAR(4000) CCSID 1208,
	WAS_ITEM_VISIBLE SMALLINT DEFAULT 0 NOT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208
);

ALTER TABLE HOMEPAGE.BOARD_MENTIONS 
    ADD CONSTRAINT HOMEPAGE.PK_BRD_MEN_ID PRIMARY KEY(BOARD_MENTIONS_ID);

ALTER TABLE HOMEPAGE.BOARD_MENTIONS
	ADD CONSTRAINT HOMEPAGE.FK_BRD_MEN_PER_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
	
ALTER TABLE HOMEPAGE.BOARD_MENTIONS ADD CONSTRAINT HOMEPAGE.FK_BOARD_MENTIONS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.BRD_MEN_PER_IDX
	ON HOMEPAGE.BOARD_MENTIONS (PERSON_ID);
	
CREATE INDEX HOMEPAGE.BRD_MEN_ITEM_IDX
	ON HOMEPAGE.BOARD_MENTIONS (ITEM_ID);	
	
COMMIT;	

---------------------------------------------------------------------------------
-- ADDING QUARANTINE TABLE
---------------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.DELETED_STORIES_QUEUE (
	QUEUE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE 	VARCHAR(36) CCSID 1208 NOT NULL, -- this is externalized
	SOURCE_TYPE SMALLINT NOT NULL,
	STATUS SMALLINT NOT NULL DEFAULT 0,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
);

ALTER TABLE HOMEPAGE.DELETED_STORIES_QUEUE 
  	ADD CONSTRAINT HOMEPAGE.PK_QUARANTINE PRIMARY KEY(QUEUE_ID);
  	
ALTER TABLE HOMEPAGE.DELETED_STORIES_QUEUE ADD CONSTRAINT HOMEPAGE.FK_DEL_STORIES_QUEUE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
CREATE INDEX HOMEPAGE.DELETED_STORY_ID 
  	ON HOMEPAGE.DELETED_STORIES_QUEUE (STORY_ID);  	

COMMIT;
  	
-----------------------------------------------
-- HOMEPAGE.NR_COMM_SETTINGS
-----------------------------------------------

CREATE TABLE HOMEPAGE.NR_COMM_SETTINGS (
	COMM_ID VARCHAR(36) CCSID 1208 NOT NULL,
	MICROBLOGGING_WRITE_ACL SMALLINT,
	FLAGS VARCHAR(36) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
);

ALTER TABLE HOMEPAGE.NR_COMM_SETTINGS
    ADD CONSTRAINT HOMEPAGE.PK_COMM_ID PRIMARY KEY(COMM_ID);
    
ALTER TABLE HOMEPAGE.NR_COMM_SETTINGS ADD CONSTRAINT HOMEPAGE.FK_COMM_SETTINGS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

COMMIT;



-----------------------------------------------------
-- 18 NR_PROFILES_VIEW
-----------------------------------------------------
CREATE TABLE HOMEPAGE.NR_PROFILES_VIEW (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
	CONSTRAINT   	HOMEPAGE.CK_CAT18_TYPE
    				CHECK
    				(CATEGORY_TYPE = 18)
);

ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW 
    ADD CONSTRAINT HOMEPAGE.PK_PROFILES_VIEW PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW
	ADD CONSTRAINT HOMEPAGE.FK_PRO_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID); 
	
ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW ADD CONSTRAINT HOMEPAGE.FK_PRF_VIEW_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
--  [start indexes] NR_PROFILES_VIEW
CREATE  INDEX HOMEPAGE.PROFILES_VIEW_STR_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_ITM_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_CD_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_RLL_IIX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE  INDEX HOMEPAGE.PROFILES_VIEW_STR_RDR 
 	ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_DEL_SERV_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (CREATION_DATE DESC, IS_BROADCAST); 
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;

--NEW ORG_ID NR_PROFILES_VIEW 
CREATE  INDEX HOMEPAGE.PROFILES_VIEW_ORG_IIDX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ORGANIZATION_ID, IS_VISIBLE, IS_BROADCAST, ROLLUP_ENTRY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.PROFILES_VIEW_COMM_IDX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_PROFILES_VIEW

--------------------------------------------------------------------------
-- 19 HOMEPAGE.NR_NOTIFICATION_SENT_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
        CONSTRAINT   	HOMEPAGE.CK_CAT19_TYPE
    			CHECK
    			(CATEGORY_TYPE = 19)
);

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS 
    ADD CONSTRAINT HOMEPAGE.PK_SENT_NOT_READ PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS
	ADD CONSTRAINT HOMEPAGE.FK_NOT_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS ADD CONSTRAINT HOMEPAGE.FK_NOT_SENT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

--  [start indexes] NR_NOTIFICATION_SENT_READERS
CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_STR_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_ITM_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_CD_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE INDEX HOMEPAGE.NOTIFICA_READERS_STR_RDR 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;


CREATE  INDEX HOMEPAGE.NOTIFICA_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_NOTIFICATION_SENT_READERS

--------------------------------------------------------------------------
-- 20 HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
        CONSTRAINT   	HOMEPAGE.CK_CAT20_TYPE
    			CHECK
    			(CATEGORY_TYPE = 20)
);

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS 
    ADD CONSTRAINT HOMEPAGE.PK_REC_NOT_READ PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS
	ADD CONSTRAINT HOMEPAGE.FK_REC_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID); 

ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS ADD CONSTRAINT HOMEPAGE.FK_NOT_REC_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

--  [start indexes] NR_NOTIFICATION_RECEIV_READERS
CREATE  INDEX HOMEPAGE.NOT_REC_READERS_STR_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_ITM_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_CD_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (READER_ID, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_STR_RDR 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (ROLLUP_ENTRY_ID, READER_ID, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.NOT_REC_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;


CREATE  INDEX HOMEPAGE.NOT_REC_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_NOTIFICATION_RECEIV_READERS

--------------------------------------------------------------------------
-- 13 HOMEPAGE.NR_SAVED_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SAVED_READERS (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	OPERATION_ID VARCHAR(512) CCSID 1208,
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
	CONSTRAINT   	HOMEPAGE.CK_CAT_SAVED_TYPE
    				CHECK
    				(CATEGORY_TYPE = 13)	
);

ALTER TABLE HOMEPAGE.NR_SAVED_READERS 
    ADD CONSTRAINT HOMEPAGE.PK_SAVED_READERS PRIMARY KEY (CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_SAVED_READERS
	ADD CONSTRAINT HOMEPAGE.FK_SAV_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);  
	
ALTER TABLE HOMEPAGE.NR_SAVED_READERS ADD CONSTRAINT HOMEPAGE.FK_SAVED_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
    
--  [start indexes] NR_SAVED_READERS
CREATE  INDEX HOMEPAGE.SAVED_READERS_STR_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.SAVED_READERS_ITM_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.SAVED_READERS_CD_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.SAVED_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_SAVED_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE  INDEX HOMEPAGE.SAVED_READERS_STR_RDR 
 	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.SAVED_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.SAVED_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_SAVED_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.SAVED_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_SAVED_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;


CREATE  INDEX HOMEPAGE.SAVED_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_SAVED_READERS (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_SAVED_READERS

--------------------------------------------------------------------------
-- 21 HOMEPAGE.NR_TOPICS_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_TOPICS_READERS (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208  DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	ROLLUP_AUTHOR_ID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
	CONSTRAINT   	HOMEPAGE.CK_CAT_TOPICS_TYPE
    				CHECK
    				(CATEGORY_TYPE = 21)	
);

ALTER TABLE HOMEPAGE.NR_TOPICS_READERS 
    ADD CONSTRAINT HOMEPAGE.PK_TOPICS_READERS PRIMARY KEY (CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_TOPICS_READERS
	ADD CONSTRAINT HOMEPAGE.FK_TOP_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID); 
	
ALTER TABLE HOMEPAGE.NR_TOPICS_READERS ADD CONSTRAINT HOMEPAGE.FK_TOPICS_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

--  [start indexes] NR_TOPICS_READERS
CREATE  INDEX HOMEPAGE.TOPICS_READERS_STR_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.TOPICS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.TOPICS_READERS_CD_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.TOPICS_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_TOPICS_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE INDEX HOMEPAGE.TOPICS_READERS_STR_RDR 
 	ON HOMEPAGE.NR_TOPICS_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.TOPICS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.TOPICS_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_TOPICS_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.TOPICS_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_TOPICS_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;


CREATE  INDEX HOMEPAGE.TOPICS_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_TOPICS_READERS (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_TOPICS_READERS

----------------------------------------------------
-- 22 HOMEPAGE.NR_MENTIONS_READERS
----------------------------------------------------
CREATE TABLE HOMEPAGE.NR_MENTIONS_READERS (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208 DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
		CONSTRAINT   	HOMEPAGE.CK_CAT22_TYPE
    			CHECK
    			(CATEGORY_TYPE = 22)
);

ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS
    ADD CONSTRAINT HOMEPAGE.PK_MEN_READERS PRIMARY KEY(CATEGORY_READER_ID);

ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS 
	ADD CONSTRAINT HOMEPAGE.FK_MEN_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID); 
	
ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS ADD CONSTRAINT HOMEPAGE.FK_MENT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
--  [start indexes] NR_MENTIONS_READERS
CREATE  INDEX HOMEPAGE.MENTIONS_READERS_STR_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_CD_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE  INDEX HOMEPAGE.MENTIONS_READERS_STR_RDR 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.MENTIONS_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;


CREATE  INDEX HOMEPAGE.MENTIONS_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_MENTIONS_READERS

----------------------------------------------------
-- 23 HOMEPAGE.NR_COMMUNITIES_VIEW
----------------------------------------------------
CREATE TABLE HOMEPAGE.NR_COMMUNITIES_VIEW (
	CATEGORY_READER_ID VARCHAR(36) CCSID 1208 DEFAULT ' ' NOT NULL,
	READER_ID VARCHAR(39) CCSID 1208 NOT NULL,
	CATEGORY_TYPE SMALLINT NOT NULL,
	SOURCE VARCHAR(36) CCSID 1208 NOT NULL,
	CONTAINER_ID VARCHAR(256) CCSID 1208,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208,
	RESOURCE_TYPE SMALLINT NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	SOURCE_TYPE SMALLINT,
	USE_IN_ROLLUP SMALLINT,
	IS_NETWORK	SMALLINT,
	IS_FOLLOWER	SMALLINT,
	EVENT_TIME 	TIMESTAMP,
	IS_STORY_COMM SMALLINT,
	IS_BROADCAST SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID VARCHAR(256) CCSID 1208,
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL,
	ROLLUP_AUTHOR_ID VARCHAR (256) CCSID 1208,
	COMMUNITY_ID VARCHAR(36) CCSID 1208,
	ROLLUP_ACTION_TYPE VARCHAR(36) CCSID 1208,
		CONSTRAINT   	HOMEPAGE.CK_CAT23_TYPE
    			CHECK
    			(CATEGORY_TYPE = 23)
);

ALTER TABLE HOMEPAGE.NR_COMMUNITIES_VIEW
    ADD CONSTRAINT HOMEPAGE.PK_CV_READERS PRIMARY KEY(CATEGORY_READER_ID);

ALTER TABLE HOMEPAGE.NR_COMMUNITIES_VIEW 
	ADD CONSTRAINT HOMEPAGE.FK_CV_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID); 
	
ALTER TABLE HOMEPAGE.NR_COMMUNITIES_VIEW ADD CONSTRAINT HOMEPAGE.FK_CV_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

---  [start indexes] NR_COMMUNITIES_VIEW
CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_STR_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (STORY_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_ITM_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (ITEM_ID); 
COMMIT;

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_CD_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (STORY_ID, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_RLL_IIX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
COMMIT;

CREATE UNIQUE  INDEX HOMEPAGE.COMMUNITIES_VIEW_STR_RDR 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID);
COMMIT;

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_DEL_SERV_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE, CREATION_DATE DESC); 
COMMIT;

CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
COMMIT;


CREATE  INDEX HOMEPAGE.COMMUNITIES_VIEW_COMM_IDX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (COMMUNITY_ID); 
COMMIT;

--  [end indexes] NR_COMMUNITIES_VIEW



-----------------------------------------------------------------------
-- [START] SEEDLIST
-----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AS_SEEDLIST (
	SEEDLIST_ID VARCHAR(36) CCSID 1208 NOT NULL, -- pk which is not linked to any value
	IS_VISIBLE SMALLINT DEFAULT 1 NOT NULL, -- when an item id is moderated
	IS_DELETED SMALLINT DEFAULT 0 NOT NULL, -- when a story is moderated
	DATA VARCHAR(4000) CCSID 1208,
	FULL_DATA CLOB CCSID 1208, -- in case data is not enough big
	FOLLOWERS VARCHAR(4000) CCSID 1208,
	FULL_FOLLOWERS CLOB CCSID 1208, -- in case followers is not enough big
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
	ITEM_ID VARCHAR(256) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	COMMUNITY_ID VARCHAR(36) CCSID 1208
);

ALTER TABLE HOMEPAGE.NR_AS_SEEDLIST
	ADD CONSTRAINT HOMEPAGE.NR_SEEDLIST_PK PRIMARY KEY (SEEDLIST_ID);

ALTER TABLE HOMEPAGE.NR_AS_SEEDLIST ADD CONSTRAINT HOMEPAGE.FK_AS_SEEDLIST_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE UNIQUE INDEX HOMEPAGE.NR_SL_STR_UNIQUE
	ON HOMEPAGE.NR_AS_SEEDLIST(STORY_ID);	

CREATE INDEX HOMEPAGE.NR_SL_ITEM_ID_IX
	ON HOMEPAGE.NR_AS_SEEDLIST (ITEM_ID);

CREATE INDEX HOMEPAGE.NR_SL_UD_DELETED_VIS
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE DESC, IS_DELETED, IS_VISIBLE);
	
CREATE INDEX HOMEPAGE.NR_SL_UD_DELETED
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE DESC);
	
CREATE INDEX HOMEPAGE.NR_SL_CD_DELETED
	ON HOMEPAGE.NR_AS_SEEDLIST (CREATION_DATE DESC);	
	
CREATE INDEX HOMEPAGE.NR_SL_UD_STR
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE ASC, STORY_ID);
	
CREATE INDEX HOMEPAGE.NR_SL_VIS_DELETED_US_STR
	ON HOMEPAGE.NR_AS_SEEDLIST (IS_VISIBLE, IS_DELETED, UPDATE_DATE DESC, STORY_ID);
COMMIT;

CREATE INDEX HOMEPAGE.NR_AS_SEEDLIST_COMM_IDX
	ON HOMEPAGE.NR_AS_SEEDLIST (COMMUNITY_ID);
COMMIT;	
	
	
	
	
COMMIT;	


-----------------------------------------------------------------------
-- [END] SEEDLIST
-----------------------------------------------------------------------

------------------------------------------------
-- HOMEPAGE.NR_AS_COLLECTION_CONFIG
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AS_COLLECTION_CONFIG (
	COLLECTION_ID VARCHAR (50) CCSID 1208 NOT NULL,
	XML_DATA CLOB (51200) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.NR_AS_COLLECTION_CONFIG
	ADD CONSTRAINT HOMEPAGE.NR_AS_CONFIG_PK PRIMARY KEY (COLLECTION_ID);
	
COMMIT;

------------------------------------------------
-- HOMEPAGE.NR_AS_CRAWLER_STATUS
------------------------------------------------	
CREATE TABLE HOMEPAGE.NR_AS_CRAWLER_STATUS (
	COLLECTION_ID VARCHAR (50) CCSID 1208 NOT NULL,
	XML_DATA CLOB (51200) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.NR_AS_CRAWLER_STATUS
	ADD CONSTRAINT HOMEPAGE.NR_AS_STATUS_PK PRIMARY KEY (COLLECTION_ID);
	
	
COMMIT;

------------------------------------------------------------------------------
-- ADD NR_AS_CONTENT_INDEX_STATS TABLE
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS (
	STAT_ID VARCHAR(36) CCSID 1208 NOT NULL,
	STAT_NAME VARCHAR(2048) CCSID 1208,
	STAT_VALUE BLOB(3670016),
	STAT_UPDATE_DATE TIMESTAMP,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000'
);

ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS
  	ADD CONSTRAINT HOMEPAGE.NR_CONTENTSTATS_PK PRIMARY KEY(STAT_ID);
  	
ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS ADD CONSTRAINT HOMEPAGE.FK_AS_CNT_INDEX_STATS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	

COMMIT;

--------------------------------------------------
-- HOMEPAGE.IMG_CACHE
--------------------------------------------------
CREATE TABLE HOMEPAGE.IMG_CACHE (
	IMG_CACHE_ID VARCHAR(36) CCSID 1208 NOT NULL,
	ORIGINAL_URL VARCHAR (1024) CCSID 1208 NOT NULL,
	FILE_PATH VARCHAR (256) CCSID 1208 NOT NULL,
	NUM_REQUEST INTEGER,
	CREATION_DATE TIMESTAMP,
	LAST_REQUEST_DATE TIMESTAMP,
	MAX_HEIGHT SMALLINT,
	MAX_WIDTH SMALLINT,	
	TRANSFORMATION SMALLINT,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000',
	ORIGINAL_URL_MD5 char(32) CCSID 1208 NOT NULL
)	;

ALTER TABLE HOMEPAGE.IMG_CACHE
  	ADD CONSTRAINT HOMEPAGE.PK_IMG_CACHE_ID PRIMARY KEY(IMG_CACHE_ID);  


ALTER TABLE HOMEPAGE.IMG_CACHE ADD CONSTRAINT HOMEPAGE.FK_IMG_CACHE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);	

CREATE UNIQUE INDEX HOMEPAGE.IMG_CACHE_FILE_UNQ
	ON HOMEPAGE.IMG_CACHE (FILE_PATH);
	
CREATE INDEX HOMEPAGE.IMG_CACHE_URL_IDX
	ON HOMEPAGE.IMG_CACHE (ORIGINAL_URL_MD5, ORGANIZATION_ID);

CREATE INDEX HOMEPAGE.IMG_CACHE_DEL_BATCH_IDX 
   	ON HOMEPAGE.IMG_CACHE (LAST_REQUEST_DATE ASC, NUM_REQUEST ASC, FILE_PATH, IMG_CACHE_ID);	
	
COMMIT;	

-----------------------------------------------------------
-- HOMEPAGE.NR_AS_COUNTS
-----------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AS_COUNTS (
	AS_COUNT_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,	
	UI_VIEW SMALLINT,
	COUNT INTEGER,
	ORGANIZATION_ID VARCHAR (36) CCSID 1208 NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
	CREATION_DATE TIMESTAMP NOT NULL,
	UPDATE_DATE TIMESTAMP NOT NULL
);

ALTER TABLE HOMEPAGE.NR_AS_COUNTS 
  	ADD CONSTRAINT HOMEPAGE.PK_AS_COUNT_ID PRIMARY KEY (AS_COUNT_ID);
  	
ALTER TABLE HOMEPAGE.NR_AS_COUNTS
    ADD CONSTRAINT HOMEPAGE.FK_AS_COUNT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
    
ALTER TABLE HOMEPAGE.NR_AS_COUNTS
    ADD CONSTRAINT HOMEPAGE.FK_AS_COUNT_PER_ID FOREIGN KEY (PERSON_ID) REFERENCES HOMEPAGE.PERSON (PERSON_ID);    

CREATE UNIQUE INDEX HOMEPAGE.NR_COUNT_PER_VIEW_UNQ 
	ON HOMEPAGE.NR_AS_COUNTS (PERSON_ID, UI_VIEW, ORGANIZATION_ID);
	
CREATE INDEX HOMEPAGE.NR_AS_COUNT_PER_IDX
	ON HOMEPAGE.NR_AS_COUNTS (PERSON_ID);
	
CREATE INDEX HOMEPAGE.NR_AS_COUNT_ORG_IDX
	ON HOMEPAGE.NR_AS_COUNTS (ORGANIZATION_ID);	
	
COMMIT;

--runstats on table HOMEPAGE.NR_AS_COUNTS with distribution and detailed indexes all allow write access;

------------------------------------------------
-- OEMBED_SCHEDULER_TASK
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_TASK (
	TASKID BIGINT NOT NULL,
	VERSION VARCHAR(5) CCSID 1208 NOT NULL,
	ROW_VERSION INTEGER NOT NULL,
	TASKTYPE INTEGER NOT NULL,
	TASKSUSPENDED SMALLINT NOT NULL,
	CANCELLED SMALLINT NOT NULL,
	NEXTFIRETIME BIGINT NOT NULL,
	STARTBYINTERVAL VARCHAR(254) CCSID 1208,
	STARTBYTIME BIGINT,
	VALIDFROMTIME BIGINT,
	VALIDTOTIME BIGINT,
	REPEATINTERVAL VARCHAR(254) CCSID 1208,
	MAXREPEATS INTEGER NOT NULL,
	REPEATSLEFT INTEGER NOT NULL,
	TASKINFO BLOB(102400),
	NAME VARCHAR(254) CCSID 1208 NOT NULL,
	AUTOPURGE INTEGER NOT NULL,
	FAILUREACTION INTEGER,
	MAXATTEMPTS INTEGER,
	QOS INTEGER,
	PARTITIONID INTEGER,
	OWNERTOKEN VARCHAR(200) CCSID 1208 NOT NULL,
	CREATETIME BIGINT NOT NULL
);

ALTER TABLE HOMEPAGE.OEMBED_SCHEDULER_TASK 
	ADD PRIMARY KEY (TASKID);

CREATE INDEX HOMEPAGE.OEMBED_SCHEDULER_TASK_IDX1 
	ON HOMEPAGE.OEMBED_SCHEDULER_TASK (TASKID, OWNERTOKEN);

CREATE INDEX HOMEPAGE.OEMBED_SCHEDULER_TASK_IDX2 
	ON HOMEPAGE.OEMBED_SCHEDULER_TASK (NEXTFIRETIME ASC, REPEATSLEFT, PARTITIONID) CLUSTER;

------------------------------------------------
-- OEMBED_SCHEDULER_TREG
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_TREG (
	REGKEY VARCHAR(254) CCSID 1208 NOT NULL,
	REGVALUE VARCHAR(254)  CCSID 1208
);

ALTER TABLE HOMEPAGE.OEMBED_SCHEDULER_TREG 
	ADD PRIMARY KEY (REGKEY);

------------------------------------------------
-- OEMBED_SCHEDULER_LMGR
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_LMGR (
	LEASENAME VARCHAR(254) CCSID 1208 NOT NULL,
	LEASEOWNER VARCHAR(254) CCSID 1208 NOT NULL,
	LEASE_EXPIRE_TIME  BIGINT,
	DISABLED VARCHAR(5) CCSID 1208
);

ALTER TABLE HOMEPAGE.OEMBED_SCHEDULER_LMGR 
	ADD PRIMARY KEY (LEASENAME);

------------------------------------------------
-- OEMBED_SCHEDULER_LMPR
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_LMPR (
	LEASENAME VARCHAR(254) CCSID 1208 NOT NULL,
	NAME VARCHAR(254) CCSID 1208 NOT NULL,
	VALUE VARCHAR(254) CCSID 1208 NOT NULL
);

CREATE INDEX HOMEPAGE.OEMBED_SCHEDULER_LMPR_IDX1 
	ON HOMEPAGE.OEMBED_SCHEDULER_LMPR (LEASENAME, NAME);
	
	
---------------------------------------------------------------
-- HOMEPAGE.NR_CUSTOM_LIST
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_CUSTOM_LIST (
	CUSTOM_LIST_ID VARCHAR(36) CCSID 1208 NOT NULL,
	CUSTOM_LIST_NAME VARCHAR(1024) CCSID 1208 NOT NULL,
	CREATION_TIME TIMESTAMP NOT NULL,
	UPDATE_TIME TIMESTAMP NOT NULL,
	CUSTOM_LIST_SUMMARY VARCHAR(2048) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,
	STATE SMALLINT NOT NULL,
	PERSON_DISPLAY VARCHAR(36) CCSID 1208
);

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST 
  	ADD CONSTRAINT HOMEPAGE.PK_CUSTOM_LIST_ID PRIMARY KEY(CUSTOM_LIST_ID);  

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST
  	ADD CONSTRAINT HOMEPAGE.FK_CUST_L_PER_ID FOREIGN KEY(PERSON_ID) REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST
  	ADD CONSTRAINT HOMEPAGE.FK_CUST_L_PER_D_ID FOREIGN KEY(PERSON_DISPLAY) REFERENCES HOMEPAGE.PERSON (PERSON_ID);  	
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST
  	ADD CONSTRAINT HOMEPAGE.FK_CUST_L_ORG_ID FOREIGN KEY(ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_PER_ORG_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST (PERSON_ID, ORGANIZATION_ID); 

CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_PER_D_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST (PERSON_DISPLAY); 	

---------------------------------------------------------------
-- HOMEPAGE.NR_CUSTOM_LIST_ITEM
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM (
	CUSTOM_LIST_ITEM_ID VARCHAR(36) CCSID 1208 NOT NULL,
	CUSTOM_LIST_ID VARCHAR(36) CCSID 1208 NOT NULL,
	ITEM_ID VARCHAR(256) CCSID 1208 NOT NULL,
	CUSTOM_LIST_ITEM_NAME VARCHAR(1024) CCSID 1208 NOT NULL,
	CREATION_TIME TIMESTAMP NOT NULL,
	UPDATE_TIME TIMESTAMP NOT NULL,
	TYPE VARCHAR(256) CCSID 1208 NOT NULL,
	CUSTOM_LIST_ITEM_SUMMARY VARCHAR(2048) CCSID 1208,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL,
	STATE SMALLINT NOT NULL,
	PERSON_DISPLAY VARCHAR(36) CCSID 1208
);

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM 
  	ADD CONSTRAINT HOMEPAGE.PK_CUSTOM_LIST_ITEM_ID PRIMARY KEY(CUSTOM_LIST_ITEM_ID);
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM 
  	ADD CONSTRAINT HOMEPAGE.FK_CUSTOM_LIST_ID FOREIGN KEY(CUSTOM_LIST_ID) REFERENCES HOMEPAGE.NR_CUSTOM_LIST (CUSTOM_LIST_ID);
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM 
  	ADD CONSTRAINT HOMEPAGE.FK_CUST_L_I_ORG_ID FOREIGN KEY(ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM
  	ADD CONSTRAINT HOMEPAGE.FK_CUST_L_I_PER_D_ID FOREIGN KEY(PERSON_DISPLAY) REFERENCES HOMEPAGE.PERSON (PERSON_ID);   	
  	
CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_ID_ORG_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (CUSTOM_LIST_ID, ORGANIZATION_ID);
	
CREATE UNIQUE INDEX HOMEPAGE.NR_CUSTOM_LIST_ITEM_IDX_UNQ
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (ITEM_ID, CUSTOM_LIST_ID);	
	
CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_ITEM_PER_D_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (PERSON_DISPLAY);	
	
COMMIT;	

CREATE INDEX HOMEPAGE.NR_CUSTOM_LIST_ITEM_CRTIME_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (CREATION_TIME);
COMMIT;	

---------------------------------------------------------------
-- HOMEPAGE.NR_READ_STATUS
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_READ_STATUS (
	READ_STATUS_ID VARCHAR(36) CCSID 1208 NOT NULL,
	PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,
	STORY_ID VARCHAR(36) CCSID 1208 NOT NULL,
	CREATION_DATE TIMESTAMP NOT NULL,
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT HOMEPAGE.PK_READ_STATUS_ID PRIMARY KEY(READ_STATUS_ID);
  	
ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT HOMEPAGE.FK_READ_STATUS_PER FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);  
	
ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT HOMEPAGE.FK_READ_STATUS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);
	
ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT HOMEPAGE.FK_READ_STATUS_ORG FOREIGN KEY (ORGANIZATION_ID)
	REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE UNIQUE INDEX HOMEPAGE.READ_STATUS_PER_STR_UNQ_IDX
	ON HOMEPAGE.NR_READ_STATUS (PERSON_ID, STORY_ID);
	
CREATE INDEX HOMEPAGE.READ_STATUS_ORG_IDX
	ON HOMEPAGE.NR_READ_STATUS (ORGANIZATION_ID);
	
COMMIT;


-------------------------------------------------------
-- NR_ENTRIES_ROLLUP_ACTION
-------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION  (
        ENTRY_ROLLUP_ACTION_ID VARCHAR(36) CCSID 1208 NOT NULL,
        ROLLUP_ENTRY_ID VARCHAR(256) CCSID 1208 NOT NULL,
        ROLLUP_AUTHOR_ID VARCHAR(36) CCSID 1208,
        TEMPLATE_NAME VARCHAR(256) CCSID 1208 NOT NULL,
        ACTION VARCHAR(50) CCSID 1208 NOT NULL,   			
        ACTION_COUNT INTEGER DEFAULT 0, 
		META_TEMPLATE VARCHAR(3328) CCSID 1208 NOT NULL,
		TEXT_META_TEMPLATE VARCHAR(1024) CCSID 1208 NOT NULL,
		CREATION_DATE TIMESTAMP NOT NULL,
        UPDATE_DATE TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000' NOT NULL 		  
);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION
	ADD CONSTRAINT HOMEPAGE.PK_ENTRIES_ROLLUP_ACTION_ID PRIMARY KEY (ENTRY_ROLLUP_ACTION_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION
	ADD CONSTRAINT HOMEPAGE.FK_ROLLUP_AUTHOR_ID FOREIGN KEY (ROLLUP_AUTHOR_ID) REFERENCES HOMEPAGE.PERSON(PERSON_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION 
	ADD CONSTRAINT HOMEPAGE.FK_ORGANIZATION_ID FOREIGN KEY (ORGANIZATION_ID)  REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE INDEX HOMEPAGE.ENTR_ROLLUP_ACT_CDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (CREATION_DATE DESC);
	
CREATE INDEX HOMEPAGE.ENTR_ROLLUP_ACT_UDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (UPDATE_DATE DESC);

CREATE UNIQUE INDEX HOMEPAGE.ENTR_ROLLUP_ACT_UNQ_IDX
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ROLLUP_ENTRY_ID, ACTION, ROLLUP_AUTHOR_ID, ORGANIZATION_ID);
	
CREATE INDEX HOMEPAGE.ENTR_ROLLUP_ACT_AUT_ID_IDX
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ROLLUP_AUTHOR_ID, ORGANIZATION_ID);	

CREATE INDEX HOMEPAGE.ENTRIES_ROLLUP_ACT_AUT_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ROLLUP_AUTHOR_ID);


---------------------------------------------------------------
-- NR_ENTRIES_ROLLUP_PERSON
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON  (
        ENTRY_ROLLUP_PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,
        ENTRY_ROLLUP_ACTION_ID VARCHAR(36) CCSID 1208 NOT NULL,			
        PERSON_ID VARCHAR(36) CCSID 1208 NOT NULL,			
        ACTION_COUNT INTEGER DEFAULT 0,
		CREATION_DATE TIMESTAMP NOT NULL,
        UPDATE_DATE TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 DEFAULT '00000000-0000-0000-0000-000000000000' NOT NULL 	  		  
);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON
	ADD CONSTRAINT HOMEPAGE.PK_ENTRY_ROLLUP_PERSON_ID PRIMARY KEY (ENTRY_ROLLUP_PERSON_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON
	ADD CONSTRAINT HOMEPAGE.FK_ENTRY_ROLLUP_ACTION_ID FOREIGN KEY (ENTRY_ROLLUP_ACTION_ID) REFERENCES HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ENTRY_ROLLUP_ACTION_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON 
	ADD CONSTRAINT HOMEPAGE.FK_PERSON_ID FOREIGN KEY (PERSON_ID) REFERENCES HOMEPAGE.PERSON(PERSON_ID);

CREATE INDEX HOMEPAGE.ENTR_ROLLUP_PER_CDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (CREATION_DATE DESC);

CREATE INDEX HOMEPAGE.ENTR_ROLLUP_PER_UDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (UPDATE_DATE DESC);

CREATE INDEX HOMEPAGE.ENTR_ROLLUP_PER_PER_ID_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (PERSON_ID, ORGANIZATION_ID);

CREATE UNIQUE INDEX HOMEPAGE.ENTR_ROLLUP_PER_ROL_ACTI_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (ENTRY_ROLLUP_ACTION_ID, PERSON_ID, ORGANIZATION_ID);

	
-----------------------------------------------------------------------
-- HOMEPAGE.L3T_ORGANIZATION table
-----------------------------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_ORGANIZATION (
	ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL,
	ORGANIZATION_EXID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_ORGANIZATION ADD CONSTRAINT HOMEPAGE.PK_L3T_ORGANIZATION_ID PRIMARY KEY(ORGANIZATION_ID);
CREATE UNIQUE INDEX HOMEPAGE.UNQ_L3T_ORG_EXID ON HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_EXID);


-------------------------------------------------
-- HOMEPAGE.L3T_COMPANIES
-------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_COMPANIES (
		COMPANY_ID VARCHAR(36) CCSID 1208 NOT NULL,
		NAME VARCHAR(128) CCSID 1208 NOT NULL,
		OPENID_ORG VARCHAR(128) CCSID 1208 NOT NULL,
		LOTUSLIVE_INSTANCE VARCHAR(5) CCSID 1208 NOT NULL,
		PACKAGEPREF_DEFAULT VARCHAR(11) CCSID 1208 NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_COMPANIES ADD CONSTRAINT HOMEPAGE.PK_COMPANY_ID PRIMARY KEY (COMPANY_ID);
ALTER TABLE HOMEPAGE.L3T_COMPANIES ADD CONSTRAINT HOMEPAGE.FK_COM_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
CREATE UNIQUE INDEX HOMEPAGE.UNQ_OPENID_ORG_IDX  ON HOMEPAGE.L3T_COMPANIES (OPENID_ORG);
	

-------------------------------------------------
-- HOMEPAGE.L3T_USERS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USERS (
		USER_ID VARCHAR(36) CCSID 1208 NOT NULL,
		NAME VARCHAR(256) CCSID 1208 NOT NULL,
		OPENID_IDENTITY VARCHAR(256) CCSID 1208 NOT NULL,
		EMAIL VARCHAR(256) CCSID 1208 NOT NULL,
		COMPANY_ID VARCHAR(36) CCSID 1208 NOT NULL,
		LOGGED_IN SMALLINT NOT NULL,
		LOGGED_IN_TIME TIMESTAMP NOT NULL,
		LANG VARCHAR(6) CCSID 1208 NOT NULL,
		PACKAGEPREF_DEFAULT VARCHAR(6) CCSID 1208 NOT NULL,
		LAST_AGREEMENT INTEGER NOT NULL DEFAULT 0,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT HOMEPAGE.PK_USERS_ID PRIMARY KEY (USER_ID);
CREATE UNIQUE INDEX HOMEPAGE.UNQ_OPENID_IDENTITY_IDX ON HOMEPAGE.L3T_USERS (OPENID_IDENTITY);
ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT HOMEPAGE.FK_USERS_COMPANY_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID);
ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT HOMEPAGE.FK_USERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.USERS_COMP_IDX ON HOMEPAGE.L3T_USERS (COMPANY_ID);
CREATE INDEX HOMEPAGE.USERS_ORG_IDX ON HOMEPAGE.L3T_USERS (ORGANIZATION_ID);



-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGES
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGES (
		PACKAGE_ID VARCHAR(36) CCSID 1208 NOT NULL,
		NAME VARCHAR(40) CCSID 1208 NOT NULL,
		ENTITLE_EVERYONE SMALLINT NOT NULL,
		OWNER_ID VARCHAR(36) CCSID 1208 NOT NULL,
		TOKEN VARCHAR(12) CCSID 1208 ,
		MAINT_MODE SMALLINT NOT NULL DEFAULT 1,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL,
		DELETEABLE SMALLINT NOT NULL DEFAULT 1
);

ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT HOMEPAGE.PK_PACKAGES_ID PRIMARY KEY (PACKAGE_ID);
ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT HOMEPAGE.FK_PACKAGES_OWNER_ID FOREIGN KEY (OWNER_ID) REFERENCES HOMEPAGE.L3T_USERS 	(USER_ID);
ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT HOMEPAGE.FK_PACKAGES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.PKG_OWNER_IDX ON HOMEPAGE.L3T_PACKAGES (OWNER_ID);
CREATE INDEX HOMEPAGE.PKG_ORG_IDX ON HOMEPAGE.L3T_PACKAGES (ORGANIZATION_ID);

-------------------------------------------------
-- HOMEPAGE.L3T_COMPANY_ENTITLEMENTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (
		COMPANY_ENTITLEMENTS_ID VARCHAR(36) CCSID 1208 NOT NULL,
		COMPANY_ID VARCHAR(36) CCSID 1208 NOT NULL,
		PACKAGE_ID VARCHAR(36) CCSID 1208 NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT HOMEPAGE.PK_COMPANY_ENT_ID PRIMARY KEY (COMPANY_ENTITLEMENTS_ID);
CREATE UNIQUE INDEX HOMEPAGE.UNQ_COM_ENT_COM_PKG_IDX ON  HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (COMPANY_ID, PACKAGE_ID);
ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT HOMEPAGE.FK_COM_ENT_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT HOMEPAGE.FK_COM_ENT_COM_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID);
ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT HOMEPAGE.FK_COM_ENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.COM_ENT_PKG_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (PACKAGE_ID);
CREATE INDEX HOMEPAGE.COM_ENT_COMP_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (COMPANY_ID);
CREATE INDEX HOMEPAGE.COM_ENT_ORG_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (ORGANIZATION_ID);




-------------------------------------------------
-- HOMEPAGE.L3T_COMPANY_PKG_PREFS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS (
		COMPANY_PKG_PREFS_ID VARCHAR(36) CCSID 1208 NOT NULL,
		COMPANY_ID VARCHAR(36) CCSID 1208 NOT NULL,
		PACKAGE_ID VARCHAR(36) CCSID 1208 NOT NULL,
		PREFERENCE VARCHAR(11) CCSID 1208 NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT HOMEPAGE.PK_COMPANY_PKG_PREFS_ID PRIMARY KEY (COMPANY_PKG_PREFS_ID);
CREATE UNIQUE INDEX HOMEPAGE.UNQ_COM_PKG_PREF_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS  (COMPANY_ID, PACKAGE_ID);
ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT HOMEPAGE.FK_COM_PKG_PREF_COM_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID);
ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT HOMEPAGE.FK_COM_PKG_PREF_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT HOMEPAGE.FK_COM_PKG_PREF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.COMP_PRF_PKG_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (PACKAGE_ID);
CREATE INDEX HOMEPAGE.COMP_PRF_COMP_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (COMPANY_ID);
CREATE INDEX HOMEPAGE.COMP_PRF_ORG_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (ORGANIZATION_ID);

-------------------------------------------------
-- HOMEPAGE.L3T_EXT_META2
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_EXT_META2 (
		EXT_META2_ID VARCHAR(36) CCSID 1208 NOT NULL,
		UNID VARCHAR(512) CCSID 1208 NOT NULL,
		OPENID_ORG VARCHAR(512) CCSID 1208 NOT NULL,
		TYPE VARCHAR(512) CCSID 1208 NOT NULL,
		PARENT VARCHAR(36) CCSID 1208 NOT NULL,
		NODE_KEY VARCHAR(256) CCSID 1208 ,
		NODE_VALUE VARCHAR(512) CCSID 1208 ,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_EXT_META2 ADD CONSTRAINT HOMEPAGE.PK_EXT_META2_ID PRIMARY KEY (EXT_META2_ID);
ALTER TABLE HOMEPAGE.L3T_EXT_META2 ADD CONSTRAINT HOMEPAGE.FK_EXT_META2_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.EXT_META2_ORG_IDX ON HOMEPAGE.L3T_EXT_META2 (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.EXT_META2_UNIDNKEY_IDX ON HOMEPAGE.L3T_EXT_META2 (UNID, NODE_KEY);
CREATE INDEX HOMEPAGE.EXT_META2_PARENT_IDX ON HOMEPAGE.L3T_EXT_META2 (PARENT);

-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGE_DETAILS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGE_DETAILS (
		PACKAGE_DETAILS_ID VARCHAR(36) CCSID 1208 NOT NULL,
		PACKAGE_ID VARCHAR(36) CCSID 1208 NOT NULL,
		POSITION_ID VARCHAR(512) CCSID 1208 NOT NULL,
		WIDGET VARCHAR(512) CCSID 1208 NOT NULL,
		LABS_ID VARCHAR(512) CCSID 1208 NOT NULL,
		POSITION_TYPE VARCHAR(36) CCSID 1208 NOT NULL,
		POSITION_INDEX INTEGER NOT NULL WITH DEFAULT 0,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT HOMEPAGE.PK_PACKAGE_DETAILS_ID PRIMARY KEY (PACKAGE_DETAILS_ID);
ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT HOMEPAGE.FK_PKG_DET_PKG_IDFOREIGN FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT HOMEPAGE.FK_PKG_DET_PKG_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.PKG_DET_PKG_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (PACKAGE_ID);
CREATE INDEX HOMEPAGE.PKG_DET_ORG_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.L3T_PACKAGE_DETAILS_LABSID_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (LABS_ID);

-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGE_LOCATION
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGE_LOCATION (
		PACKAGE_LOCATION_ID VARCHAR(36) CCSID 1208 NOT NULL,
		POSITION_URL VARCHAR(512) CCSID 1208 NOT NULL,
		LABS_ID VARCHAR(512) CCSID 1208 NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_PACKAGE_LOCATION ADD CONSTRAINT HOMEPAGE.PK_PACKAGE_LOCATION_ID PRIMARY KEY (PACKAGE_LOCATION_ID);
ALTER TABLE HOMEPAGE.L3T_PACKAGE_LOCATION ADD CONSTRAINT HOMEPAGE.FK_PACKAGE_LOCATION_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.PKG_LOC_ORG_IDX ON HOMEPAGE.L3T_PACKAGE_LOCATION (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.L3T_PACKAGE_LOCATN_LABSID_IDX ON HOMEPAGE.L3T_PACKAGE_LOCATION (LABS_ID);



-------------------------------------------------
-- HOMEPAGE.L3T_USER_ENTITLEMENTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS (
		USER_ENTITLEMENTS_ID VARCHAR(36) CCSID 1208 NOT NULL,
		PACKAGE_ID VARCHAR(36) CCSID 1208 NOT NULL,
		USER_ID VARCHAR(36) CCSID 1208 NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL		
);

ALTER TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS ADD CONSTRAINT HOMEPAGE.PK_USER_ENTITLEMENTS_ID PRIMARY KEY (USER_ENTITLEMENTS_ID);
CREATE UNIQUE INDEX HOMEPAGE.UNQ_USR_ENT_PKG_USR_IDX ON HOMEPAGE.L3T_USER_ENTITLEMENTS  (PACKAGE_ID,  USER_ID);
ALTER TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS ADD CONSTRAINT HOMEPAGE.FK_USR_ENT_PGK_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES 	(PACKAGE_ID);


-------------------------------------------------
-- HOMEPAGE.L3T_USER_PKG_PREFS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USER_PKG_PREFS (
		USER_PKG_PREFS_ID VARCHAR(36) CCSID 1208 NOT NULL, 
		PACKAGE_ID VARCHAR(36) CCSID 1208 NOT NULL,
		USER_ID VARCHAR(36) CCSID 1208 NOT NULL,
		PREFERENCE VARCHAR(9) CCSID 1208 NOT NULL,
		CREATED TIMESTAMP NOT NULL,
		MODIFIED TIMESTAMP NOT NULL,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT HOMEPAGE.PK_USER_PKG_PREFS_ID PRIMARY KEY (USER_PKG_PREFS_ID);
CREATE UNIQUE INDEX  HOMEPAGE.USER_PKG_PREF_PKG_USR_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS  (PACKAGE_ID, USER_ID);
ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT HOMEPAGE.FK_USR_PKG_PRF_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT HOMEPAGE.FK_USR_PKG_PRF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
CREATE INDEX HOMEPAGE.USR_PGK_PFR_PKG_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS (PACKAGE_ID);
CREATE INDEX HOMEPAGE.USR_PKG_PRF_ORG_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS (ORGANIZATION_ID);


-------------------------------------------------
-- HOMEPAGE.L3T_EXT_POINTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_EXT_POINTS (
		EXT_POINT_ID VARCHAR(36) CCSID 1208 NOT NULL,
		NAME VARCHAR(256) CCSID 1208 NOT NULL,
		SERVICE VARCHAR(128) CCSID 1208 NOT NULL,
		EXT_TYPE VARCHAR(128) CCSID 1208 NOT NULL,
		DESCRIPTION VARCHAR(512) CCSID 1208 
);

ALTER TABLE HOMEPAGE.L3T_EXT_POINTS ADD CONSTRAINT HOMEPAGE.PK_EXT_POINT_ID PRIMARY KEY (EXT_POINT_ID);

-------------------------------------------------
-- HOMEPAGE.L3T_EXT_BINDS
-------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_EXT_BINDS (
		EXT_BIND_ID VARCHAR(36) CCSID 1208 NOT NULL,
		EXT_ID VARCHAR(36) CCSID 1208 NOT NULL,
		EXT_POINT_ID VARCHAR(36) CCSID 1208 NOT NULL,
		ENABLED SMALLINT NOT NULL DEFAULT 0,
		ORGANIZATION_ID VARCHAR(36) CCSID 1208 NOT NULL
);

ALTER TABLE HOMEPAGE.L3T_EXT_BINDS ADD CONSTRAINT HOMEPAGE.PK_EXT_BIND_ID PRIMARY KEY (EXT_BIND_ID);
CREATE UNIQUE INDEX HOMEPAGE.UNQ_EXT_BIND_IDX ON HOMEPAGE.L3T_EXT_BINDS (EXT_ID, EXT_POINT_ID, ORGANIZATION_ID);

