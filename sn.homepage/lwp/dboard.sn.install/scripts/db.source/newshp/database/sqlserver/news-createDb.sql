-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2017                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

------------------------------------------------
-- NR_SOURCE_TYPE_DEFAULT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SOURCE_TYPE_DEFAULT (
	SOURCE_TYPE_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0) NOT NULL, -- numeric that is 1,2,3 etc.. 100, 101..
	SOURCE nvarchar(36) NOT NULL,
	DISPLAY_NAME nvarchar(4000),
	IMAGE_URL nvarchar(2048),
	PUBLISHED DATETIME2(3),
	UPDATED DATETIME2(3),	
	IS_ENABLED NUMERIC(5,0),
	SUMMARY nvarchar (4000),
	URL nvarchar(2048),
	URL_SSL nvarchar(2048),
	IMAGE_URL_SSL nvarchar(2048),
	IS_DIGEST_ENABLED NUMERIC(5,0)  NOT NULL DEFAULT 0,
    DEFAULT_DIGEST_FREQUENCY NUMERIC(5,0)  NOT NULL DEFAULT 0,
    IS_DIGEST_LOCKED NUMERIC(5,0) NOT NULL DEFAULT 0,
    ORGANIZATION_ID nvarchar (36)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE_DEFAULT 
  	ADD CONSTRAINT PK_SRC_TYPE_DEF_ID PRIMARY KEY(SOURCE_TYPE_ID);
  	
CREATE UNIQUE INDEX NR_SRC_TYPE_DEF_UIDX 
	ON HOMEPAGE.NR_SOURCE_TYPE_DEFAULT (SOURCE_TYPE);
	
CREATE UNIQUE INDEX NR_SRC_DEF_UIDX
	ON HOMEPAGE.NR_SOURCE_TYPE_DEFAULT (SOURCE);

GO	

------------------------------------------------
-- NR_SOURCE_TYPE
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SOURCE_TYPE (
	SOURCE_TYPE_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0) NOT NULL, -- numeric that is 1,2,3 etc.. 100, 101..
	SOURCE nvarchar(36) NOT NULL,
	DISPLAY_NAME nvarchar(4000),
	IMAGE_URL nvarchar(2048),
	PUBLISHED DATETIME2(3),
	UPDATED DATETIME2(3),	
	IS_ENABLED NUMERIC(5,0),
	SUMMARY nvarchar (4000),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	URL nvarchar(2048),
	URL_SSL nvarchar(2048),
	IMAGE_URL_SSL nvarchar(2048),
	IS_DIGEST_ENABLED NUMERIC(5,0)  NOT NULL DEFAULT 0,
    DEFAULT_DIGEST_FREQUENCY NUMERIC(5,0)  NOT NULL DEFAULT 0,
    IS_DIGEST_LOCKED NUMERIC(5,0) NOT NULL DEFAULT 0
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE 
  	ADD CONSTRAINT PK_SRC_TYPE_ID PRIMARY KEY(SOURCE_TYPE_ID);

ALTER TABLE HOMEPAGE.NR_SOURCE_TYPE ADD CONSTRAINT FK_SOURCE_TYPE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
CREATE UNIQUE INDEX NR_SRC_TYPE_ORG_UIDX 
	ON HOMEPAGE.NR_SOURCE_TYPE (SOURCE_TYPE, ORGANIZATION_ID);
	
CREATE UNIQUE INDEX UNQ_SOURCE_TYPE_SRC_ORG
 	ON HOMEPAGE.NR_SOURCE_TYPE (SOURCE, ORGANIZATION_ID);
 	
CREATE INDEX SRC_TYPE_ORG_ID
    ON HOMEPAGE.NR_SOURCE_TYPE (ORGANIZATION_ID, SOURCE_TYPE ASC);
    
GO	

------------------------------------------------
-- NR_TEMPLATE
------------------------------------------------ 
CREATE TABLE HOMEPAGE.NR_TEMPLATE (
	TEMPLATE_ID nvarchar(36) NOT NULL,
 	NAME nvarchar(256) NOT NULL,
 	FORMAT nvarchar(256) NOT NULL,
 	DATA_SOURCE_STRING nvarchar(256) NOT NULL,
 	NO_VALUES NUMERIC(5,0) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_TEMPLATE 
  	ADD CONSTRAINT PK_TEMPLATE_ID PRIMARY KEY(TEMPLATE_ID);

------------------------------------------------
-- NR_SCHEDULER_TASK
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_TASK (
	[TASKID] BIGINT NOT NULL ,
	[VERSION] NVARCHAR(5) NOT NULL ,
	[ROW_VERSION] INT NOT NULL ,
	[TASKTYPE] INT NOT NULL ,
	[TASKSUSPENDED] TINYINT NOT NULL ,
	[CANCELLED] TINYINT NOT NULL ,
	[NEXTFIRETIME] BIGINT NOT NULL ,
	[STARTBYINTERVAL] NVARCHAR(254) NULL ,
	[STARTBYTIME] BIGINT NULL ,
	[VALIDFROMTIME] BIGINT NULL ,
  	[VALIDTOTIME] BIGINT NULL ,
  	[REPEATINTERVAL] NVARCHAR(254) NULL ,
  	[MAXREPEATS] INT NOT NULL ,
  	[REPEATSLEFT] INT NOT NULL ,
  	[TASKINFO] IMAGE NULL ,
  	[NAME] NVARCHAR(254) NOT NULL ,
  	[AUTOPURGE] INT NOT NULL ,
  	[FAILUREACTION] INT NULL ,
  	[MAXATTEMPTS] INT NULL ,
  	[QOS] INT NULL ,
  	[PARTITIONID] INT NULL ,
  	[OWNERTOKEN] NVARCHAR(200) NOT NULL ,
  	[CREATETIME] BIGINT NOT NULL
) 
GO

ALTER TABLE HOMEPAGE.NR_SCHEDULER_TASK WITH NOCHECK 
	ADD CONSTRAINT NR_SCHEDULER_TASK_PK PRIMARY KEY  NONCLUSTERED ( [TASKID] ) 
GO

CREATE INDEX NR_SCHEDULER_TASK_IDX1 
	ON HOMEPAGE.NR_SCHEDULER_TASK ( [TASKID], [OWNERTOKEN] ) 
GO

CREATE CLUSTERED INDEX NR_SCHEDULER_TASK_IDX2 
	ON HOMEPAGE.NR_SCHEDULER_TASK ( [NEXTFIRETIME] ASC, [REPEATSLEFT], [PARTITIONID] )
GO

------------------------------------------------
-- NR_SCHEDULER_TREG
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_TREG ( 
	[REGKEY] NVARCHAR(254) NOT NULL ,
	[REGVALUE] NVARCHAR(254) NULL ,
	PRIMARY KEY ( [REGKEY] ) )
GO

------------------------------------------------
-- NR_SCHEDULER_LMGR
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_LMGR ( 
	[LEASENAME] NVARCHAR(254) NOT NULL,
	[LEASEOWNER] NVARCHAR(254) NOT NULL,
	[LEASE_EXPIRE_TIME] BIGINT,
	[DISABLED] NVARCHAR(5) )
GO

ALTER TABLE HOMEPAGE.NR_SCHEDULER_LMGR WITH NOCHECK 
	ADD CONSTRAINT NR_SCHEDULER_LMGR_PK PRIMARY KEY  NONCLUSTERED ( [LEASENAME] ) 
GO

------------------------------------------------
-- NR_SCHEDULER_LMPR
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SCHEDULER_LMPR ( 
	[LEASENAME] NVARCHAR(224) NOT NULL,
	[NAME] NVARCHAR(224) NOT NULL,
    [VALUE] NVARCHAR(254) NOT NULL )
GO

CREATE INDEX NR_SCHEDULER_LMPR_IDX1 
	ON HOMEPAGE.NR_SCHEDULER_LMPR ( [LEASENAME], [NAME] ) 
GO

------------------------------------------------
-- NR_NEWS_STATUS_NETWORK
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK (
	NEWS_STATUS_NETWORK_ID nvarchar(36) NOT NULL,
	READER_ID nvarchar(39),
	ACTOR_UUID nvarchar(36) NOT NULL,
	BRIEF_DESC nvarchar(4000),
	ITEM_URL nvarchar(2048),
	ITEM_ID  nvarchar(36),
	EVENT_NAME nvarchar(36),
	TARGET_SUBJECT_ID nvarchar(36),
	IS_WALL_POST  NUMERIC(5,0) NOT NULL DEFAULT 0,
	CREATION_DATE DATETIME2(3),
	UPDATE_DATE DATETIME2(3),
	N_COMMENTS NUMERIC(5,0) NOT NULL DEFAULT 0,
	IS_NETWORK_NEWS NUMERIC(5,0) NOT NULL DEFAULT 0,
	IS_FOLLOW_NEWS NUMERIC(5,0) NOT NULL DEFAULT 0,
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK
  	ADD CONSTRAINT PK_NEWS_STATUS_ID PRIMARY KEY(NEWS_STATUS_NETWORK_ID);

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK ADD CONSTRAINT FK_NEWS_STATUS_NETWORK_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
CREATE INDEX NR_NEWS_STATUS_NETWORK_ITEM_ID
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (ITEM_ID);

CREATE INDEX NR_NEWS_SN_READER_FOLL
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (UPDATE_DATE DESC, READER_ID, IS_FOLLOW_NEWS);

CREATE INDEX NR_NEWS_SN_READER_NETW
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (UPDATE_DATE DESC, READER_ID, IS_NETWORK_NEWS);

CREATE INDEX NEWS_STATUS_NET_R_U 
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (READER_ID, UPDATE_DATE DESC);

CREATE INDEX NR_STATUS_NETWORK_DATE
    ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (UPDATE_DATE ASC);

CREATE INDEX NR_NEWS_SN_READER_IDX
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (READER_ID);

CREATE UNIQUE INDEX NR_SN_ITEM_READ_UNQ
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (ITEM_ID, READER_ID);
	
CREATE INDEX NR_STATUS_UPDATE_IX
	ON HOMEPAGE.NR_NEWS_STATUS_NETWORK (READER_ID, UPDATE_DATE ASC, CREATION_DATE ASC, ITEM_ID, ACTOR_UUID);
	

------------------------------------------------
-- NR_NEWS_STATUS_COMMENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT (
	NEWS_STATUS_COMMENT_ID nvarchar(36) NOT NULL,
	ACTOR_UUID nvarchar(36) NOT NULL,
	CREATION_DATE DATETIME2(3),
	BRIEF_DESC nvarchar(500),
	ITEM_ID  nvarchar(36),
	ITEM_CORRELATION_ID nvarchar(256),
	ITEM_URL nvarchar(2048),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
) ON [PRIMARY]
GO

CREATE CLUSTERED INDEX CL_STATUS_COMMENT_IDX 
    ON HOMEPAGE.NR_NEWS_STATUS_COMMENT (ITEM_CORRELATION_ID);

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT
  	ADD CONSTRAINT PK_NEWS_COMMENT_ID PRIMARY KEY(NEWS_STATUS_COMMENT_ID);

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_COMMENT ADD CONSTRAINT FK_STATUS_COMMENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
CREATE INDEX STATUS_COMMENT_ITEM_ID
    ON HOMEPAGE.NR_NEWS_STATUS_COMMENT (ITEM_ID);    

CREATE INDEX NR_STATUS_COMMENT_DATE
    ON HOMEPAGE.NR_NEWS_STATUS_COMMENT (CREATION_DATE ASC);
    
------------------------------------------------
-- NR_NEWS_STATUS_CONTENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT (
	NEWS_STATUS_CONTENT_ID nvarchar(36) NOT NULL,
	ITEM_ID  nvarchar(36),
	ACTOR_UUID nvarchar(36),
	CREATION_DATE DATETIME2(3),
	TARGET_SUBJECT_ID nvarchar(36),
	ITEM_URL nvarchar(2048),
	UPDATE_DATE DATETIME2(3),
	RECOMMENDATIONS_COUNT NUMERIC(10 ,0),
	CONTENT nvarchar (MAX),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT
  	ADD CONSTRAINT PK_S_CONTENT_ID PRIMARY KEY(NEWS_STATUS_CONTENT_ID);    

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_CONTENT ADD CONSTRAINT FK_STATUS_CONTENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
CREATE INDEX NR_NEWS_SC_ITEM_ID
    ON HOMEPAGE.NR_NEWS_STATUS_CONTENT (ITEM_ID);

CREATE INDEX NR_NEWS_SC_CD
    ON HOMEPAGE.NR_NEWS_STATUS_CONTENT (CREATION_DATE ASC);

CREATE INDEX NR_SC_UDATE
    ON HOMEPAGE.NR_NEWS_STATUS_CONTENT (UPDATE_DATE ASC);     

    
    
------------------------------------------------
-- NR_NEWS_COMMENT_CONTENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT (
	NEWS_COMMENT_CONTENT_ID nvarchar(36) NOT NULL,
	NEWS_STATUS_COMMENT_ID  nvarchar(36),
	CONTENT nvarchar (MAX),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT
  	ADD CONSTRAINT PK_C_CONTENT_ID PRIMARY KEY(NEWS_COMMENT_CONTENT_ID);    

ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT
  	ADD CONSTRAINT FK_C_COMMENT_ID FOREIGN KEY (NEWS_STATUS_COMMENT_ID)
	REFERENCES HOMEPAGE.NR_NEWS_STATUS_COMMENT(NEWS_STATUS_COMMENT_ID);

ALTER TABLE HOMEPAGE.NR_NEWS_COMMENT_CONTENT ADD CONSTRAINT FK_NEWS_COMMENT_CONTENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE INDEX NR_NEWS_COMMENT_CONTENT_ID
    ON HOMEPAGE.NR_NEWS_COMMENT_CONTENT (NEWS_STATUS_COMMENT_ID);	

----------------------------------------------------------------------
-- HOMEPAGE.NR_RESOURCE
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_RESOURCE (
	RESOURCE_ID nvarchar(36) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256) NOT NULL,
	CONTAINER_NAME nvarchar(256),
	CONTAINER_URL nvarchar(2048),
	CATEGORY_TYPE NUMERIC(5,0),
	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
	LAST_UPDATE DATETIME2(3),
	SOURCE_TYPE NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_RESOURCE 
    ADD CONSTRAINT PK_RESOURCE_ID PRIMARY KEY(RESOURCE_ID);

ALTER TABLE HOMEPAGE.NR_RESOURCE ADD CONSTRAINT FK_RESOURCE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
ALTER TABLE HOMEPAGE.NR_RESOURCE
	ADD CONSTRAINT UNIQUE_RES UNIQUE (CONTAINER_ID, RESOURCE_TYPE);

CREATE INDEX NR_RESOURCE_TYPE_CONT
    ON HOMEPAGE.NR_RESOURCE (RESOURCE_TYPE, CONTAINER_ID);		 

CREATE INDEX NR_RESOURCE_TYPE_CONT_IX
	ON HOMEPAGE.NR_RESOURCE (RESOURCE_TYPE, CONTAINER_NAME);
	
CREATE UNIQUE INDEX NR_RES_LU_UIDX
	ON HOMEPAGE.NR_RESOURCE (RESOURCE_ID, RESOURCE_TYPE, LAST_UPDATE DESC, CONTAINER_NAME DESC);
	
CREATE INDEX NR_RES_CONT_NAME_ORG_ID_IDX
	ON HOMEPAGE.NR_RESOURCE (CONTAINER_NAME, ORGANIZATION_ID);	

----------------------------------------------------------------------
-- HOMEPAGE.NR_FOLLOWS 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_FOLLOWS (
	FOLLOW_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	RESOURCE_ID nvarchar(36) NOT NULL,
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_FOLLOWS 
    ADD CONSTRAINT PK_FOLLOWS_ID PRIMARY KEY(FOLLOW_ID);

ALTER TABLE HOMEPAGE.NR_FOLLOWS
    ADD CONSTRAINT FK_FS_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.NR_FOLLOWS
    ADD CONSTRAINT FK_FS_RESOURCE_ID FOREIGN KEY (RESOURCE_ID)
	REFERENCES HOMEPAGE.NR_RESOURCE (RESOURCE_ID);
	
ALTER TABLE HOMEPAGE.NR_FOLLOWS ADD CONSTRAINT FK_FOLLOWS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE UNIQUE INDEX NR_FOLLOWS_IDX
    ON HOMEPAGE.NR_FOLLOWS (RESOURCE_ID, PERSON_ID);

CREATE INDEX NR_FOLLOWS_PERS
    ON HOMEPAGE.NR_FOLLOWS (PERSON_ID);

CREATE INDEX NR_FOLLOWS_RES
    ON HOMEPAGE.NR_FOLLOWS (RESOURCE_ID); 
    
CREATE UNIQUE INDEX NR_FOLLOWS_PER_RES_UIDX
	ON HOMEPAGE.NR_FOLLOWS (PERSON_ID, RESOURCE_ID);    

----------------------------------------------------------------------
-- HOMEPAGE.NR_COMM_FOLLOW 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_COMM_FOLLOW (
	COMM_FOLLOW_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	COMMUNITY_ID nvarchar(39) NOT NULL,
	COMMUNITY_NAME nvarchar(256),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
    ADD CONSTRAINT PK_COMM_FOLLOW_ID PRIMARY KEY(COMM_FOLLOW_ID);

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
    ADD CONSTRAINT FK_COMM_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW ADD CONSTRAINT FK_COMM_FOLLOW_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
    ADD CONSTRAINT UNIQUE_PERS_COMM UNIQUE (PERSON_ID, COMMUNITY_ID);	

CREATE INDEX NR_COMM_FOLLOW_PERSON_ID
    ON HOMEPAGE.NR_COMM_FOLLOW (PERSON_ID);

CREATE INDEX NR_COMM_FOLLOW_COM_ID
    ON HOMEPAGE.NR_COMM_FOLLOW (COMMUNITY_ID);        	

----------------------------------------------------------------------
-- HOMEPAGE.NR_STORIES
----------------------------------------------------------------------
--CREATE TABLE HOMEPAGE.NR_STORIES (
--	STORY_ID nvarchar(36) NOT NULL,
--	EVENT_NAME nvarchar(256) NOT NULL,
--	SOURCE nvarchar(36),
--	CONTAINER_ID nvarchar(256),	
--	CONTAINER_NAME nvarchar(256),
--	CONTAINER_URL nvarchar(2048),
--	ITEM_NAME nvarchar(256),
--	ITEM_URL nvarchar(2048),
--	ITEM_ATOM_URL nvarchar(2048),
--	ITEM_ID nvarchar(36), -- NEW
--	ITEM_CORRELATION_ID nvarchar(36), -- NEW	
--	CREATION_DATE DATETIME NOT NULL,
--	BRIEF_DESC nvarchar(512),
--	ACTOR_UUID nvarchar(36),
--	EVENT_RECORD_UUID nvarchar(36) NOT NULL,
--	TAGS nvarchar(1024),
--	META_TEMPLATE nvarchar(4000) DEFAULT '' NOT NULL,
--	TEXT_META_TEMPLATE nvarchar(1024),
--	R_META_TEMPLATE nvarchar(4000),
--	R_TEXT_META_TEMPLATE nvarchar(1024),
--	N_COMMENTS NUMERIC(5,0) NOT NULL DEFAULT 0, -- NEW
--	N_RECOMMANDATIONS NUMERIC(5,0) NOT NULL DEFAULT 0, -- NEW
--	IS_COMMUNITY_STORY NUMERIC(5,0) DEFAULT 0,
--	ITEM_CORRELATION_NAME nvarchar(256)
--)
--ON [PRIMARY]
--GO

--ALTER TABLE HOMEPAGE.NR_STORIES
--   ADD CONSTRAINT PK_STORY_ID PRIMARY KEY(STORY_ID);

--CREATE INDEX NR_STORIES_DATE
--	ON HOMEPAGE.NR_STORIES(CREATION_DATE DESC);

--CREATE INDEX STORIES_CONTAINED_ID
--    ON HOMEPAGE.NR_STORIES (CONTAINER_ID);

--CREATE INDEX STORIES_ITEM_ID
--    ON HOMEPAGE.NR_STORIES (ITEM_ID);

--CREATE INDEX STORIES_ITEM_CORR_ID
--    ON HOMEPAGE.NR_STORIES (ITEM_CORRELATION_ID);

--CREATE UNIQUE INDEX NR_STORIES_ER_UUID
--	ON HOMEPAGE.NR_STORIES(EVENT_RECORD_UUID);    
        
--GO        

----------------------------------------------------------------------
-- HOMEPAGE.NR_FOLLOWED_STORIES
----------------------------------------------------------------------
--CREATE TABLE HOMEPAGE.NR_FOLLOWED_STORIES (
--	CATEGORY_READER_ID nvarchar(36) NOT NULL,
--	READER_ID nvarchar(36) NOT NULL,
--	CATEGORY_TYPE NUMERIC(5,0) NOT NULL,
--	SOURCE nvarchar(36) NOT NULL,
--	CONTAINER_ID nvarchar(256),
--	ITEM_ID nvarchar(36), -- I don't think we need SOURCE_ID here, this should be in the SOURCE table?
--	RESOURCE_TYPE NUMERIC(5,0) NOT NULL, -- ???? what is this ??
--	CREATION_DATE DATETIME NOT NULL,
--	STORY_ID nvarchar(36) NOT NULL
--)
--ON [PRIMARY]
--GO

--ALTER TABLE HOMEPAGE.NR_FOLLOWED_STORIES
--    ADD CONSTRAINT PK_F_STORY_ID PRIMARY KEY(CATEGORY_READER_ID);

--ALTER TABLE HOMEPAGE.NR_FOLLOWED_STORIES
--    ADD CONSTRAINT FK_F_STORY_ID FOREIGN KEY (STORY_ID)
--	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);

--CREATE INDEX NR_FOLLOWED_STORIES_READER_CAT
--   ON HOMEPAGE.NR_FOLLOWED_STORIES (CREATION_DATE ASC, READER_ID, CATEGORY_TYPE);

----------------------------------------------------------------------
-- HOMEPAGE.NR_COMM_STORIES
----------------------------------------------------------------------
--CREATE TABLE HOMEPAGE.NR_COMM_STORIES (
--	COMM_STORY_ID nvarchar(36) NOT NULL,
--	COMMUNITY_ID nvarchar(36) NOT NULL,
--	CONTAINER_ID nvarchar(256),
--	ITEM_ID nvarchar(36),
--	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
--	CREATION_DATE DATETIME NOT NULL,
--	STORY_ID nvarchar(36) NOT NULL,
--	SOURCE_TYPE NUMERIC(5,0)
--)
--ON [PRIMARY]
--GO

--ALTER TABLE HOMEPAGE.NR_COMM_STORIES
--   ADD CONSTRAINT PK_F_CSTORY_ID PRIMARY KEY(COMM_STORY_ID);

--ALTER TABLE HOMEPAGE.NR_COMM_STORIES
--    ADD CONSTRAINT FK_COMM_STORY_ID FOREIGN KEY (STORY_ID)
--	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);

--CREATE INDEX NR_COMM_STORIES_STORY_ID
--    ON HOMEPAGE.NR_COMM_STORIES (STORY_ID);

--CREATE INDEX NR_COMM_STORIES_COM_ID
--    ON HOMEPAGE.NR_COMM_STORIES (COMMUNITY_ID);

--CREATE INDEX COMM_STORIES_ITEM_ID
--    ON HOMEPAGE.NR_COMM_STORIES (ITEM_ID);

--CREATE INDEX NR_COMM_STORIES_DATE
--    ON HOMEPAGE.NR_COMM_STORIES (CREATION_DATE ASC);

--CREATE INDEX NR_COMM_STORIES_CDATE
--    ON HOMEPAGE.NR_COMM_STORIES (COMMUNITY_ID, CREATION_DATE ASC);
    
--CREATE INDEX NR_COM_STORY_ID			
--	ON HOMEPAGE.NR_COMM_STORIES (COMMUNITY_ID, STORY_ID);    

------------------------------------------------
-- NR_STORIES_CONTENT
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_STORIES_CONTENT (
	STORY_CONTENT_ID nvarchar(36) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36),
	SOURCE_TYPE NUMERIC(5,0),
	ACTIVITY_META_DATA NVARCHAR(MAX),
	ITEM_CONTENT NVARCHAR(MAX),	
	ITEM_CORRELATION_CONTENT NVARCHAR(MAX),
	ITEM_CONTENT_FORMAT  NUMERIC(5 ,0),
	ITEM_CORRELATION_FORMAT  NUMERIC(5 ,0),
	CONTENT_FORMAT NUMERIC(5 ,0),
	ACTIVITY_META_DATA_1 VARBINARY(3584),
	ACTIVITY_META_DATA_2 VARBINARY(3584),
	IS_META_DATA_TRUNCATED NUMERIC(5 ,0),
	ITEM_BRIEF_DESC nvarchar(4000),
	ITEM_CORRELATION_BRIEF_DESC nvarchar(4000),
	ITEM_TAGS nvarchar(1024),
	ITEM_CORRELATION_TAGS nvarchar(1024),
	CONTENT nvarchar (MAX),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_STORIES_CONTENT
  	ADD CONSTRAINT PK_STORY_CONT_ID PRIMARY KEY(STORY_CONTENT_ID);

ALTER TABLE HOMEPAGE.NR_STORIES_CONTENT ADD CONSTRAINT FK_STORIES_CONTENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
CREATE INDEX STORIES_CONTENT_STORY
    ON HOMEPAGE.NR_STORIES_CONTENT (STORY_ID);

CREATE INDEX NR_STORIES_CONTENT_DATE
    ON HOMEPAGE.NR_STORIES_CONTENT (CREATION_DATE ASC);
        

----------------------------------------------------------------------
-- HOMEPAGE.NR_NETWORK
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NETWORK (
	NETWORK_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	COLLEAGUE_ID nvarchar(36) NOT NULL,
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_NETWORK
    ADD CONSTRAINT PK_NETWORK_ID PRIMARY KEY(NETWORK_ID);

ALTER TABLE HOMEPAGE.NR_NETWORK
    ADD CONSTRAINT FK_NTW_PERS_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.NR_NETWORK
    ADD CONSTRAINT FK_NTW_COLL_ID FOREIGN KEY (COLLEAGUE_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
	
ALTER TABLE HOMEPAGE.NR_NETWORK ADD CONSTRAINT FK_NETWORK_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	

CREATE INDEX NR_NETWORK_PERS
    ON HOMEPAGE.NR_NETWORK (PERSON_ID);

CREATE UNIQUE INDEX COLL_PERSON_IDX 
	ON HOMEPAGE.NR_NETWORK (COLLEAGUE_ID, PERSON_ID);

CREATE UNIQUE INDEX NR_NETWORK_PER_COL_IDX
	ON HOMEPAGE.NR_NETWORK (PERSON_ID, COLLEAGUE_ID);		

GO	

-----------------------------------------
-- HOMEPAGE.EMD_RESOURCE_PREF
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_RESOURCE_PREF (
	RESOURCE_PREF_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
	FREQUENCY_TYPE NUMERIC(5,0) NOT NULL,
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF 
  	ADD CONSTRAINT PK_RES_PREF_ID PRIMARY KEY(RESOURCE_PREF_ID);

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF
    ADD CONSTRAINT FK_RES_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.EMD_RESOURCE_PREF ADD CONSTRAINT FK_EMD_RES_PREF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE INDEX EMD_RES_PREF_PER_ID
    ON HOMEPAGE.EMD_RESOURCE_PREF (PERSON_ID);

CREATE UNIQUE INDEX EMD_RESOURCE_PREF_UNQ
	ON HOMEPAGE.EMD_RESOURCE_PREF (PERSON_ID, RESOURCE_TYPE); 
	
CREATE INDEX NR_EMD_RES_PRF_PER_FRQ_RES_IDX 
	ON HOMEPAGE.EMD_RESOURCE_PREF (PERSON_ID, FREQUENCY_TYPE, RESOURCE_TYPE);	

-----------------------------------------
-- HOMEPAGE.EMD_TRANCHE
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_TRANCHE (
	TRANCHE_ID nvarchar(36) NOT NULL,
	SEQ_NUMBER NUMERIC(5,0) NOT NULL,
	LAST_PROCESSED_DAILY DATETIME2(3),
	LAST_PROCESSED_WEEKLY DATETIME2(3),
	IS_LOCKED NUMERIC(5,0) NOT NULL,
	IS_LOCKED_DAILY NUMERIC(5,0) DEFAULT 0 NOT NULL,
	IS_LOCKED_WEEKLY NUMERIC(5,0) DEFAULT 0 NOT NULL,
	LAST_STARTED_DAILY DATETIME2(3),
	LAST_STARTED_WEEKLY DATETIME2(3),
	LAST_EXEC_TIME_DAILY_MIN NUMERIC(10,0),
	LAST_EXEC_TIME_WEEKLY_MIN NUMERIC(10,0),
	LAST_RUNNER_DAILY nvarchar(256),
	LAST_RUNNER_WEEKLY nvarchar(256),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.EMD_TRANCHE 
  	ADD CONSTRAINT PK_TRANCHE_ID PRIMARY KEY(TRANCHE_ID);

CREATE UNIQUE INDEX SEQ_NUMBER_UNIQUE
    ON HOMEPAGE.EMD_TRANCHE (SEQ_NUMBER, ORGANIZATION_ID);	

ALTER TABLE HOMEPAGE.EMD_TRANCHE ADD CONSTRAINT FK_EMD_TRANCHE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
-----------------------------------------
-- HOMEPAGE.EMD_TRANCHE_INFO
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_TRANCHE_INFO (
	TRANCHE_INFO_ID nvarchar(36) NOT NULL,
	TRANCHE_ID nvarchar(36) NOT NULL,
	COUNT_PROCESSED_DAILY NUMERIC(5,0),
	COUNT_PROCESSED_WEEKLY NUMERIC(5,0),
	AVG_EXEC_TIME_DAILY_MIN NUMERIC(5,0),
	AVG_EXEC_TIME_WEEKLY_MIN NUMERIC(5,0),
	DOMAIN_AFFINITY NVARCHAR(MAX),
	N_USERS NUMERIC(10,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO
  	ADD CONSTRAINT PK_TRC_INFO_ID PRIMARY KEY(TRANCHE_INFO_ID);

ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO
    ADD CONSTRAINT FK_TRANCHE_ID FOREIGN KEY (TRANCHE_ID)
	REFERENCES HOMEPAGE.EMD_TRANCHE (TRANCHE_ID);

ALTER TABLE HOMEPAGE.EMD_TRANCHE_INFO ADD CONSTRAINT FK_EMD_TRANCHE_INFO_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
-----------------------------------------
-- HOMEPAGE.EMD_EMAIL_PREFS
-----------------------------------------
CREATE TABLE HOMEPAGE.EMD_EMAIL_PREFS (
	EMAIL_PREFS_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	SEND_DIRECTED NUMERIC(5,0),
	TRANCHE_ID nvarchar(36) NOT NULL,
	EMAIL_ADDRESS nvarchar(256),
	LANG nvarchar(36),
	USE_TEXT_EMAIL NUMERIC(5,0),
	REPLYTO_ENABLED NUMERIC(5,0) NOT NULL DEFAULT 1,
	TIMEZONE nvarchar(255) DEFAULT NULL,
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS 
  	ADD CONSTRAINT PK_EMAIL_PREFS_ID PRIMARY KEY(EMAIL_PREFS_ID);

ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS
    ADD CONSTRAINT FK_EMD_PERSON_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
	
ALTER TABLE HOMEPAGE.EMD_EMAIL_PREFS ADD CONSTRAINT FK_EMD_EMAIL_PREFS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE UNIQUE INDEX EMD_EMAIL_PREFS_PER
    ON HOMEPAGE.EMD_EMAIL_PREFS (PERSON_ID);
    
CREATE INDEX EMD_EMAIL_PREFS_TR
    ON HOMEPAGE.EMD_EMAIL_PREFS (TRANCHE_ID);    

------------------------------
-- NR_COMM_PERSON_FOLLOW
------------------------------
CREATE TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW (
	COMM_PERSON_FOLLOW_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	PERSON_COMMUNITY_ID nvarchar(39) NOT NULL,
	IS_READER_COMM NUMERIC (5,0) DEFAULT 0 NOT NULL,
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
    ADD CONSTRAINT PK_COMM_PER_ID PRIMARY KEY(COMM_PERSON_FOLLOW_ID);

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
    ADD CONSTRAINT FK_COMM_PER_PER_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
	
ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW ADD CONSTRAINT FK_COMM_PERSON_FOLLOW_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);


ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
    ADD CONSTRAINT UNIQUE_PERS_P_COMM UNIQUE (PERSON_ID, PERSON_COMMUNITY_ID);	

CREATE INDEX NR_COMM_PER_FOLLOW_PER_ID
    ON HOMEPAGE.NR_COMM_PERSON_FOLLOW (PERSON_ID);

CREATE INDEX NR_COMM_FOLLOW_COM_PER_ID
    ON HOMEPAGE.NR_COMM_PERSON_FOLLOW (PERSON_COMMUNITY_ID);
    
-- 108309: CR3 - Improve per. for the 5th most expensive query
CREATE INDEX NR_COMM_PERSON_F 
	ON HOMEPAGE.NR_COMM_PERSON_FOLLOW (PERSON_ID, IS_READER_COMM, PERSON_COMMUNITY_ID, ORGANIZATION_ID);    

{SQL_GRANT_START} HOMEPAGE.NR_COMM_PERSON_FOLLOW {SQL_GRANT_STOP}

----------------------------------------------------------------
-- HOMEPAGE.NR_ENTRIES
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES (
	ENTRY_ID nvarchar(36) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0),
	CONTAINER_ID nvarchar(256),
	CONTAINER_NAME nvarchar(256),
	CONTAINER_URL nvarchar(2048),
	ITEM_ID nvarchar(256),
	ITEM_NAME nvarchar(256),
	ITEM_URL nvarchar(2048),
	ITEM_CREATION_DATE DATETIME2(3),
	ITEM_UPDATE_DATE DATETIME2(3),
	ITEM_TAGS nvarchar(1024),
	N_COMMENTS NUMERIC(10,0) DEFAULT NULL,
	N_RECOMMANDATIONS NUMERIC(10,0) DEFAULT NULL,
	LAST_COMMENT_ID nvarchar(256),
	LAST_DATE_COMMENT DATETIME2(3),
	LAST_AUTHOR_COMMENT nvarchar(36),
	PREV_COMMENT_ID nvarchar(256),
	PREV_DATE_COMMENT DATETIME2(3),
	PREV_AUTHOR_COMMENT nvarchar(36),
	ITEM_ATOM_URL nvarchar(2048),
	PREVIEW_IMAGE_URL nvarchar(2048),
	JSON_META_DATA NVARCHAR(MAX),
	ITEM_SCOPE NUMERIC(5,0),
	IS_LAST_COMMENT_PUBLIC NUMERIC(5,0),
	IS_PREV_COMMENT_PUBLIC NUMERIC(5,0),
	ITEM_CORRELATION_ID nvarchar(256),
	ITEM_CORRELATION_NAME nvarchar(256),
	LAST_DESC_COMMENT nvarchar(4000),
	PREV_DESC_COMMENT nvarchar(4000),
	LAST_UPDATE_DATE_COMMENT DATETIME2(3), 
	PREV_UPDATE_DATE_COMMENT DATETIME2(3),
	ITEM_AUTHOR_UUID nvarchar (256),
	ITEM_CORRELATION_AUTHOR_UUID nvarchar (256),
	BRIEF_DESC nvarchar (4000),
	ITEM_CORRELATION_BRIEF_DESC nvarchar(4000),
	IS_LAST_COMMENT_VISIBLE NUMERIC(5,0) DEFAULT 1,
	IS_PREV_COMMENT_VISIBLE NUMERIC(5,0) DEFAULT 1,
	LAST_UPDATE_RECORD DATETIME2(3),
	PREV_COMMENT_NUM_REC NUMERIC(10,0) DEFAULT NULL,
	LAST_COMMENT_NUM_REC NUMERIC(10,0) DEFAULT NULL,
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	PREV_COMMENT_OBJECT_META_DATA NVARCHAR(MAX),
	LAST_COMMENT_OBJECT_META_DATA NVARCHAR(MAX),
	LAST_COMMENT_TAGS nvarchar (1024),
	PREV_COMMENT_TAGS nvarchar (1024),
	IS_EXTERNAL NUMERIC(5 ,0) DEFAULT 0 NOT NULL,
	ITEM_CORRELATION_CREATION_DATE DATETIME2(3)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_ENTRIES
    ADD CONSTRAINT PK_ENTRY_ID PRIMARY KEY(ENTRY_ID);
    
ALTER TABLE HOMEPAGE.NR_ENTRIES ADD CONSTRAINT FK_ENTRIES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX NR_ENTRIES_CONT
    ON HOMEPAGE.NR_ENTRIES (CONTAINER_ID);

CREATE UNIQUE INDEX NR_ENTRIES_ITEMORG
    ON HOMEPAGE.NR_ENTRIES (ITEM_ID, ORGANIZATION_ID);

GO

----------------------------------------------------------------
-- HOMEPAGE.NR_STORIES
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_STORIES (
	STORY_ID nvarchar(36) NOT NULL,
	EVENT_NAME nvarchar(256) NOT NULL,
	SOURCE nvarchar(36),
	CONTAINER_ID nvarchar(256),	
	CONTAINER_NAME nvarchar(256),
	CONTAINER_URL nvarchar(2048),
	CONTAINER_ATOM_URL nvarchar(2048),
	ITEM_NAME nvarchar(256),
	ITEM_URL nvarchar(2048),
	ITEM_ATOM_URL nvarchar(2048),
	ITEM_ID nvarchar(256),
	ITEM_CORRELATION_ID nvarchar(256),
	CREATION_DATE DATETIME2(3) NOT NULL,
	BRIEF_DESC nvarchar(4000),
	ACTOR_UUID nvarchar(256),
	EVENT_RECORD_UUID nvarchar(36) NOT NULL,
	TAGS nvarchar(1024),
	META_TEMPLATE nvarchar(3328) DEFAULT '' NOT NULL,
	TEXT_META_TEMPLATE nvarchar(1024),
	R_META_TEMPLATE nvarchar(3328),
	R_TEXT_META_TEMPLATE nvarchar(1024),
	IS_COMMUNITY_STORY NUMERIC(5,0) DEFAULT 0,
	ITEM_CORRELATION_NAME nvarchar(256),
	HAS_ATTACHMENT NUMERIC(5,0) DEFAULT 0,
	SOURCE_TYPE NUMERIC(5,0),
	ENTRY_ID nvarchar(36),
	EVENT_TIME DATETIME2(3),
	VERB nvarchar (128),
	ITEM_SCOPE NUMERIC(5,0),
	ITEM_UPDATE_DATE DATETIME2(3),
	FIRST_RECIPIENT_ID nvarchar(36),
	NUM_RECIPIENTS NUMERIC(5,0), 
	PRIMARY_ACTION_URL nvarchar(768), 
	SECONDARY_ACTION_URL nvarchar(768),
	ITEM_AUTHOR_UUID nvarchar (256),
	ITEM_CORRELATION_AUTHOR_UUID nvarchar (256),
	EVENT_SCOPE NUMERIC(5 ,0),
	RELATED_COMMUNITY_ID nvarchar(39),
	ITEM_CORRELATION_SCOPE NUMERIC(5,0),
	ITEM_CORRELATION_UPDATE_DATE DATETIME2(3),
	ITEM_CORRELATION_URL nvarchar(2048),
	ENTRY_CORRELATION_ID nvarchar(256),
	ITEM_CORRELATION_ATOM_URL nvarchar(2048),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ITEM_CREATION_DATE DATETIME2(3),
	ITEM_CORRELATION_CREATION_DATE DATETIME2(3)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_STORIES
    ADD CONSTRAINT PK_STORY_ID PRIMARY KEY(STORY_ID);

ALTER TABLE HOMEPAGE.NR_STORIES
  	ADD CONSTRAINT FK_ENTRY_ID FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.NR_ENTRIES (ENTRY_ID);
	
ALTER TABLE HOMEPAGE.NR_STORIES ADD CONSTRAINT FK_STORIES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	

CREATE INDEX NR_STORIES_DATE
	ON HOMEPAGE.NR_STORIES (CREATION_DATE DESC);

CREATE INDEX STORY_CONTAINED_ID
    ON HOMEPAGE.NR_STORIES (CONTAINER_ID);

CREATE INDEX STORIES_ITEM_CORR_ID
    ON HOMEPAGE.NR_STORIES (ITEM_CORRELATION_ID, ORGANIZATION_ID);

CREATE INDEX NR_STORIES_EIDX
    ON HOMEPAGE.NR_STORIES (ENTRY_ID);

CREATE INDEX  NR_STORIES_ER_UUID 
	ON HOMEPAGE.NR_STORIES (EVENT_RECORD_UUID, STORY_ID);
	
CREATE INDEX NR_STORY_CD_IDX 
	ON HOMEPAGE.NR_STORIES (CREATION_DATE ASC, STORY_ID);    

CREATE INDEX STORIES_EVENT_ITEM_ACTOR_IDX ON
	HOMEPAGE.NR_STORIES (EVENT_NAME, ITEM_ID, ACTOR_UUID);

CREATE INDEX STORIES_ITEM_ID_IX ON
	HOMEPAGE.NR_STORIES (ITEM_ID);
	
CREATE INDEX NR_STORIES_REL_COMM
	ON HOMEPAGE.NR_STORIES (RELATED_COMMUNITY_ID);
	
CREATE INDEX STORIES_ITEM_ENTRY_CORR_ID
    ON HOMEPAGE.NR_STORIES (ENTRY_CORRELATION_ID, ORGANIZATION_ID); 	
GO

----------------------------------------------------------------
-- HOMEPAGE.NR_ENTRIES_ARCHIVE
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE (
	ENTRY_ID nvarchar(36) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0),
	CONTAINER_ID nvarchar(256),
	CONTAINER_NAME nvarchar(256),
	CONTAINER_URL nvarchar(2048),
	ITEM_ID nvarchar(256),
	ITEM_NAME nvarchar(256),
	ITEM_URL nvarchar(2048),
	ITEM_CREATION_DATE DATETIME2(3),
	ITEM_UPDATE_DATE DATETIME2(3),
	ITEM_TAGS nvarchar(1024),
	N_COMMENTS NUMERIC(5,0) DEFAULT NULL,
	N_RECOMMANDATIONS NUMERIC(5,0) DEFAULT NULL,
	LAST_COMMENT_ID nvarchar(256),
	LAST_DATE_COMMENT DATETIME2(3),
	LAST_AUTHOR_COMMENT nvarchar(36),
	PREV_COMMENT_ID nvarchar(256),
	PREV_DATE_COMMENT DATETIME2(3),
	PREV_AUTHOR_COMMENT nvarchar(36),
	ITEM_ATOM_URL nvarchar(2048),
	PREVIEW_IMAGE_URL nvarchar(2048),
	JSON_META_DATA NVARCHAR(MAX),
	ITEM_SCOPE NUMERIC(5,0),
	IS_LAST_COMMENT_PUBLIC NUMERIC(5,0),
	IS_PREV_COMMENT_PUBLIC NUMERIC(5,0),
	ITEM_CORRELATION_ID nvarchar(256),
	ITEM_CORRELATION_NAME nvarchar(256),
	LAST_DESC_COMMENT nvarchar(4000),
	PREV_DESC_COMMENT nvarchar(4000),
	LAST_UPDATE_DATE_COMMENT DATETIME2(3), 
	PREV_UPDATE_DATE_COMMENT DATETIME2(3),
	ITEM_AUTHOR_UUID nvarchar (256),
	ITEM_CORRELATION_AUTHOR_UUID nvarchar (256),
	BRIEF_DESC nvarchar (4000),
	ITEM_CORRELATION_BRIEF_DESC nvarchar (4000),
	IS_LAST_COMMENT_VISIBLE NUMERIC(5,0) DEFAULT 1,
	IS_PREV_COMMENT_VISIBLE NUMERIC(5,0) DEFAULT 1,
	LAST_UPDATE_RECORD DATETIME2(3),
	PREV_COMMENT_NUM_REC NUMERIC(10,0) DEFAULT NULL,
	LAST_COMMENT_NUM_REC NUMERIC(10,0) DEFAULT NULL,
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	PREV_COMMENT_OBJECT_META_DATA NVARCHAR(MAX),
	LAST_COMMENT_OBJECT_META_DATA NVARCHAR(MAX),
	LAST_COMMENT_TAGS nvarchar (1024),
	PREV_COMMENT_TAGS nvarchar (1024),
	IS_EXTERNAL NUMERIC(5 ,0) DEFAULT 0 NOT NULL,
	ITEM_CORRELATION_CREATION_DATE DATETIME2(3)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE
    ADD CONSTRAINT PK_ENTRY_AR_ID PRIMARY KEY(ENTRY_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE ADD CONSTRAINT FK_ENTRIES_ARCHIVE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
    
CREATE INDEX NR_ENTRIES_AR_CONT
    ON HOMEPAGE.NR_ENTRIES_ARCHIVE (CONTAINER_ID);

CREATE UNIQUE INDEX NR_ENTRIES_AR_ITEMORG
    ON HOMEPAGE.NR_ENTRIES_ARCHIVE (ITEM_ID, ORGANIZATION_ID);

GO

----------------------------------------------------------------------
-- HOMEPAGE.NR_AGGREGATED_READERS 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AGGREGATED_READERS (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5 ,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5 ,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5 ,0),
	USE_IN_ROLLUP NUMERIC(5 ,0),
	IS_NETWORK	NUMERIC(5 ,0),
	IS_FOLLOWER	NUMERIC(5 ,0),
	EVENT_TIME 	DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36)
) ON [PRIMARY]
GO
	
ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS
    ADD CONSTRAINT PK_AGG_READERS PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS 
	ADD CONSTRAINT FK_AGG_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);    
	
ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS ADD CONSTRAINT FK_AGG_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	

--  [start indexes] NR_AGGREGATED_READERS
CREATE  INDEX AGGREGATED_READERS_STR_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (STORY_ID); 
GO

CREATE  INDEX AGGREGATED_READERS_ITM_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (ITEM_ID); 
GO

CREATE  INDEX AGGREGATED_READERS_CD_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX AGGREGATED_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE  INDEX AGGREGATED_READERS_STR_RDR 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (STORY_ID, READER_ID, CONTAINER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX AGGREGATED_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (CREATION_DATE DESC, IS_BROADCAST); 
GO

CREATE  INDEX AGGREGATED_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX AGGREGATED_READERS_RLL_BRD_VVI
 	ON HOMEPAGE.NR_AGGREGATED_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO

CREATE  INDEX AGGREGATED_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_AGGREGATED_READERS (COMMUNITY_ID); 
GO

CREATE INDEX MPM_AGG_READERS_1B 
	ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, USE_IN_ROLLUP, ORGANIZATION_ID, CREATION_DATE, SOURCE_TYPE);
GO

CREATE INDEX MWC_AGG_READERS_1B
    ON HOMEPAGE.NR_AGGREGATED_READERS (ROLLUP_ENTRY_ID, CATEGORY_TYPE, READER_ID, USE_IN_ROLLUP, ORGANIZATION_ID, CREATION_DATE);
GO

--  [end indexes] NR_AGGREGATED_READERS
    


--------------------------------------------------------------------------
-- 11) HOMEPAGE.NR_STATUS_UPDATE_READERS
--------------------------------------------------------------------------	
CREATE TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0),
	USE_IN_ROLLUP NUMERIC(5,0),
	IS_NETWORK	NUMERIC(5,0),
	IS_FOLLOWER	NUMERIC(5,0),
	EVENT_TIME DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
   	CONSTRAINT  CK_CAT11_TYPE
    			CHECK
    			(CATEGORY_TYPE = 11)
) ON [PRIMARY]
GO

	
ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS 
    ADD CONSTRAINT PK_SU_READERS PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS
	ADD CONSTRAINT FK_STA_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);
	
ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS ADD CONSTRAINT FK_SU_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	

--  [start indexes] NR_STATUS_UPDATE_READERS
CREATE  INDEX STATUS_READERS_STR_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (STORY_ID); 
GO

CREATE  INDEX STATUS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (ITEM_ID); 
GO

CREATE  INDEX STATUS_READERS_CD_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX STATUS_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE INDEX STATUS_READERS_STR_RDR 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX STATUS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (CREATION_DATE DESC, IS_STORY_COMM); 
GO

CREATE  INDEX STATUS_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX STATUS_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO


CREATE  INDEX STATUS_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_STATUS_UPDATE_READERS (COMMUNITY_ID); 
GO

--  [end indexes] NR_STATUS_UPDATE_READERS

---------------------------------------------------------
-- 12) ADDING A NR_EXTERNAL_READERS READER TABLE
---------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_EXTERNAL_READERS (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0),
	USE_IN_ROLLUP NUMERIC(5,0),
	IS_NETWORK	NUMERIC(5,0),
	IS_FOLLOWER	NUMERIC(5,0),
	EVENT_TIME DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
   	CONSTRAINT  CK_CAT12_TYPE
    			CHECK
    			(CATEGORY_TYPE = 12)
) ON [PRIMARY]
GO

	
ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS 
    ADD CONSTRAINT PK_EXT_READERS PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS
	ADD CONSTRAINT FK_EXT_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);   
	
ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS ADD CONSTRAINT FK_EXT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
    
--  [start indexes] NR_EXTERNAL_READERS
CREATE  INDEX EXTERNAL_READERS_STR_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (STORY_ID); 
GO

CREATE  INDEX EXTERNAL_READERS_ITM_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (ITEM_ID); 
GO

CREATE  INDEX EXTERNAL_READERS_CD_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX EXTERNAL_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE INDEX EXTERNAL_READERS_STR_RDR 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX EXTERNAL_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (CREATION_DATE DESC); 
GO

CREATE  INDEX EXTERNAL_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX EXTERNAL_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO


CREATE  INDEX EXTERNAL_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_EXTERNAL_READERS (COMMUNITY_ID); 
GO

--  [end indexes] NR_EXTERNAL_READERS
    
---------------------------------------------------------
-- ADDING NR_ACTIONABLE_READERS READER TABLE
---------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ACTIONABLE_READERS (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0),
	USE_IN_ROLLUP NUMERIC(5,0),
	IS_NETWORK	NUMERIC(5,0),
	IS_FOLLOWER	NUMERIC(5,0),
	EVENT_TIME DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	OPERATION_ID nvarchar(512),
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
	CONSTRAINT   	CK_CAT_ACTION_TYPE
    				CHECK
    				(CATEGORY_TYPE >= 14 AND CATEGORY_TYPE <= 16)	
) ON [PRIMARY]
GO


	
ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS 
    ADD CONSTRAINT PK_ACTION_READERS PRIMARY KEY (CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS
	ADD CONSTRAINT FK_ACT_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);   
	
ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS ADD CONSTRAINT FK_ACT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
    
--  [start indexes] NR_ACTIONABLE_READERS
CREATE  INDEX ACTIONABLE_READERS_STR_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (STORY_ID); 
GO

CREATE  INDEX ACTIONABLE_READERS_ITM_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (ITEM_ID); 
GO

CREATE  INDEX ACTIONABLE_READERS_CD_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX ACTIONABLE_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE INDEX ACTIONABLE_READERS_STR_RDR 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX ACTIONABLE_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (CREATION_DATE DESC); 
GO

CREATE  INDEX ACTIONABLE_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX ACTIONABLE_READERS_RLL_BRD_VVI
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO


CREATE  INDEX ACTIONABLE_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_ACTIONABLE_READERS (COMMUNITY_ID); 
GO

--  [end indexes] NR_ACTIONABLE_READERS


-------------------------------------------------------
-- 1) HOMEPAGE.BOARD
-------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD  (
	BOARD_ID nvarchar(256) NOT NULL,
	BOARD_CONTAINER_ID nvarchar(256) NOT NULL,
	BOARD_TYPE nvarchar(64) NOT NULL,
	BOARD_OWNER_ASSOC_ID nvarchar(36) NOT NULL,
	BOARD_OWNER_ASSOC_TYPE nvarchar(64) NOT NULL,
	CREATED DATETIME2(3) NOT NULL,
	CREATED_BY nvarchar(36) NOT NULL,
	LASTUPDATE DATETIME2(3) NOT NULL,
	LASTUPDATE_BY nvarchar(36) NOT NULL,
	IS_ENABLED NUMERIC(5, 0) DEFAULT 1 NOT NULL,
	VISIBILITY nvarchar(36),
	EDITABILITY nvarchar(36),
	ORGANIZATION_ID nvarchar(36)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT BOARD_PK PRIMARY KEY (BOARD_ID);

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT FK_BRD_OWNER FOREIGN KEY (BOARD_OWNER_ASSOC_ID) 
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT FK_BRD_CREATED FOREIGN KEY (CREATED_BY) 
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);	

ALTER TABLE HOMEPAGE.BOARD 
	ADD CONSTRAINT FK_BRD_LASTUPDATE FOREIGN KEY (LASTUPDATE_BY) 
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.BOARD ADD CONSTRAINT FK_BOARD_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE UNIQUE INDEX BOARD_OWNER_ASSOC_UIDX 
	ON HOMEPAGE.BOARD (BOARD_OWNER_ASSOC_ID ASC, BOARD_TYPE ASC);

ALTER TABLE HOMEPAGE.BOARD
	ADD CONSTRAINT CONTAINER_ID_UNQ UNIQUE (BOARD_CONTAINER_ID);
      
CREATE UNIQUE INDEX BRD_CONTAINER_ID_UIDX 
	ON HOMEPAGE.BOARD (BOARD_CONTAINER_ID);	
	
GO

--------------------------------------
-- HOMEPAGE.BOARD_ENTRIES to store the relationship between a reader and a status update
--------------------------------------
CREATE TABLE HOMEPAGE.BOARD_ENTRIES  (
	ENTRY_ID nvarchar(47) NOT NULL, -- the format will include in the pk also the creation time
	ENTRY_TYPE NUMERIC (5,0),
	CATEGORY_TYPE NUMERIC (5,0),
	SOURCE nvarchar(36),
	SOURCE_TYPE NUMERIC (5,0),
	ITEM_ID nvarchar(36),
	ITEM_URL nvarchar(2048),
	CONTAINER_ID nvarchar(256),
	CREATION_DATE DATETIME2(3) NOT NULL, -- used also by the seedlist, when something is created the update is equal to is created
	UPDATE_DATE DATETIME2(3) NOT NULL, -- this field is used and queried from the the seedlist for initial and incremental index
	ACTOR_UUID nvarchar(36),
	IS_COMMUNITY_STORY NUMERIC (5,0) DEFAULT 0,
	TARGET_SUBJECT_ID nvarchar(256),
	TAGS nvarchar(1024),
	SL_IS_UPDATED NUMERIC (5,0) DEFAULT 0 NOT NULL, -- this field is used by the seedlist
	SL_IS_DELETED NUMERIC (5,0) DEFAULT 0 NOT NULL, -- this field is used by the seedlist
	SL_UPDATE_DATE DATETIME2(3) NOT NULL, -- this field is used by the seedlist
	LAST_CONTRIBUTOR_ID nvarchar(36),
	CONTENT_LOCALE  nvarchar(5),
	HTML_CONTENT NVARCHAR(MAX),
	CONTENT nvarchar (MAX),
	ORGANIZATION_ID nvarchar(36),
	CREATION_DATE_DISPLAY DATETIME2(3),
	UPDATE_DATE_DISPLAY DATETIME2(3),
	ACTOR_UUID_DISPLAY nvarchar(36),
	LAST_CONTRIBUTOR_ID_DISPLAY nvarchar(36)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.BOARD_ENTRIES 
    ADD CONSTRAINT PK_BRD_ENTRIES PRIMARY KEY(ENTRY_ID);

ALTER TABLE HOMEPAGE.BOARD_ENTRIES
	ADD CONSTRAINT FK_CONTAINER_ID FOREIGN KEY (CONTAINER_ID) 
	REFERENCES HOMEPAGE.BOARD (BOARD_CONTAINER_ID);	
	
ALTER TABLE HOMEPAGE.BOARD_ENTRIES ADD CONSTRAINT FK_BOARD_ENTRIES_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	

CREATE INDEX NEWS_BRD_SL_UPDATE
    ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC);

CREATE UNIQUE INDEX ITEM_ID_IDX
   ON HOMEPAGE.BOARD_ENTRIES (ITEM_ID ASC) INCLUDE (CONTAINER_ID);

CREATE INDEX CREATION_ITEM_IDX 
	ON HOMEPAGE.BOARD_ENTRIES (CREATION_DATE_DISPLAY DESC, ITEM_ID DESC);
	
CREATE INDEX BRD_E_CONTAINER_ID_UIDX 
	ON HOMEPAGE.BOARD_ENTRIES (CONTAINER_ID);

CREATE INDEX BRD_SL_UPDATED_DEL 
	ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC, SL_IS_DELETED);
	
CREATE INDEX BRD_ENTRIES_ITEM
	ON HOMEPAGE.BOARD_ENTRIES (ITEM_ID, SL_IS_DELETED);
	
CREATE INDEX SEEDLIST_BRD_IDX 
	ON HOMEPAGE.BOARD_ENTRIES (SL_UPDATE_DATE ASC, ENTRY_ID);
	
CREATE INDEX BRD_IS_DEL_CDATE_ACT_ENT
	ON HOMEPAGE.BOARD_ENTRIES (SL_IS_DELETED, CREATION_DATE DESC, ACTOR_UUID, ENTRY_TYPE);	
    
GO

--------------------------------------
-- HOMEPAGE.BOARD_COMMENTS
--------------------------------------
CREATE TABLE HOMEPAGE.BOARD_COMMENTS  (
	COMMENT_ID nvarchar(47) NOT NULL, -- the format will include in the pk also the creation time
	ACTOR_UUID nvarchar(36),
	CREATION_DATE DATETIME2(3) NOT NULL,
	ITEM_ID nvarchar(47),
	ENTRY_ID nvarchar(47),
	ITEM_URL nvarchar(2048),
	UPDATE_DATE DATETIME2(3),
	LAST_CONTRIBUTOR_ID nvarchar(36),
	CONTENT_LOCALE nvarchar(5),
	PUBLISHED_ORDER NUMERIC(10,0),
	TAGS nvarchar(1024),
	HTML_CONTENT NVARCHAR(MAX),
	CONTENT nvarchar(MAX),
	ORGANIZATION_ID nvarchar(36),
	AUTHOR_UUID_DISPLAY nvarchar(36),
	LAST_CONTRIBUTOR_ID_DISPLAY nvarchar(36),
	CREATION_DATE_DISPLAY DATETIME2(3),
	UPDATE_DATE_DISPLAY DATETIME2(3)
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.BOARD_COMMENTS 
    ADD CONSTRAINT PK_BRD_COMMENT_ID PRIMARY KEY(COMMENT_ID);

ALTER TABLE HOMEPAGE.BOARD_COMMENTS
	ADD CONSTRAINT FK_BRD_COM_ENTRY FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.BOARD_ENTRIES (ENTRY_ID);
	
ALTER TABLE HOMEPAGE.BOARD_COMMENTS  ADD CONSTRAINT FK_BOARD_COMMENTS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX NEWS_BRD_ITEM_ID
    ON HOMEPAGE.BOARD_COMMENTS  (ITEM_ID);

CREATE INDEX NEWS_BRD_ITEM_CORR_ID
    ON HOMEPAGE.BOARD_COMMENTS  (ENTRY_ID);

CREATE INDEX CREATION_DATE_IDX 
	ON HOMEPAGE.BOARD_COMMENTS (CREATION_DATE ASC);
	
CREATE INDEX ITEM_CORR_CREATION_IDX 
	ON HOMEPAGE.BOARD_COMMENTS (ENTRY_ID, CREATION_DATE ASC);
	
CREATE INDEX ITEM_ITEM_CORR_IDX
	ON HOMEPAGE.BOARD_COMMENTS (ITEM_ID ASC, ENTRY_ID ASC);	

CREATE UNIQUE INDEX BRD_COMM_ITEM_COR_PUB
    ON HOMEPAGE.BOARD_COMMENTS (ENTRY_ID, PUBLISHED_ORDER ASC); 
    
CREATE INDEX CREATION_DATE_ITEM_IDX
	ON HOMEPAGE.BOARD_COMMENTS (CREATION_DATE ASC, ITEM_ID);    
	
GO

----------------------------------------------------------------
-- ADDING NR_STATUS_ATTACHMENT
----------------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE (
	OBJECT_ID nvarchar(47) NOT NULL,
	ITEM_ID nvarchar(47) NOT NULL,
	DISPLAY_NAME nvarchar(2048),
	IMAGE_NAME   nvarchar(2048),
	NAME nvarchar(512), 
	URL nvarchar(1024), 
	CONTENT nvarchar(4000),
	IMAGE_URL nvarchar(1024),
	SOURCE  nvarchar(36),
	SOURCE_TYPE  NUMERIC(5 ,0),
	CREATION_DATE DATETIME2(3),
	TYPE nvarchar(36),
	AUTHOR_ID nvarchar(36),
	AUTHOR_DISPLAY_NAME nvarchar(256),
	OBJECT_META_DATA nvarchar(4000),
	OBJECT_META_DATA_2 nvarchar(4000),
	FULL_OBJECT_META_DATA nvarchar(MAX),
	OBJECT_EXTERNAL_ID nvarchar(256),
	ORGANIZATION_ID nvarchar(36)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE 
    ADD CONSTRAINT PK_BRD_OBJ_ID PRIMARY KEY(OBJECT_ID);

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE
	ADD CONSTRAINT FK_BRD_AUTHOR_ID FOREIGN KEY (AUTHOR_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);

ALTER TABLE HOMEPAGE.BOARD_OBJECT_REFERENCE ADD CONSTRAINT FK_BRD_OBJ_REFERENCE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE INDEX BRD_ENTRY_IDX
    ON HOMEPAGE.BOARD_OBJECT_REFERENCE (ITEM_ID);

CREATE INDEX BRD_AUTHOR_IDX
    ON HOMEPAGE.BOARD_OBJECT_REFERENCE (AUTHOR_ID);    
GO

--------------------------------------
-- HOMEPAGE.BOARD_RECOMMANDATIONS to store the relationship between a board entries and something which has been recommended
---------------------------------------
CREATE TABLE HOMEPAGE.BOARD_RECOMMENDATIONS  (
	RECOMMENDATION_ID nvarchar(47) NOT NULL, --primary key
	RECOMMENDER_ID nvarchar(36) NOT NULL, -- PERSON_ID of the recommender, FK to PERSON table
	ITEM_ID nvarchar(47) NOT NULL,
	SOURCE_TYPE NUMERIC (5,0) NOT NULL, 
	CREATION_DATE DATETIME2(3),
	ORGANIZATION_ID nvarchar(36),
	RECOMMENDER_ID_DISPLAY nvarchar(36),
	CREATION_DATE_DISPLAY DATETIME2(3)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS 
    ADD CONSTRAINT PK_BRD_RECOMM_ID PRIMARY KEY(RECOMMENDATION_ID);
    
ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS
	ADD CONSTRAINT FK_BRD_RECOMMENDER FOREIGN KEY (RECOMMENDER_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
	
ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS ADD CONSTRAINT FK_BRD_RECOMM_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS
	ADD CONSTRAINT FK_BRD_RECOMMENDER_D FOREIGN KEY (RECOMMENDER_ID_DISPLAY) REFERENCES HOMEPAGE.PERSON (PERSON_ID);

--ALTER TABLE HOMEPAGE.BOARD_RECOMMENDATIONS
--	ADD CONSTRAINT FK_BRD_ENTRY_ID FOREIGN KEY (ENTRY_ID)
--	REFERENCES HOMEPAGE.BOARD_ENTRIES (ENTRY_ID);    

CREATE INDEX BRD_REC_ITEM_ID
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (ITEM_ID);
    
CREATE UNIQUE INDEX BRD_REC_RECOM_D_ITEM_ID
	ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID_DISPLAY, ITEM_ID);
    
CREATE INDEX BRD_RECOMMENDER_ID
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID);
    
CREATE INDEX BRD_RECOMMENDER_ID_D
    ON HOMEPAGE.BOARD_RECOMMENDATIONS (RECOMMENDER_ID_DISPLAY);    
    
GO

------------------------------------------------
-- HOMEPAGE.BOARD_MENTIONS
------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_MENTIONS  (
	BOARD_MENTIONS_ID nvarchar(36) NOT NULL, --primary key
	ITEM_ID nvarchar(256) NOT NULL, 
	PERSON_ID nvarchar(36) NOT NULL, -- PERSON_ID of the recommender, FK to PERSON table
	LABEL nvarchar(4000),
	WAS_ITEM_VISIBLE NUMERIC(5,0) DEFAULT 0 NOT NULL,
	ORGANIZATION_ID nvarchar(36)
) ON [PRIMARY]
GO


ALTER TABLE HOMEPAGE.BOARD_MENTIONS 
    ADD CONSTRAINT PK_BRD_MEN_ID PRIMARY KEY (BOARD_MENTIONS_ID);

ALTER TABLE HOMEPAGE.BOARD_MENTIONS
	ADD CONSTRAINT FK_BRD_MEN_PER_ID FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);
	
ALTER TABLE HOMEPAGE.BOARD_MENTIONS ADD CONSTRAINT FK_BOARD_MENTIONS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE INDEX BRD_MEN_PER_IDX
	ON HOMEPAGE.BOARD_MENTIONS (PERSON_ID);
	
CREATE INDEX BRD_MEN_ITEM_IDX
	ON HOMEPAGE.BOARD_MENTIONS (ITEM_ID);	
	
GO	

-------------------------------------------------------
-- HOMEPAGE.BOARD_CURRENT_STATUS 
-- table to store the history of current status updates
-------------------------------------------------------
CREATE TABLE HOMEPAGE.BOARD_CURRENT_STATUS  (
	CURRENT_STATUS_ID nvarchar(47) NOT NULL, -- the format will include in the pk also the creation time
	ACTOR_UUID nvarchar(36) NOT NULL,
	ENTRY_ID nvarchar(47) NOT NULL,
	CURRENT_STATUS_SET DATETIME2(3) NOT NULL,
	ORGANIZATION_ID nvarchar(36)
) ON [PRIMARY]
GO


ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS 
    ADD CONSTRAINT PK_CUR_ST_ID PRIMARY KEY (CURRENT_STATUS_ID);

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS
	ADD CONSTRAINT FK_CUR_ST_ACTOR_ID FOREIGN KEY (ACTOR_UUID)
	REFERENCES HOMEPAGE.PERSON(PERSON_ID);

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS
	ADD CONSTRAINT FK_CUR_ST_ENTRY_ID FOREIGN KEY (ENTRY_ID)
	REFERENCES HOMEPAGE.BOARD_ENTRIES(ENTRY_ID);

ALTER TABLE HOMEPAGE.BOARD_CURRENT_STATUS ADD CONSTRAINT FK_BOARD_CURRENT_STATUS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE INDEX CURRENT_STATUS_INDEX 
	ON HOMEPAGE.BOARD_CURRENT_STATUS	(ACTOR_UUID ASC, CURRENT_STATUS_SET ASC, CURRENT_STATUS_ID ASC, ENTRY_ID ASC);

CREATE UNIQUE INDEX ACTOR_ENTRY 
	ON HOMEPAGE.BOARD_CURRENT_STATUS (ACTOR_UUID);
	
CREATE INDEX BRD_CURRENT_STATUS 
	ON HOMEPAGE.BOARD_CURRENT_STATUS (ENTRY_ID);
	
GO
	
---------------------------------------------------------------------------------
-- ADDING QUARANTINE TABLE
---------------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.DELETED_STORIES_QUEUE (
	QUEUE_ID nvarchar(36) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE 	nvarchar(36) NOT NULL, -- this is externalized
	SOURCE_TYPE NUMERIC(5,0) NOT NULL,
	STATUS NUMERIC(5,0) DEFAULT 0 NOT NULL,
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
)
ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.DELETED_STORIES_QUEUE 
  	ADD CONSTRAINT PK_QUARANTINE PRIMARY KEY(QUEUE_ID);
  	
ALTER TABLE HOMEPAGE.DELETED_STORIES_QUEUE ADD CONSTRAINT FK_DEL_STORIES_QUEUE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	

CREATE INDEX DELETED_STORY_ID 
  	ON HOMEPAGE.DELETED_STORIES_QUEUE (STORY_ID);

GO 

-----------------------------------------------
-- HOMEPAGE.NR_COMM_SETTINGS
-----------------------------------------------

CREATE TABLE HOMEPAGE.NR_COMM_SETTINGS (
	COMM_ID nvarchar(36) NOT NULL,
	MICROBLOGGING_WRITE_ACL NUMERIC(5 ,0),
	FLAGS nvarchar(36),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_COMM_SETTINGS
    ADD CONSTRAINT PK_COMM_ID PRIMARY KEY(COMM_ID);
    
ALTER TABLE HOMEPAGE.NR_COMM_SETTINGS ADD CONSTRAINT FK_COMM_SETTINGS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
    
GO 



-----------------------------------------------------
-- 18 NR_PROFILES_VIEW
-----------------------------------------------------
CREATE TABLE HOMEPAGE.NR_PROFILES_VIEW (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39),
	CATEGORY_TYPE NUMERIC(5,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0),
	USE_IN_ROLLUP NUMERIC(5,0),
	IS_NETWORK	NUMERIC(5,0),
	IS_FOLLOWER	NUMERIC(5,0),
	EVENT_TIME 	DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5 ,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
	CONSTRAINT   	CK_CAT18_TYPE
    				CHECK
    				(CATEGORY_TYPE = 18)
)
ON [PRIMARY]
GO


	
ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW 
    ADD CONSTRAINT PK_PROFILES_VIEW PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW
	ADD CONSTRAINT FK_PRO_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);    

ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW ADD CONSTRAINT FK_PRF_VIEW_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
--  [start indexes] NR_PROFILES_VIEW
CREATE  INDEX PROFILES_VIEW_STR_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID); 
GO

CREATE  INDEX PROFILES_VIEW_ITM_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ITEM_ID); 
GO

CREATE  INDEX PROFILES_VIEW_CD_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX PROFILES_VIEW_RLL_IIX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE INDEX PROFILES_VIEW_STR_RDR 
 	ON HOMEPAGE.NR_PROFILES_VIEW (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX PROFILES_VIEW_DEL_SERV_IX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (CREATION_DATE DESC, IS_BROADCAST); 
GO

CREATE  INDEX PROFILES_VIEW_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX PROFILES_VIEW_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO

--NEW ORG_ID NR_PROFILES_VIEW 
CREATE  INDEX PROFILES_VIEW_ORG_IIDX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (ORGANIZATION_ID, IS_VISIBLE, IS_BROADCAST, ROLLUP_ENTRY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX PROFILES_VIEW_COMM_IDX 
 	ON HOMEPAGE.NR_PROFILES_VIEW (COMMUNITY_ID); 
GO

--  [end indexes] NR_PROFILES_VIEW

--------------------------------------------------------------------------
-- 19 HOMEPAGE.NR_NOTIFICATION_SENT_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0),
	USE_IN_ROLLUP NUMERIC(5,0),
	IS_NETWORK	NUMERIC(5,0),
	IS_FOLLOWER	NUMERIC(5,0),
	EVENT_TIME 	DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
        CONSTRAINT   	CK_CAT19_TYPE
    			CHECK
    			(CATEGORY_TYPE = 19)
)
ON [PRIMARY]
GO

	
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS 
    ADD CONSTRAINT PK_SENT_NOT_READ PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS
	ADD CONSTRAINT FK_NOT_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);   
	
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS ADD CONSTRAINT FK_NOT_SENT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
--  [start indexes] NR_NOTIFICATION_SENT_READERS
CREATE  INDEX NOTIFICA_READERS_STR_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (STORY_ID); 
GO

CREATE  INDEX NOTIFICA_READERS_ITM_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (ITEM_ID); 
GO

CREATE  INDEX NOTIFICA_READERS_CD_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX NOTIFICA_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE INDEX NOTIFICA_READERS_STR_RDR 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX NOTIFICA_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (CREATION_DATE DESC); 
GO

CREATE  INDEX NOTIFICA_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX NOTIFICA_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO


CREATE  INDEX NOTIFICA_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (COMMUNITY_ID); 
GO

--  [end indexes] NR_NOTIFICATION_SENT_READERS

--------------------------------------------------------------------------
-- 20 HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0),
	USE_IN_ROLLUP NUMERIC(5,0),
	IS_NETWORK	NUMERIC(5,0),
	IS_FOLLOWER	NUMERIC(5,0),
	EVENT_TIME 	DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
        CONSTRAINT   	CK_CAT20_TYPE
    			CHECK
    			(CATEGORY_TYPE = 20)
) ON [PRIMARY]
GO



ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS 
    ADD CONSTRAINT PK_REC_NOT_READ PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS
	ADD CONSTRAINT FK_REC_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);
	
ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS ADD CONSTRAINT FK_NOT_REC_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
--  [start indexes] NR_NOTIFICATION_RECEIV_READERS
CREATE  INDEX NOT_REC_READERS_STR_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (STORY_ID); 
GO

CREATE  INDEX NOT_REC_READERS_ITM_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (ITEM_ID); 
GO

CREATE  INDEX NOT_REC_READERS_CD_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX NOT_REC_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (READER_ID, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX NOT_REC_READERS_STR_RDR 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX NOT_REC_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (CREATION_DATE DESC); 
GO

CREATE  INDEX NOT_REC_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (ROLLUP_ENTRY_ID, READER_ID, IS_VISIBLE, CREATION_DATE DESC); 
GO

CREATE  INDEX NOT_REC_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO


CREATE  INDEX NOT_REC_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (COMMUNITY_ID); 
GO

--  [end indexes] NR_NOTIFICATION_RECEIV_READERS


--------------------------------------------------------------------------
-- 13 HOMEPAGE.NR_SAVED_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_SAVED_READERS (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5,0),
	USE_IN_ROLLUP NUMERIC(5,0),
	IS_NETWORK	NUMERIC(5,0),
	IS_FOLLOWER	NUMERIC(5,0),
	EVENT_TIME DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	OPERATION_ID nvarchar(512),
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
	CONSTRAINT   	CK_CAT_SAVED_TYPE
    				CHECK
    				(CATEGORY_TYPE = 13)	
) ON [PRIMARY]
GO


	
ALTER TABLE HOMEPAGE.NR_SAVED_READERS 
    ADD CONSTRAINT PK_SAVED_READERS PRIMARY KEY (CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_SAVED_READERS
	ADD CONSTRAINT FK_SAV_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);
	
ALTER TABLE HOMEPAGE.NR_SAVED_READERS ADD CONSTRAINT FK_SAVED_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
--  [start indexes] NR_SAVED_READERS
CREATE  INDEX SAVED_READERS_STR_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID); 
GO

CREATE  INDEX SAVED_READERS_ITM_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (ITEM_ID); 
GO

CREATE  INDEX SAVED_READERS_CD_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX SAVED_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_SAVED_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE INDEX SAVED_READERS_STR_RDR 
 	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX SAVED_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_SAVED_READERS (CREATION_DATE DESC); 
GO

CREATE  INDEX SAVED_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_SAVED_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX SAVED_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_SAVED_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO


CREATE  INDEX SAVED_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_SAVED_READERS (COMMUNITY_ID); 
GO

--  [end indexes] NR_SAVED_READERS


--------------------------------------------------------------------------
-- 21 HOMEPAGE.NR_TOPICS_READERS
--------------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_TOPICS_READERS (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5 ,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5 ,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5 ,0),
	USE_IN_ROLLUP NUMERIC(5 ,0),
	IS_NETWORK	NUMERIC(5 ,0),
	IS_FOLLOWER	NUMERIC(5 ,0),
	EVENT_TIME 	DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar(256),
	IS_VISIBLE NUMERIC(5,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
	CONSTRAINT   	CK_CAT_TOPICS_TYPE
    				CHECK
    				(CATEGORY_TYPE = 21)	
) ON [PRIMARY]
GO



ALTER TABLE HOMEPAGE.NR_TOPICS_READERS 
    ADD CONSTRAINT PK_TOPICS_READERS PRIMARY KEY (CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_TOPICS_READERS
	ADD CONSTRAINT FK_TOP_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID); 

ALTER TABLE HOMEPAGE.NR_TOPICS_READERS ADD CONSTRAINT FK_TOPICS_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
--  [start indexes] NR_TOPICS_READERS
CREATE  INDEX TOPICS_READERS_STR_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (STORY_ID); 
GO

CREATE  INDEX TOPICS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (ITEM_ID); 
GO

CREATE  INDEX TOPICS_READERS_CD_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX TOPICS_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_TOPICS_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE INDEX TOPICS_READERS_STR_RDR 
 	ON HOMEPAGE.NR_TOPICS_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX TOPICS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_TOPICS_READERS (CREATION_DATE DESC); 
GO

CREATE  INDEX TOPICS_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_TOPICS_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX TOPICS_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_TOPICS_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO


CREATE  INDEX TOPICS_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_TOPICS_READERS (COMMUNITY_ID); 
GO

--  [end indexes] NR_TOPICS_READERS


----------------------------------------------------------------------
-- 22 HOMEPAGE.NR_MENTIONS_READERS 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_MENTIONS_READERS (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5 ,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5 ,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5 ,0),
	USE_IN_ROLLUP NUMERIC(5 ,0),
	IS_NETWORK	NUMERIC(5 ,0),
	IS_FOLLOWER	NUMERIC(5 ,0),
	EVENT_TIME 	DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
		CONSTRAINT   	CK_CAT22_TYPE
    			CHECK
    			(CATEGORY_TYPE = 22)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS
    ADD CONSTRAINT PK_MEN_READERS PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS 
	ADD CONSTRAINT FK_MEN_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID); 
	
ALTER TABLE HOMEPAGE.NR_MENTIONS_READERS ADD CONSTRAINT FK_MENT_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	

--  [start indexes] NR_MENTIONS_READERS
CREATE  INDEX MENTIONS_READERS_STR_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID); 
GO

CREATE  INDEX MENTIONS_READERS_ITM_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ITEM_ID); 
GO

CREATE  INDEX MENTIONS_READERS_CD_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX MENTIONS_READERS_RLL_IIX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE INDEX MENTIONS_READERS_STR_RDR 
 	ON HOMEPAGE.NR_MENTIONS_READERS (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX MENTIONS_READERS_DEL_SERV_IX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (CREATION_DATE DESC); 
GO

CREATE  INDEX MENTIONS_READERS_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX MENTIONS_READERS_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_MENTIONS_READERS (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO


CREATE  INDEX MENTIONS_READERS_COMM_IDX 
 	ON HOMEPAGE.NR_MENTIONS_READERS (COMMUNITY_ID); 
GO

--  [end indexes] NR_MENTIONS_READERS


----------------------------------------------------------------------
-- 23 HOMEPAGE.NR_COMMUNITIES_VIEW 
----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_COMMUNITIES_VIEW (
	CATEGORY_READER_ID nvarchar(36)  DEFAULT ' ' NOT NULL,
	READER_ID nvarchar(39) NOT NULL,
	CATEGORY_TYPE NUMERIC(5 ,0) NOT NULL,
	SOURCE nvarchar(36) NOT NULL,
	CONTAINER_ID nvarchar(256),
	ITEM_ID nvarchar(256),
	ROLLUP_ENTRY_ID nvarchar(256),
	RESOURCE_TYPE NUMERIC(5 ,0) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	SOURCE_TYPE NUMERIC(5 ,0),
	USE_IN_ROLLUP NUMERIC(5 ,0),
	IS_NETWORK	NUMERIC(5 ,0),
	IS_FOLLOWER	NUMERIC(5 ,0),
	EVENT_TIME 	DATETIME2(3),
	IS_STORY_COMM NUMERIC(5 ,0),
	IS_BROADCAST NUMERIC(5,0),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ACTOR_UUID nvarchar(256),
	ROLLUP_AUTHOR_ID nvarchar (256),
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL,
	COMMUNITY_ID nvarchar(36),
	ROLLUP_ACTION_TYPE nvarchar(36),
		CONSTRAINT   	CK_CAT23_TYPE
    			CHECK
    			(CATEGORY_TYPE = 23)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_COMMUNITIES_VIEW
    ADD CONSTRAINT PK_CV_READERS PRIMARY KEY(CATEGORY_READER_ID);
    
ALTER TABLE HOMEPAGE.NR_COMMUNITIES_VIEW 
	ADD CONSTRAINT FK_CV_READERS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID); 
	
ALTER TABLE HOMEPAGE.NR_COMMUNITIES_VIEW ADD CONSTRAINT FK_CV_READERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

--  [start indexes] NR_COMMUNITIES_VIEW
CREATE  INDEX COMMUNITIES_VIEW_STR_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (STORY_ID); 
GO

CREATE  INDEX COMMUNITIES_VIEW_ITM_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (ITEM_ID); 
GO

CREATE  INDEX COMMUNITIES_VIEW_CD_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (STORY_ID, CREATION_DATE DESC); 
GO

CREATE  INDEX COMMUNITIES_VIEW_RLL_IIX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (READER_ID, CATEGORY_TYPE, IS_VISIBLE, ORGANIZATION_ID, CREATION_DATE DESC); 
GO

CREATE UNIQUE INDEX COMMUNITIES_VIEW_STR_RDR 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (STORY_ID, READER_ID, CATEGORY_TYPE, ORGANIZATION_ID); 
GO

CREATE  INDEX COMMUNITIES_VIEW_DEL_SERV_IX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (CREATION_DATE DESC); 
GO

CREATE  INDEX COMMUNITIES_VIEW_ROLLUP_IIIX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (ROLLUP_ENTRY_ID, READER_ID, CATEGORY_TYPE, IS_VISIBLE); 
GO

CREATE  INDEX COMMUNITIES_VIEW_RLL_BRD_VVIS 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (ROLLUP_AUTHOR_ID, IS_BROADCAST, IS_VISIBLE); 
GO


CREATE  INDEX COMMUNITIES_VIEW_COMM_IDX 
 	ON HOMEPAGE.NR_COMMUNITIES_VIEW (COMMUNITY_ID); 
GO

--  [end indexes] NR_COMMUNITIES_VIEW

-----------------------------------------------------------------------
-- [START] SEEDLIST
-----------------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AS_SEEDLIST (
	SEEDLIST_ID nvarchar(36) NOT NULL, -- pk which is not linked to any value
	IS_VISIBLE NUMERIC(5 ,0) DEFAULT 1 NOT NULL, -- when an item id is moderated
	IS_DELETED NUMERIC(5 ,0) DEFAULT 0 NOT NULL, -- when a story is moderated
	DATA nvarchar(4000),
	FULL_DATA nvarchar (MAX), -- in case data is not enough big
	FOLLOWERS nvarchar(4000),
	FULL_FOLLOWERS nvarchar (MAX), -- in case followers is not enough big
	STORY_ID nvarchar(36) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	UPDATE_DATE DATETIME2(3) NOT NULL,
	ITEM_ID nvarchar(256),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000',
	COMMUNITY_ID nvarchar(36)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_AS_SEEDLIST
	ADD CONSTRAINT NR_SEEDLIST_PK PRIMARY KEY (SEEDLIST_ID);

ALTER TABLE HOMEPAGE.NR_AS_SEEDLIST ADD CONSTRAINT FK_AS_SEEDLIST_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE UNIQUE INDEX NR_SL_STR_UNIQUE
	ON HOMEPAGE.NR_AS_SEEDLIST(STORY_ID);	

CREATE INDEX NR_SL_ITEM_ID_IX
	ON HOMEPAGE.NR_AS_SEEDLIST (ITEM_ID);

CREATE INDEX NR_SL_UD_DELETED_VIS
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE DESC, IS_DELETED, IS_VISIBLE);
	
CREATE INDEX NR_SL_UD_DELETED
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE DESC);
	
CREATE INDEX NR_SL_CD_DELETED
	ON HOMEPAGE.NR_AS_SEEDLIST (CREATION_DATE DESC);	
	
CREATE INDEX NR_SL_UD_STR
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE ASC, STORY_ID);

-- Just sql server
CREATE INDEX NR_SL_UD_STR_DELETED_VIS_DESC
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE DESC, STORY_ID, IS_DELETED, IS_VISIBLE);    

CREATE INDEX NR_SL_UD_STR_DELETED_VIS_ASC
	ON HOMEPAGE.NR_AS_SEEDLIST (UPDATE_DATE ASC, STORY_ID, IS_DELETED, IS_VISIBLE);	
	

CREATE INDEX NR_SL_VIS_DELETED_US_STR
	ON HOMEPAGE.NR_AS_SEEDLIST (IS_VISIBLE, IS_DELETED, UPDATE_DATE DESC, STORY_ID);

CREATE INDEX NR_AS_SEEDLIST_COMM_IDX
	ON HOMEPAGE.NR_AS_SEEDLIST (COMMUNITY_ID);
GO


	
ALTER TABLE HOMEPAGE.NR_AS_SEEDLIST
	ADD CONSTRAINT NR_AS_SEEDLIST_UPDATE_DATE_DEFAULT DEFAULT (getdate()) FOR UPDATE_DATE;
	
GO

-----------------------------------------------------------------------
-- [END] SEEDLIST
-----------------------------------------------------------------------

------------------------------------------------
-- HOMEPAGE.NR_AS_COLLECTION_CONFIG
------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AS_COLLECTION_CONFIG (
	COLLECTION_ID nvarchar (50) NOT NULL,
	XML_DATA nvarchar (MAX) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_AS_COLLECTION_CONFIG
	ADD CONSTRAINT NR_AS_CONFIG_PK PRIMARY KEY (COLLECTION_ID);

GO

------------------------------------------------
-- HOMEPAGE.NR_AS_CRAWLER_STATUS
------------------------------------------------	
CREATE TABLE HOMEPAGE.NR_AS_CRAWLER_STATUS (
	COLLECTION_ID nvarchar (50) NOT NULL,
	XML_DATA nvarchar (MAX) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_AS_CRAWLER_STATUS
	ADD CONSTRAINT NR_AS_STATUS_PK PRIMARY KEY (COLLECTION_ID);

GO

------------------------------------------------------------------------------
-- ADD AS_CONTENT_INDEX_STATS TABLE
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS (
	STAT_ID nvarchar(36) NOT NULL,
	STAT_NAME nvarchar(2048),
	STAT_VALUE varbinary(MAX),
	STAT_UPDATE_DATE DATETIME2(3),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000'
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS
  	ADD CONSTRAINT NR_CONTENTSTATS_PK PRIMARY KEY(STAT_ID);

ALTER TABLE HOMEPAGE.NR_AS_CONTENT_INDEX_STATS ADD CONSTRAINT FK_AS_CNT_INDEX_STATS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
GO

--------------------------------------------------
-- HOMEPAGE.IMG_CACHE
--------------------------------------------------
CREATE TABLE HOMEPAGE.IMG_CACHE (
	IMG_CACHE_ID nvarchar(36) NOT NULL,
	ORIGINAL_URL nvarchar (1024) NOT NULL,
	FILE_PATH nvarchar (256) NOT NULL,
	NUM_REQUEST NUMERIC (10, 0),
	CREATION_DATE DATETIME2(3),
	LAST_REQUEST_DATE DATETIME2(3),
	MAX_HEIGHT NUMERIC(5,0),
	MAX_WIDTH NUMERIC(5,0),	
	TRANSFORMATION NUMERIC(5,0),
	ORGANIZATION_ID nvarchar (36) DEFAULT '00000000-0000-0000-0000-000000000000',
	ORIGINAL_URL_MD5 char(32) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.IMG_CACHE
  	ADD CONSTRAINT PK_IMG_CACHE_ID PRIMARY KEY(IMG_CACHE_ID);  

ALTER TABLE HOMEPAGE.IMG_CACHE ADD CONSTRAINT FK_IMG_CACHE_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);

CREATE UNIQUE INDEX IMG_CACHE_FILE_UNQ
	ON HOMEPAGE.IMG_CACHE (FILE_PATH);
	
CREATE INDEX IMG_CACHE_URL_IDX
	ON HOMEPAGE.IMG_CACHE (ORIGINAL_URL_MD5, ORGANIZATION_ID);
	
CREATE INDEX IMG_CACHE_DEL_BATCH_IDX 
   	ON HOMEPAGE.IMG_CACHE (LAST_REQUEST_DATE ASC, NUM_REQUEST ASC, FILE_PATH, IMG_CACHE_ID);

GO

-----------------------------------------------------------
-- HOMEPAGE.NR_AS_COUNTS
-----------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_AS_COUNTS (
	AS_COUNT_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,	
	UI_VIEW NUMERIC(5 ,0),
	COUNT NUMERIC(10),
	ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000' NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	UPDATE_DATE DATETIME2(3) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_AS_COUNTS 
  	ADD CONSTRAINT PK_AS_COUNT_ID PRIMARY KEY (AS_COUNT_ID);
  	
ALTER TABLE HOMEPAGE.NR_AS_COUNTS
    ADD CONSTRAINT FK_AS_COUNT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
    
ALTER TABLE HOMEPAGE.NR_AS_COUNTS
    ADD CONSTRAINT FK_AS_COUNT_PER_ID FOREIGN KEY (PERSON_ID) REFERENCES HOMEPAGE.PERSON (PERSON_ID);    

CREATE UNIQUE INDEX NR_COUNT_PER_VIEW_UNQ 
	ON HOMEPAGE.NR_AS_COUNTS (PERSON_ID, UI_VIEW, ORGANIZATION_ID);
	
CREATE INDEX NR_AS_COUNT_PER_IDX
	ON HOMEPAGE.NR_AS_COUNTS (PERSON_ID);
	
CREATE INDEX NR_AS_COUNT_ORG_IDX
	ON HOMEPAGE.NR_AS_COUNTS (ORGANIZATION_ID);
	
GO


------------------------------------------------
-- OEMBED_SCHEDULER_TASK
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_TASK (
	[TASKID] BIGINT NOT NULL ,
	[VERSION] NVARCHAR(5) NOT NULL ,
	[ROW_VERSION] INT NOT NULL ,
	[TASKTYPE] INT NOT NULL ,
	[TASKSUSPENDED] TINYINT NOT NULL ,
	[CANCELLED] TINYINT NOT NULL ,
	[NEXTFIRETIME] BIGINT NOT NULL ,
	[STARTBYINTERVAL] NVARCHAR(254) NULL ,
	[STARTBYTIME] BIGINT NULL ,
	[VALIDFROMTIME] BIGINT NULL ,
  	[VALIDTOTIME] BIGINT NULL ,
  	[REPEATINTERVAL] NVARCHAR(254) NULL ,
  	[MAXREPEATS] INT NOT NULL ,
  	[REPEATSLEFT] INT NOT NULL ,
  	[TASKINFO] IMAGE NULL ,
  	[NAME] NVARCHAR(254) NOT NULL ,
  	[AUTOPURGE] INT NOT NULL ,
  	[FAILUREACTION] INT NULL ,
  	[MAXATTEMPTS] INT NULL ,
  	[QOS] INT NULL ,
  	[PARTITIONID] INT NULL ,
  	[OWNERTOKEN] NVARCHAR(200) NOT NULL ,
  	[CREATETIME] BIGINT NOT NULL
) 
GO

ALTER TABLE HOMEPAGE.OEMBED_SCHEDULER_TASK WITH NOCHECK 
	ADD CONSTRAINT OEMBED_SCHEDULER_TASK_PK PRIMARY KEY  NONCLUSTERED ( [TASKID] ) 
GO

CREATE INDEX OEMBED_SCHEDULER_TASK_IDX1 
	ON HOMEPAGE.OEMBED_SCHEDULER_TASK ( [TASKID], [OWNERTOKEN] ) 
GO

CREATE CLUSTERED INDEX OEMBED_SCHEDULER_TASK_IDX2 
	ON HOMEPAGE.OEMBED_SCHEDULER_TASK ( [NEXTFIRETIME] ASC, [REPEATSLEFT], [PARTITIONID] )
GO

------------------------------------------------
-- OEMBED_SCHEDULER_TREG
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_TREG ( 
	[REGKEY] NVARCHAR(254) NOT NULL ,
	[REGVALUE] NVARCHAR(254) NULL ,
	PRIMARY KEY ( [REGKEY] ) )
GO

------------------------------------------------
-- OEMBED_SCHEDULER_LMGR
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_LMGR ( 
	[LEASENAME] NVARCHAR(254) NOT NULL,
	[LEASEOWNER] NVARCHAR(254) NOT NULL,
	[LEASE_EXPIRE_TIME] BIGINT,
	[DISABLED] NVARCHAR(5) )
GO

ALTER TABLE HOMEPAGE.OEMBED_SCHEDULER_LMGR WITH NOCHECK 
	ADD CONSTRAINT OEMBED_SCHEDULER_LMGR_PK PRIMARY KEY  NONCLUSTERED ( [LEASENAME] ) 
GO

------------------------------------------------
-- OEMBED_SCHEDULER_LMPR
------------------------------------------------
CREATE TABLE HOMEPAGE.OEMBED_SCHEDULER_LMPR ( 
	[LEASENAME] NVARCHAR(224) NOT NULL,
	[NAME] NVARCHAR(224) NOT NULL,
    [VALUE] NVARCHAR(254) NOT NULL )
GO

CREATE INDEX OEMBED_SCHEDULER_LMPR_IDX1 
	ON HOMEPAGE.OEMBED_SCHEDULER_LMPR ( [LEASENAME], [NAME] ) 
GO

---------------------------------------------------------------
-- HOMEPAGE.NR_CUSTOM_LIST
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_CUSTOM_LIST (
	CUSTOM_LIST_ID nvarchar(36) NOT NULL,
	CUSTOM_LIST_NAME nvarchar(1024) NOT NULL,
	CREATION_TIME DATETIME2(3) NOT NULL,
	UPDATE_TIME DATETIME2(3) NOT NULL,
	CUSTOM_LIST_SUMMARY nvarchar(2048),
	ORGANIZATION_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	STATE NUMERIC(5,0) NOT NULL,
	PERSON_DISPLAY nvarchar(36)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST 
  	ADD CONSTRAINT PK_CUSTOM_LIST_ID PRIMARY KEY(CUSTOM_LIST_ID);	
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST
  	ADD CONSTRAINT FK_CUST_L_PER_ID FOREIGN KEY(PERSON_ID) REFERENCES HOMEPAGE.PERSON (PERSON_ID);
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST
  	ADD CONSTRAINT FK_CUST_L_PER_D_ID FOREIGN KEY(PERSON_DISPLAY) REFERENCES HOMEPAGE.PERSON (PERSON_ID);  	
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST
  	ADD CONSTRAINT FK_CUST_L_ORG_ID FOREIGN KEY(ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
CREATE INDEX NR_CUSTOM_LIST_PER_ORG_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST (PERSON_ID, ORGANIZATION_ID);
	
CREATE INDEX NR_CUSTOM_LIST_PER_D_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST (PERSON_DISPLAY);	


---------------------------------------------------------------
-- HOMEPAGE.NR_CUSTOM_LIST_ITEM
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM (
	CUSTOM_LIST_ITEM_ID nvarchar(36) NOT NULL,
	CUSTOM_LIST_ID nvarchar(36) NOT NULL,
	ITEM_ID nvarchar(256) NOT NULL,
	CUSTOM_LIST_ITEM_NAME nvarchar(1024) NOT NULL,
	CREATION_TIME DATETIME2(3) NOT NULL,
	UPDATE_TIME DATETIME2(3) NOT NULL,
	TYPE nvarchar(256) NOT NULL,
	CUSTOM_LIST_ITEM_SUMMARY VARCHAR(2048),
	ORGANIZATION_ID nvarchar(36) NOT NULL,
	STATE NUMERIC(5,0) NOT NULL,
	PERSON_DISPLAY nvarchar(36)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM 
  	ADD CONSTRAINT PK_CUSTOM_LIST_ITEM_ID PRIMARY KEY(CUSTOM_LIST_ITEM_ID);
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM 
  	ADD CONSTRAINT FK_CUSTOM_LIST_ID FOREIGN KEY(CUSTOM_LIST_ID) REFERENCES HOMEPAGE.NR_CUSTOM_LIST (CUSTOM_LIST_ID);

ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM 
  	ADD CONSTRAINT FK_CUST_L_I_ORG_ID FOREIGN KEY(ORGANIZATION_ID) REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
  	
ALTER TABLE HOMEPAGE.NR_CUSTOM_LIST_ITEM
  	ADD CONSTRAINT FK_CUST_L_I_PER_D_ID FOREIGN KEY(PERSON_DISPLAY) REFERENCES HOMEPAGE.PERSON (PERSON_ID);  	
  	
CREATE INDEX NR_CUSTOM_LIST_ID_ORG_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (CUSTOM_LIST_ID, ORGANIZATION_ID);
	
CREATE UNIQUE INDEX NR_CUSTOM_LIST_ITEM_IDX_UNQ
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (ITEM_ID, CUSTOM_LIST_ID);
	
CREATE INDEX NR_CUSTOM_LIST_ITEM_PER_D_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (PERSON_DISPLAY);	

CREATE INDEX NR_CUSTOM_LIST_ITEM_CRTIME_IDX
	ON HOMEPAGE.NR_CUSTOM_LIST_ITEM (CREATION_TIME);	
GO

---------------------------------------------------------------
-- HOMEPAGE.NR_READ_STATUS
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_READ_STATUS (
	READ_STATUS_ID nvarchar(36) NOT NULL,
	PERSON_ID nvarchar(36) NOT NULL,
	STORY_ID nvarchar(36) NOT NULL,
	CREATION_DATE DATETIME2(3) NOT NULL,
	ORGANIZATION_ID nvarchar(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT PK_READ_STATUS_ID PRIMARY KEY(READ_STATUS_ID);
  	
ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT FK_READ_STATUS_PER FOREIGN KEY (PERSON_ID)
	REFERENCES HOMEPAGE.PERSON (PERSON_ID);  
	
ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT FK_READ_STATUS_STR FOREIGN KEY (STORY_ID)
	REFERENCES HOMEPAGE.NR_STORIES (STORY_ID);
	
ALTER TABLE HOMEPAGE.NR_READ_STATUS
  	ADD CONSTRAINT FK_READ_STATUS_ORG FOREIGN KEY (ORGANIZATION_ID)
	REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE UNIQUE INDEX READ_STATUS_PER_STR_UNQ_IDX
	ON HOMEPAGE.NR_READ_STATUS (PERSON_ID, STORY_ID);  
	
CREATE INDEX READ_STATUS_ORG_IDX
	ON HOMEPAGE.NR_READ_STATUS (ORGANIZATION_ID);
	
CREATE INDEX READ_STATUS_STORY_ID_IDX 
	ON HOMEPAGE.NR_READ_STATUS (STORY_ID);

GO

---------------------------------------
-- NR_ENTRIES_ROLLUP_ACTION
---------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION  (
        ENTRY_ROLLUP_ACTION_ID nvarchar(36) NOT NULL,
        ROLLUP_ENTRY_ID nvarchar(256) NOT NULL,
        ROLLUP_AUTHOR_ID nvarchar(36),
        TEMPLATE_NAME nvarchar(256) NOT NULL,
        ACTION nvarchar(50) NOT NULL,   			
        ACTION_COUNT NUMERIC(5 ,0) DEFAULT 0, 
		META_TEMPLATE nvarchar(3328) NOT NULL,
		TEXT_META_TEMPLATE nvarchar(1024) NOT NULL,
		CREATION_DATE DATETIME2(3) NOT NULL,
        UPDATE_DATE DATETIME2(3) NOT NULL,
		ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000' NOT NULL 		  
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION
	ADD CONSTRAINT PK_ENTRIES_ROLLUP_ACTION_ID PRIMARY KEY (ENTRY_ROLLUP_ACTION_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION
	ADD CONSTRAINT FK_ROLLUP_AUTHOR_ID FOREIGN KEY (ROLLUP_AUTHOR_ID) REFERENCES HOMEPAGE.PERSON(PERSON_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION 
	ADD CONSTRAINT FK_ORGANIZATION_ID FOREIGN KEY (ORGANIZATION_ID)  REFERENCES HOMEPAGE.MT_ORGANIZATION (ORGANIZATION_ID);
	
CREATE INDEX ENTR_ROLLUP_ACT_CDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (CREATION_DATE DESC);
	
CREATE INDEX ENTR_ROLLUP_ACT_UDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (UPDATE_DATE DESC);

CREATE UNIQUE INDEX ENTR_ROLLUP_ACT_UNQ_IDX
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ROLLUP_ENTRY_ID, ACTION, ROLLUP_AUTHOR_ID, ORGANIZATION_ID);
	
CREATE INDEX ENTR_ROLLUP_ACT_AUT_ID_IDX
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ROLLUP_AUTHOR_ID, ORGANIZATION_ID);	

CREATE INDEX ENTR_ROLLUP_ENTRYACT_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ROLLUP_ENTRY_ID, ACTION);

---------------------------------------------------------------
-- NR_ENTRIES_ROLLUP_PERSON
---------------------------------------------------------------
CREATE TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON  (
        ENTRY_ROLLUP_PERSON_ID nvarchar(36) NOT NULL,
        ENTRY_ROLLUP_ACTION_ID nvarchar(36) NOT NULL,			
        PERSON_ID nvarchar(36) NOT NULL,			
        ACTION_COUNT NUMERIC(5 ,0) DEFAULT 0,
		CREATION_DATE DATETIME2(3) NOT NULL,
        UPDATE_DATE DATETIME2(3) NOT NULL,
		ORGANIZATION_ID nvarchar(36) DEFAULT '00000000-0000-0000-0000-000000000000' NOT NULL 	  		  
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON
	ADD CONSTRAINT PK_ENTRY_ROLLUP_PERSON_ID PRIMARY KEY (ENTRY_ROLLUP_PERSON_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON
	ADD CONSTRAINT FK_ENTRY_ROLLUP_ACTION_ID FOREIGN KEY (ENTRY_ROLLUP_ACTION_ID) REFERENCES HOMEPAGE.NR_ENTRIES_ROLLUP_ACTION (ENTRY_ROLLUP_ACTION_ID);

ALTER TABLE HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON 
	ADD CONSTRAINT FK_PERSON_ID FOREIGN KEY (PERSON_ID) REFERENCES HOMEPAGE.PERSON(PERSON_ID);

CREATE INDEX ENTR_ROLLUP_PER_CDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (CREATION_DATE DESC);

CREATE INDEX ENTR_ROLLUP_PER_UDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (UPDATE_DATE DESC);

CREATE INDEX ENTR_ROLLUP_PER_PER_ID_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (PERSON_ID, ORGANIZATION_ID);

CREATE UNIQUE INDEX ENTR_ROLLUP_PER_ROL_ACTI_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (ENTRY_ROLLUP_ACTION_ID, PERSON_ID, ORGANIZATION_ID);	

CREATE INDEX ENTR_ROLLUP_PER_ENTRUDATE_IDX 
	ON HOMEPAGE.NR_ENTRIES_ROLLUP_PERSON (ENTRY_ROLLUP_ACTION_ID, UPDATE_DATE DESC);
	
-----------------------------------------------------------------------------------------

-----------------------------------------------------------------------
-- HOMEPAGE.L3T_ORGANIZATION table
-----------------------------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_ORGANIZATION (
	ORGANIZATION_ID VARCHAR(36) NOT NULL,
	ORGANIZATION_EXID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_ORGANIZATION ADD CONSTRAINT PK_L3T_ORGANIZATION_ID PRIMARY KEY(ORGANIZATION_ID);
GO

CREATE UNIQUE INDEX UNQ_L3T_ORG_EXID ON HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_EXID);
GO



-------------------------------------------------
-- HOMEPAGE.L3T_COMPANIES
-------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_COMPANIES (
		COMPANY_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(128) NOT NULL,
		OPENID_ORG VARCHAR(128) NOT NULL,
		LOTUSLIVE_INSTANCE VARCHAR(5) NOT NULL,
		PACKAGEPREF_DEFAULT VARCHAR(11) NOT NULL,
		CREATED DATETIME2(3) NOT NULL,
		MODIFIED DATETIME2(3) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO


ALTER TABLE HOMEPAGE.L3T_COMPANIES ADD CONSTRAINT PK_COMPANY_ID PRIMARY KEY (COMPANY_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANIES ADD CONSTRAINT FK_COM_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE UNIQUE INDEX UNQ_OPENID_ORG_IDX  ON HOMEPAGE.L3T_COMPANIES (OPENID_ORG);
GO  
	

-------------------------------------------------
-- HOMEPAGE.L3T_USERS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USERS (
		USER_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(256) NOT NULL,
		OPENID_IDENTITY VARCHAR(256) NOT NULL,
		EMAIL VARCHAR(256) NOT NULL,
		COMPANY_ID VARCHAR(36) NOT NULL,
		LOGGED_IN NUMERIC(5,0) NOT NULL,
		LOGGED_IN_TIME DATETIME2(3) NOT NULL,
		LANG VARCHAR(6) NOT NULL,
		PACKAGEPREF_DEFAULT VARCHAR(6) NOT NULL,
		LAST_AGREEMENT INTEGER NOT NULL DEFAULT 0,
		CREATED DATETIME2(3) NOT NULL,
		MODIFIED DATETIME2(3) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT PK_USERS_ID PRIMARY KEY (USER_ID);
GO

CREATE UNIQUE INDEX UNQ_OPENID_IDENTITY_IDX ON HOMEPAGE.L3T_USERS (OPENID_IDENTITY);
GO

ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT FK_USERS_COMPANY_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID);
GO

ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT FK_USERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX USERS_COMP_IDX ON HOMEPAGE.L3T_USERS (COMPANY_ID);
CREATE INDEX USERS_ORG_IDX ON HOMEPAGE.L3T_USERS (ORGANIZATION_ID);
GO



-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGES
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGES (
		PACKAGE_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(40) NOT NULL,
		ENTITLE_EVERYONE NUMERIC(5,0) NOT NULL,
		OWNER_ID VARCHAR(36) NOT NULL,
		TOKEN VARCHAR(12),
		MAINT_MODE NUMERIC(5,0) NOT NULL DEFAULT 1,
		CREATED DATETIME2(3) NOT NULL,
		MODIFIED DATETIME2(3) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL,
		DELETEABLE NUMERIC(5,0) NOT NULL DEFAULT 1
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT PK_PACKAGES_ID PRIMARY KEY (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT FK_PACKAGES_OWNER_ID FOREIGN KEY (OWNER_ID) REFERENCES HOMEPAGE.L3T_USERS 	(USER_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT FK_PACKAGES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX PKG_OWNER_IDX ON HOMEPAGE.L3T_PACKAGES (OWNER_ID);
CREATE INDEX PKG_ORG_IDX ON HOMEPAGE.L3T_PACKAGES (ORGANIZATION_ID);
GO

-------------------------------------------------
-- HOMEPAGE.L3T_COMPANY_ENTITLEMENTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (
		COMPANY_ENTITLEMENTS_ID VARCHAR(36) NOT NULL,
		COMPANY_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		CREATED DATETIME2(3) NOT NULL,
		MODIFIED DATETIME2(3) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT PK_COMPANY_ENT_ID PRIMARY KEY (COMPANY_ENTITLEMENTS_ID);
GO

CREATE UNIQUE INDEX UNQ_COM_ENT_COM_PKG_IDX ON  HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (COMPANY_ID, PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT FK_COM_ENT_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT FK_COM_ENT_COM_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT FK_COM_ENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX COM_ENT_PKG_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (PACKAGE_ID);
CREATE INDEX COM_ENT_COMP_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (COMPANY_ID);
CREATE INDEX COM_ENT_ORG_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (ORGANIZATION_ID);
GO




-------------------------------------------------
-- HOMEPAGE.L3T_COMPANY_PKG_PREFS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS (
		COMPANY_PKG_PREFS_ID VARCHAR(36) NOT NULL,
		COMPANY_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		PREFERENCE VARCHAR(11) NOT NULL,
		CREATED DATETIME2(3) NOT NULL,
		MODIFIED DATETIME2(3) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT PK_COMPANY_PKG_PREFS_ID PRIMARY KEY (COMPANY_PKG_PREFS_ID);
GO

CREATE UNIQUE INDEX UNQ_COM_PKG_PREF_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS  (COMPANY_ID, PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT FK_COM_PKG_PREF_COM_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT FK_COM_PKG_PREF_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT FK_COM_PKG_PREF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX COMP_PRF_PKG_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (PACKAGE_ID);
CREATE INDEX COMP_PRF_COMP_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (COMPANY_ID);
CREATE INDEX COMP_PRF_ORG_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (ORGANIZATION_ID);
GO

-------------------------------------------------
-- HOMEPAGE.L3T_EXT_META2
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_EXT_META2 (
		EXT_META2_ID VARCHAR(36) NOT NULL,
		UNID VARCHAR(512) NOT NULL,
		OPENID_ORG VARCHAR(512) NOT NULL,
		TYPE VARCHAR(512) NOT NULL,
		PARENT VARCHAR(36) NOT NULL,
		NODE_KEY VARCHAR(256),
		NODE_VALUE VARCHAR(512),
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_EXT_META2 ADD CONSTRAINT PK_EXT_META2_ID PRIMARY KEY (EXT_META2_ID);
GO

ALTER TABLE HOMEPAGE.L3T_EXT_META2 ADD CONSTRAINT FK_EXT_META2_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX EXT_META2_ORG_IDX ON HOMEPAGE.L3T_EXT_META2 (ORGANIZATION_ID);
CREATE INDEX EXT_META2_UNIDNKEY_IDX ON HOMEPAGE.L3T_EXT_META2 (UNID, NODE_KEY);
CREATE INDEX EXT_META2_PARENT_IDX ON HOMEPAGE.L3T_EXT_META2 (PARENT);
GO

-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGE_DETAILS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGE_DETAILS (
		PACKAGE_DETAILS_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		POSITION_ID VARCHAR(512) NOT NULL,
		WIDGET VARCHAR(512) NOT NULL,
		LABS_ID VARCHAR(512) NOT NULL,
		POSITION_TYPE VARCHAR(36) NOT NULL,
		POSITION_INDEX INTEGER NOT NULL DEFAULT 0,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT PK_PACKAGE_DETAILS_ID PRIMARY KEY (PACKAGE_DETAILS_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT FK_PKG_DET_PKG_IDFOREIGN FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT FK_PKG_DET_PKG_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX PKG_DET_PKG_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (PACKAGE_ID);
CREATE INDEX PKG_DET_ORG_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (ORGANIZATION_ID);
CREATE INDEX L3T_PACKAGE_DETAILS_LABSID_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (LABS_ID);
GO

-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGE_LOCATION
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGE_LOCATION (
		PACKAGE_LOCATION_ID VARCHAR(36) NOT NULL,
		POSITION_URL VARCHAR(512) NOT NULL,
		LABS_ID VARCHAR(512) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_LOCATION ADD CONSTRAINT PK_PACKAGE_LOCATION_ID PRIMARY KEY (PACKAGE_LOCATION_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_LOCATION ADD CONSTRAINT FK_PACKAGE_LOCATION_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX PKG_LOC_ORG_IDX ON HOMEPAGE.L3T_PACKAGE_LOCATION (ORGANIZATION_ID);
GO

CREATE INDEX L3T_PACKAGE_LOCATN_LABSID_IDX ON HOMEPAGE.L3T_PACKAGE_LOCATION (LABS_ID);
GO


-------------------------------------------------
-- HOMEPAGE.L3T_USER_ENTITLEMENTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS (
		USER_ENTITLEMENTS_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		USER_ID VARCHAR(36) NOT NULL,
		CREATED DATETIME2(3) NOT NULL,
		MODIFIED DATETIME2(3) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL		
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS ADD CONSTRAINT PK_USER_ENTITLEMENTS_ID PRIMARY KEY (USER_ENTITLEMENTS_ID);
GO

CREATE UNIQUE INDEX UNQ_USR_ENT_PKG_USR_IDX ON HOMEPAGE.L3T_USER_ENTITLEMENTS  (PACKAGE_ID,  USER_ID);
GO

ALTER TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS ADD CONSTRAINT FK_USR_ENT_PGK_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES 	(PACKAGE_ID);
GO


-------------------------------------------------
-- HOMEPAGE.L3T_USER_PKG_PREFS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USER_PKG_PREFS (
		USER_PKG_PREFS_ID VARCHAR(36) NOT NULL, 
		PACKAGE_ID VARCHAR(36) NOT NULL,
		USER_ID VARCHAR(36) NOT NULL,
		PREFERENCE VARCHAR(9) NOT NULL,
		CREATED DATETIME2(3) NOT NULL,
		MODIFIED DATETIME2(3) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT PK_USER_PKG_PREFS_ID PRIMARY KEY (USER_PKG_PREFS_ID);
GO

CREATE UNIQUE INDEX  USER_PKG_PREF_PKG_USR_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS  (PACKAGE_ID, USER_ID);
GO

ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT FK_USR_PKG_PRF_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT FK_USR_PKG_PRF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX USR_PGK_PFR_PKG_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS (PACKAGE_ID);
CREATE INDEX USR_PKG_PRF_ORG_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS (ORGANIZATION_ID);
GO


-------------------------------------------------
-- HOMEPAGE.L3T_EXT_POINTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_EXT_POINTS (
		EXT_POINT_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(256) NOT NULL,
		SERVICE VARCHAR(128) NOT NULL,
		EXT_TYPE VARCHAR(128) NOT NULL,
		DESCRIPTION VARCHAR(512)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_EXT_POINTS ADD CONSTRAINT PK_EXT_POINT_ID PRIMARY KEY (EXT_POINT_ID);
GO


-------------------------------------------------
-- HOMEPAGE.L3T_EXT_BINDS
-------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_EXT_BINDS (
		EXT_BIND_ID VARCHAR(36) NOT NULL,
		EXT_ID VARCHAR(36) NOT NULL,
		EXT_POINT_ID VARCHAR(36) NOT NULL,
		ENABLED NUMERIC(5,0) NOT NULL DEFAULT 0,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_EXT_BINDS ADD CONSTRAINT PK_EXT_BIND_ID PRIMARY KEY (EXT_BIND_ID);
CREATE UNIQUE INDEX UNQ_EXT_BIND_IDX ON HOMEPAGE.L3T_EXT_BINDS (EXT_ID, EXT_POINT_ID, ORGANIZATION_ID);
GO


------------------------------------- V2 AppRegistry -------------------------------------

------------ SERVICES ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICES(
	ID nvarchar(36) NOT NULL,
	NAME nvarchar(100) NOT NULL,
	TITLE nvarchar(100),
	ENABLE SMALLINT DEFAULT 0,
	DESCRIPTION nvarchar(500),
	TRANSLATIONS nvarchar(1000),
	SCOPE nvarchar(12),
	LAST_MODIFIED DATETIME2(6) NOT NULL,
	PAYLOAD nvarchar(max)
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_SERVICES ADD CONSTRAINT PK_SERVICES_ID PRIMARY KEY (ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICES ADD CONSTRAINT UK_SERVICE_NAME UNIQUE(NAME);
GO

------------ PATHS ------------
CREATE TABLE HOMEPAGE.APPREG_PATHS(
	ID nvarchar(36) NOT NULL,
	NAME nvarchar(100) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_PATHS ADD CONSTRAINT PK_PATHS PRIMARY KEY (ID);
ALTER TABLE HOMEPAGE.APPREG_PATHS ADD CONSTRAINT UK_PATHS UNIQUE(NAME);
GO

------------ OBJECTS ------------
CREATE TABLE HOMEPAGE.APPREG_OBJECTS(
	ID nvarchar(36) NOT NULL,
	NAME nvarchar(100) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_OBJECTS ADD CONSTRAINT PK_OBJECTS PRIMARY KEY (ID);
ALTER TABLE HOMEPAGE.APPREG_OBJECTS ADD CONSTRAINT UK_OBJECTS UNIQUE(NAME);
GO

------------ EVENTS ------------
CREATE TABLE HOMEPAGE.APPREG_EVENTS(
	ID nvarchar(36) NOT NULL,
	NAME nvarchar(100) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_EVENTS ADD CONSTRAINT PK_EVENTS PRIMARY KEY (ID);
ALTER TABLE HOMEPAGE.APPREG_EVENTS ADD CONSTRAINT UK_EVENTS UNIQUE(NAME);
GO

------------ RESOURCES ------------
CREATE TABLE HOMEPAGE.APPREG_RESOURCES(
	ID nvarchar(36) NOT NULL,
	NAME nvarchar(100) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_RESOURCES ADD CONSTRAINT PK_RESOURCES PRIMARY KEY (ID);
ALTER TABLE HOMEPAGE.APPREG_RESOURCES ADD CONSTRAINT UK_RESOURCES UNIQUE(NAME);
GO

------------ THEMES ------------
CREATE TABLE HOMEPAGE.APPREG_THEMES(
	ID nvarchar(36) NOT NULL,
	NAME nvarchar(100) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_THEMES ADD CONSTRAINT PK_THEMES PRIMARY KEY (ID);
ALTER TABLE HOMEPAGE.APPREG_THEMES ADD CONSTRAINT UK_THEMES UNIQUE(NAME);
GO

------------ SERVICE_PATH ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_PATH(
	SERVICE_ID nvarchar(36) NOT NULL,
	PATH_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_SERVICE_PATH ADD CONSTRAINT PK_SRVPTH_SERVICE_PATH PRIMARY KEY (SERVICE_ID, PATH_ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_PATH ADD CONSTRAINT FK_SRVPTH_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_PATH ADD CONSTRAINT FK_SRVPTH_PATH_ID FOREIGN KEY (PATH_ID) REFERENCES HOMEPAGE.APPREG_PATHS (ID);
CREATE INDEX UNQ_APPREG_SRV_PTH_SRV_ID ON HOMEPAGE.APPREG_SERVICE_PATH (SERVICE_ID);
CREATE INDEX UNQ_APPREG_SRV_PTH_PTH_ID ON HOMEPAGE.APPREG_SERVICE_PATH (PATH_ID);
GO

------------ SERVICE_OBJECT ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_OBJECT(
	SERVICE_ID nvarchar(36) NOT NULL,
	OBJECT_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_SERVICE_OBJECT ADD CONSTRAINT PK_SRVOBJ_SERVICE_OBJECT PRIMARY KEY (SERVICE_ID, OBJECT_ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_OBJECT ADD CONSTRAINT FK_SRVOBJ_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_OBJECT ADD CONSTRAINT FK_SRVOBJ_OBJECT_ID FOREIGN KEY (OBJECT_ID) REFERENCES HOMEPAGE.APPREG_OBJECTS (ID);
CREATE INDEX UNQ_APPREG_SRV_OBJ_SRV_ID ON HOMEPAGE.APPREG_SERVICE_OBJECT (SERVICE_ID);
CREATE INDEX UNQ_APPREG_SRV_OBJ_OBJ_ID ON HOMEPAGE.APPREG_SERVICE_OBJECT (OBJECT_ID);
GO

------------ SERVICE_EVENT ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_EVENT(
	SERVICE_ID nvarchar(36) NOT NULL,
	EVENT_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_SERVICE_EVENT ADD CONSTRAINT PK_SRVEVN_SERVICE_EVENT PRIMARY KEY (SERVICE_ID, EVENT_ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_EVENT ADD CONSTRAINT FK_SRVEVN_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_EVENT ADD CONSTRAINT FK_SRVEVN_EVENT_ID FOREIGN KEY (EVENT_ID) REFERENCES HOMEPAGE.APPREG_EVENTS (ID);
CREATE INDEX UNQ_APPREG_SRV_EVN_SRV_ID ON HOMEPAGE.APPREG_SERVICE_EVENT (SERVICE_ID);
CREATE INDEX UNQ_APPREG_SRV_EVN_EVN_ID ON HOMEPAGE.APPREG_SERVICE_EVENT (EVENT_ID);
GO

------------ SERVICE_RESOURCE ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_RESOURCE(
	SERVICE_ID nvarchar(36) NOT NULL,
	RESOURCE_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_SERVICE_RESOURCE ADD CONSTRAINT PK_SRVRES_SERVICE_RESOURCE PRIMARY KEY (SERVICE_ID, RESOURCE_ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_RESOURCE ADD CONSTRAINT FK_SRVRES_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_RESOURCE ADD CONSTRAINT FK_SRVRES_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES HOMEPAGE.APPREG_RESOURCES (ID);
CREATE INDEX UNQ_APPREG_SRV_RES_SRV_ID ON HOMEPAGE.APPREG_SERVICE_RESOURCE (SERVICE_ID);
CREATE INDEX UNQ_APPREG_SRV_RES_RES_ID ON HOMEPAGE.APPREG_SERVICE_RESOURCE (RESOURCE_ID);
GO

------------ SERVICE_THEME ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_THEME(
	SERVICE_ID nvarchar(36) NOT NULL,
	THEME_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_SERVICE_THEME ADD CONSTRAINT PK_SRVTHM_SERVICE_THEME PRIMARY KEY (SERVICE_ID, THEME_ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_THEME ADD CONSTRAINT FK_SRVTHM_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_THEME ADD CONSTRAINT FK_SRVTHM_THEME_ID FOREIGN KEY (THEME_ID) REFERENCES HOMEPAGE.APPREG_THEMES (ID);
CREATE INDEX UNQ_APPREG_SRV_THM_SRV_ID ON HOMEPAGE.APPREG_SERVICE_THEME (SERVICE_ID);
CREATE INDEX UNQ_APPREG_SRV_THM_THM_ID ON HOMEPAGE.APPREG_SERVICE_THEME (THEME_ID);
GO

------------ APPLICATIONS ------------
CREATE TABLE HOMEPAGE.APPREG_APPLICATIONS(
	ID nvarchar(36) NOT NULL,
	NAME nvarchar(100) NOT NULL,
	TITLE nvarchar(100),
	APP_ID nvarchar(100) NOT NULL,
	DESCRIPTION nvarchar(500),
	TRANSLATIONS nvarchar(1000),
	URL nvarchar(512),
	ICON nvarchar(500),
	SCOPE nvarchar(12),
	ORGANIZATION_ID nvarchar(36) NOT NULL,
	LAST_MODIFIED DATETIME2(6) NOT NULL,
	PAYLOAD nvarchar(max),
	ENTITLEMENT nvarchar(100)
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_APPLICATIONS ADD CONSTRAINT PK_APPLICATIONS PRIMARY KEY (ID);
CREATE INDEX UNQ_APPREG_APP_ORG_ID ON HOMEPAGE.APPREG_APPLICATIONS (ORGANIZATION_ID);
CREATE INDEX UNQ_APPREG_APP_ID_ORG_ID ON HOMEPAGE.APPREG_APPLICATIONS (ID, ORGANIZATION_ID);
CREATE INDEX UNQ_APPREG_APP_APP_NAME_ORG_ID ON HOMEPAGE.APPREG_APPLICATIONS (NAME, ORGANIZATION_ID);
CREATE INDEX UNQ_APPREG_APP_APP_ID_ORG_ID ON HOMEPAGE.APPREG_APPLICATIONS (APP_ID, ORGANIZATION_ID);
GO

------------ SERVICE_APPLICATION ------------
CREATE TABLE HOMEPAGE.APPREG_SERVICE_APPLICATION(
	SERVICE_ID nvarchar(36) NOT NULL,
	APPLICATION_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_SERVICE_APPLICATION ADD CONSTRAINT PK_SRVAPP_SERVICE_APPLICATION PRIMARY KEY (SERVICE_ID, APPLICATION_ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_APPLICATION ADD CONSTRAINT FK_SRVAPP_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES HOMEPAGE.APPREG_SERVICES (ID);
ALTER TABLE HOMEPAGE.APPREG_SERVICE_APPLICATION ADD CONSTRAINT FK_SRVAPP_APPLICATION_ID FOREIGN KEY (APPLICATION_ID) REFERENCES HOMEPAGE.APPREG_APPLICATIONS (ID);
CREATE INDEX UNQ_APPREG_SRV_APP_SRV_ID ON HOMEPAGE.APPREG_SERVICE_APPLICATION (SERVICE_ID);
CREATE INDEX UNQ_APPREG_SRV_APP_APP_ID ON HOMEPAGE.APPREG_SERVICE_APPLICATION (APPLICATION_ID);
GO

------------ EXTENSIONS ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSIONS(
	ID nvarchar(36) NOT NULL,
	NAME nvarchar(100) NOT NULL,
	TITLE nvarchar(100),
	EXT_ID nvarchar(100) NOT NULL,
	TYPE nvarchar(100),
	DESCRIPTION nvarchar(500),
	TRANSLATIONS nvarchar(1000),
	SCOPE nvarchar(12),
	LAST_MODIFIED DATETIME2(6) NOT NULL,
	PAYLOAD nvarchar(max)
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_EXTENSIONS ADD CONSTRAINT PK_EXTENSIONS PRIMARY KEY (ID);
CREATE INDEX UNQ_APPREG_EXT_EXT_NAME ON HOMEPAGE.APPREG_EXTENSIONS (NAME);
CREATE INDEX UNQ_APPREG_EXT_EXT_ID ON HOMEPAGE.APPREG_EXTENSIONS (EXT_ID);
CREATE INDEX UNQ_APPREG_EXT_EXT_TYPE ON HOMEPAGE.APPREG_EXTENSIONS (TYPE);
GO

------------ APPLICATION_EXTENSIONS ------------
CREATE TABLE HOMEPAGE.APPREG_APPLICATION_EXTENSION(
	APPLICATION_ID nvarchar(36) NOT NULL,
	EXTENSION_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_APPLICATION_EXTENSION ADD CONSTRAINT PK_APPEXT_APPLICATION_EXTENSION PRIMARY KEY (APPLICATION_ID, EXTENSION_ID);
ALTER TABLE HOMEPAGE.APPREG_APPLICATION_EXTENSION ADD CONSTRAINT FK_APPEXT_APPLICATION_ID FOREIGN KEY (APPLICATION_ID) REFERENCES HOMEPAGE.APPREG_APPLICATIONS (ID);
ALTER TABLE HOMEPAGE.APPREG_APPLICATION_EXTENSION ADD CONSTRAINT FK_APPEXT_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID);
CREATE INDEX UNQ_APPREG_APP_EXT_APP_ID ON HOMEPAGE.APPREG_APPLICATION_EXTENSION (APPLICATION_ID);
CREATE INDEX UNQ_APPREG_APP_EXT_EXT_ID ON HOMEPAGE.APPREG_APPLICATION_EXTENSION (EXTENSION_ID);
GO

------------ EXTENSION_PATH ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_PATH(
	EXTENSION_ID nvarchar(36) NOT NULL,
	PATH_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_PATH ADD CONSTRAINT PK_EXTPTH_EXTENSION_PATH PRIMARY KEY (EXTENSION_ID, PATH_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_PATH ADD CONSTRAINT UK_EXTPTH_EXTENSION_ID UNIQUE(EXTENSION_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_PATH ADD CONSTRAINT FK_EXTPTH_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_PATH ADD CONSTRAINT FK_EXTPTH_PATH_ID FOREIGN KEY (PATH_ID) REFERENCES HOMEPAGE.APPREG_PATHS (ID);
CREATE INDEX UNQ_APPREG_EXT_PTH_PTH_ID ON HOMEPAGE.APPREG_EXTENSION_PATH (PATH_ID);
GO

------------ EXTENSION_OBJECT ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT(
	EXTENSION_ID nvarchar(36) NOT NULL,
	OBJECT_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT ADD CONSTRAINT PK_EXTOBJ_EXTENSION_OBJECT PRIMARY KEY (EXTENSION_ID, OBJECT_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT ADD CONSTRAINT UK_EXTOBJ_EXTENSION_ID UNIQUE(EXTENSION_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT ADD CONSTRAINT FK_EXTOBJ_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_OBJECT ADD CONSTRAINT FK_EXTOBJ_OBJECT_ID FOREIGN KEY (OBJECT_ID) REFERENCES HOMEPAGE.APPREG_OBJECTS (ID);
CREATE INDEX UNQ_APPREG_EXT_OBJ_OBJ_ID ON HOMEPAGE.APPREG_EXTENSION_OBJECT (OBJECT_ID);
GO

------------ EXTENSION_EVENT ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_EVENT(
	EXTENSION_ID nvarchar(36) NOT NULL,
	EVENT_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_EVENT ADD CONSTRAINT PK_EXTEVN_EXTENSION_EVENT PRIMARY KEY (EXTENSION_ID, EVENT_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_EVENT ADD CONSTRAINT UK_EXTEVN_EXTENSION_ID UNIQUE(EXTENSION_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_EVENT ADD CONSTRAINT FK_EXTEVN_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_EVENT ADD CONSTRAINT FK_EXTEVN_EVENT_ID FOREIGN KEY (EVENT_ID) REFERENCES HOMEPAGE.APPREG_EVENTS (ID);
CREATE INDEX UNQ_APPREG_EXT_EVN_EVN_ID ON HOMEPAGE.APPREG_EXTENSION_EVENT (EVENT_ID);
GO

------------ EXTENSION_RESOURCE ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE(
	EXTENSION_ID nvarchar(36) NOT NULL,
	RESOURCE_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE ADD CONSTRAINT PK_EXTRES_EXTENSION_RESOURCE PRIMARY KEY (EXTENSION_ID, RESOURCE_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE ADD CONSTRAINT UK_EXTRES_EXTENSION_ID UNIQUE(EXTENSION_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE ADD CONSTRAINT FK_EXTRES_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_RESOURCE ADD CONSTRAINT FK_EXTRES_RESOURCE_ID FOREIGN KEY (RESOURCE_ID) REFERENCES HOMEPAGE.APPREG_RESOURCES (ID);
CREATE INDEX UNQ_APPREG_EXT_RES_RES_ID ON HOMEPAGE.APPREG_EXTENSION_RESOURCE (RESOURCE_ID);
GO

------------ EXTENSION_THEME ------------
CREATE TABLE HOMEPAGE.APPREG_EXTENSION_THEME(
	EXTENSION_ID nvarchar(36) NOT NULL,
	THEME_ID nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_EXTENSION_THEME ADD CONSTRAINT PK_EXTTHM_EXTENSION_THEME PRIMARY KEY (EXTENSION_ID, THEME_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_THEME ADD CONSTRAINT UK_EXTTHM_EXTENSION_ID UNIQUE(EXTENSION_ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_THEME ADD CONSTRAINT FK_EXTTHM_EXTENSION_ID FOREIGN KEY (EXTENSION_ID) REFERENCES HOMEPAGE.APPREG_EXTENSIONS (ID);
ALTER TABLE HOMEPAGE.APPREG_EXTENSION_THEME ADD CONSTRAINT FK_EXTTHM_THEME_ID FOREIGN KEY (THEME_ID) REFERENCES HOMEPAGE.APPREG_THEMES (ID);
CREATE INDEX UNQ_APPREG_EXT_THM_THM_ID ON HOMEPAGE.APPREG_EXTENSION_THEME (THEME_ID);
GO

------------ APPREG_SETTINGS ------------
CREATE TABLE HOMEPAGE.APPREG_SETTINGS(
	SETTING_KEY nvarchar(100) NOT NULL,
	SETTING_VALUE nvarchar(100) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.APPREG_SETTINGS ADD CONSTRAINT PK_APPREG_SETTINGS PRIMARY KEY (SETTING_KEY);
GO

-- -----------------------------------------------------------------
-- Visitor model event tracking table
-- -----------------------------------------------------------------

CREATE TABLE HOMEPAGE.VM_EVENT_TRACKER(
	SUBSCRIBER_ID nvarchar(36) NOT NULL,
	VISITING_ORG_ID nvarchar(36),
	HOME_ORG_ID nvarchar(36),
	LAST_MODIFIED DATETIME2(6) NOT NULL,
	MIGRATED NUMERIC(5,0) DEFAULT 0 NOT NULL,
	EVENT_NAME nvarchar(36) NOT NULL
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.VM_EVENT_TRACKER ADD CONSTRAINT PK_VM_SUBSCRIBER_ID PRIMARY KEY (SUBSCRIBER_ID);
CREATE INDEX VM_VISITING_ORG_IDX ON HOMEPAGE.VM_EVENT_TRACKER (VISITING_ORG_ID);
CREATE INDEX VM_HOME_ORG_IDX ON HOMEPAGE.VM_EVENT_TRACKER (HOME_ORG_ID);

GO

------------------------------------------------------------------------------
-- Migration News : Event Synchronization
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.MIGN_EVENT_SYNC (
	EVENT_ID nvarchar(36) NOT NULL,
	EVENT varbinary(MAX),
	CREATION_DATE DATETIME2(3) NOT NULL,
    SOURCE nvarchar(36) NOT NULL,
    TAGS nvarchar(2048),
    URL nvarchar(2048),
    ATTEMPTS NUMERIC(5,0) NOT NULL DEFAULT 0 
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.MIGN_EVENT_SYNC 
	ADD CONSTRAINT PK_MIGN_EVENT_SYNC PRIMARY KEY(EVENT_ID);	 	

CREATE INDEX MIGN_EVENT_SYNC_DATE_IDX
	ON HOMEPAGE.MIGN_EVENT_SYNC (CREATION_DATE ASC);
GO

------------------------------------------------------------------------------
-- Migration Profiles Tool : Migration People
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.MIGP_MIGRATIONPEOPLE (
    ID          	NVARCHAR(36) NOT NULL,
    USERID      	NVARCHAR(36),
    EMAIL       	NVARCHAR(256),
    ORGID         	NVARCHAR(36),
    PRIORITY    	INTEGER  DEFAULT '0',
    STATE         	BIGINT  DEFAULT '0',
    CREATETIME      DATETIME2(3) DEFAULT CURRENT_TIMESTAMP,
    STATEUPDATETIME DATETIME2(3) DEFAULT CURRENT_TIMESTAMP,
    MIGRATIONTYPE   NVARCHAR(36) DEFAULT 'migrate'

)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.MIGP_MIGRATIONPEOPLE 
	ADD CONSTRAINT MIGP_MIGRATIONPEOPLE_PK PRIMARY KEY (ID);

CREATE INDEX MIGP_MP_NEXT_PEOPLE_IDX 
	ON HOMEPAGE.MIGP_MIGRATIONPEOPLE (PRIORITY DESC, STATE, STATEUPDATETIME);

CREATE INDEX MIGP_MP_FIND_IDX 
	ON HOMEPAGE.MIGP_MIGRATIONPEOPLE (USERID, EMAIL);
GO

------------------------------------------------------------------------------
-- Migration Profiles Tool : Populate Status
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.MIGP_POPULATESTATUS (
    ID              NVARCHAR(36) NOT NULL,
    CURRENTURL      NVARCHAR(256),
    TIME            DATETIME2(3),
    MIGRATIONTYPE   NVARCHAR(36) DEFAULT 'migrate'

)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.MIGP_POPULATESTATUS 
	ADD CONSTRAINT MIGP_POPULATESTATUS_PK PRIMARY KEY (ID);
GO

------------------------------------------------------------------------------
-- Migration Profiles Tool : Profile Key Map
------------------------------------------------------------------------------

CREATE TABLE HOMEPAGE.MIGP_PROFILEKEYMAP (
    ID            NVARCHAR(36) NOT NULL,
    PROFILEKEY    NVARCHAR(36) NOT NULL,
    EXTERNALID    NVARCHAR(36) NOT NULL,
    ORGID         NVARCHAR(36) NOT NULL,
    CREATED       DATETIME2(3)
)ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.MIGP_PROFILEKEYMAP 
	ADD CONSTRAINT MIGP_PROFILEKEYMAP_PK PRIMARY KEY (ID);

CREATE UNIQUE INDEX MIGP_PKM_PROFILEKEY_UIDX 
	ON HOMEPAGE.MIGP_PROFILEKEYMAP (PROFILEKEY);

CREATE UNIQUE INDEX MIGP_PKM_EXTERNALID_UIDX 
	ON HOMEPAGE.MIGP_PROFILEKEYMAP (EXTERNALID);
GO

