-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

---------------------------------------------------------------------------------
------------------------ START NEWS FIXUP 102 -----------------------------------
---------------------------------------------------------------------------------

INSERT INTO HOMEPAGE.NR_TEMPLATE
		(TEMPLATE_ID, NAME, DATA_SOURCE_STRING, FORMAT, NO_VALUES)
VALUES	('profileContainervmladkL9DFYU5ADFla9a','profileContainer', 'profileContainer', 'profilePhoto', 1); 

GO



DROP TABLE HOMEPAGE.NR_COMM_STORIES;

GO


---------------------------------------------------------------------------------
-- Increase READER_ID column size 36 -> 39
---------------------------------------------------------------------------------

ALTER TABLE HOMEPAGE.NR_NEWS_STATUS_NETWORK 
	ALTER COLUMN READER_ID nvarchar(39);

GO


ALTER TABLE HOMEPAGE.NR_AGGREGATED_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_RESPONSES_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_PROFILES_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_COMMUNITIES_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_ACTIVITIES_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_BLOGS_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_BOOKMARKS_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_FILES_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_FORUMS_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_WIKIS_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_TAGS_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_STATUS_UPDATE_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_EXTERNAL_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_ACTIONABLE_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_DISCOVERY_VIEW
	ALTER COLUMN READER_ID nvarchar(39);

GO


ALTER TABLE HOMEPAGE.NR_PROFILES_VIEW
	ALTER COLUMN READER_ID nvarchar(39);

GO


ALTER TABLE HOMEPAGE.NR_NOTIFICATION_SENT_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_SAVED_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO


ALTER TABLE HOMEPAGE.NR_TOPICS_READERS
	ALTER COLUMN READER_ID nvarchar(39) NOT NULL;

GO

---------------------------------------------------------------------------------
-- Increase COMMUNITY_ID column size 36 -> 39
---------------------------------------------------------------------------------

ALTER TABLE HOMEPAGE.NR_COMM_FOLLOW
	ALTER COLUMN COMMUNITY_ID nvarchar(39) NOT NULL;

GO

ALTER TABLE HOMEPAGE.NR_COMM_PERSON_FOLLOW
	ALTER COLUMN PERSON_COMMUNITY_ID nvarchar(39) NOT NULL;

GO

ALTER TABLE HOMEPAGE.NR_STORIES
	ALTER COLUMN RELATED_COMMUNITY_ID nvarchar(39);

GO

---------------------------------------------------------------------------------
-- MODIFY NR_STORIES AND NR_ENTRIES TABLE TO HAVE CONSISTENT DATA MODEL
---------------------------------------------------------------------------------

ALTER TABLE HOMEPAGE.NR_ENTRIES 
	DROP COLUMN ITEM_CORRELATION_AUTHOR_NAME;

ALTER TABLE HOMEPAGE.NR_ENTRIES 
	DROP COLUMN ITEM_AUTHOR_DISPLAYNAME;

GO

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE 
	DROP COLUMN ITEM_CORRELATION_AUTHOR_NAME;

ALTER TABLE HOMEPAGE.NR_ENTRIES_ARCHIVE 
	DROP COLUMN ITEM_AUTHOR_DISPLAYNAME;

GO

ALTER TABLE HOMEPAGE.NR_STORIES 
	DROP COLUMN ITEM_CORRELATION_AUTHOR_NAME;

ALTER TABLE HOMEPAGE.NR_STORIES ADD 
	ENTRY_CORRELATION_ID nvarchar(36),
	ITEM_CORRELATION_ATOM_URL nvarchar(2048);

GO


---------------------------------------------------------------------------------
-- READER TABLES: MAKE INDEX ON READER_ID,STORY_ID CLUSTER
---------------------------------------------------------------------------------

DROP INDEX AGGREGATED_READERS_RDR_STR ON HOMEPAGE.NR_AGGREGATED_READERS;
GO

DROP INDEX CL_AGGREGATED_READERS_IDX ON HOMEPAGE.NR_AGGREGATED_READERS;
GO

CREATE INDEX AGGREGATED_READERS_RDR_STR
ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_AGGREGATED_READERS_IDX
ON HOMEPAGE.NR_AGGREGATED_READERS (READER_ID);
GO


DROP INDEX RESPONSES_READERS_RDR_STR ON HOMEPAGE.NR_RESPONSES_READERS;
GO

DROP INDEX CL_RESPONSES_READERS_IDX ON HOMEPAGE.NR_RESPONSES_READERS;
GO

CREATE INDEX RESPONSES_READERS_RDR_STR
ON HOMEPAGE.NR_RESPONSES_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_RESPONSES_READERS_IDX
ON HOMEPAGE.NR_RESPONSES_READERS (READER_ID);
GO


DROP INDEX PROFILES_READERS_RDR_STR ON HOMEPAGE.NR_PROFILES_READERS;
GO

DROP INDEX CL_PROFILES_READERS_IDX ON HOMEPAGE.NR_PROFILES_READERS;
GO

CREATE INDEX PROFILES_READERS_RDR_STR
ON HOMEPAGE.NR_PROFILES_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_PROFILES_READERS_IDX
ON HOMEPAGE.NR_PROFILES_READERS (READER_ID);
GO


DROP INDEX COMM_READERS_RDR_STR ON HOMEPAGE.NR_COMMUNITIES_READERS;
GO

DROP INDEX CL_COMM_READERS_IDX ON HOMEPAGE.NR_COMMUNITIES_READERS;
GO

CREATE INDEX COMM_READERS_RDR_STR
ON HOMEPAGE.NR_COMMUNITIES_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_COMM_READERS_IDX
ON HOMEPAGE.NR_COMMUNITIES_READERS (READER_ID);
GO


DROP INDEX ACTIVITIES_READERS_RDR_STR ON HOMEPAGE.NR_ACTIVITIES_READERS;
GO

DROP INDEX CL_ACTIVITIES_READERS_IDX ON HOMEPAGE.NR_ACTIVITIES_READERS;
GO

CREATE INDEX ACTIVITIES_READERS_RDR_STR
ON HOMEPAGE.NR_ACTIVITIES_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_ACTIVITIES_READERS_IDX
ON HOMEPAGE.NR_ACTIVITIES_READERS (READER_ID);
GO


DROP INDEX BLOGS_READERS_RDR_STR ON HOMEPAGE.NR_BLOGS_READERS;
GO

DROP INDEX CL_BLOGS_READERS_IDX ON HOMEPAGE.NR_BLOGS_READERS;
GO

CREATE INDEX BLOGS_READERS_RDR_STR
ON HOMEPAGE.NR_BLOGS_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_BLOGS_READERS_IDX
ON HOMEPAGE.NR_BLOGS_READERS (READER_ID);
GO


DROP INDEX BOOKMARKS_READERS_RDR_STR ON HOMEPAGE.NR_BOOKMARKS_READERS;
GO

DROP INDEX CL_BOOKMARKS_READERS_IDX ON HOMEPAGE.NR_BOOKMARKS_READERS;
GO

CREATE INDEX BOOKMARKS_READERS_RDR_STR
ON HOMEPAGE.NR_BOOKMARKS_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_BOOKMARKS_READERS_IDX
ON HOMEPAGE.NR_BOOKMARKS_READERS (READER_ID);
GO


DROP INDEX FILES_READERS_RDR_STR ON HOMEPAGE.NR_FILES_READERS;
GO

DROP INDEX CL_FILES_READERS_IDX ON HOMEPAGE.NR_FILES_READERS;
GO

CREATE INDEX FILES_READERS_RDR_STR
ON HOMEPAGE.NR_FILES_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_FILES_READERS_IDX
ON HOMEPAGE.NR_FILES_READERS (READER_ID);
GO


DROP INDEX FORUMS_READERS_RDR_STR ON HOMEPAGE.NR_FORUMS_READERS;
GO

DROP INDEX CL_FORUMS_READERS_IDX ON HOMEPAGE.NR_FORUMS_READERS;
GO

CREATE INDEX FORUMS_READERS_RDR_STR
ON HOMEPAGE.NR_FORUMS_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_FORUMS_READERS_IDX
ON HOMEPAGE.NR_FORUMS_READERS (READER_ID);
GO


DROP INDEX WIKIS_READERS_RDR_STR ON HOMEPAGE.NR_WIKIS_READERS;
GO

DROP INDEX CL_WIKIS_READERS_IDX ON HOMEPAGE.NR_WIKIS_READERS;
GO

CREATE INDEX WIKIS_READERS_RDR_STR
ON HOMEPAGE.NR_WIKIS_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_WIKIS_READERS_IDX
ON HOMEPAGE.NR_WIKIS_READERS (READER_ID);
GO


DROP INDEX TAGS_READERS_RDR_STR ON HOMEPAGE.NR_TAGS_READERS;
GO

DROP INDEX CL_TAGS_READERS_IDX ON HOMEPAGE.NR_TAGS_READERS;
GO

CREATE INDEX TAGS_READERS_RDR_STR
ON HOMEPAGE.NR_TAGS_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_TAGS_READERS_IDX
ON HOMEPAGE.NR_TAGS_READERS (READER_ID);
GO


DROP INDEX STATUS_READERS_RDR_STR ON HOMEPAGE.NR_STATUS_UPDATE_READERS;
GO

DROP INDEX CL_STATUS_READERS_IDX ON HOMEPAGE.NR_STATUS_UPDATE_READERS;
GO

CREATE INDEX STATUS_READERS_RDR_STR
ON HOMEPAGE.NR_STATUS_UPDATE_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_STATUS_READERS_IDX
ON HOMEPAGE.NR_STATUS_UPDATE_READERS (READER_ID);
GO


DROP INDEX EXTERNAL_READERS_RDR_STR ON HOMEPAGE.NR_EXTERNAL_READERS;
GO

DROP INDEX CL_EXTERNAL_READERS_IDX ON HOMEPAGE.NR_EXTERNAL_READERS;
GO

CREATE INDEX EXTERNAL_READERS_RDR_STR
ON HOMEPAGE.NR_EXTERNAL_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_EXTERNAL_READERS_IDX
ON HOMEPAGE.NR_EXTERNAL_READERS (READER_ID);
GO


DROP INDEX ACTIONABLE_READERS_RDR_STR ON HOMEPAGE.NR_ACTIONABLE_READERS;
GO

DROP INDEX CL_ACTIONABLE_READERS_IDX ON HOMEPAGE.NR_ACTIONABLE_READERS;
GO

CREATE INDEX ACTIONABLE_READERS_RDR_STR
ON HOMEPAGE.NR_ACTIONABLE_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_ACTIONABLE_READERS_IDX
ON HOMEPAGE.NR_ACTIONABLE_READERS (READER_ID);
GO


DROP INDEX DISCOVERY_VIEW_RDR_STR ON HOMEPAGE.NR_DISCOVERY_VIEW;
GO

DROP INDEX CL_DISCOVERY_READERS_IDX ON HOMEPAGE.NR_DISCOVERY_VIEW;
GO

CREATE INDEX DISCOVERY_VIEW_RDR_STR
ON HOMEPAGE.NR_DISCOVERY_VIEW (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_DISCOVERY_READERS_IDX
ON HOMEPAGE.NR_DISCOVERY_VIEW (READER_ID);
GO


DROP INDEX PROFILES_VIEW_RDR_STR ON HOMEPAGE.NR_PROFILES_VIEW;
GO

DROP INDEX CL_PROFILESV_READERS_IDX ON HOMEPAGE.NR_PROFILES_VIEW;
GO

CREATE INDEX PROFILES_VIEW_RDR_STR
ON HOMEPAGE.NR_PROFILES_VIEW (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_PROFILESV_READERS_IDX
ON HOMEPAGE.NR_PROFILES_VIEW (READER_ID);
GO


DROP INDEX NOTIFICA_READERS_RDR_STR ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS;
GO

DROP INDEX CL_NOTIFICA_READERS_IDX ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS;
GO

CREATE INDEX NOTIFICA_READERS_RDR_STR
ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_NOTIFICA_READERS_IDX
ON HOMEPAGE.NR_NOTIFICATION_SENT_READERS (READER_ID);
GO


DROP INDEX NOT_REC_READERS_RDR_STR ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS;
GO

DROP INDEX CL_REC_READERS_IDX ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS;
GO

CREATE INDEX NOT_REC_READERS_RDR_STR
ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_REC_READERS_IDX
ON HOMEPAGE.NR_NOTIFICATION_RECEIV_READERS (READER_ID);
GO


DROP INDEX SAVED_READERS_RDR_STR ON HOMEPAGE.NR_SAVED_READERS;
GO

DROP INDEX CL_SAVED_READERS_IDX ON HOMEPAGE.NR_SAVED_READERS;
GO

CREATE INDEX SAVED_READERS_RDR_STR
ON HOMEPAGE.NR_SAVED_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_SAVED_READERS_IDX
ON HOMEPAGE.NR_SAVED_READERS (READER_ID);
GO


DROP INDEX TOPICS_READERS_RDR_STR ON HOMEPAGE.NR_TOPICS_READERS;
GO

DROP INDEX CL_TOPICS_READERS_IDX ON HOMEPAGE.NR_TOPICS_READERS;
GO

CREATE INDEX TOPICS_READERS_RDR_STR
ON HOMEPAGE.NR_TOPICS_READERS (READER_ID, STORY_ID);
GO

CREATE  INDEX CL_TOPICS_READERS_IDX
ON HOMEPAGE.NR_TOPICS_READERS (READER_ID);
GO



---------------------------------------------------------------------------------
-- ADD ADDITIONAL INDEXES BASED ON W3 RALLY AND MIGRATION TESTS
---------------------------------------------------------------------------------


-- NR_STORIES TABLE

CREATE INDEX STORIES_ITEM_ID_IX 
	ON HOMEPAGE.NR_STORIES (ITEM_ID);

GO


-- NR_RESOURCE

CREATE INDEX NR_RESOURCE_TYPE_CONT_IX
	ON HOMEPAGE.NR_RESOURCE (RESOURCE_TYPE, CONTAINER_NAME);

GO


-- NR_SAVED_READERS

CREATE INDEX SAVED_READERS_SR_IX
	ON HOMEPAGE.NR_SAVED_READERS (STORY_ID, READER_ID);

GO


---------------------------------------------------------------------------------
------------------------ END NEWS FIXUP 102 -------------------------------------
---------------------------------------------------------------------------------
