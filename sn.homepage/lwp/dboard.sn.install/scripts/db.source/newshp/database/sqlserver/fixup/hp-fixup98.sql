-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2007, 2015                                    
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

/* Bookmarks widgets */
UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png'
WHERE WIDGET_ID='dogear46x0a77x4a43x82aaxb00187218631';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png'
WHERE WIDGET_ID='dembk46x0a77x4a43x82aaxb00187218631';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png'
WHERE WIDGET_ID='depbk46x0a77x4a43x82aaxb00187218631';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png'
WHERE WIDGET_ID='derbk46x0a77x4a43x82aaxb00187218631';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBookmarks16.png'
WHERE WIDGET_ID='dewl46x0a77x4a43x82aaxb00187218631';

/* Activities widgets */
UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconActivities16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconActivities16.png'
WHERE WIDGET_ID='activitixa187x491dxa4bfx2e1261d0b6ec';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconActivities16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconActivities16.png'
WHERE WIDGET_ID='myactxa187x491dxa4bfx2e1261d0b6ec';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconActivities16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconActivities16.png'
WHERE WIDGET_ID='pubactxa187x491dxa4bfx2e1261d0b6ec';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconActivities16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconActivities16.png'
WHERE WIDGET_ID='activities-sidebar7x4229x8';

/* Communities widgets. */
UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconCommunities16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconCommunities16.png'
WHERE WIDGET_ID='communitxe7c4x4e08xab54x80e7a4eb8933';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconCommunities16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconCommunities16.png'
WHERE WIDGET_ID='mycommunxe7c4x4e08xab54x80e7a4eb8933';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconCommunities16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconCommunities16.png'
WHERE WIDGET_ID='pubcommuxe7c4x4e08xab54x80e7a4eb8933';

/* Blogs widget. */
UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBlogs16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconBlogs16.png'
WHERE WIDGET_ID='blogs448xcd34x4565x9469x9c34fcefe48c';

/* Profiles widget. */
UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconProfiles16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconProfiles16.png'
WHERE WIDGET_ID='profilesxaac7x4229x87bbx9a1c3551c591';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconProfiles16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconProfiles16.png'
WHERE WIDGET_ID='myprofisxaac7x4229x87bbx9a1c3551c591';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconProfiles16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconProfiles16.png'
WHERE WIDGET_ID='colprofsxaac7x4229x87bbx9a1c3551c591';

/* Wiki widget. */
UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconWikis16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconWikis16.png'
WHERE WIDGET_ID='mywikiz1xaac7x4229x87BBx91ac3551c591';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconWikis16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconWikis16.png'
WHERE WIDGET_ID='pop-wiki1xaac7x4229x87BBx91ac3551c5';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconWikis16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconWikis16.png'
WHERE WIDGET_ID='latest-wiki5jz1xaac7x4229x87BBx91ac';

/* Files widget. */
UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconFiles16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconFiles16.png'
WHERE WIDGET_ID='myFilesPb86locI7vRV4yY1KKawZvE8Qul88';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconFiles16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconFiles16.png'
WHERE WIDGET_ID='sharedFilesV4fv72LD5NAcGv2nbrex0ExEq';

UPDATE HOMEPAGE.WIDGET
SET WIDGET_ICON = '${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconFiles16.png',
    WIDGET_SECURE_ICON='${COMMON_CONTEXT_ROOT}/web/com.ibm.lconn.core.styles/images/iconFiles16.png'
WHERE WIDGET_ID='sharedFilesV4fv72LD5NAcGv2nbrex0ExEq';

-----------------------
-- Adding index on person table
-----------------------
CREATE INDEX DISPLAYNAME_LOWER_MEM
	ON HOMEPAGE.PERSON (DISPLAYNAME_LOWER, MEMBER_TYPE);
	
GO

-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------

-- DROP EXISTING OH TABLES





DROP  TABLE HOMEPAGE.OH_OAUTHACL;
DROP  TABLE HOMEPAGE.OH_APPLICATION;
DROP  TABLE HOMEPAGE.OH_CONTEXT;
DROP  TABLE HOMEPAGE.OH_CLIENT;
DROP  TABLE HOMEPAGE.OH_PROVIDER;
DROP  TABLE HOMEPAGE.OH_TOKEN;


-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- START: OAuth Consumer Schema
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--
-- Replace							Example
--  HOMEPAGE					HOMEPAGE
--	 		HOMEPAGE.
-- 	IN USERSPACE8K INDEX IN USERSPACE8K
--  LCUSER
--  STMT == End statement
--
-- Types - You will need to substitue these tokens
--  VARCHAR
--  TIMESTAMP

-------------------------------------------
-- HOMEPAGE.OAUTH1_TOKEN
-------------------------------------------	 
CREATE TABLE HOMEPAGE.OAUTH1_TOKEN (
	ID NVARCHAR(254) NOT NULL PRIMARY KEY,
	TOKEN NVARCHAR(1024) NOT NULL,
	SECRET NVARCHAR(1024) NOT NULL,
	EXPIRATION DATETIME,
	CREATED DATETIME NOT NULL,
	MODIFIED DATETIME NOT NULL
) ON [PRIMARY]
GO

-------------------------------------------
-- HOMEPAGE.OAUTH1_PROVIDER
-------------------------------------------	 
CREATE TABLE HOMEPAGE.OAUTH1_PROVIDER (
	ID NVARCHAR(254) NOT NULL PRIMARY KEY,
	NAME NVARCHAR(254) NOT NULL,
	DESCRIPTION NVARCHAR(1024),
	REQUESTTOKENURL NVARCHAR(512) NOT NULL,
	AUTHORIZEURL NVARCHAR(512) NOT NULL,
	ACCESSTOKENURL NVARCHAR(512) NOT NULL,
	BASEURL NVARCHAR(512),
	MANAGEURL NVARCHAR(512),
	REGISTERURL NVARCHAR(512),
	SIGNMETHOD NVARCHAR(32),
	VERSION NVARCHAR(8),
	CREATEED DATETIME NOT NULL,
	MODIFIED DATETIME NOT NULL,
	CONSTRAINT PRVD_NAME_UK UNIQUE (NAME)
) ON [PRIMARY]
GO
	
-------------------------------------------
-- HOMEPAGE.OAUTH1_CLIENT
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH1_CLIENT (
	ID NVARCHAR(254) NOT NULL PRIMARY KEY,
	NAME NVARCHAR(254) NOT NULL,
	TOKENID NVARCHAR(254) NOT NULL,
	PROVIDERID NVARCHAR(254) NOT NULL,
	DESCRIPTION NVARCHAR(1024),
	CALLBACKURL NVARCHAR(512),
	USERNAME NVARCHAR(256) NOT NULL,
	CREATEED DATETIME NOT NULL,
	MODIFIED DATETIME NOT NULL,
	CONSTRAINT CLNT_NAME_UK UNIQUE (NAME)
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.OAUTH1_CLIENT 
	ADD CONSTRAINT CLNT_TOKEN_FK FOREIGN KEY (TOKENID) 
	REFERENCES HOMEPAGE.OAUTH1_TOKEN(ID) ON DELETE CASCADE ON UPDATE NO ACTION;
	
ALTER TABLE HOMEPAGE.OAUTH1_CLIENT 
	ADD CONSTRAINT CLNT_FK FOREIGN KEY (PROVIDERID) 
	REFERENCES HOMEPAGE.OAUTH1_PROVIDER(ID) ON DELETE CASCADE ON UPDATE NO ACTION;

-------------------------------------------
-- HOMEPAGE.OAUTH1_CONTEXT
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH1_CONTEXT (
	ID NVARCHAR(254) NOT NULL PRIMARY KEY,
	CLIENTID NVARCHAR(254) NOT NULL,
	USERID NVARCHAR(256),
	CALLBACKURL NVARCHAR(1024),
	REQUESTAUTHURL NVARCHAR(1024),
	TOKENID NVARCHAR(254) NOT NULL,
	CREATED DATETIME NOT NULL,
	MODIFIED DATETIME NOT NULL,
	SESSIONHANDLE NVARCHAR(256),
	REFERER NVARCHAR(512),
	EXPIRATION DATETIME,
	AUTHORIZED SMALLINT DEFAULT 0 NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.OAUTH1_CONTEXT
	ADD CONSTRAINT CONTEXT_CLNT_FK FOREIGN KEY (CLIENTID) 
	REFERENCES HOMEPAGE.OAUTH1_CLIENT(ID) ON DELETE CASCADE ON UPDATE NO ACTION;

ALTER TABLE HOMEPAGE.OAUTH1_CONTEXT
	ADD CONSTRAINT AUTH_TOKEN_FK FOREIGN KEY (TOKENID) 
	REFERENCES HOMEPAGE.OAUTH1_TOKEN(ID);
	
-------------------------------------------
-- HOMEPAGE.OAUTH2_PROVIDER
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH2_PROVIDER (
  NAME NVARCHAR(254) NOT NULL PRIMARY KEY,
  CLIENT_AUTH NVARCHAR(254),
  AUTH_HEADER SMALLINT,
  URL_PARAM SMALLINT,
  AUTH_URL NVARCHAR(1024),
  TOKEN_URL NVARCHAR(1024)
) ON [PRIMARY]
GO

-------------------------------------------
-- HOMEPAGE.OAUTH2_CLIENT
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH2_CLIENT (
  NAME NVARCHAR(254) NOT NULL PRIMARY KEY,
  PROVIDER_NAME NVARCHAR(254) NOT NULL,
  REDIRECT_URI NVARCHAR(1024),
  CTYPE NVARCHAR(254) NOT NULL,
  GRANT_TYPE NVARCHAR(254) NOT NULL,
  CLIENT_ID NVARCHAR(1024) NOT NULL,
  CLIENT_SECRET NVARCHAR(1024) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.OAUTH2_CLIENT
  ADD CONSTRAINT FK_CLIENT_PRO_NAME FOREIGN KEY(PROVIDER_NAME)
  REFERENCES HOMEPAGE.OAUTH2_PROVIDER(NAME) ON DELETE CASCADE ON UPDATE NO ACTION;
    
-------------------------------------------
-- HOMEPAGE.OAUTH2_GADGET_BINDING
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH2_GADGET_BINDING (
  URI_SHA1 CHAR(40) NOT NULL, 
  SERVICE_NAME NVARCHAR(254)  NOT NULL,
  URI NVARCHAR(1024) NOT NULL,
  CLIENT_NAME NVARCHAR(254) NOT NULL,
  OVERRIDES SMALLINT NOT NULL,
  CONSTRAINT PK_GADGET_PK UNIQUE (URI_SHA1, SERVICE_NAME) -- Needed to overcome mssql index size limits
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.OAUTH2_GADGET_BINDING
  ADD CONSTRAINT FK_BINDING_CLIENT FOREIGN KEY(CLIENT_NAME)
  REFERENCES HOMEPAGE.OAUTH2_CLIENT(NAME) ON DELETE CASCADE ON UPDATE NO ACTION;


-------------------------------------------
-- HOMEPAGE.OAUTH2_TOKEN
-------------------------------------------
CREATE TABLE HOMEPAGE.OAUTH2_TOKEN (
  ID NVARCHAR(254) NOT NULL PRIMARY KEY,
  URI NVARCHAR(1024) NOT NULL,
  SERVICE_NAME NVARCHAR(254) NOT NULL,
  USERID NVARCHAR(254) NOT NULL,
  SCOPE NVARCHAR(1024) NOT NULL,
  TTYPE SMALLINT NOT NULL,
  SECRET NVARCHAR(1024),
  EXPIRES DATETIME,
  ISSUED DATETIME NOT NULL,
  TOKEN_TYPE NVARCHAR(254),
  MAC_SECRET NVARCHAR(1024),
  MAC_ALG NVARCHAR(254),
  MAC_EXT NVARCHAR(254),
  PROPS NVARCHAR(1024)
) ON [PRIMARY]
GO

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- END OAuth Consumer Schema
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
