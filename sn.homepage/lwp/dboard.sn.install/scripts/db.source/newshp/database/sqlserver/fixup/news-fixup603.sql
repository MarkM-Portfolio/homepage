-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- OCO Source Materials                                              
--                                                                   
-- Copyright IBM Corp. 2015                                   
--                                                                   
-- The source code for this program is not published or otherwise    
-- divested of its trade secrets, irrespective of what has been      
-- deposited with the U.S. Copyright Office.                         
--                                                                   
-- ***************************************************************** 

-- {COPYRIGHT}

-- SCEE

-----------------------------------------------------------------------
-- HOMEPAGE.L3T_ORGANIZATION table
-----------------------------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_ORGANIZATION (
	ORGANIZATION_ID VARCHAR(36) NOT NULL,
	ORGANIZATION_EXID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_ORGANIZATION ADD CONSTRAINT PK_L3T_ORGANIZATION_ID PRIMARY KEY(ORGANIZATION_ID);
GO

CREATE UNIQUE INDEX UNQ_L3T_ORG_EXID ON HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_EXID);
GO



-------------------------------------------------
-- HOMEPAGE.L3T_COMPANIES
-------------------------------------------------

CREATE TABLE HOMEPAGE.L3T_COMPANIES (
		COMPANY_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(128) NOT NULL,
		OPENID_ORG VARCHAR(128) NOT NULL,
		LOTUSLIVE_INSTANCE VARCHAR(5) NOT NULL,
		PACKAGEPREF_DEFAULT VARCHAR(11) NOT NULL,
		CREATED DATETIME NOT NULL,
		MODIFIED DATETIME NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO


ALTER TABLE HOMEPAGE.L3T_COMPANIES ADD CONSTRAINT PK_COMPANY_ID PRIMARY KEY (COMPANY_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANIES ADD CONSTRAINT FK_COM_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE UNIQUE INDEX UNQ_OPENID_ORG_IDX  ON HOMEPAGE.L3T_COMPANIES (OPENID_ORG);
GO  
	

-------------------------------------------------
-- HOMEPAGE.L3T_USERS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USERS (
		USER_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(256) NOT NULL,
		OPENID_IDENTITY VARCHAR(256) NOT NULL,
		EMAIL VARCHAR(256) NOT NULL,
		COMPANY_ID VARCHAR(36) NOT NULL,
		LOGGED_IN NUMERIC(5,0) NOT NULL,
		LOGGED_IN_TIME DATETIME NOT NULL,
		LANG VARCHAR(6) NOT NULL,
		PACKAGEPREF_DEFAULT VARCHAR(6) NOT NULL,
		LAST_AGREEMENT INTEGER NOT NULL DEFAULT 0,
		CREATED DATETIME NOT NULL,
		MODIFIED DATETIME NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT PK_USERS_ID PRIMARY KEY (USER_ID);
GO

CREATE UNIQUE INDEX UNQ_OPENID_IDENTITY_IDX ON HOMEPAGE.L3T_USERS (OPENID_IDENTITY);
GO

ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT FK_USERS_COMPANY_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID);
GO

ALTER TABLE HOMEPAGE.L3T_USERS ADD CONSTRAINT FK_USERS_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX USERS_COMP_IDX ON HOMEPAGE.L3T_USERS (COMPANY_ID);
CREATE INDEX USERS_ORG_IDX ON HOMEPAGE.L3T_USERS (ORGANIZATION_ID);
GO



-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGES
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGES (
		PACKAGE_ID VARCHAR(36) NOT NULL,
		NAME VARCHAR(40) NOT NULL,
		ENTITLE_EVERYONE NUMERIC(5,0) NOT NULL,
		OWNER_ID VARCHAR(36) NOT NULL,
		TOKEN VARCHAR(12),
		MAINT_MODE NUMERIC(5,0) NOT NULL DEFAULT 1,
		CREATED DATETIME NOT NULL,
		MODIFIED DATETIME NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT PK_PACKAGES_ID PRIMARY KEY (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT FK_PACKAGES_OWNER_ID FOREIGN KEY (OWNER_ID) REFERENCES HOMEPAGE.L3T_USERS 	(USER_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGES ADD CONSTRAINT FK_PACKAGES_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX PKG_OWNER_IDX ON HOMEPAGE.L3T_PACKAGES (OWNER_ID);
CREATE INDEX PKG_ORG_IDX ON HOMEPAGE.L3T_PACKAGES (ORGANIZATION_ID);
GO

-------------------------------------------------
-- HOMEPAGE.L3T_COMPANY_ENTITLEMENTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (
		COMPANY_ENTITLEMENTS_ID VARCHAR(36) NOT NULL,
		COMPANY_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		CREATED DATETIME NOT NULL,
		MODIFIED DATETIME NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT PK_COMPANY_ENT_ID PRIMARY KEY (COMPANY_ENTITLEMENTS_ID);
GO

CREATE UNIQUE INDEX UNQ_COM_ENT_COM_PKG_IDX ON  HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (COMPANY_ID, PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT FK_COM_ENT_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT FK_COM_ENT_COM_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_ENTITLEMENTS ADD CONSTRAINT FK_COM_ENT_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX COM_ENT_PKG_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (PACKAGE_ID);
CREATE INDEX COM_ENT_COMP_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (COMPANY_ID);
CREATE INDEX COM_ENT_ORG_IDX ON HOMEPAGE.L3T_COMPANY_ENTITLEMENTS (ORGANIZATION_ID);
GO




-------------------------------------------------
-- HOMEPAGE.L3T_COMPANY_PKG_PREFS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS (
		COMPANY_PKG_PREFS_ID VARCHAR(36) NOT NULL,
		COMPANY_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		PREFERENCE VARCHAR(11) NOT NULL,
		CREATED DATETIME NOT NULL,
		MODIFIED DATETIME NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT PK_COMPANY_PKG_PREFS_ID PRIMARY KEY (COMPANY_PKG_PREFS_ID);
GO

CREATE UNIQUE INDEX UNQ_COM_PKG_PREF_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS  (COMPANY_ID, PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT FK_COM_PKG_PREF_COM_ID FOREIGN KEY (COMPANY_ID) REFERENCES HOMEPAGE.L3T_COMPANIES (COMPANY_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT FK_COM_PKG_PREF_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_COMPANY_PKG_PREFS ADD CONSTRAINT FK_COM_PKG_PREF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX COMP_PRF_PKG_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (PACKAGE_ID);
CREATE INDEX COMP_PRF_COMP_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (COMPANY_ID);
CREATE INDEX COMP_PRF_ORG_IDX ON HOMEPAGE.L3T_COMPANY_PKG_PREFS (ORGANIZATION_ID);
GO

-------------------------------------------------
-- HOMEPAGE.L3T_EXT_META2
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_EXT_META2 (
		EXT_META2_ID VARCHAR(36) NOT NULL,
		UNID VARCHAR(512) NOT NULL,
		OPENID_ORG VARCHAR(512) NOT NULL,
		TYPE VARCHAR(512) NOT NULL,
		PARENT VARCHAR(36) NOT NULL,
		NODE_KEY VARCHAR(256),
		NODE_VALUE VARCHAR(512),
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_EXT_META2 ADD CONSTRAINT PK_EXT_META2_ID PRIMARY KEY (EXT_META2_ID);
GO

ALTER TABLE HOMEPAGE.L3T_EXT_META2 ADD CONSTRAINT FK_EXT_META2_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX EXT_META2_ORG_IDX ON HOMEPAGE.L3T_EXT_META2 (ORGANIZATION_ID);
GO

-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGE_DETAILS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGE_DETAILS (
		PACKAGE_DETAILS_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		POSITION_ID VARCHAR(512) NOT NULL,
		WIDGET VARCHAR(512) NOT NULL,
		LABS_ID VARCHAR(512) NOT NULL,
		POSITION_TYPE VARCHAR(10) NOT NULL,
		POSITION_INDEX INTEGER NOT NULL DEFAULT 0,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT PK_PACKAGE_DETAILS_ID PRIMARY KEY (PACKAGE_DETAILS_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT FK_PKG_DET_PKG_IDFOREIGN FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_DETAILS ADD CONSTRAINT FK_PKG_DET_PKG_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX PKG_DET_PKG_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (PACKAGE_ID);
CREATE INDEX PKG_DET_ORG_IDX ON HOMEPAGE.L3T_PACKAGE_DETAILS (ORGANIZATION_ID);
GO

-------------------------------------------------
-- HOMEPAGE.L3T_PACKAGE_LOCATION
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_PACKAGE_LOCATION (
		PACKAGE_LOCATION_ID VARCHAR(36) NOT NULL,
		POSITION_URL VARCHAR(512) NOT NULL,
		LABS_ID VARCHAR(512) NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_LOCATION ADD CONSTRAINT PK_PACKAGE_LOCATION_ID PRIMARY KEY (PACKAGE_LOCATION_ID);
GO

ALTER TABLE HOMEPAGE.L3T_PACKAGE_LOCATION ADD CONSTRAINT FK_PACKAGE_LOCATION_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX PKG_LOC_ORG_IDX ON HOMEPAGE.L3T_PACKAGE_LOCATION (ORGANIZATION_ID);
GO


-------------------------------------------------
-- HOMEPAGE.L3T_USER_ENTITLEMENTS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS (
		USER_ENTITLEMENTS_ID VARCHAR(36) NOT NULL,
		PACKAGE_ID VARCHAR(36) NOT NULL,
		USER_ID VARCHAR(36) NOT NULL,
		CREATED DATETIME NOT NULL,
		MODIFIED DATETIME NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL		
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS ADD CONSTRAINT PK_USER_ENTITLEMENTS_ID PRIMARY KEY (USER_ENTITLEMENTS_ID);
GO

CREATE UNIQUE INDEX UNQ_USR_ENT_PKG_USR_IDX ON HOMEPAGE.L3T_USER_ENTITLEMENTS  (PACKAGE_ID,  USER_ID);
GO

ALTER TABLE HOMEPAGE.L3T_USER_ENTITLEMENTS ADD CONSTRAINT FK_USR_ENT_PGK_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES 	(PACKAGE_ID);
GO


-------------------------------------------------
-- HOMEPAGE.L3T_USER_PKG_PREFS
-------------------------------------------------
CREATE TABLE HOMEPAGE.L3T_USER_PKG_PREFS (
		USER_PKG_PREFS_ID VARCHAR(36) NOT NULL, 
		PACKAGE_ID VARCHAR(36) NOT NULL,
		USER_ID VARCHAR(36) NOT NULL,
		PREFERENCE VARCHAR(9) NOT NULL,
		CREATED DATETIME NOT NULL,
		MODIFIED DATETIME NOT NULL,
		ORGANIZATION_ID VARCHAR(36) NOT NULL
) ON [PRIMARY]
GO

ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT PK_USER_PKG_PREFS_ID PRIMARY KEY (USER_PKG_PREFS_ID);
GO

CREATE UNIQUE INDEX  USER_PKG_PREF_PKG_USR_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS  (PACKAGE_ID, USER_ID);
GO

ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT FK_USR_PKG_PRF_PKG_ID FOREIGN KEY (PACKAGE_ID) REFERENCES HOMEPAGE.L3T_PACKAGES (PACKAGE_ID);
GO

ALTER TABLE HOMEPAGE.L3T_USER_PKG_PREFS ADD CONSTRAINT FK_USR_PKG_PRF_ORG_ID FOREIGN KEY (ORGANIZATION_ID) REFERENCES HOMEPAGE.L3T_ORGANIZATION (ORGANIZATION_ID);
GO

CREATE INDEX USR_PGK_PFR_PKG_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS (PACKAGE_ID);
CREATE INDEX USR_PKG_PRF_ORG_IDX ON HOMEPAGE.L3T_USER_PKG_PREFS (ORGANIZATION_ID);
GO

